{"code":"!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&n&&\"string\"!=typeof e)for(var i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,\"a\",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p=\"\",t(t.s=81)}([function(e,t,n){\"use strict\";function r(e,t){function n(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?n(e.value):i(e.value).then(o,s)}u((r=r.apply(e,t||[])).next())})}function a(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError(\"Generator is already executing.\");for(;u;)try{if(i=1,a&&(o=2&n[0]?a.return:n[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,a=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(!(o=0<(o=u.trys).length&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],a=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,o,s,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},\"function\"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s}function o(e){var t=\"function\"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&\"number\"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?\"Object is not iterable.\":\"Symbol.iterator is not defined.\")}function s(e,t){var n=\"function\"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e}n.d(t,\"c\",function(){return r}),n.d(t,\"a\",function(){return l}),n.d(t,\"b\",function(){return i}),n.d(t,\"d\",function(){return a}),n.d(t,\"g\",function(){return o}),n.d(t,\"e\",function(){return s}),n.d(t,\"f\",function(){return u});var c=function(e,t){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(e,t){this.query=e,this.parameters=t}},function(e,t,n){\"use strict\";n.d(t,\"d\",function(){return r}),n.d(t,\"f\",function(){return i}),n.d(t,\"e\",function(){return a}),n.d(t,\"g\",function(){return o}),n.d(t,\"i\",function(){return s}),n.d(t,\"a\",function(){return u}),n.d(t,\"c\",function(){return c}),n.d(t,\"h\",function(){return l}),n.d(t,\"j\",function(){return h}),n.d(t,\"b\",function(){return p});var r=function(){},i=function(){},a=function(){},o=function(){},s=function(){},u=function(){},c=function(){},l=function(){},h=function(){},p=function(){}},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return l});var r=n(8),i=n(12),a=n(13),o=n(54),s=n(10),u=n(18),c=n(36),l=function(){function e(e){this.columns=[],this.indices=[],this.foreignKeys=[],this.uniques=[],this.checks=[],this.exclusions=[],this.justCreated=!1,e&&(this.name=e.name,e.columns&&(this.columns=e.columns.map(function(e){return new r.a(e)})),e.indices&&(this.indices=e.indices.map(function(e){return new i.a(e)})),e.foreignKeys&&(this.foreignKeys=e.foreignKeys.map(function(e){return new a.a(e)})),e.uniques&&(this.uniques=e.uniques.map(function(e){return new s.a(e)})),e.checks&&(this.checks=e.checks.map(function(e){return new u.a(e)})),e.exclusions&&(this.exclusions=e.exclusions.map(function(e){return new c.a(e)})),void 0!==e.justCreated&&(this.justCreated=e.justCreated),this.engine=e.engine)}return Object.defineProperty(e.prototype,\"primaryColumns\",{get:function(){return this.columns.filter(function(e){return e.isPrimary})},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e({name:this.name,columns:this.columns.map(function(e){return e.clone()}),indices:this.indices.map(function(e){return e.clone()}),foreignKeys:this.foreignKeys.map(function(e){return e.clone()}),uniques:this.uniques.map(function(e){return e.clone()}),checks:this.checks.map(function(e){return e.clone()}),exclusions:this.exclusions.map(function(e){return e.clone()}),justCreated:this.justCreated,engine:this.engine})},e.prototype.addColumn=function(e){this.columns.push(e)},e.prototype.removeColumn=function(e){var t=this.columns.find(function(t){return t.name===e.name});t&&this.columns.splice(this.columns.indexOf(t),1)},e.prototype.addUniqueConstraint=function(e){if(this.uniques.push(e),1===e.columnNames.length){var t=this.columns.find(function(t){return t.name===e.columnNames[0]});t&&(t.isUnique=!0)}},e.prototype.removeUniqueConstraint=function(e){var t=this.uniques.find(function(t){return t.name===e.name});if(t&&(this.uniques.splice(this.uniques.indexOf(t),1),1===t.columnNames.length)){var n=this.columns.find(function(e){return e.name===t.columnNames[0]});n&&(n.isUnique=!1)}},e.prototype.addCheckConstraint=function(e){this.checks.push(e)},e.prototype.removeCheckConstraint=function(e){var t=this.checks.find(function(t){return t.name===e.name});t&&this.checks.splice(this.checks.indexOf(t),1)},e.prototype.addExclusionConstraint=function(e){this.exclusions.push(e)},e.prototype.removeExclusionConstraint=function(e){var t=this.exclusions.find(function(t){return t.name===e.name});t&&this.exclusions.splice(this.exclusions.indexOf(t),1)},e.prototype.addForeignKey=function(e){this.foreignKeys.push(e)},e.prototype.removeForeignKey=function(e){var t=this.foreignKeys.find(function(t){return t.name===e.name});t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)},e.prototype.addIndex=function(e,t){if(void 0===t&&(t=!1),this.indices.push(e),1===e.columnNames.length&&e.isUnique&&t){var n=this.columns.find(function(t){return t.name===e.columnNames[0]});n&&(n.isUnique=!0)}},e.prototype.removeIndex=function(e,t){void 0===t&&(t=!1);var n=this.indices.find(function(t){return t.name===e.name});if(n&&(this.indices.splice(this.indices.indexOf(n),1),1===n.columnNames.length&&n.isUnique&&t)){var r=this.columns.find(function(e){return e.name===n.columnNames[0]});r&&(r.isUnique=this.indices.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===r.name&&!!n.isUnique}))}},e.prototype.findColumnByName=function(e){return this.columns.find(function(t){return t.name===e})},e.prototype.findColumnIndices=function(e){return this.indices.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.prototype.findColumnForeignKeys=function(e){return this.foreignKeys.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.prototype.findColumnUniques=function(e){return this.uniques.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.prototype.findColumnChecks=function(e){return this.checks.filter(function(t){return!!t.columnNames.find(function(t){return t===e.name})})},e.create=function(t,n){return new e({name:n.buildTableName(t.tableName,t.schema,t.database),engine:t.engine,columns:t.columns.filter(function(e){return e}).map(function(e){return o.a.createTableColumnOptions(e,n)}),indices:t.indices.filter(function(e){return!0===e.synchronize}).map(function(e){return i.a.create(e)}),uniques:t.uniques.map(function(e){return s.a.create(e)}),checks:t.checks.map(function(e){return u.a.create(e)}),exclusions:t.exclusions.map(function(e){return c.a.create(e)})})},e}()},function(e,t,n){\"use strict\";(function(e){n.d(t,\"a\",function(){return i});var r=n(0),i=function(){function t(){}return t.chunk=function(e,t){return Array.from(Array(Math.ceil(e.length/t)),function(n,r){return e.slice(r*t,r*t+t)})},t.splitClassesAndStrings=function(e){return[e.filter(function(e){return\"string\"!=typeof e}),e.filter(function(e){return\"string\"==typeof e})]},t.groupBy=function(e,t){return e.reduce(function(e,n){var r=t(n),i=e.find(function(e){return e.id===r});return i||(i={id:r,items:[]},e.push(i)),i.items.push(n),e},[])},t.uniq=function(e,t){return e.reduce(function(e,n){var r=!1;if(t instanceof Function){var i=t(n);r=!!e.find(function(e){return t(e)===i})}else r=\"string\"==typeof t?!!e.find(function(e){return e[t]===n[t]}):-1!==e.indexOf(n);return r||e.push(n),e},[])},t.isObject=function(e){return e&&\"object\"==typeof e&&!Array.isArray(e)},t.mergeDeep=function(t){for(var n,i,a=[],o=1;o<arguments.length;o++)a[o-1]=arguments[o];if(!a.length)return t;var s=a.shift();if(this.isObject(t)&&this.isObject(s))for(var u in s){var c=s[u];\"__proto__\"==u||c instanceof Promise||(!this.isObject(c)||c instanceof Map||c instanceof Set||c instanceof Date||c instanceof e||c instanceof RegExp?Object.assign(t,((i={})[u]=c,i)):(!t[u]&&Object.assign(t,((n={})[u]=Object.create(Object.getPrototypeOf(c)),n)),this.mergeDeep(t[u],c)))}return this.mergeDeep.apply(this,Object(r.f)([t],a))},t.deepCompare=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n,r,i,a;if(1>arguments.length)return!0;for(n=1,r=arguments.length;n<r;n++)if(i=[],a=[],!this.compare2Objects(i,a,arguments[0],arguments[n]))return!1;return!0},t.compareIds=function(e,n){return null!=e&&null!=n&&((\"string\"==typeof e.id&&\"string\"==typeof n.id||\"number\"==typeof e.id&&\"number\"==typeof n.id)&&1===Object.keys(e).length&&1===Object.keys(n).length?e.id===n.id:t.deepCompare(e,n))},t.toBoolean=function(e){return\"boolean\"==typeof e?e:\"string\"==typeof e?\"true\"==e||\"1\"==e:\"number\"==typeof e&&0<e},t.zipObject=function(e,t){return e.reduce(function(e,n,r){return e[n]=t[r],e},{})},t.isArraysEqual=function(e,t){return e.length===t.length&&e.every(function(e){return-1!==t.indexOf(e)})},t.compare2Objects=function(e,t,n,r){var i,a=Number.isNaN;if(a(n)&&a(r))return!0;if(n===r)return!0;if(null===n||null===r||void 0===n||void 0===r)return!1;if((\"function\"==typeof n.equals||n.equals instanceof Function)&&n.equals(r))return!0;if(\"function\"==typeof n&&\"function\"==typeof r||n instanceof Date&&r instanceof Date||n instanceof RegExp&&r instanceof RegExp||n instanceof String&&r instanceof String||n instanceof Number&&r instanceof Number)return n.toString()===r.toString();if(!(n instanceof Object&&r instanceof Object))return!1;if(n.isPrototypeOf(r)||r.isPrototypeOf(n))return!1;if(n.constructor!==r.constructor)return!1;if(n.prototype!==r.prototype)return!1;if(-1<e.indexOf(n)||-1<t.indexOf(r))return!1;for(i in r){if(r.hasOwnProperty(i)!==n.hasOwnProperty(i))return!1;if(typeof r[i]!=typeof n[i])return!1}for(i in n){if(r.hasOwnProperty(i)!==n.hasOwnProperty(i))return!1;if(typeof r[i]!=typeof n[i])return!1;switch(typeof n[i]){case\"object\":case\"function\":if(e.push(n),t.push(r),!this.compare2Objects(e,t,n[i],r[i]))return!1;e.pop(),t.pop();break;default:if(n[i]!==r[i])return!1}}return!0},t}()}).call(this,n(38).Buffer)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(){function e(){}return e.normalizeHydratedDate=function(e){return e&&\"string\"==typeof e?new Date(e):e},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+\"-\"+this.formatZerolessValue(e.getMonth()+1)+\"-\"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToDate=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var r=\"string\"==typeof e?new Date(e):e;return t&&(r=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())),n||r.setUTCMilliseconds(0),r},e.mixedDateToTimeString=function(e,t){return void 0===t&&(t=!1),e instanceof Date?this.formatZerolessValue(e.getHours())+\":\"+this.formatZerolessValue(e.getMinutes())+(t?\"\":\":\"+this.formatZerolessValue(e.getSeconds())):e},e.mixedTimeToDate=function(e){if(\"string\"==typeof e){var t=Object(r.e)(e.split(\":\"),3),n=t[0],i=t[1],a=t[2],o=new Date;return n&&o.setHours(parseInt(n)),i&&o.setMinutes(parseInt(i)),a&&o.setSeconds(parseInt(a)),o}return e},e.mixedTimeToString=function(e,t){return void 0===t&&(t=!1),\"string\"==typeof(e=e instanceof Date?e.getHours()+\":\"+e.getMinutes()+(t?\"\":\":\"+e.getSeconds()):e)?e.split(\":\").map(function(e){return 1===e.length?\"0\"+e:e}).join(\":\"):e},e.mixedDateToDatetimeString=function(e,t){if(\"string\"==typeof e&&(e=new Date(e)),e instanceof Date){var n=this.formatZerolessValue(e.getFullYear())+\"-\"+this.formatZerolessValue(e.getMonth()+1)+\"-\"+this.formatZerolessValue(e.getDate())+\" \"+this.formatZerolessValue(e.getHours())+\":\"+this.formatZerolessValue(e.getMinutes())+\":\"+this.formatZerolessValue(e.getSeconds());t&&(n+=\".\"+this.formatMilliseconds(e.getMilliseconds())),e=n}return e},e.mixedDateToUtcDatetimeString=function(e){return\"string\"==typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear())+\"-\"+this.formatZerolessValue(e.getUTCMonth()+1)+\"-\"+this.formatZerolessValue(e.getUTCDate())+\" \"+this.formatZerolessValue(e.getUTCHours())+\":\"+this.formatZerolessValue(e.getUTCMinutes())+\":\"+this.formatZerolessValue(e.getUTCSeconds())+\".\"+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.simpleArrayToString=function(e){return Array.isArray(e)?e.map(function(e){return e+\"\"}).join(\",\"):e},e.stringToSimpleArray=function(e){return e instanceof String||\"string\"==typeof e?0<e.length?e.split(\",\"):[]:e},e.simpleJsonToString=function(e){return JSON.stringify(e)},e.stringToSimpleJson=function(e){try{var t=JSON.parse(e);return\"object\"==typeof t?t:{}}catch(e){return{}}},e.simpleEnumToString=function(e){return\"\"+e},e.stringToSimpleEnum=function(e,t){return t.enum&&!isNaN(e)&&0<=t.enum.indexOf(parseInt(e))&&(e=parseInt(e)),e},e.formatZerolessValue=function(e){return 10>e?\"0\"+e:e+\"\"},e.formatMilliseconds=function(e){return 10>e?\"00\"+e:100>e?\"0\"+e:e+\"\"},e}()},function(e,t,n){\"use strict\";(function(e){n.d(t,\"a\",function(){return r});var r=function(){function t(){}return t.getGlobalVariable=function(){return\"undefined\"==typeof window?e:window},t.load=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require(\"'+e+'\").');return\"\"},t.pathNormalize=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize(\"'+e+'\").');return\"\"},t.pathExtname=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname(\"'+e+'\").');return\"\"},t.pathResolve=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve(\"'+e+'\").');return\"\"},t.fileExist=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync(\"'+e+'\").');return!1},t.dotenv=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: dotenv.config({ path: \"'+e+'\" }).')},t.getEnvVariable=function(){},t.readFileSync=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.readFileSync(\"'+e+'\").');return null},t.appendFileSync=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync(\"'+e+'\").')},t.writeFile=function(e){if(\"browser\"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.writeFile(\"'+e+'\").');return Promise.reject(null)},t.highlightSql=function(e){return e},t.highlightJson=function(e){return e},t.logInfo=function(e,t){console.info(e+\" \",t)},t.logError=function(e,t){console.error(e+\" \",t)},t.logWarn=function(e,t){console.warn(e+\" \",t)},t.log=function(e){console.log(e)},t.warn=function(e){return e},t.type=\"browser\",t}();\"undefined\"!=typeof window&&(window.Buffer=n(38).Buffer),void 0!==e&&(e.Buffer=n(38).Buffer)}).call(this,n(64))},function(e,t,n){\"use strict\";(function(e){n.d(t,\"a\",function(){return m});var r=n(0),i=n(60),a=n(29),o=n(16),s=n(74),u=n(5),c=n(6),l=n(44),h=n(19),p=n(8),d=n(4),f=n(23),m=function(){function t(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=[\"int\",\"bigint\",\"bit\",\"decimal\",\"money\",\"numeric\",\"smallint\",\"smallmoney\",\"tinyint\",\"float\",\"real\",\"date\",\"datetime2\",\"datetime\",\"datetimeoffset\",\"smalldatetime\",\"time\",\"char\",\"varchar\",\"text\",\"nchar\",\"nvarchar\",\"ntext\",\"binary\",\"image\",\"varbinary\",\"hierarchyid\",\"sql_variant\",\"timestamp\",\"uniqueidentifier\",\"xml\",\"geometry\",\"geography\",\"rowversion\"],this.spatialTypes=[\"geometry\",\"geography\"],this.withLengthColumnTypes=[\"char\",\"varchar\",\"nchar\",\"nvarchar\",\"binary\",\"varbinary\"],this.withPrecisionColumnTypes=[\"decimal\",\"numeric\",\"time\",\"datetime2\",\"datetimeoffset\"],this.withScaleColumnTypes=[\"decimal\",\"numeric\"],this.mappedDataTypes={createDate:\"datetime2\",createDateDefault:\"getdate()\",updateDate:\"datetime2\",updateDateDefault:\"getdate()\",deleteDate:\"datetime2\",deleteDateNullable:!0,version:\"int\",treeLevel:\"int\",migrationId:\"int\",migrationName:\"varchar\",migrationTimestamp:\"bigint\",cacheId:\"int\",cacheIdentifier:\"nvarchar\",cacheTime:\"bigint\",cacheDuration:\"int\",cacheQuery:\"nvarchar(MAX)\",cacheResult:\"nvarchar(MAX)\",metadataType:\"varchar\",metadataDatabase:\"varchar\",metadataSchema:\"varchar\",metadataTable:\"varchar\",metadataName:\"varchar\",metadataValue:\"nvarchar(MAX)\"},this.dataTypeDefaults={char:{length:1},nchar:{length:1},varchar:{length:255},nvarchar:{length:255},binary:{length:1},varbinary:{length:1},decimal:{precision:18,scale:0},numeric:{precision:18,scale:0},time:{precision:7},datetime2:{precision:7},datetimeoffset:{precision:7}},this.maxAliasLength=128,this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return t.prototype.connect=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return i.createPool(i.options,e)}))]):[3,3];case 1:return e.slaves=r.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=r.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=r.sent(),this.database=this.options.database,r.label=5;case 5:return[2]}})})},t.prototype.afterConnect=function(){return Promise.resolve()},t.prototype.disconnect=function(){return Object(r.b)(this,void 0,void 0,function(){var e=this;return Object(r.d)(this,function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new i.a(\"mssql\"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map(function(t){return e.closePool(t)}))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}})})},t.prototype.closePool=function(e){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,new Promise(function(t,n){e.close(function(e){return e?n(e):t()})})]})})},t.prototype.createSchemaBuilder=function(){return new l.a(this.connection)},t.prototype.createQueryRunner=function(e){return new s.a(this,e)},t.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return\"(:(\\\\.\\\\.\\\\.)?\"+e+\"\\\\b)\"}).join(\"|\");return[e=e.replace(new RegExp(i,\"g\"),function(e){var n,i=!1;return\":...\"===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map(function(e){return r.push(e),\"@\"+(r.length-1)}).join(\", \"):n instanceof Function?n():(r.push(n),\"@\"+(r.length-1))}),r]},t.prototype.escape=function(e){return'\"'+e+'\"'},t.prototype.buildTableName=function(e,t,n){var r=e;return t&&(r=t+\".\"+e),n&&(r=t?n+\".\"+r:n+\"..\"+e),r},t.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=f.a.transformTo(t.transformer,e)),null==e?e:t.type===Boolean?!0===e?1:0:\"date\"===t.type?u.a.mixedDateToDate(e):\"time\"===t.type?u.a.mixedTimeToDate(e):\"datetime\"===t.type||\"smalldatetime\"===t.type||t.type===Date?u.a.mixedDateToDate(e,!1,!1):\"datetime2\"===t.type||\"datetimeoffset\"===t.type?u.a.mixedDateToDate(e,!1,!0):\"simple-array\"===t.type?u.a.simpleArrayToString(e):\"simple-json\"===t.type?u.a.simpleJsonToString(e):\"simple-enum\"===t.type?u.a.simpleEnumToString(e):e},t.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?f.a.transformFrom(t.transformer,e):e:(t.type===Boolean?e=!!e:\"datetime\"===t.type||t.type===Date||\"datetime2\"===t.type||\"smalldatetime\"===t.type||\"datetimeoffset\"===t.type?e=u.a.normalizeHydratedDate(e):\"date\"===t.type?e=u.a.mixedDateToDateString(e):\"time\"===t.type?e=u.a.mixedTimeToString(e):\"simple-array\"===t.type?e=u.a.stringToSimpleArray(e):\"simple-json\"===t.type?e=u.a.stringToSimpleJson(e):\"simple-enum\"===t.type&&(e=u.a.stringToSimpleEnum(e,t)),t.transformer&&(e=f.a.transformFrom(t.transformer,e)),e)},t.prototype.normalizeType=function(t){return t.type===Number||\"integer\"===t.type?\"int\":t.type===String?\"nvarchar\":t.type===Date?\"datetime\":t.type===Boolean?\"bit\":t.type===e?\"binary\":\"uuid\"===t.type?\"uniqueidentifier\":\"simple-array\"===t.type||\"simple-json\"===t.type?\"ntext\":\"simple-enum\"===t.type?\"nvarchar\":\"dec\"===t.type?\"decimal\":\"double precision\"===t.type?\"float\":\"rowversion\"===t.type?\"timestamp\":t.type||\"\"},t.prototype.normalizeDefault=function(e){var t=e.default;return\"number\"==typeof t?\"\"+t:\"boolean\"==typeof t?!0===t?\"1\":\"0\":\"function\"==typeof t?t():\"string\"==typeof t?\"'\"+t+\"'\":t},t.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some(function(t){return 1===t.columns.length&&t.columns[0]===e})},t.prototype.getColumnLength=function(e){return e.length?e.length.toString():\"varchar\"===e.type||\"nvarchar\"===e.type||e.type===String?\"255\":\"\"},t.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+=\"(\"+this.getColumnLength(e)+\")\":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+=\"(\"+e.precision+\",\"+e.scale+\")\":null!==e.precision&&void 0!==e.precision&&(t+=\"(\"+e.precision+\")\"),e.isArray&&(t+=\" array\"),t},t.prototype.obtainMasterConnection=function(){return Promise.resolve(this.master)},t.prototype.obtainSlaveConnection=function(){if(!this.slaves.length)return this.obtainMasterConnection();var e=Math.floor(Math.random()*this.slaves.length);return Promise.resolve(this.slaves[e])},t.prototype.createGeneratedMap=function(e,t){var n=this;return t?Object.keys(t).reduce(function(r,i){var a=e.findColumnWithDatabaseName(i);return a&&d.a.mergeDeep(r,a.createValueMap(n.prepareHydratedValue(t[i],a))),r},{}):void 0},t.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||!r.isGenerated&&n.lowerDefaultValueIfNessesary(n.normalizeDefault(t))!==n.lowerDefaultValueIfNessesary(r.default)||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||r.isGenerated!==t.isGenerated)})},t.prototype.lowerDefaultValueIfNessesary=function(e){return e?e.split(\"'\").map(function(e,t){return 1==t%2?e:e.toLowerCase()}).join(\"'\"):e},t.prototype.isReturningSqlSupported=function(){return!this.options.options||!this.options.options.disableOutputReturning},t.prototype.isUUIDGenerationSupported=function(){return!0},t.prototype.isFullTextColumnTypeSupported=function(){return!1},t.prototype.createParameter=function(e,t){return\"@\"+t},t.prototype.parametrizeValue=function(e,t){if(t instanceof h.a)return t;var n=this.normalizeType({type:e.type});return e.length?new h.a(t,n,e.length):null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?new h.a(t,n,e.precision,e.scale):null!==e.precision&&void 0!==e.precision?new h.a(t,n,e.precision):null!==e.scale&&void 0!==e.scale?new h.a(t,n,e.scale):new h.a(t,n)},t.prototype.parametrizeMap=function(e,t){var n=this;if(!this.connection.hasMetadata(e))return t;var r=this.connection.getMetadata(e);return Object.keys(t).reduce(function(e,i){var a=t[i],o=r.findColumnWithDatabaseName(i);return o?(e[i]=n.parametrizeValue(o,a),e):a},{})},t.prototype.buildTableVariableDeclaration=function(e,t){var n=this;return\"DECLARE \"+e+\" TABLE (\"+t.map(function(e){return n.escape(e.databaseName)+\" \"+n.createFullType(new p.a({name:e.databaseName,type:n.normalizeType(e),length:e.length,isNullable:e.isNullable,isArray:e.isArray}))}).join(\", \")+\")\"},t.prototype.loadDependencies=function(){try{this.mssql=c.a.load(\"mssql\")}catch(e){throw new a.a(\"SQL Server\",\"mssql\")}},t.prototype.createPool=function(e,t){var n=this;t=Object.assign({},t,o.a.buildDriverOptions(t));var r=Object.assign({},{connectionTimeout:this.options.connectionTimeout,requestTimeout:this.options.requestTimeout,stream:this.options.stream,pool:this.options.pool,options:this.options.options},{server:t.host,user:t.username,password:t.password,database:t.database,port:t.port,domain:t.domain},e.extra||{});return r.options?!r.options.useUTC&&(r.options.useUTC=!1):r.options={useUTC:!1},new Promise(function(t,i){var a=new n.mssql.ConnectionPool(r),o=n.connection.logger,s=e.pool&&e.pool.errorHandler||function(e){return o.log(\"warn\",\"MSSQL pool raised an error. \"+e)};a.on(\"error\",s);var u=a.connect(function(e){return e?i(e):void t(u)})})},t}()}).call(this,n(38).Buffer)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){function e(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length=\"\",this.zerofill=!1,this.unsigned=!1,e&&(this.name=e.name,this.type=e.type||\"\",this.length=e.length||\"\",this.width=e.width,this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.zerofill=e.zerofill||!1,this.unsigned=!!this.zerofill||e.unsigned||!1,this.default=e.default,this.onUpdate=e.onUpdate,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.isArray=e.isArray||!1,this.comment=e.comment,this.enum=e.enum,this.enumName=e.enumName,this.asExpression=e.asExpression,this.generatedType=e.generatedType,this.spatialFeatureType=e.spatialFeatureType,this.srid=e.srid)}return e.prototype.clone=function(){return new e({name:this.name,type:this.type,length:this.length,width:this.width,charset:this.charset,collation:this.collation,precision:this.precision,scale:this.scale,zerofill:this.zerofill,unsigned:this.unsigned,enum:this.enum,enumName:this.enumName,asExpression:this.asExpression,generatedType:this.generatedType,default:this.default,onUpdate:this.onUpdate,isNullable:this.isNullable,isGenerated:this.isGenerated,generationStrategy:this.generationStrategy,isPrimary:this.isPrimary,isUnique:this.isUnique,isArray:this.isArray,comment:this.comment,spatialFeatureType:this.spatialFeatureType,srid:this.srid})},e}()},function(e,t,n){\"use strict\";(function(e){n.d(t,\"a\",function(){return d});var r=n(0),i=n(60),a=n(29),o=n(76),s=n(5),u=n(6),c=n(44),l=n(16),h=n(4),p=n(23),d=function(){function t(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=[\"char\",\"nchar\",\"nvarchar2\",\"varchar2\",\"long\",\"raw\",\"long raw\",\"number\",\"numeric\",\"float\",\"dec\",\"decimal\",\"integer\",\"int\",\"smallint\",\"real\",\"double precision\",\"date\",\"timestamp\",\"timestamp with time zone\",\"timestamp with local time zone\",\"interval year to month\",\"interval day to second\",\"bfile\",\"blob\",\"clob\",\"nclob\",\"rowid\",\"urowid\"],this.spatialTypes=[],this.withLengthColumnTypes=[\"char\",\"nchar\",\"nvarchar2\",\"varchar2\",\"varchar\",\"raw\"],this.withPrecisionColumnTypes=[\"number\",\"float\",\"timestamp\",\"timestamp with time zone\",\"timestamp with local time zone\"],this.withScaleColumnTypes=[\"number\"],this.mappedDataTypes={createDate:\"timestamp\",createDateDefault:\"CURRENT_TIMESTAMP\",updateDate:\"timestamp\",updateDateDefault:\"CURRENT_TIMESTAMP\",deleteDate:\"timestamp\",deleteDateNullable:!0,version:\"number\",treeLevel:\"number\",migrationId:\"number\",migrationName:\"varchar2\",migrationTimestamp:\"number\",cacheId:\"number\",cacheIdentifier:\"varchar2\",cacheTime:\"number\",cacheDuration:\"number\",cacheQuery:\"clob\",cacheResult:\"clob\",metadataType:\"varchar2\",metadataDatabase:\"varchar2\",metadataSchema:\"varchar2\",metadataTable:\"varchar2\",metadataName:\"varchar2\",metadataValue:\"clob\"},this.dataTypeDefaults={char:{length:1},nchar:{length:1},varchar:{length:255},varchar2:{length:255},nvarchar2:{length:255},raw:{length:2e3},float:{precision:126},timestamp:{precision:6},\"timestamp with time zone\":{precision:6},\"timestamp with local time zone\":{precision:6}},this.maxAliasLength=30,this.connection=e,this.options=e.options,this.loadDependencies(),this.oracle.outFormat=this.oracle.OBJECT}return t.prototype.connect=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return this.oracle.fetchAsString=[this.oracle.CLOB],this.oracle.fetchAsBuffer=[this.oracle.BLOB],this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map(function(e){return i.createPool(i.options,e)}))]):[3,3];case 1:return e.slaves=r.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=r.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=r.sent(),this.database=this.options.database,r.label=5;case 5:return[2]}})})},t.prototype.afterConnect=function(){return Promise.resolve()},t.prototype.disconnect=function(){return Object(r.b)(this,void 0,void 0,function(){var e=this;return Object(r.d)(this,function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new i.a(\"oracle\"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map(function(t){return e.closePool(t)}))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}})})},t.prototype.createSchemaBuilder=function(){return new c.a(this.connection)},t.prototype.createQueryRunner=function(e){return new o.a(this,e)},t.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return\"boolean\"==typeof n[e]?n[e]?1:0:n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return\"(:(\\\\.\\\\.\\\\.)?\"+e+\"\\\\b)\"}).join(\"|\");return[e=e.replace(new RegExp(i,\"g\"),function(e){var n,i=!1;return\":...\"===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map(function(t,n){return r.push(t),\":\"+e.substr(4)+n}).join(\", \"):n instanceof Function?n():\"boolean\"==typeof n?n?1:0:(r.push(n),e)}),r]},t.prototype.escape=function(e){return'\"'+e+'\"'},t.prototype.buildTableName=function(e){return e},t.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=p.a.transformTo(t.transformer,e)),null==e?e:t.type===Boolean?e?1:0:\"date\"===t.type?(\"string\"==typeof e&&(e=e.replace(/[^0-9-]/g,\"\")),function(){return\"TO_DATE('\"+s.a.mixedDateToDateString(e)+\"', 'YYYY-MM-DD')\"}):t.type===Date||\"timestamp\"===t.type||\"timestamp with time zone\"===t.type||\"timestamp with local time zone\"===t.type?s.a.mixedDateToDate(e):\"simple-array\"===t.type?s.a.simpleArrayToString(e):\"simple-json\"===t.type?s.a.simpleJsonToString(e):e},t.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?p.a.transformFrom(t.transformer,e):e:(t.type===Boolean?e=!!e:\"date\"===t.type?e=s.a.mixedDateToDateString(e):\"time\"===t.type?e=s.a.mixedTimeToString(e):t.type===Date||\"timestamp\"===t.type||\"timestamp with time zone\"===t.type||\"timestamp with local time zone\"===t.type?e=s.a.normalizeHydratedDate(e):\"json\"===t.type?e=JSON.parse(e):\"simple-array\"===t.type?e=s.a.stringToSimpleArray(e):\"simple-json\"===t.type&&(e=s.a.stringToSimpleJson(e)),t.transformer&&(e=p.a.transformFrom(t.transformer,e)),e)},t.prototype.normalizeType=function(t){return t.type===Number||t.type===Boolean||\"numeric\"===t.type||\"dec\"===t.type||\"decimal\"===t.type||\"int\"===t.type||\"integer\"===t.type||\"smallint\"===t.type?\"number\":\"real\"===t.type||\"double precision\"===t.type?\"float\":t.type===String||\"varchar\"===t.type?\"varchar2\":t.type===Date?\"timestamp\":t.type===e?\"blob\":\"uuid\"===t.type?\"varchar2\":\"simple-array\"===t.type?\"clob\":\"simple-json\"===t.type?\"clob\":t.type||\"\"},t.prototype.normalizeDefault=function(e){var t=e.default;return\"number\"==typeof t?\"\"+t:\"boolean\"==typeof t?!0===t?\"1\":\"0\":\"function\"==typeof t?t():\"string\"==typeof t?\"'\"+t+\"'\":t},t.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some(function(t){return 1===t.columns.length&&t.columns[0]===e})},t.prototype.getColumnLength=function(e){if(e.length)return e.length.toString();switch(e.type){case String:case\"varchar\":case\"varchar2\":case\"nvarchar2\":return\"255\";case\"raw\":return\"2000\";case\"uuid\":return\"36\";default:return\"\"}},t.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+=\"(\"+this.getColumnLength(e)+\")\":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+=\"(\"+e.precision+\",\"+e.scale+\")\":null!==e.precision&&void 0!==e.precision&&(t+=\"(\"+e.precision+\")\"),\"timestamp with time zone\"===e.type?t=\"TIMESTAMP\"+(null!==e.precision&&void 0!==e.precision?\"(\"+e.precision+\")\":\"\")+\" WITH TIME ZONE\":\"timestamp with local time zone\"===e.type&&(t=\"TIMESTAMP\"+(null!==e.precision&&void 0!==e.precision?\"(\"+e.precision+\")\":\"\")+\" WITH LOCAL TIME ZONE\"),e.isArray&&(t+=\" array\"),t},t.prototype.obtainMasterConnection=function(){var e=this;return new Promise(function(t,n){e.master.getConnection(function(e,r){return e?n(e):void t(r)})})},t.prototype.obtainSlaveConnection=function(){var e=this;return this.slaves.length?new Promise(function(t,n){var r=Math.floor(Math.random()*e.slaves.length);e.slaves[r].getConnection(function(e,r){return e?n(e):void t(r)})}):this.obtainMasterConnection()},t.prototype.createGeneratedMap=function(e,t){var n=this;return t?Object.keys(t).reduce(function(r,i){var a=e.findColumnWithDatabaseName(i);return a&&h.a.mergeDeep(r,a.createValueMap(n.prepareHydratedValue(t[i],a))),r},{}):void 0},t.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||n.normalizeDefault(t)!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||\"uuid\"!==t.generationStrategy&&r.isGenerated!==t.isGenerated)})},t.prototype.isReturningSqlSupported=function(){return!0},t.prototype.isUUIDGenerationSupported=function(){return!1},t.prototype.isFullTextColumnTypeSupported=function(){return!1},t.prototype.createParameter=function(e,t){return\":\"+(t+1)},t.prototype.columnTypeToNativeParameter=function(e){switch(this.normalizeType({type:e})){case\"number\":case\"numeric\":case\"int\":case\"integer\":case\"smallint\":case\"dec\":case\"decimal\":return this.oracle.NUMBER;case\"char\":case\"nchar\":case\"nvarchar2\":case\"varchar2\":return this.oracle.STRING;case\"blob\":return this.oracle.BLOB;case\"clob\":return this.oracle.CLOB;case\"date\":case\"timestamp\":case\"timestamp with time zone\":case\"timestamp with local time zone\":return this.oracle.DATE}},t.prototype.loadDependencies=function(){try{this.oracle=u.a.load(\"oracledb\")}catch(e){throw new a.a(\"Oracle\",\"oracledb\")}},t.prototype.createPool=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(){return t=Object.assign({},t,l.a.buildDriverOptions(t)),n=Object.assign({},{user:t.username,password:t.password,connectString:t.connectString?t.connectString:t.host+\":\"+t.port+\"/\"+t.sid},e.extra||{}),[2,new Promise(function(e,t){i.oracle.createPool(n,function(n,r){return n?t(n):void e(r)})})]})})},t.prototype.closePool=function(e){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,new Promise(function(t,n){e.close(function(e){return e?n(e):t()}),e=void 0})]})})},t}()}).call(this,n(38).Buffer)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames}return e.prototype.clone=function(){return new e({name:this.name,columnNames:Object(r.f)(this.columnNames)})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map(function(e){return e.databaseName})})},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){function e(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=!1),this._type=e,this._value=t,this._useParameter=n,this._multipleParameters=r}return Object.defineProperty(e.prototype,\"useParameter\",{get:function(){return this._value instanceof e?this._value.useParameter:this._useParameter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"multipleParameters\",{get:function(){return this._value instanceof e?this._value.multipleParameters:this._multipleParameters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"type\",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"value\",{get:function(){return this._value instanceof e?this._value.value:this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"child\",{get:function(){return this._value instanceof e?this._value:void 0},enumerable:!0,configurable:!0}),e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.isUnique=!!e.isUnique,this.isSpatial=!!e.isSpatial,this.isFulltext=!!e.isFulltext,this.parser=e.parser,this.where=e.where?e.where:\"\"}return e.prototype.clone=function(){return new e({name:this.name,columnNames:Object(r.f)(this.columnNames),isUnique:this.isUnique,isSpatial:this.isSpatial,isFulltext:this.isFulltext,parser:this.parser,where:this.where})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map(function(e){return e.databaseName}),isUnique:t.isUnique,isSpatial:t.isSpatial,isFulltext:t.isFulltext,parser:t.parser,where:t.where})},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(){function e(e){this.columnNames=[],this.referencedColumnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.referencedColumnNames=e.referencedColumnNames,this.referencedTableName=e.referencedTableName,this.onDelete=e.onDelete,this.onUpdate=e.onUpdate,this.deferrable=e.deferrable}return e.prototype.clone=function(){return new e({name:this.name,columnNames:Object(r.f)(this.columnNames),referencedColumnNames:Object(r.f)(this.referencedColumnNames),referencedTableName:this.referencedTableName,onDelete:this.onDelete,onUpdate:this.onUpdate,deferrable:this.deferrable})},e.create=function(t){return new e({name:t.name,columnNames:t.columnNames,referencedColumnNames:t.referencedColumnNames,referencedTableName:t.referencedTablePath,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable})},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name=\"QueryRunnerAlreadyReleasedError\",Object.setPrototypeOf(n,t.prototype),n.message=\"Query runner already released. Cannot run queries anymore.\",n}return Object(r.c)(t,e),t}(Error)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return u});var r=n(0),i=n(5),a=n(44),o=n(4),s=n(23),u=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=[\"int\",\"integer\",\"tinyint\",\"smallint\",\"mediumint\",\"bigint\",\"unsigned big int\",\"int2\",\"int8\",\"integer\",\"character\",\"varchar\",\"varying character\",\"nchar\",\"native character\",\"nvarchar\",\"text\",\"clob\",\"text\",\"blob\",\"real\",\"double\",\"double precision\",\"float\",\"real\",\"numeric\",\"decimal\",\"boolean\",\"date\",\"time\",\"datetime\"],this.withLengthColumnTypes=[\"character\",\"varchar\",\"varying character\",\"nchar\",\"native character\",\"nvarchar\",\"text\",\"blob\",\"clob\"],this.spatialTypes=[],this.withPrecisionColumnTypes=[\"real\",\"double\",\"double precision\",\"float\",\"real\",\"numeric\",\"decimal\",\"date\",\"time\",\"datetime\"],this.withScaleColumnTypes=[\"real\",\"double\",\"double precision\",\"float\",\"real\",\"numeric\",\"decimal\"],this.mappedDataTypes={createDate:\"datetime\",createDateDefault:\"datetime('now')\",updateDate:\"datetime\",updateDateDefault:\"datetime('now')\",deleteDate:\"datetime\",deleteDateNullable:!0,version:\"integer\",treeLevel:\"integer\",migrationId:\"integer\",migrationName:\"varchar\",migrationTimestamp:\"bigint\",cacheId:\"int\",cacheIdentifier:\"varchar\",cacheTime:\"bigint\",cacheDuration:\"int\",cacheQuery:\"text\",cacheResult:\"text\",metadataType:\"varchar\",metadataDatabase:\"varchar\",metadataSchema:\"varchar\",metadataTable:\"varchar\",metadataName:\"varchar\",metadataValue:\"text\"},this.connection=e,this.options=e.options}return e.prototype.connect=function(){return Object(r.b)(this,void 0,void 0,function(){var e;return Object(r.d)(this,function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}})})},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return Object(r.b)(this,void 0,void 0,function(){var e=this;return Object(r.d)(this,function(){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(function(e){return e?n(e):t()})})]})})},e.prototype.createSchemaBuilder=function(){return new a.a(this.connection)},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=s.a.transformTo(t.transformer,e)),null==e?e:t.type===Boolean||\"boolean\"===t.type?!0===e?1:0:\"date\"===t.type?i.a.mixedDateToDateString(e):\"time\"===t.type?i.a.mixedDateToTimeString(e):\"datetime\"===t.type||t.type===Date?i.a.mixedDateToUtcDatetimeString(e):\"simple-array\"===t.type?i.a.simpleArrayToString(e):\"simple-json\"===t.type?i.a.simpleJsonToString(e):\"simple-enum\"===t.type?i.a.simpleEnumToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?s.a.transformFrom(t.transformer,e):e:(t.type===Boolean||\"boolean\"===t.type?e=!!e:\"datetime\"===t.type||t.type===Date?(e&&\"string\"==typeof e&&(/^\\d\\d\\d\\d-\\d\\d-\\d\\d \\d\\d:\\d\\d/.test(e)&&(e=e.replace(\" \",\"T\")),/^\\d\\d\\d\\d-\\d\\d-\\d\\dT\\d\\d:\\d\\d(:\\d\\d(\\.\\d\\d\\d)?)?$/.test(e)&&(e+=\"Z\")),e=i.a.normalizeHydratedDate(e)):\"date\"===t.type?e=i.a.mixedDateToDateString(e):\"time\"===t.type?e=i.a.mixedTimeToString(e):\"simple-array\"===t.type?e=i.a.stringToSimpleArray(e):\"simple-json\"===t.type?e=i.a.stringToSimpleJson(e):\"simple-enum\"===t.type&&(e=i.a.stringToSimpleEnum(e,t)),t.transformer&&(e=s.a.transformFrom(t.transformer,e)),e)},e.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return\"boolean\"==typeof n[e]?!0===n[e]?1:0:n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return\"(:(\\\\.\\\\.\\\\.)?\"+e+\"\\\\b)\"}).join(\"|\");return[e=e.replace(new RegExp(i,\"g\"),function(e){var n,i=!1;return\":...\"===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map(function(e){return r.push(e),\"?\"}).join(\", \"):n instanceof Function?n():(r.push(n),\"?\")}),r]},e.prototype.escape=function(e){return'\"'+e+'\"'},e.prototype.buildTableName=function(e){return e},e.prototype.normalizeType=function(e){return e.type===Number||\"int\"===e.type?\"integer\":e.type===String?\"varchar\":e.type===Date?\"datetime\":e.type===Boolean?\"boolean\":\"uuid\"===e.type?\"varchar\":\"simple-array\"===e.type?\"text\":\"simple-json\"===e.type?\"text\":\"simple-enum\"===e.type?\"varchar\":e.type||\"\"},e.prototype.normalizeDefault=function(e){var t=e.default;return\"number\"==typeof t?\"\"+t:\"boolean\"==typeof t?!0===t?\"1\":\"0\":\"function\"==typeof t?t():\"string\"==typeof t?\"'\"+t+\"'\":t},e.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some(function(t){return 1===t.columns.length&&t.columns[0]===e})},e.prototype.getColumnLength=function(e){return e.length?e.length.toString():\"\"},e.prototype.createFullType=function(e){var t=e.type;return e.enum?\"varchar\":(e.length?t+=\"(\"+e.length+\")\":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+=\"(\"+e.precision+\",\"+e.scale+\")\":null!==e.precision&&void 0!==e.precision&&(t+=\"(\"+e.precision+\")\"),e.isArray&&(t+=\" array\"),t)},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.createGeneratedMap=function(e,t,n,r){var i=e.generatedColumns.reduce(function(e,i){var a;return\"increment\"===i.generationStrategy&&t&&(a=t-r+n+1),a?o.a.mergeDeep(e,i.createValueMap(a)):e},{});return 0<Object.keys(i).length?i:void 0},e.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||n.normalizeDefault(t)!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||\"uuid\"!==t.generationStrategy&&r.isGenerated!==t.isGenerated)})},e.prototype.isReturningSqlSupported=function(){return!1},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.isFullTextColumnTypeSupported=function(){return!1},e.prototype.createParameter=function(){return\"?\"},e.prototype.createDatabaseConnection=function(){throw new Error(\"Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers\")},e.prototype.loadDependencies=function(){},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return a});var r=n(0),i=n(34),a=function(){function e(){}return e.buildDriverOptions=function(e,t){if(e.url){var n=this.parseConnectionUrl(e.url),r={type:n.type,host:n.host,username:n.username,password:n.password,port:n.port,database:n.database};return t&&t.useSid&&(r.sid=n.database),Object.assign({},e,r)}return Object.assign({},e)},e.buildColumnAlias=function(e,t,n){var r=e.maxAliasLength,a=t+\"_\"+n;return r&&0<r&&a.length>r?Object(i.b)(a,{length:r}):a},e.parseConnectionUrl=function(e){var t=e.split(\":\")[0],n=e.indexOf(\"//\"),i=e.substr(n+2),a=i.indexOf(\"/\"),o=-1===a?i:i.substr(0,a),s=-1===a?void 0:i.substr(a+1);s&&-1!==s.indexOf(\"?\")&&(s=s.substr(0,s.indexOf(\"?\")));var u=o.lastIndexOf(\"@\"),c=o.substr(0,u),l=o.substr(u+1),h=c,p=\"\",d=c.indexOf(\":\");-1!==d&&(h=c.substr(0,d),p=c.substr(d+1));var f=Object(r.e)(l.split(\":\"),2),m=f[0],y=f[1];return{type:t,host:m,username:decodeURIComponent(h),password:decodeURIComponent(p),port:y?parseInt(y):void 0,database:s||void 0}},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){function e(e){e&&(this.name=e.name,this.expression=e.expression,this.materialized=!!e.materialized)}return e.prototype.clone=function(){return new e({name:this.name,expression:this.expression,materialized:this.materialized})},e.create=function(t,n){return new e({name:n.buildTableName(t.tableName,t.schema,t.database),expression:t.expression,materialized:t.tableMetadataArgs.materialized})},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,columnNames:this.columnNames?Object(r.f)(this.columnNames):[],expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];this.value=e,this.type=t,this.params=[],this.params=n}},function(e,t,n){\"use strict\";(function(e){n.d(t,\"a\",function(){return h});var r=n(0),i=n(29),a=n(6),o=n(44),s=n(23),u=n(5),c=n(4),l=n(75),h=function(){function t(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=[\"tinyint\",\"smallint\",\"int\",\"integer\",\"bigint\",\"smalldecimal\",\"decimal\",\"dec\",\"real\",\"double\",\"float\",\"date\",\"time\",\"seconddate\",\"timestamp\",\"boolean\",\"char\",\"nchar\",\"varchar\",\"nvarchar\",\"text\",\"alphanum\",\"shorttext\",\"array\",\"varbinary\",\"blob\",\"clob\",\"nclob\",\"st_geometry\",\"st_point\"],this.spatialTypes=[\"st_geometry\",\"st_point\"],this.withLengthColumnTypes=[\"varchar\",\"nvarchar\",\"alphanum\",\"shorttext\",\"varbinary\"],this.withPrecisionColumnTypes=[\"decimal\"],this.withScaleColumnTypes=[\"decimal\"],this.mappedDataTypes={createDate:\"timestamp\",createDateDefault:\"CURRENT_TIMESTAMP\",updateDate:\"timestamp\",updateDateDefault:\"CURRENT_TIMESTAMP\",deleteDate:\"timestamp\",deleteDateNullable:!0,version:\"integer\",treeLevel:\"integer\",migrationId:\"integer\",migrationName:\"nvarchar\",migrationTimestamp:\"bigint\",cacheId:\"integer\",cacheIdentifier:\"nvarchar\",cacheTime:\"bigint\",cacheDuration:\"integer\",cacheQuery:\"nvarchar(5000)\",cacheResult:\"text\",metadataType:\"nvarchar\",metadataDatabase:\"nvarchar\",metadataSchema:\"nvarchar\",metadataTable:\"nvarchar\",metadataName:\"nvarchar\",metadataValue:\"nvarchar(5000)\"},this.dataTypeDefaults={char:{length:1},nchar:{length:1},varchar:{length:255},nvarchar:{length:255},shorttext:{length:255},varbinary:{length:255},decimal:{precision:18,scale:0}},this.maxAliasLength=128,this.connection=e,this.options=e.options,this.loadDependencies()}return t.prototype.connect=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i;return Object(r.d)(this,function(){return e=Object(r.a)({hostName:this.options.host,port:this.options.port,userName:this.options.username,password:this.options.password},this.options.extra),this.options.database&&(e.databaseName=this.options.database),this.options.encrypt&&(e.encrypt=this.options.encrypt),this.options.sslValidateCertificate&&(e.validateCertificate=this.options.sslValidateCertificate),this.options.key&&(e.key=this.options.key),this.options.cert&&(e.cert=this.options.cert),this.options.ca&&(e.ca=this.options.ca),t={min:this.options.pool&&this.options.pool.min?this.options.pool.min:1,max:this.options.pool&&this.options.pool.max?this.options.pool.max:10},this.options.pool&&this.options.pool.checkInterval&&(t.checkInterval=this.options.pool.checkInterval),this.options.pool&&this.options.pool.maxWaitingRequests&&(t.maxWaitingRequests=this.options.pool.maxWaitingRequests),this.options.pool&&this.options.pool.requestTimeout&&(t.requestTimeout=this.options.pool.requestTimeout),this.options.pool&&this.options.pool.idleTimeout&&(t.idleTimeout=this.options.pool.idleTimeout),n=this.connection.logger,i=t.poolErrorHandler||function(e){return n.log(\"warn\",\"SAP Hana pool raised an error. \"+e)},this.client.eventEmitter.on(\"poolError\",i),this.master=this.client.createPool(e,t),this.database=this.options.database,[2]})})},t.prototype.afterConnect=function(){return Promise.resolve()},t.prototype.disconnect=function(){return Object(r.b)(this,void 0,void 0,function(){var e;return Object(r.d)(this,function(){return e=this.master.clear(),this.master=void 0,[2,e]})})},t.prototype.createSchemaBuilder=function(){return new o.a(this.connection)},t.prototype.createQueryRunner=function(e){return new l.a(this,e)},t.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map(function(e){return n[e]instanceof Date?u.a.mixedDateToDatetimeString(n[e],!0):n[e]});if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map(function(e){return\"(:(\\\\.\\\\.\\\\.)?\"+e+\"\\\\b)\"}).join(\"|\");return[e=e.replace(new RegExp(i,\"g\"),function(e){var n,i=!1;return\":...\"===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map(function(e){return r.push(e),\"?\"}).join(\", \"):n instanceof Function?n():n instanceof Date?u.a.mixedDateToDatetimeString(n,!0):(r.push(n),\"?\")}),r]},t.prototype.escape=function(e){return'\"'+e+'\"'},t.prototype.buildTableName=function(e,t){return t?t+\".\"+e:e},t.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=s.a.transformTo(t.transformer,e)),null==e?e:t.type===Boolean?!0===e?1:0:\"date\"===t.type?u.a.mixedDateToDateString(e):\"time\"===t.type?u.a.mixedDateToTimeString(e):\"timestamp\"===t.type||t.type===Date?u.a.mixedDateToDatetimeString(e,!0):\"seconddate\"===t.type?u.a.mixedDateToDatetimeString(e,!1):\"simple-array\"===t.type?u.a.simpleArrayToString(e):\"simple-json\"===t.type?u.a.simpleJsonToString(e):\"simple-enum\"===t.type?u.a.simpleEnumToString(e):t.isArray?function(){return\"ARRAY(\"+e.map(function(e){return\"'\"+e+\"'\"})+\")\"}:e},t.prototype.prepareHydratedValue=function(e,t){return null==e?t.transformer?s.a.transformFrom(t.transformer,e):e:(t.type===Boolean?e=!!e:\"timestamp\"===t.type||\"seconddate\"===t.type||t.type===Date?e=u.a.normalizeHydratedDate(e):\"date\"===t.type?e=u.a.mixedDateToDateString(e):\"time\"===t.type?e=u.a.mixedTimeToString(e):\"simple-array\"===t.type?e=u.a.stringToSimpleArray(e):\"simple-json\"===t.type?e=u.a.stringToSimpleJson(e):\"simple-enum\"===t.type&&(e=u.a.stringToSimpleEnum(e,t)),t.transformer&&(e=s.a.transformFrom(t.transformer,e)),e)},t.prototype.normalizeType=function(t){return t.type===Number||\"int\"===t.type?\"integer\":t.type===String?\"nvarchar\":t.type===Date?\"timestamp\":t.type===Boolean?\"boolean\":t.type===e?\"blob\":\"uuid\"===t.type?\"nvarchar\":\"simple-array\"===t.type||\"simple-json\"===t.type?\"text\":\"simple-enum\"===t.type?\"nvarchar\":t.type||\"\"},t.prototype.normalizeDefault=function(e){var t=e.default;return\"number\"==typeof t?\"\"+t:\"boolean\"==typeof t?!0===t?\"true\":\"false\":\"function\"==typeof t?t():\"string\"==typeof t?\"'\"+t+\"'\":t},t.prototype.normalizeIsUnique=function(e){return e.entityMetadata.indices.some(function(t){return t.isUnique&&1===t.columns.length&&t.columns[0]===e})},t.prototype.getColumnLength=function(e){if(e.length)return e.length.toString();if(\"uuid\"===e.generationStrategy)return\"36\";switch(e.type){case\"varchar\":case\"nvarchar\":case\"shorttext\":case String:return\"255\";case\"alphanum\":return\"127\";case\"varbinary\":return\"255\"}return\"\"},t.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+=\"(\"+this.getColumnLength(e)+\")\":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+=\"(\"+e.precision+\",\"+e.scale+\")\":null!==e.precision&&void 0!==e.precision&&(t+=\"(\"+e.precision+\")\"),e.isArray&&(t+=\" array\"),t},t.prototype.obtainMasterConnection=function(){return this.master.getConnection()},t.prototype.obtainSlaveConnection=function(){return this.obtainMasterConnection()},t.prototype.createGeneratedMap=function(e,t){var n=e.generatedColumns.reduce(function(e,n){var r;return\"increment\"===n.generationStrategy&&t&&(r=t),c.a.mergeDeep(e,n.createValueMap(r))},{});return 0<Object.keys(n).length?n:void 0},t.prototype.findChangedColumns=function(e,t){var n=this;return t.filter(function(t){var r=e.find(function(e){return e.name===t.databaseName});if(!r)return!1;var i=n.normalizeDefault(t),a=null==i?void 0:i;return r.name!==t.databaseName||r.type!==n.normalizeType(t)||t.length&&r.length!==n.getColumnLength(t)||r.precision!==t.precision||r.scale!==t.scale||!r.isGenerated&&a!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||\"uuid\"!==t.generationStrategy&&r.isGenerated!==t.isGenerated})},t.prototype.isReturningSqlSupported=function(){return!1},t.prototype.isUUIDGenerationSupported=function(){return!1},t.prototype.isFullTextColumnTypeSupported=function(){return!0},t.prototype.createParameter=function(){return\"?\"},t.prototype.loadDependencies=function(){try{this.client=a.a.load(\"hdb-pool\")}catch(e){throw new i.a(\"SAP Hana\",\"hdb-pool\")}try{a.a.load(\"@sap/hana-client\")}catch(e){throw new i.a(\"SAP Hana\",\"@sap/hana-client\")}},t}()}).call(this,n(38).Buffer)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(){function e(){}return e.assign=function(e){for(var t,n,i,a,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];try{for(var u,c=Object(r.g)(o),l=c.next();!l.done;l=c.next()){u=l.value;try{for(var h,p=(i=void 0,Object(r.g)(Object.getOwnPropertyNames(u))),d=p.next();!d.done;d=p.next())e[h=d.value]=u[h]}catch(e){i={error:e}}finally{try{d&&!d.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name=\"TransactionNotStartedError\",Object.setPrototypeOf(n,t.prototype),n.message=\"Transaction is not started yet, start transaction before committing or rolling it back.\",n}return Object(r.c)(t,e),t}(Error)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){function e(){}return e.transformFrom=function(e,t){return Array.isArray(e)?e.slice().reverse().reduce(function(e,t){return t.from(e)},t):e.from(t)},e.transformTo=function(e,t){return Array.isArray(e)?e.reduce(function(e,t){return t.to(e)},t):e.to(t)},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return a});var r=n(0),i=n(21),a=function(e){function t(n,a,o){var s=e.call(this)||this;return Object.setPrototypeOf(s,t.prototype),s.message=o.toString().replace(/^error: /,\"\").replace(/^Error: /,\"\").replace(/^Request/,\"\"),i.a.assign(s,Object(r.a)(Object(r.a)({},o),{name:\"QueryFailedError\",query:n,parameters:a||[]})),s}return Object(r.c)(t,e),t}(Error)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){function e(e){this.queryRunner=e}return e.prototype.broadcastBeforeInsertEvent=function(e,t,n){var r=this;n&&t.beforeInsertListeners.length&&t.beforeInsertListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(i){if(r.isAllowedSubscriber(i,t.target)&&i.beforeInsert){var a=i.beforeInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}})},e.prototype.broadcastBeforeUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.beforeUpdateListeners.length&&t.beforeUpdateListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(s){if(o.isAllowedSubscriber(s,t.target)&&s.beforeUpdate){var u=s.beforeUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}})},e.prototype.broadcastBeforeRemoveEvent=function(e,t,n,r){var i=this;n&&t.beforeRemoveListeners.length&&t.beforeRemoveListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(a){if(i.isAllowedSubscriber(a,t.target)&&a.beforeRemove){var o=a.beforeRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}})},e.prototype.broadcastAfterInsertEvent=function(e,t,n){var r=this;n&&t.afterInsertListeners.length&&t.afterInsertListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterInsert){var a=i.afterInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}})},e.prototype.broadcastAfterUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.afterUpdateListeners.length&&t.afterUpdateListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(s){if(o.isAllowedSubscriber(s,t.target)&&s.afterUpdate){var u=s.afterUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}})},e.prototype.broadcastAfterRemoveEvent=function(e,t,n,r){var i=this;n&&t.afterRemoveListeners.length&&t.afterRemoveListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(a){if(i.isAllowedSubscriber(a,t.target)&&a.afterRemove){var o=a.afterRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}})},e.prototype.broadcastLoadEventsForAll=function(e,t,n){var r=this;n.forEach(function(n){n instanceof Promise||(t.relations.length&&t.relations.forEach(function(t){if(!t.isLazy||n.hasOwnProperty(t.propertyName)){var i=t.getEntityValue(n);i instanceof Object&&r.broadcastLoadEventsForAll(e,t.inverseEntityMetadata,Array.isArray(i)?i:[i])}}),t.afterLoadListeners.length&&t.afterLoadListeners.forEach(function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}}),r.queryRunner.connection.subscribers.length&&r.queryRunner.connection.subscribers.forEach(function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterLoad){var a=i.afterLoad(n,{connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}}))})},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t||e.listenTo().isPrototypeOf(t)},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return u});var r=n(0),i=n(4),a=n(2),o=n(11),s=n(23),u=function(){function e(e){this.length=\"\",this.isPrimary=!1,this.isGenerated=!1,this.isNullable=!1,this.isSelect=!0,this.isInsert=!0,this.isUpdate=!0,this.comment=\"\",this.zerofill=!1,this.unsigned=!1,this.isArray=!1,this.isVirtual=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isDeleteDate=!1,this.isVersion=!1,this.isObjectId=!1,this.isNestedSetLeft=!1,this.isNestedSetRight=!1,this.isMaterializedPath=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():\"\"),e.args.options.width&&(this.width=e.args.options.width),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),null===e.args.options.default&&(this.isNullable=!0),void 0!==e.args.options.nullable&&(this.isNullable=e.args.options.nullable),void 0!==e.args.options.select&&(this.isSelect=e.args.options.select),void 0!==e.args.options.insert&&(this.isInsert=e.args.options.insert),void 0!==e.args.options.update&&(this.isUpdate=e.args.options.update),void 0!==e.args.options.readonly&&(this.isUpdate=!e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.onUpdate&&(this.onUpdate=e.args.options.onUpdate),null!==e.args.options.scale&&void 0!==e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.zerofill&&(this.zerofill=e.args.options.zerofill,this.unsigned=!0),e.args.options.unsigned&&(this.unsigned=e.args.options.unsigned),void 0!==e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.enum&&(e.args.options.enum instanceof Object&&!Array.isArray(e.args.options.enum)?this.enum=Object.keys(e.args.options.enum).filter(function(e){return isNaN(+e)}).map(function(t){return e.args.options.enum[t]}):this.enum=e.args.options.enum),e.args.options.enumName&&(this.enumName=e.args.options.enumName),e.args.options.asExpression&&(this.asExpression=e.args.options.asExpression,this.generatedType=e.args.options.generatedType?e.args.options.generatedType:\"VIRTUAL\"),e.args.options.hstoreType&&(this.hstoreType=e.args.options.hstoreType),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtual=\"virtual\"===e.args.mode,this.isTreeLevel=\"treeLevel\"===e.args.mode,this.isCreateDate=\"createDate\"===e.args.mode,this.isUpdateDate=\"updateDate\"===e.args.mode,this.isDeleteDate=\"deleteDate\"===e.args.mode,this.isVersion=\"version\"===e.args.mode,this.isObjectId=\"objectId\"===e.args.mode),e.args.options.transformer&&(this.transformer=e.args.options.transformer),e.args.options.spatialFeatureType&&(this.spatialFeatureType=e.args.options.spatialFeatureType),void 0!==e.args.options.srid&&(this.srid=e.args.options.srid),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(!this.type&&(this.type=e.connection.driver.mappedDataTypes.createDate),!this.default&&(this.default=function(){return e.connection.driver.mappedDataTypes.createDateDefault}),void 0===this.precision&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(!this.type&&(this.type=e.connection.driver.mappedDataTypes.updateDate),!this.default&&(this.default=function(){return e.connection.driver.mappedDataTypes.updateDateDefault}),void 0===this.precision&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isDeleteDate&&(!this.type&&(this.type=e.connection.driver.mappedDataTypes.deleteDate),!this.isNullable&&(this.isNullable=e.connection.driver.mappedDataTypes.deleteDateNullable),void 0===this.precision&&e.connection.driver.mappedDataTypes.deleteDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.deleteDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version),e.closureType&&(this.closureType=e.closureType),e.nestedSetLeft&&(this.isNestedSetLeft=e.nestedSetLeft),e.nestedSetRight&&(this.isNestedSetRight=e.nestedSetRight),e.materializedPath&&(this.isMaterializedPath=e.materializedPath)}return e.prototype.createValueMap=function(e,t){var n,i=this;if(void 0===t&&(t=!1),this.embeddedMetadata){var a=Object(r.f)(this.embeddedMetadata.parentPropertyNames),o=function(n,r){var a=n.shift();return a?(r[a]={},o(n,r[a]),r):((\"increment\"===i.generationStrategy||\"rowid\"===i.generationStrategy)&&\"bigint\"===i.type&&(e+=\"\"),r[t?i.databaseName:i.propertyName]=e,r)};return o(a,{})}return(\"increment\"===this.generationStrategy||\"rowid\"===this.generationStrategy)&&\"bigint\"===this.type&&(e+=\"\"),(n={})[t?this.databaseName:this.propertyName]=e,n},e.prototype.getEntityValueMap=function(e){var t,n,a=this;if(this.embeddedMetadata){var o=Object(r.f)(this.embeddedMetadata.parentPropertyNames),s=function(e,t,n){var r=e.shift();if(void 0===t)return n;if(r){var i={};return s(e,t[r],i),0<Object.keys(i).length&&(n[r]=i),n}return void 0!==t[a.propertyName]&&(n[a.propertyName]=t[a.propertyName]),n};return s(o,e,u={}),0<Object.keys(u).length?u:void 0}if(this.relationMetadata&&e[this.propertyName]&&e[this.propertyName]instanceof Object){var u=this.relationMetadata.joinColumns.reduce(function(t,n){var r=n.referencedColumn.getEntityValueMap(e[a.propertyName]);return void 0===r?t:i.a.mergeDeep(t,r)},{});return 0<Object.keys(u).length?((t={})[this.propertyName]=u,t):void 0}return void 0!==e[this.propertyName]?((n={})[this.propertyName]=e[this.propertyName],n):void 0},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),null!=e){var n;if(this.embeddedMetadata){var i=Object(r.f)(this.embeddedMetadata.parentPropertyNames),a=function(e,t){var n=e.shift();return n&&t?a(e,t[n]):t},u=a(i,e);if(u)if(this.relationMetadata&&this.referencedColumn){n=(c=this.relationMetadata.getEntityValue(u))&&c instanceof Object&&!(c instanceof o.a)?this.referencedColumn.getEntityValue(c):u[this.propertyName]&&u[this.propertyName]instanceof Object&&!(u[this.propertyName]instanceof o.a)?this.referencedColumn.getEntityValue(u[this.propertyName]):u[this.propertyName]}else n=this.referencedColumn?this.referencedColumn.getEntityValue(u[this.propertyName]):u[this.propertyName]}else if(this.relationMetadata&&this.referencedColumn){var c;n=!((c=this.relationMetadata.getEntityValue(e))&&c instanceof Object)||c instanceof o.a||c instanceof Function?!(e[this.propertyName]&&e[this.propertyName]instanceof Object)||e[this.propertyName]instanceof o.a||e[this.propertyName]instanceof Function?e[this.propertyName]:this.referencedColumn.getEntityValue(e[this.propertyName]):this.referencedColumn.getEntityValue(c)}else n=this.referencedColumn?this.referencedColumn.getEntityValue(e[this.propertyName]):e[this.propertyName];return t&&this.transformer&&(n=s.a.transformTo(this.transformer,n)),n}},e.prototype.setEntityValue=function(e,t){var n=this;if(this.embeddedMetadata){var i=function(e,r){var a=e.shift();return a?(r[a.propertyName]||(r[a.propertyName]=a.create()),i(e,r[a.propertyName]),r):(r[n.propertyName]=t,r)};return i(Object(r.f)(this.embeddedMetadata.embeddedMetadataTree),e)}e[this.propertyName]=t},e.prototype.build=function(e){return this.propertyPath=this.buildPropertyPath(),this.propertyAliasName=this.propertyPath.replace(\".\",\"_\"),this.databaseName=this.buildDatabaseName(e),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this},e.prototype.buildPropertyPath=function(){var e=\"\";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(\".\")+\".\"),e+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+=\".\"+this.referencedColumn.propertyName),e},e.prototype.buildDatabasePath=function(){var e=\"\";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(\".\")+\".\"),e+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(e+=\".\"+this.referencedColumn.databaseName),e},e.prototype.buildDatabaseName=function(e){var t=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return e.driver instanceof a.d&&(t=[]),e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,t)},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){this.count=0,this.promises=[]}},function(e,t,n){\"use strict\";var r=n(0),i=n(2),a=n(20),o=n(7),s=n(9),u=function(e){function t(n,r){var i=e.call(this)||this;i.name=\"CannotCreateEntityIdMapError\",Object.setPrototypeOf(i,t.prototype);var a=n.primaryColumns.reduce(function(e,t,n){return t.setEntityValue(e,n+1),e},{});return i.message='Cannot use given entity id \"'+r+'\" because \"'+n.targetName+'\" contains multiple primary columns, you must provide object in following form: '+JSON.stringify(a)+\" as an id.\",i}return Object(r.c)(t,e),t}(Error),c=n(4),l=n(34);n.d(t,\"a\",function(){return h});var h=function(){function e(e){this.childEntityMetadatas=[],this.inheritanceTree=[],this.tableType=\"regular\",this.withoutRowid=!1,this.synchronize=!0,this.hasNonNullableRelations=!1,this.isJunction=!1,this.isClosureJunction=!1,this.hasMultiplePrimaryKeys=!1,this.hasUUIDGeneratedColumns=!1,this.ownColumns=[],this.columns=[],this.ancestorColumns=[],this.descendantColumns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.generatedColumns=[],this.primaryColumns=[],this.ownRelations=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[],this.relationIds=[],this.relationCounts=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.ownIndices=[],this.indices=[],this.uniques=[],this.ownUniques=[],this.checks=[],this.exclusions=[],this.ownListeners=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.afterRemoveListeners=[],this.connection=e.connection,this.inheritanceTree=e.inheritanceTree||[],this.inheritancePattern=e.inheritancePattern,this.treeType=e.tableTree?e.tableTree.type:void 0,this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.tableMetadataArgs=e.args,this.target=this.tableMetadataArgs.target,this.tableType=this.tableMetadataArgs.type,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid}return e.prototype.create=function(e){var t,n=this;if(this.target instanceof Function)return t=new this.target,this.lazyRelations.forEach(function(r){return n.connection.relationLoader.enableLazyLoad(r,t,e)}),t;var r={};return this.lazyRelations.forEach(function(t){return n.connection.relationLoader.enableLazyLoad(t,r,e)}),r},e.prototype.hasId=function(e){return!!e&&this.primaryColumns.every(function(t){var n=t.getEntityValue(e);return null!=n&&\"\"!==n})},e.prototype.hasAllPrimaryKeys=function(e){return this.primaryColumns.every(function(t){var n=t.getEntityValue(e);return null!=n})},e.prototype.ensureEntityIdMap=function(e){if(e instanceof Object)return e;if(this.hasMultiplePrimaryKeys)throw new u(this,e);return this.primaryColumns[0].createValueMap(e)},e.prototype.getEntityIdMap=function(t){return t?e.getValueMap(t,this.primaryColumns,{skipNulls:!0}):void 0},e.prototype.getEntityIdMixedMap=function(e){if(!e)return e;var t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?this.primaryColumns[0].getEntityValue(t):t},e.prototype.compareEntities=function(e,t){var n=this.getEntityIdMap(e);if(!n)return!1;var r=this.getEntityIdMap(t);return!!r&&c.a.compareIds(n,r)},e.prototype.findColumnWithPropertyName=function(e){return this.columns.find(function(t){return t.propertyName===e})},e.prototype.findColumnWithDatabaseName=function(e){return this.columns.find(function(t){return t.databaseName===e})},e.prototype.findColumnWithPropertyPath=function(e){var t=this.columns.find(function(t){return t.propertyPath===e});if(t)return t;var n=this.relations.find(function(t){return t.propertyPath===e});return n&&1===n.joinColumns.length?n.joinColumns[0]:void 0},e.prototype.findColumnsWithPropertyPath=function(e){var t=this.columns.find(function(t){return t.propertyPath===e});if(t)return[t];var n=this.relations.find(function(t){return t.propertyPath===e});return n&&n.joinColumns?n.joinColumns:[]},e.prototype.findRelationWithPropertyPath=function(e){return this.relations.find(function(t){return t.propertyPath===e})},e.prototype.hasEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.some(function(t){return t.propertyPath===e})},e.prototype.findEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.find(function(t){return t.propertyPath===e})},e.prototype.extractRelationValuesFromEntity=function(e,t){var n=this,r=[];return t.forEach(function(t){var i=t.getEntityValue(e);Array.isArray(i)?i.forEach(function(e){return r.push([t,e,n.getInverseEntityMetadata(e,t)])}):i&&r.push([t,i,n.getInverseEntityMetadata(i,t)])}),r},e.prototype.getInverseEntityMetadata=function(e,t){var n=t.inverseEntityMetadata.childEntityMetadatas.find(function(t){return t.target===e.constructor});return n||t.inverseEntityMetadata},e.createPropertyPath=function(e,t,n){var i=this;void 0===n&&(n=\"\");var a=[];return Object.keys(t).forEach(function(o){var s=n?n+\".\"+o:o;if(e.hasEmbeddedWithPropertyPath(s)){var u=i.createPropertyPath(e,t[o],s);a.push.apply(a,Object(r.f)(u))}else{var c=n?n+\".\"+o:o;a.push(c)}}),a},e.difference=function(e,t){return e.filter(function(e){return!t.find(function(t){return c.a.compareIds(e,t)})})},e.getValueMap=function(e,t,n){return t.reduce(function(t,r){var i=r.getEntityValueMap(e,n);return void 0===t||null==i?void 0:r.isObjectId?Object.assign(t,i):c.a.mergeDeep(t,i)},{})},e.prototype.build=function(){var e=this.connection.namingStrategy,t=this.connection.options.entityPrefix;this.engine=this.tableMetadataArgs.engine,this.database=\"entity-child\"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.database:this.tableMetadataArgs.database,this.schema=this.tableMetadataArgs.schema?this.tableMetadataArgs.schema:\"entity-child\"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.schema:this.connection.options.schema,this.givenTableName=\"entity-child\"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.givenTableName:this.tableMetadataArgs.name,this.synchronize=!1!==this.tableMetadataArgs.synchronize,this.targetName=this.tableMetadataArgs.target instanceof Function?this.tableMetadataArgs.target.name:this.tableMetadataArgs.target,\"closure-junction\"===this.tableMetadataArgs.type?this.tableNameWithoutPrefix=e.closureJunctionTableName(this.givenTableName):\"entity-child\"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.tableNameWithoutPrefix=e.tableName(this.parentEntityMetadata.targetName,this.parentEntityMetadata.givenTableName):(this.tableNameWithoutPrefix=e.tableName(this.targetName,this.givenTableName),this.connection.driver.maxAliasLength&&0<this.connection.driver.maxAliasLength&&this.tableNameWithoutPrefix.length>this.connection.driver.maxAliasLength&&(this.tableNameWithoutPrefix=Object(l.c)(this.tableNameWithoutPrefix,{separator:\"_\",segmentLength:3}))),this.tableName=t?e.prefixTableName(t,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=!0===this.tableMetadataArgs.withoutRowid,this.tablePath=this.buildTablePath(),this.schemaPath=this.buildSchemaPath(),this.orderBy=this.tableMetadataArgs.orderBy instanceof Function?this.tableMetadataArgs.orderBy(this.propertiesMap):this.tableMetadataArgs.orderBy,this.isJunction=\"closure-junction\"===this.tableMetadataArgs.type||\"junction\"===this.tableMetadataArgs.type,this.isClosureJunction=\"closure-junction\"===this.tableMetadataArgs.type},e.prototype.registerColumn=function(e){-1!==this.ownColumns.indexOf(e)||(this.ownColumns.push(e),this.columns=this.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},this.ownColumns),this.primaryColumns=this.columns.filter(function(e){return e.isPrimary}),this.hasMultiplePrimaryKeys=1<this.primaryColumns.length,this.hasUUIDGeneratedColumns=0<this.columns.filter(function(e){return e.isGenerated||\"uuid\"===e.generationStrategy}).length,this.propertiesMap=this.createPropertiesMap(),this.childEntityMetadatas&&this.childEntityMetadatas.forEach(function(t){return t.registerColumn(e)}))},e.prototype.createPropertiesMap=function(){var e={};return this.columns.forEach(function(t){return c.a.mergeDeep(e,t.createValueMap(t.propertyPath))}),this.relations.forEach(function(t){return c.a.mergeDeep(e,t.createValueMap(t.propertyPath))}),e},e.prototype.buildTablePath=function(){var e=this.tableName;return this.schema&&(this.connection.driver instanceof s.a||this.connection.driver instanceof i.i||this.connection.driver instanceof o.a||this.connection.driver instanceof a.a)&&(e=this.schema+\".\"+e),this.database&&!(this.connection.driver instanceof i.i)&&(e=!this.schema&&this.connection.driver instanceof o.a?this.database+\"..\"+e:this.database+\".\"+e),e},e.prototype.buildSchemaPath=function(){return this.schema?!this.database||this.connection.driver instanceof i.i?this.schema:this.database+\".\"+this.schema:void 0},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(e){function t(n,r){var i=e.call(this)||this;return i.name=\"DriverPackageNotInstalledError\",Object.setPrototypeOf(i,t.prototype),i.message=n+\" package has not been found installed. Try to install it: npm install \"+r+\" --save\",i}return Object(r.c)(t,e),t}(Error)},function(e,t,n){\"use strict\";var r=n(0),i=n(21),a=function(){function e(e){i.a.assign(this,e||{})}return Object.defineProperty(e.prototype,\"target\",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"hasMetadata\",{get:function(){return!!this._metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"metadata\",{get:function(){if(!this._metadata)throw new Error('Cannot get entity metadata for the given alias \"'+this.name+'\"');return this._metadata},set:function(e){this._metadata=e},enumerable:!0,configurable:!0}),e}(),o=n(61),s=n(51),u=n(52),c=function(){function e(e){this.connection=e,this.queryEntity=!1,this.aliases=[],this.queryType=\"select\",this.selects=[],this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict=\"\",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition=\"\",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={}}return Object.defineProperty(e.prototype,\"allOrderBys\",{get:function(){var e=this;if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&-1===this.options.indexOf(\"disable-global-order\")){var t=this.mainAlias.metadata.orderBy||{};return Object.keys(t).reduce(function(n,r){return n[e.mainAlias.name+\".\"+r]=t[r],n},{})}return this.orderBys},enumerable:!0,configurable:!0}),e.prototype.setMainAlias=function(e){return this.mainAlias=e,e},e.prototype.createAlias=function(e){var t=e.name;!t&&e.tablePath&&(t=e.tablePath),!t&&e.target instanceof Function&&(t=e.target.name),t||\"string\"!=typeof e.target||(t=e.target);var n=new a;return n.type=e.type,t&&(n.name=t),e.metadata&&(n.metadata=e.metadata),e.target&&!n.hasMetadata&&(n.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(n.tablePath=e.tablePath),e.subQuery&&(n.subQuery=e.subQuery),this.aliases.push(n),n},e.prototype.findAliasByName=function(e){var t=this.aliases.find(function(t){return t.name===e});if(!t)throw new Error('\"'+e+'\" alias was not found. Maybe you forgot to join it?');return t},e.prototype.findColumnByAliasExpression=function(e){var t=Object(r.e)(e.split(\".\"),2),n=t[0],i=t[1];return this.findAliasByName(n).metadata.findColumnWithPropertyName(i)},Object.defineProperty(e.prototype,\"relationMetadata\",{get:function(){if(!this.mainAlias)throw new Error(\"Entity to work with is not specified!\");var e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error(\"Relation \"+this.relationPropertyPath+\" was not found in entity \"+this.mainAlias.name);return e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=this,n=new e(this.connection);return n.queryType=this.queryType,n.selects=this.selects.map(function(e){return e}),n.selectDistinct=this.selectDistinct,n.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach(function(e){return n.aliases.push(new a(e))}),n.mainAlias=this.mainAlias,n.valuesSet=this.valuesSet,n.returning=this.returning,n.onConflict=this.onConflict,n.onIgnore=this.onIgnore,n.onUpdate=this.onUpdate,n.joinAttributes=this.joinAttributes.map(function(e){return new o.a(t.connection,t,e)}),n.relationIdAttributes=this.relationIdAttributes.map(function(e){return new s.a(t,e)}),n.relationCountAttributes=this.relationCountAttributes.map(function(e){return new u.a(t,e)}),n.wheres=this.wheres.map(function(e){return Object(r.a)({},e)}),n.havings=this.havings.map(function(e){return Object(r.a)({},e)}),n.orderBys=Object.assign({},this.orderBys),n.groupBys=this.groupBys.map(function(e){return e}),n.limit=this.limit,n.offset=this.offset,n.skip=this.skip,n.take=this.take,n.lockMode=this.lockMode,n.lockVersion=this.lockVersion,n.withDeleted=this.withDeleted,n.parameters=Object.assign({},this.parameters),n.disableEscaping=this.disableEscaping,n.enableRelationIdValues=this.enableRelationIdValues,n.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,n.subQuery=this.subQuery,n.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,n.cache=this.cache,n.cacheId=this.cacheId,n.cacheDuration=this.cacheDuration,n.relationPropertyPath=this.relationPropertyPath,n.of=this.of,n.insertColumns=this.insertColumns,n.whereEntities=this.whereEntities,n.updateEntity=this.updateEntity,n.callListeners=this.callListeners,n.useTransaction=this.useTransaction,n.nativeParameters=Object.assign({},this.nativeParameters),n},e}(),l=n(57),h=n(28),p=n(32),d=n(7),f=n(9),m=n(2),y=n(42),b=n(11),v=n(58),g=n(62);n.d(t,\"a\",function(){return E});var E=function(){function e(t,n){t instanceof e?(this.connection=t.connection,this.queryRunner=t.queryRunner,this.expressionMap=t.expressionMap.clone()):(this.connection=t,this.queryRunner=n,this.expressionMap=new c(this.connection))}return Object.defineProperty(e.prototype,\"alias\",{get:function(){if(!this.expressionMap.mainAlias)throw new Error(\"Main alias is not set\");return this.expressionMap.mainAlias.name},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){this.expressionMap.queryType=\"select\",Array.isArray(e)?this.expressionMap.selects=e.map(function(e){return{selection:e}}):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);var r=n(50).SelectQueryBuilder;return this instanceof r?this:new r(this)},e.prototype.insert=function(){this.expressionMap.queryType=\"insert\";var e=n(68).InsertQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.update=function(e,t){var r=t||e;if((e=e instanceof y.a?e.options.name:e)instanceof Function||\"string\"==typeof e){var i=this.createFromAlias(e);this.expressionMap.setMainAlias(i)}this.expressionMap.queryType=\"update\",this.expressionMap.valuesSet=r;var a=n(65).UpdateQueryBuilder;return this instanceof a?this:new a(this)},e.prototype.delete=function(){this.expressionMap.queryType=\"delete\";var e=n(66).DeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.softDelete=function(){this.expressionMap.queryType=\"soft-delete\";var e=n(72).SoftDeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.restore=function(){this.expressionMap.queryType=\"restore\";var e=n(72).SoftDeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.relation=function(e,t){var r=2===arguments.length?e:void 0,i=2===arguments.length?t:e;if(this.expressionMap.queryType=\"relation\",this.expressionMap.relationPropertyPath=i,r){var a=this.createFromAlias(r);this.expressionMap.setMainAlias(a)}var o=n(67).RelationQueryBuilder;return this instanceof o?this:new o(this)},e.prototype.hasRelation=function(e,t){var n=this.connection.getMetadata(e);return(Array.isArray(t)?t:[t]).every(function(e){return!!n.findRelationWithPropertyPath(e)})},e.prototype.setParameter=function(e,t){return this.expressionMap.parameters[e]=t,this},e.prototype.setParameters=function(e){var t=this;return Object.keys(e).forEach(function(t){if(e[t]instanceof Function)throw new Error(\"Function parameter isn't supported in the parameters. Please check \\\"\"+t+'\" parameter.')}),this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setParameters(e),Object.keys(e).forEach(function(n){return t.setParameter(n,e[n])}),this},e.prototype.setNativeParameters=function(e){var t=this;return this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach(function(n){t.expressionMap.nativeParameters[n]=e[n]}),this},e.prototype.getParameters=function(){var e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=t.childEntityMetadatas.filter(function(e){return e.discriminatorColumn}).map(function(e){return e.discriminatorValue});n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e},e.prototype.printSql=function(){var e=Object(r.e)(this.getQueryAndParameters(),2),t=e[0],n=e[1];return this.connection.logger.logQuery(t,n),this},e.prototype.getSql=function(){return this.getQueryAndParameters()[0]},e.prototype.getQueryAndParameters=function(){var e=this.getQuery(),t=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,t,this.expressionMap.nativeParameters)},e.prototype.execute=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i;return Object(r.d)(this,function(a){switch(a.label){case 0:e=Object(r.e)(this.getQueryAndParameters(),2),t=e[0],n=e[1],i=this.obtainQueryRunner(),a.label=1;case 1:return a.trys.push([1,,3,8]),[4,i.query(t,n)];case 2:return[2,a.sent()];case 3:return i===this.queryRunner?[3,5]:[4,i.release()];case 4:a.sent(),a.label=5;case 5:return this.connection.driver instanceof p.a?[4,this.connection.driver.autoSave()]:[3,7];case 6:a.sent(),a.label=7;case 7:return[7];case 8:return[2]}})})},e.prototype.createQueryBuilder=function(){return new this.constructor(this.connection,this.queryRunner)},e.prototype.clone=function(){return new this.constructor(this)},e.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},e.prototype.escape=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e},e.prototype.setQueryRunner=function(e){return this.queryRunner=e,this},e.prototype.callListeners=function(e){return this.expressionMap.callListeners=e,this},e.prototype.useTransaction=function(e){return this.expressionMap.useTransaction=e,this},e.prototype.getTableName=function(e){var t=this;return e.split(\".\").map(function(e){return\"\"===e?e:t.escape(e)}).join(\".\")},e.prototype.getMainTableName=function(){if(!this.expressionMap.mainAlias)throw new Error('Entity where values should be inserted is not specified. Call \"qb.into(entity)\" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath},e.prototype.createFromAlias=function(e,t){if(this.connection.hasMetadata(e)){var n=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:\"from\",name:t,metadata:this.connection.getMetadata(e),tablePath:n.tablePath})}if(\"string\"==typeof e){var r=\"(\"===e.substr(0,1)&&\")\"===e.substr(-1);return this.expressionMap.createAlias({type:\"from\",name:t,tablePath:r?void 0:e,subQuery:r?e:void 0})}var i=e(this.subQuery());this.setParameters(i.getParameters());var a=i.getQuery();return this.expressionMap.createAlias({type:\"from\",name:t,subQuery:a})},e.prototype.replacePropertyNames=function(e){var t=this;return this.expressionMap.aliases.forEach(function(n){if(n.hasMetadata){var i=t.expressionMap.aliasNamePrefixingEnabled?n.name+\"\\\\.\":\"\",a=t.expressionMap.aliasNamePrefixingEnabled?t.escape(n.name)+\".\":\"\";n.metadata.columns.forEach(function(n){var r=\"([ =(]|^.{0})\"+i+n.propertyPath+\"([ =),]|.{0}$)\";e=e.replace(new RegExp(r,\"gm\"),\"$1\"+a+t.escape(n.databaseName)+\"$2\");var o=\"([ =(]|^.{0})\"+i+n.propertyName+\"([ =),]|.{0}$)\";e=e.replace(new RegExp(o,\"gm\"),\"$1\"+a+t.escape(n.databaseName)+\"$2\")}),n.metadata.relations.forEach(function(n){if(Object(r.f)(n.joinColumns,n.inverseJoinColumns).forEach(function(r){var o=\"([ =(]|^.{0})\"+i+n.propertyPath+\"\\\\.\"+r.referencedColumn.propertyPath+\"([ =),]|.{0}$)\";e=e.replace(new RegExp(o,\"gm\"),\"$1\"+a+t.escape(r.databaseName)+\"$2\")}),0<n.joinColumns.length){var o=\"([ =(]|^.{0})\"+i+n.propertyPath+\"([ =),]|.{0}$)\";e=e.replace(new RegExp(o,\"gm\"),\"$1\"+a+t.escape(n.joinColumns[0].databaseName)+\"$2\")}})}}),e},e.prototype.createWhereExpression=function(){var e=[];if(this.createWhereExpressionString().trim()&&e.push(this.createWhereExpressionString()),this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(\"select\"===this.expressionMap.queryType&&!this.expressionMap.withDeleted&&t.deleteDateColumn){var n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+\".\"+t.deleteDateColumn.propertyName:t.deleteDateColumn.propertyName,r=this.replacePropertyNames(n)+\" IS NULL\";e.push(r)}if(t.discriminatorColumn&&t.parentEntityMetadata){n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+\".\"+t.discriminatorColumn.databaseName:t.discriminatorColumn.databaseName,r=this.replacePropertyNames(n)+\" IN (:...discriminatorColumnValues)\";e.push(r)}}if(this.expressionMap.extraAppendedAndWhereCondition){r=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition);e.push(r)}return e.length?1===e.length?\" WHERE \"+e[0]:\" WHERE ( \"+e.join(\" ) AND ( \")+\" )\":\" \"},e.prototype.createReturningExpression=function(){var e=this,t=this.getReturningColumns(),n=this.connection.driver;if(\"string\"!=typeof this.expressionMap.returning&&0<this.expressionMap.extraReturningColumns.length&&n.isReturningSqlSupported()&&t.push.apply(t,Object(r.f)(this.expressionMap.extraReturningColumns.filter(function(e){return-1===t.indexOf(e)}))),t.length){var i=t.map(function(t){var r=e.escape(t.databaseName);return n instanceof d.a?\"insert\"===e.expressionMap.queryType||\"update\"===e.expressionMap.queryType||\"soft-delete\"===e.expressionMap.queryType||\"restore\"===e.expressionMap.queryType?\"INSERTED.\"+r:e.escape(e.getMainTableName())+\".\"+r:r}).join(\", \");return n instanceof f.a&&(i+=\" INTO \"+t.map(function(t){var r=\"output_\"+t.databaseName;return e.expressionMap.nativeParameters[r]={type:n.columnTypeToNativeParameter(t.type),dir:n.oracle.BIND_OUT},e.connection.driver.createParameter(r,Object.keys(e.expressionMap.nativeParameters).length)}).join(\", \")),n instanceof d.a&&(\"insert\"===this.expressionMap.queryType||\"update\"===this.expressionMap.queryType)&&(i+=\" INTO @OutputTable\"),i}return\"string\"==typeof this.expressionMap.returning?this.expressionMap.returning:\"\"},e.prototype.getReturningColumns=function(){var e=this,t=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach(function(n){e.expressionMap.mainAlias.hasMetadata&&t.push.apply(t,Object(r.f)(e.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n)))}),t},e.prototype.createWhereExpressionString=function(){var e=this;return this.expressionMap.wheres.map(function(t,n){switch(t.type){case\"and\":return(0<n?\"AND \":\"\")+e.replacePropertyNames(t.condition);case\"or\":return(0<n?\"OR \":\"\")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(\" \")},e.prototype.createWhereIdsExpression=function(e){var t,n=this,r=this.expressionMap.mainAlias.metadata,i=(Array.isArray(e)?e:[e]).map(function(e){return r.ensureEntityIdMap(e)});if(!r.hasMultiplePrimaryKeys&&0===r.embeddeds.length){var a=r.primaryColumns[0];if(!a.transformer)return this.computeWhereParameter(((t={})[a.propertyName]=Object(v.a)(i.map(function(e){return a.getEntityValue(e,!1)})),t))}var o=this.expressionMap.aliasNamePrefixingEnabled?this.escape(this.expressionMap.mainAlias.name)+\".\":\"\",s=Object.keys(this.expressionMap.nativeParameters).length,u=i.map(function(e,t){var i=[];return r.primaryColumns.forEach(function(r,a){var u=\"id_\"+t+\"_\"+a;i.push(o+n.escape(r.databaseName)+\" = \"+n.connection.driver.createParameter(u,s)),n.expressionMap.nativeParameters[u]=r.getEntityValue(e,!0),s++}),i.join(\" AND \")});return 1<u.length?\"(\"+u.map(function(e){return\"(\"+e+\")\"}).join(\" OR \")+\")\":u[0]},e.prototype.computeWhereParameter=function(e){var t=this;if(\"string\"==typeof e)return e;if(e instanceof l.a){var n=this.createQueryBuilder();e.whereFactory(n);var r=n.createWhereExpressionString();return this.setParameters(n.getParameters()),r?\"(\"+r+\")\":\"\"}if(e instanceof Function)return e(this);if(e instanceof Object){var i=Array.isArray(e)?e:[e],a=void 0,o=Object.keys(this.expressionMap.nativeParameters).length;return 1<(a=this.expressionMap.mainAlias.hasMetadata?i.map(function(e,n){return h.a.createPropertyPath(t.expressionMap.mainAlias.metadata,e).map(function(r,i){var a=t.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(r);if(!a.length)throw new g.a(r);return a.map(function(a,s){var u=t.expressionMap.aliasNamePrefixingEnabled?t.alias+\".\"+r:a.propertyPath,c=a.getEntityValue(e,!0),l=\"where_\"+n+\"_\"+i+\"_\"+s,h=Object.keys(t.expressionMap.nativeParameters).filter(function(e){return e.startsWith(l)}).length;if(null===c)return u+\" IS NULL\";if(c instanceof b.a){var p=[];if(c.useParameter)(c.multipleParameters?c.value:[c.value]).forEach(function(e,n){t.expressionMap.nativeParameters[l+(h+n)]=e,o++,p.push(t.connection.driver.createParameter(l+(h+n),o-1))});return t.computeFindOperatorExpression(c,u,p)}return t.expressionMap.nativeParameters[l]=c,o++,u+\" = \"+t.connection.driver.createParameter(l,o-1)}).filter(function(e){return!!e}).join(\" AND \")}).filter(function(e){return!!e}).join(\" AND \")}):i.map(function(e,n){return Object.keys(e).map(function(r,i){var a=e[r],o=t.expressionMap.aliasNamePrefixingEnabled?t.alias+\".\"+r:r;if(null===a)return o+\" IS NULL\";var s=\"where_\"+n+\"_\"+i;return t.expressionMap.nativeParameters[s]=a,i++,o+\" = \"+t.connection.driver.createParameter(s,i-1)}).join(\" AND \")})).length?a.map(function(e){return\"(\"+e+\")\"}).join(\" OR \"):a.join(\"\")}return\"\"},e.prototype.computeFindOperatorExpression=function(e,t,n){switch(e.type){case\"not\":return e.child?\"NOT(\"+this.computeFindOperatorExpression(e.child,t,n)+\")\":t+\" != \"+n[0];case\"lessThan\":return t+\" < \"+n[0];case\"lessThanOrEqual\":return t+\" <= \"+n[0];case\"moreThan\":return t+\" > \"+n[0];case\"moreThanOrEqual\":return t+\" >= \"+n[0];case\"equal\":return t+\" = \"+n[0];case\"like\":return t+\" LIKE \"+n[0];case\"between\":return t+\" BETWEEN \"+n[0]+\" AND \"+n[1];case\"in\":return(this.connection.driver instanceof f.a||this.connection.driver instanceof m.h)&&0===n.length?t+\" IN (null)\":t+\" IN (\"+n.join(\", \")+\")\";case\"any\":return t+\" = ANY(\"+n[0]+\")\";case\"isNull\":return t+\" IS NULL\";case\"raw\":return\"function\"==typeof e.value?e.value(t):t+\" = \"+e.value}throw new TypeError(\"Unsupported FindOperator \"+b.a.constructor.name)},e.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner()},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name=\"TransactionAlreadyStartedError\",Object.setPrototypeOf(n,t.prototype),n.message=\"Transaction already started for the given connection, commit current transaction before starting a new one.\",n}return Object(r.c)(t,e),t}(Error)},function(e,t,n){\"use strict\";(function(e){n.d(t,\"a\",function(){return l});var r=n(0),i=n(15),a=n(77),o=n(29),s=n(33),u=n(6),c=n(4),l=function(t){function n(e){var n=t.call(this,e)||this;if(n.options.autoSave&&!n.options.location&&!n.options.autoSaveCallback)throw new s.a(\"location or autoSaveCallback\");return n.loadDependencies(),n}return Object(r.c)(n,t),n.prototype.connect=function(){return Object(r.b)(this,void 0,void 0,function(){var e;return Object(r.d)(this,function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}})})},n.prototype.disconnect=function(){return Object(r.b)(this,void 0,void 0,function(){var e=this;return Object(r.d)(this,function(){return[2,new Promise(function(t,n){try{e.queryRunner=void 0,e.databaseConnection.close(),t()}catch(t){n(t)}})]})})},n.prototype.createQueryRunner=function(){return this.queryRunner||(this.queryRunner=new a.a(this)),this.queryRunner},n.prototype.load=function(e,t){return void 0===t&&(t=!0),Object(r.b)(this,void 0,void 0,function(){var n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:if(\"string\"!=typeof e)return[3,8];if(\"node\"!==u.a.type)return[3,1];if(u.a.fileExist(e))return n=u.a.readFileSync(e),[2,this.createDatabaseConnectionWithImport(n)];if(t)throw new Error(\"File \"+e+\" does not exist\");return[2,this.createDatabaseConnectionWithImport()];case 1:return i=null,this.options.useLocalForage?window.localforage?[4,window.localforage.getItem(e)]:[3,3]:[3,5];case 2:return i=r.sent(),[3,4];case 3:throw new Error(\"localforage is not defined - please import localforage.js into your site\");case 4:return[3,6];case 5:i=u.a.getGlobalVariable().localStorage.getItem(e),r.label=6;case 6:if(null!=i)return[2,this.createDatabaseConnectionWithImport(JSON.parse(i))];if(t)throw new Error(\"File \"+e+\" does not exist\");return[2,this.createDatabaseConnectionWithImport()];case 7:return[3,9];case 8:return[2,this.createDatabaseConnectionWithImport(e)];case 9:return[2]}})})},n.prototype.save=function(t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:if(!t&&!this.options.location)throw new Error(\"No location is set, specify a location parameter or add the location option to your configuration\");if(n=\"\",t?n=t:this.options.location&&(n=this.options.location),\"node\"!==u.a.type)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),i=e.from(this.databaseConnection.export()),[4,u.a.writeFile(n,i)];case 2:return r.sent(),[3,4];case 3:throw a=r.sent(),new Error(\"Could not save database, error: \"+a);case 4:return[3,10];case 5:return o=this.databaseConnection.export(),s=[].slice.call(o),this.options.useLocalForage?window.localforage?[4,window.localforage.setItem(n,JSON.stringify(s))]:[3,7]:[3,9];case 6:return r.sent(),[3,8];case 7:throw new Error(\"localforage is not defined - please import localforage.js into your site\");case 8:return[3,10];case 9:u.a.getGlobalVariable().localStorage.setItem(n,JSON.stringify(s)),r.label=10;case 10:return[2]}})})},n.prototype.autoSave=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:return this.options.autoSave?this.options.autoSaveCallback?[4,this.options.autoSaveCallback(this.export())]:[3,2]:[3,4];case 1:return e.sent(),[3,4];case 2:return[4,this.save()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},n.prototype.export=function(){return this.databaseConnection.export()},n.prototype.createGeneratedMap=function(e){var t=this,n=e.generatedColumns.reduce(function(e,n){if(n.isPrimary&&\"increment\"===n.generationStrategy){var r=\"SELECT last_insert_rowid()\";try{var i=t.databaseConnection.exec(r);return t.connection.logger.logQuery(r),c.a.mergeDeep(e,n.createValueMap(i[0].values[0][0]))}catch(n){t.connection.logger.logQueryError(n,r,[])}}return e},{});return 0<Object.keys(n).length?n:void 0},n.prototype.createDatabaseConnection=function(){return this.options.location?this.load(this.options.location,!1):this.createDatabaseConnectionWithImport(this.options.database)},n.prototype.createDatabaseConnectionWithImport=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return\"function\"==typeof this.sqlite.Database?(n=this.sqlite,[3,3]):[3,1];case 1:return[4,this.sqlite(this.options.sqlJsConfig)];case 2:n=r.sent(),r.label=3;case 3:return t=n,this.databaseConnection=e&&0<e.length?new t.Database(e):new t.Database,[2,new Promise(function(e,t){try{i.databaseConnection.exec(\"PRAGMA foreign_keys = ON;\"),e(i.databaseConnection)}catch(e){t(e)}})]}})})},n.prototype.loadDependencies=function(){if(\"browser\"===u.a.type)this.sqlite=window.SQL;else try{this.sqlite=u.a.load(\"sql.js\")}catch(e){throw new o.a(\"sql.js\",\"sql.js\")}},n}(i.a)}).call(this,n(38).Buffer)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(e){function t(n){var r=e.call(this)||this;return r.name=\"DriverOptionNotSetError\",Object.setPrototypeOf(r,t.prototype),r.message=\"Driver option (\"+n+\") is not set. Please set it to perform connection to the database.\",r}return Object(r.c)(t,e),t}(Error)},function(e,t,n){\"use strict\";function r(e,t){return void 0===t&&(t=!1),e.replace(/^([A-Z])|[\\s-_](\\w)/g,function(e,n,r,i){return!0===t&&0===i?n:r?r.toUpperCase():n.toLowerCase()})}function i(e){return e.replace(/(?:([a-z])([A-Z]))|(?:((?!^)[A-Z])([a-z]))/g,\"$1_$3$2$4\").toLowerCase()}function a(e){return e.replace(/\\w\\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function o(e,t){void 0===t&&(t={});var n=t.segmentLength,r=void 0===n?4:n,i=t.separator,a=void 0===i?\"__\":i,o=t.termLength,s=void 0===o?2:o;return e.split(a).reduce(function(e,t){var n=t.replace(/([a-z\\xE0-\\xFF])([A-Z\\xC0-\\xDF])/g,\"$1 $2\").split(\" \"),i=1<n.length?s:r,a=n.map(function(e){return e.substr(0,i)}).join(\"\");return e.push(a),e},[]).join(a)}function s(e,t){void 0===t&&(t={});var n=c()(\"sha256\");n.update(e,\"utf8\");var r=n.digest(\"hex\");return t.length?r.slice(0,t.length):r}n.d(t,\"a\",function(){return r}),n.d(t,\"d\",function(){return i}),n.d(t,\"e\",function(){return a}),n.d(t,\"c\",function(){return o}),n.d(t,\"b\",function(){return s});var u=n(73),c=n.n(u)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(){function e(){}return e.isAliasProperty=function(e){if(\"string\"!=typeof e||-1===e.indexOf(\".\"))return!1;var t=Object(r.e)(e.split(\".\"),2),n=t[0],i=t[1];return n&&i&&-1===e.indexOf(\"(\")&&-1===e.indexOf(\")\")},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){function e(e){this.name=e.name,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){function e(){}return e.sha1=function(e){var t,n,r,i,a,o,s,u,c,l=function(e,t){return e<<t|e>>>32-t},h=function(e){var t,n=\"\";for(t=7;0<=t;t--)n+=(15&e>>>4*t).toString(16);return n},p=Array(80),d=1732584193,f=4023233417,m=2562383102,y=271733878,b=3285377520,v=(e=encodeURIComponent(e)).length,g=[];for(n=0;n<v-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),g.push(r);switch(v%4){case 0:n=2147483648;break;case 1:n=8388608|e.charCodeAt(v-1)<<24;break;case 2:n=e.charCodeAt(v-2)<<24|e.charCodeAt(v-1)<<16|32768;break;case 3:n=e.charCodeAt(v-3)<<24|e.charCodeAt(v-2)<<16|e.charCodeAt(v-1)<<8|128}for(g.push(n);14!=g.length%16;)g.push(0);for(g.push(v>>>29),g.push(4294967295&v<<3),t=0;t<g.length;t+=16){for(n=0;16>n;n++)p[n]=g[t+n];for(n=16;79>=n;n++)p[n]=l(p[n-3]^p[n-8]^p[n-14]^p[n-16],1);for(i=d,a=f,o=m,s=y,u=b,n=0;19>=n;n++)c=4294967295&l(i,5)+(a&o|~a&s)+u+p[n]+1518500249,u=s,s=o,o=l(a,30),a=i,i=c;for(n=20;39>=n;n++)c=4294967295&l(i,5)+(a^o^s)+u+p[n]+1859775393,u=s,s=o,o=l(a,30),a=i,i=c;for(n=40;59>=n;n++)c=4294967295&l(i,5)+(a&o|a&s|o&s)+u+p[n]+2400959708,u=s,s=o,o=l(a,30),a=i,i=c;for(n=60;79>=n;n++)c=4294967295&l(i,5)+(a^o^s)+u+p[n]+3395469782,u=s,s=o,o=l(a,30),a=i,i=c;d=4294967295&d+i,f=4294967295&f+a,m=4294967295&m+o,y=4294967295&y+s,b=4294967295&b+u}return(c=h(d)+h(f)+h(m)+h(y)+h(b)).toLowerCase()},e.uuid4=function(){return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(e){var t=0|16*Math.random();return(\"x\"===e?t:8|3&t).toString(16)})},e}()},function(e,t,n){\"use strict\";var r=Math.pow,i=Math.min,a=Math.floor;(function(e){function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError(\"Invalid typed array length\");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if(\"number\"==typeof e){if(\"string\"==typeof t)throw new Error(\"If encoding is specified then the first argument must be a string\");return h(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if(\"number\"==typeof t)throw new TypeError('\"value\" argument must not be a number');return\"undefined\"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,0>n||t.byteLength<n)throw new RangeError(\"'offset' is out of bounds\");if(t.byteLength<n+(r||0))throw new RangeError(\"'length' is out of bounds\");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=p(e,t),e}(e,t,n,r):\"string\"==typeof t?function(e,t,n){if((\"string\"!=typeof n||\"\"===n)&&(n=\"utf8\"),!u.isEncoding(n))throw new TypeError('\"encoding\" must be a valid string encoding');var r=0|f(t,n),i=(e=s(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|d(t.length);return 0===(e=s(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if(\"undefined\"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||\"length\"in t)return\"number\"!=typeof t.length||function(e){return e!=e}(t.length)?s(e,0):p(e,t);if(\"Buffer\"===t.type&&K(t.data))return p(e,t.data)}throw new TypeError(\"First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.\")}(e,t)}function l(e){if(\"number\"!=typeof e)throw new TypeError('\"size\" argument must be a number');if(0>e)throw new RangeError('\"size\" argument must not be negative')}function h(e,t){if(l(t),e=s(e,0>t?0:0|d(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t){var n=0>t.length?0:0|d(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function d(e){if(e>=o())throw new RangeError(\"Attempt to allocate Buffer larger than maximum size: 0x\"+o().toString(16)+\" bytes\");return 0|e}function f(e,t){if(u.isBuffer(e))return e.length;if(\"undefined\"!=typeof ArrayBuffer&&\"function\"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;\"string\"!=typeof e&&(e=\"\"+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case\"ascii\":case\"latin1\":case\"binary\":return n;case\"utf8\":case\"utf-8\":case void 0:return B(e).length;case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return 2*n;case\"hex\":return n>>>1;case\"base64\":return U(e).length;default:if(r)return B(e).length;t=(\"\"+t).toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if(\"string\"==typeof n?(r=n,n=0):2147483647<n?n=2147483647:-2147483648>n&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),0>n&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(0>n){if(!i)return-1;n=0}if(\"string\"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:b(e,t,n,r,i);if(\"number\"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&\"function\"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,r,i);throw new TypeError(\"val must be string, number or Buffer\")}function b(e,t,n,r,i){function a(e,t){return 1==s?e[t]:e.readUInt16BE(t*s)}var o,s=1,u=e.length,c=t.length;if(void 0!==r&&(\"ucs2\"===(r=(r+\"\").toLowerCase())||\"ucs-2\"===r||\"utf16le\"===r||\"utf-16le\"===r)){if(2>e.length||2>t.length)return-1;s=2,u/=2,c/=2,n/=2}if(i){var l=-1;for(o=n;o<u;o++)if(a(e,o)!==a(t,-1==l?0:o-l))-1!=l&&(o-=o-l),l=-1;else if(-1==l&&(l=o),o-l+1===c)return l*s}else for(n+c>u&&(n=u-c),o=n;0<=o;o--){for(var h=!0,p=0;p<c;p++)if(a(e,o+p)!==a(t,p)){h=!1;break}if(h)return o}return-1}function v(e,t,n,r){n=+n||0;var i=e.length-n;r?(r=+r)>i&&(r=i):r=i;var a=t.length;if(0!=a%2)throw new TypeError(\"Invalid hex string\");r>a/2&&(r=a/2);for(var o,s=0;s<r;++s){if(o=parseInt(t.substr(2*s,2),16),isNaN(o))return s;e[n+s]=o}return s}function g(e,t,n,r){return F(B(t,e.length-n),e,n,r)}function E(e,t,n,r){return F(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function T(e,t,n,r){return E(e,t,n,r)}function N(e,t,n,r){return F(U(t),e,n,r)}function O(e,t,n,r){return F(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!(0>(t-=2));++o)n=e.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function A(e,t,n){return 0===t&&n===e.length?Q.fromByteArray(e):Q.fromByteArray(e.slice(t,n))}function C(e,t,n){n=i(e.length,n);for(var r=[],a=t;a<n;){var o,s,u,c,l=e[a],h=null,p=239<l?4:223<l?3:191<l?2:1;if(a+p<=n)1==p?128>l&&(h=l):2==p?128==(192&(o=e[a+1]))&&(127<(c=(31&l)<<6|63&o)&&(h=c)):3==p?(o=e[a+1],s=e[a+2],128==(192&o)&&128==(192&s)&&(2047<(c=(15&l)<<12|(63&o)<<6|63&s)&&(55296>c||57343<c)&&(h=c))):4==p&&(o=e[a+1],s=e[a+2],u=e[a+3],128==(192&o)&&128==(192&s)&&128==(192&u)&&(65535<(c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&u)&&1114112>c&&(h=c)));null===h?(h=65533,p=1):65535<h&&(h-=65536,r.push(55296|1023&h>>>10),h=56320|1023&h),r.push(h),a+=p}return function(e){var t=e.length;if(t<=W)return k.apply(String,e);for(var n=\"\",r=0;r<t;)n+=k.apply(String,e.slice(r,r+=W));return n}(r)}function w(e,t,n){var r=\"\";n=i(e.length,n);for(var a=t;a<n;++a)r+=k(127&e[a]);return r}function R(e,t,n){var r=\"\";n=i(e.length,n);for(var a=t;a<n;++a)r+=k(e[a]);return r}function S(e,t,n){var r=e.length;(!t||0>t)&&(t=0),(!n||0>n||n>r)&&(n=r);for(var i=\"\",a=t;a<n;++a)i+=q(e[a]);return i}function M(e,t,n){for(var r=e.slice(t,n),i=\"\",a=0;a<r.length;a+=2)i+=k(r[a]+256*r[a+1]);return i}function j(e,t,n){if(0!=e%1||0>e)throw new RangeError(\"offset is not uint\");if(e+t>n)throw new RangeError(\"Trying to access beyond buffer length\")}function P(e,t,n,r,i,a){if(!u.isBuffer(e))throw new TypeError('\"buffer\" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('\"value\" argument is out of bounds');if(n+r>e.length)throw new RangeError(\"Index out of range\")}function x(e,t,n,r){0>t&&(t=65535+t+1);for(var a=0,o=i(e.length-n,2);a<o;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function I(e,t,n,r){0>t&&(t=4294967295+t+1);for(var a=0,o=i(e.length-n,4);a<o;++a)e[n+a]=255&t>>>8*(r?a:3-a)}function _(e,t,n,r){if(n+r>e.length)throw new RangeError(\"Index out of range\");if(0>n)throw new RangeError(\"Index out of range\")}function L(e,t,n,r,i){return i||_(e,0,n,4),V.write(e,t,n,r,23,4),n+4}function D(e,t,n,r,i){return i||_(e,0,n,8),V.write(e,t,n,r,52,8),n+8}function q(e){return 16>e?\"0\"+e.toString(16):e.toString(16)}function B(e,t){t=t||1/0;for(var n,r=e.length,i=null,a=[],o=0;o<r;++o){if(55295<(n=e.charCodeAt(o))&&57344>n){if(!i){if(56319<n){-1<(t-=3)&&a.push(239,191,189);continue}if(o+1===r){-1<(t-=3)&&a.push(239,191,189);continue}i=n;continue}if(56320>n){-1<(t-=3)&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&-1<(t-=3)&&a.push(239,191,189);if(i=null,128>n){if(0>(t-=1))break;a.push(n)}else if(2048>n){if(0>(t-=2))break;a.push(192|n>>6,128|63&n)}else if(65536>n){if(0>(t-=3))break;a.push(224|n>>12,128|63&n>>6,128|63&n)}else{if(!(1114112>n))throw new Error(\"Invalid code point\");if(0>(t-=4))break;a.push(240|n>>18,128|63&n>>12,128|63&n>>6,128|63&n)}}return a}function U(e){return Q.toByteArray(function(e){if(2>(e=function(e){return e.trim?e.trim():e.replace(/^\\s+|\\s+$/g,\"\")}(e).replace(H,\"\")).length)return\"\";for(;0!=e.length%4;)e+=\"=\";return e}(e))}function F(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}var k=String.fromCharCode,Q=n(84),V=n(85),K=n(86);\n/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */t.Buffer=u,t.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0===e.TYPED_ARRAY_SUPPORT?function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&\"function\"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}():e.TYPED_ARRAY_SUPPORT,t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,\"undefined\"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),0>=t?s(e,t):void 0===n?s(e,t):\"string\"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n)}(null,e,t,n)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError(\"Arguments must be Buffers\");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,o=i(n,r);a<o;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch((e+\"\").toLowerCase()){case\"hex\":case\"utf8\":case\"utf-8\":case\"ascii\":case\"latin1\":case\"binary\":case\"base64\":case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return!0;default:return!1}},u.concat=function(e,t){if(!K(e))throw new TypeError('\"list\" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(!u.isBuffer(a))throw new TypeError('\"list\" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},u.byteLength=f,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(0!=e%2)throw new RangeError(\"Buffer size must be a multiple of 16-bits\");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(0!=e%4)throw new RangeError(\"Buffer size must be a multiple of 32-bits\");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(0!=e%8)throw new RangeError(\"Buffer size must be a multiple of 64-bits\");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0==e?\"\":0===arguments.length?C(this,0,e):function(e,t,n){var r=!1;if((void 0===t||0>t)&&(t=0),t>this.length)return\"\";if((void 0===n||n>this.length)&&(n=this.length),0>=n)return\"\";if((n>>>=0)<=(t>>>=0))return\"\";for(e||(e=\"utf8\");;)switch(e){case\"hex\":return S(this,t,n);case\"utf8\":case\"utf-8\":return C(this,t,n);case\"ascii\":return w(this,t,n);case\"latin1\":case\"binary\":return R(this,t,n);case\"base64\":return A(this,t,n);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return M(this,t,n);default:if(r)throw new TypeError(\"Unknown encoding: \"+e);e=(e+\"\").toLowerCase(),r=!0}}.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError(\"Argument must be a Buffer\");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e=\"\",n=t.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString(\"hex\",0,n).match(/.{2}/g).join(\" \"),this.length>n&&(e+=\" ... \")),\"<Buffer \"+e+\">\"},u.prototype.compare=function(e,t,n,r,a){if(!u.isBuffer(e))throw new TypeError(\"Argument must be a Buffer\");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),0>t||n>e.length||0>r||a>this.length)throw new RangeError(\"out of range index\");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(a>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),c=i(o,s),l=this.slice(r,a),h=e.slice(t,n),p=0;p<c;++p)if(l[p]!==h[p]){o=l[p],s=h[p];break}return o<s?-1:s<o?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r=\"utf8\",n=this.length,t=0;else if(void 0===n&&\"string\"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error(\"Buffer.write(string, encoding, offset[, length]) is no longer supported\");t|=0,isFinite(n)?(n|=0,void 0===r&&(r=\"utf8\")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),0<e.length&&(0>n||0>t)||t>this.length)throw new RangeError(\"Attempt to write outside buffer bounds\");r||(r=\"utf8\");for(var a=!1;;)switch(r){case\"hex\":return v(this,e,t,n);case\"utf8\":case\"utf-8\":return g(this,e,t,n);case\"ascii\":return E(this,e,t,n);case\"latin1\":case\"binary\":return T(this,e,t,n);case\"base64\":return N(this,e,t,n);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return O(this,e,t,n);default:if(a)throw new TypeError(\"Unknown encoding: \"+r);r=(\"\"+r).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:\"Buffer\",data:Array.prototype.slice.call(this._arr||this,0)}};var W=4096;u.prototype.slice=function(e,t){var n,r=this.length;if(0>(e=~~e)?0>(e+=r)&&(e=0):e>r&&(e=r),0>(t=void 0===t?r:~~t)?0>(t+=r)&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var r=this[e+--t],i=1;0<t&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||j(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||j(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||j(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||j(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||j(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var i=this[e],a=1,o=0;++o<t&&(a*=256);)i+=this[e+o]*a;return i>=(a*=128)&&(i-=r(2,8*t)),i},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||j(e,t,this.length);for(var i=t,a=1,o=this[e+--i];0<i&&(a*=256);)o+=this[e+--i]*a;return o>=(a*=128)&&(o-=r(2,8*t)),o},u.prototype.readInt8=function(e,t){return t||j(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||j(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||j(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||j(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||j(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||j(e,4,this.length),V.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||j(e,4,this.length),V.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||j(e,8,this.length),V.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||j(e,8,this.length),V.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||P(this,e,t,n,r(2,8*n)-1,0);var a=1,o=0;for(this[t]=255&e;++o<n&&(a*=256);)this[t+o]=255&e/a;return t+n},u.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||P(this,e,t,n,r(2,8*n)-1,0);var a=n-1,o=1;for(this[t+a]=255&e;0<=--a&&(o*=256);)this[t+a]=255&e/o;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=a(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):I(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var a=r(2,8*n-1);P(this,e,t,n,a-1,-a)}var o=0,s=1,u=0;for(this[t]=255&e;++o<n&&(s*=256);)0>e&&0==u&&0!==this[t+o-1]&&(u=1),this[t+o]=255&(e/s>>0)-u;return t+n},u.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var a=r(2,8*n-1);P(this,e,t,n,a-1,-a)}var o=n-1,s=1,u=0;for(this[t+o]=255&e;0<=--o&&(s*=256);)0>e&&0==u&&0!==this[t+o+1]&&(u=1),this[t+o]=255&(e/s>>0)-u;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=a(e)),0>e&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):I(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return L(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return L(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return D(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return D(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),0<r&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(0>t)throw new RangeError(\"targetStart out of bounds\");if(0>n||n>=this.length)throw new RangeError(\"sourceStart out of bounds\");if(0>r)throw new RangeError(\"sourceEnd out of bounds\");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;0<=i;--i)e[i+t]=this[i+n];else if(1e3>a||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},u.prototype.fill=function(e,t,n,r){if(\"string\"==typeof e){if(\"string\"==typeof t?(r=t,t=0,n=this.length):\"string\"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);256>i&&(e=i)}if(void 0!==r&&\"string\"!=typeof r)throw new TypeError(\"encoding must be a string\");if(\"string\"==typeof r&&!u.isEncoding(r))throw new TypeError(\"Unknown encoding: \"+r)}else\"number\"==typeof e&&(e&=255);if(0>t||this.length<t||this.length<n)throw new RangeError(\"Out of range index\");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),\"number\"==typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=u.isBuffer(e)?e:B(new u(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var H=/[^+\\/0-9A-Za-z-_]/g}).call(this,n(64))},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return b});var r=n(0),i=n(31),a=n(22),o=n(8),s=n(26),u=n(3),c=n(12),l=n(13),h=n(17),p=n(1),d=n(10),f=n(41),m=n(4),y=n(18),b=function(e){function t(){return e.call(this)||this}return Object(r.c)(t,e),t.prototype.connect=function(){return Promise.resolve(this.driver.databaseConnection)},t.prototype.release=function(){return this.loadedTables=[],this.clearSqlMemory(),Promise.resolve()},t.prototype.startTransaction=function(e){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(t){switch(t.label){case 0:if(this.isTransactionActive)throw new i.a;if(this.isTransactionActive=!0,!e)return[3,4];if(\"READ UNCOMMITTED\"!==e&&\"SERIALIZABLE\"!==e)throw new Error(\"SQLite only supports SERIALIZABLE and READ UNCOMMITTED isolation\");return\"READ UNCOMMITTED\"===e?[4,this.query(\"PRAGMA read_uncommitted = true\")]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,this.query(\"PRAGMA read_uncommitted = false\")];case 3:t.sent(),t.label=4;case 4:return[4,this.query(\"BEGIN TRANSACTION\")];case 5:return t.sent(),[2]}})})},t.prototype.commitTransaction=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query(\"COMMIT\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.rollbackTransaction=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query(\"ROLLBACK\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.stream=function(){throw new Error(\"Stream is not supported by sqlite driver.\")},t.prototype.getDatabases=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve([])]})})},t.prototype.getSchemas=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve([])]})})},t.prototype.hasDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve(!1)]})})},t.prototype.hasSchema=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"This driver does not support table schemas\")})})},t.prototype.hasTable=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n;return Object(r.d)(this,function(r){switch(r.label){case 0:return t=e instanceof u.a?e.name:e,n='SELECT * FROM \"sqlite_master\" WHERE \"type\" = \\'table\\' AND \"name\" = \\''+t+\"'\",[4,this.query(n)];case 1:return[2,!!r.sent().length]}})})},t.prototype.hasColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=e instanceof u.a?e.name:e,i='PRAGMA table_info(\"'+n+'\")',[4,this.query(i)];case 1:return[2,!!r.sent().find(function(e){return e.name===t})]}})})},t.prototype.createDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve()]})})},t.prototype.dropDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve()]})})},t.prototype.createSchema=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve()]})})},t.prototype.dropSchema=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve()]})})},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),Object(r.b)(this,void 0,void 0,function(){var a,o,s=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return a=[],o=[],t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a.push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),i&&e.indices.forEach(function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(t))}),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),Object(r.b)(this,void 0,void 0,function(){var a,o,s,c,l,h=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof u.a?(s=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,c=[],l=[],i&&o.indices.forEach(function(e){c.push(h.dropIndexSql(e)),l.push(h.createIndexSql(o,e))}),c.push(this.dropTableSql(o,t)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(c,l)];case 6:return r.sent(),[2]}})})},t.prototype.createView=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),t.push(this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(this.deleteViewDefinitionSql(e)),[4,this.executeQueries(t,n)];case 1:return r.sent(),[2]}})})},t.prototype.dropView=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return t=e instanceof h.a?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],(i=[]).push(this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),a.push(this.insertViewDefinitionSql(n)),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 2:return r.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,c=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).name=t,o=new p.a('ALTER TABLE \"'+n.name+'\" RENAME TO \"'+t+'\"'),s=new p.a('ALTER TABLE \"'+t+'\" RENAME TO \"'+n.name+'\"'),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.name=a.name,a.uniques.forEach(function(e){e.name=c.connection.namingStrategy.uniqueConstraintName(a,e.columnNames)}),a.foreignKeys.forEach(function(e){e.name=c.connection.namingStrategy.foreignKeyName(a,e.columnNames,e.referencedTableName,e.referencedColumnNames)}),a.indices.forEach(function(e){e.name=c.connection.namingStrategy.indexName(a,e.columnNames,e.where)}),[4,this.recreateTable(a,n)];case 5:return r.sent(),[2]}})})},t.prototype.addColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,[2,this.addColumns(n,[t])]}})})},t.prototype.addColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addColumn(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.renameColumn=function(e,t,n){return Object(r.b)(this,void 0,void 0,function(){var i,a,s,c;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(s=t instanceof o.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+i.name+'\" table.');return c=void 0,n instanceof o.a?c=n:(c=s.clone()).name=n,[2,this.changeColumn(i,s,c)]}})})},t.prototype.changeColumn=function(e,t,n){return Object(r.b)(this,void 0,void 0,function(){var i,a,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(s=t instanceof o.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+i.name+'\" table.');return[4,this.changeColumns(i,[{oldColumn:s,newColumn:n}])];case 4:return r.sent(),[2]}})})},t.prototype.changeColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){e.newColumn.name!==e.oldColumn.name&&(a.findColumnUniques(e.oldColumn).forEach(function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.uniqueConstraintName(a,t.columnNames)}),a.findColumnForeignKeys(e.oldColumn).forEach(function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.foreignKeyName(a,t.columnNames,t.referencedTableName,t.referencedColumnNames)}),a.findColumnIndices(e.oldColumn).forEach(function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.indexName(a,t.columnNames,t.where)}));var t=a.columns.find(function(t){return t.name===e.oldColumn.name});t&&(a.columns[a.columns.indexOf(t)]=e.newColumn)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof o.a?t:n.findColumnByName(t)))throw new Error('Column \"'+t+'\" was not found in table \"'+n.name+'\"');return[4,this.dropColumns(n,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){a.removeColumn(e),a.findColumnUniques(e).forEach(function(e){return a.removeUniqueConstraint(e)}),a.findColumnIndices(e).forEach(function(e){return a.removeIndex(e)}),a.findColumnForeignKeys(e).forEach(function(e){return a.removeForeignKey(e)})}),[4,this.recreateTable(a,n)];case 4:return r.sent(),t.forEach(function(e){n.removeColumn(e),n.findColumnUniques(e).forEach(function(e){return n.removeUniqueConstraint(e)}),n.findColumnIndices(e).forEach(function(e){return n.removeIndex(e)}),n.findColumnForeignKeys(e).forEach(function(e){return n.removeForeignKey(e)})}),[2]}})})},t.prototype.createPrimaryKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),n.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),[2]}})})},t.prototype.updatePrimaryKeys=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:return[4,Promise.resolve()];case 1:return e.sent(),[2]}})})},t.prototype.dropPrimaryKey=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return(i=(t=n).clone()).primaryColumns.forEach(function(e){e.isPrimary=!1}),[4,this.recreateTable(i,t)];case 4:return r.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(n){switch(n.label){case 0:return[4,this.createUniqueConstraints(e,[t])];case 1:return n.sent(),[2]}})})},t.prototype.createUniqueConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addUniqueConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof d.a?t:n.uniques.find(function(e){return e.name===t})))throw new Error(\"Supplied unique constraint was not found in table \"+n.name);return[4,this.dropUniqueConstraints(n,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.removeUniqueConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.createCheckConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(n){switch(n.label){case 0:return[4,this.createCheckConstraints(e,[t])];case 1:return n.sent(),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addCheckConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof y.a?t:n.checks.find(function(e){return e.name===t})))throw new Error(\"Supplied check constraint was not found in table \"+n.name);return[4,this.dropCheckConstraints(n,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.removeCheckConstraint(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"Sqlite does not support exclusion constraints.\")})})},t.prototype.createExclusionConstraints=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"Sqlite does not support exclusion constraints.\")})})},t.prototype.dropExclusionConstraint=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"Sqlite does not support exclusion constraints.\")})})},t.prototype.dropExclusionConstraints=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"Sqlite does not support exclusion constraints.\")})})},t.prototype.createForeignKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(n){switch(n.label){case 0:return[4,this.createForeignKeys(e,[t])];case 1:return n.sent(),[2]}})})},t.prototype.createForeignKeys=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.addForeignKey(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof l.a?t:n.foreignKeys.find(function(e){return e.name===t})))throw new Error(\"Supplied foreign key was not found in table \"+n.name);return[4,this.dropForeignKeys(e,[a])];case 4:return r.sent(),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach(function(e){return a.removeForeignKey(e)}),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}})})},t.prototype.createIndex=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}})})},t.prototype.createIndices=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropIndex=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof c.a?t:n.indices.find(function(e){return e.name===t})))throw new Error(\"Supplied index was not found in table \"+n.name);return o=this.dropIndexSql(a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}})})},t.prototype.dropIndices=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.clearTable=function(e){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(t){switch(t.label){case 0:return[4,this.query('DELETE FROM \"'+e+'\"')];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return[4,this.query(\"PRAGMA foreign_keys = OFF;\")];case 1:return r.sent(),[4,this.startTransaction()];case 2:r.sent(),r.label=3;case 3:return r.trys.push([3,9,14,16]),\"SELECT 'DROP VIEW \\\"' || name || '\\\";' as query FROM \\\"sqlite_master\\\" WHERE \\\"type\\\" = 'view'\",[4,this.query(\"SELECT 'DROP VIEW \\\"' || name || '\\\";' as query FROM \\\"sqlite_master\\\" WHERE \\\"type\\\" = 'view'\")];case 4:return e=r.sent(),[4,Promise.all(e.map(function(e){return i.query(e.query)}))];case 5:return r.sent(),\"SELECT 'DROP TABLE \\\"' || name || '\\\";' as query FROM \\\"sqlite_master\\\" WHERE \\\"type\\\" = 'table' AND \\\"name\\\" != 'sqlite_sequence'\",[4,this.query(\"SELECT 'DROP TABLE \\\"' || name || '\\\";' as query FROM \\\"sqlite_master\\\" WHERE \\\"type\\\" = 'table' AND \\\"name\\\" != 'sqlite_sequence'\")];case 6:return t=r.sent(),[4,Promise.all(t.map(function(e){return i.query(e.query)}))];case 7:return r.sent(),[4,this.commitTransaction()];case 8:return r.sent(),[3,16];case 9:n=r.sent(),r.label=10;case 10:return r.trys.push([10,12,,13]),[4,this.rollbackTransaction()];case 11:return r.sent(),[3,13];case 12:return r.sent(),[3,13];case 13:throw n;case 14:return[4,this.query(\"PRAGMA foreign_keys = ON;\")];case 15:return r.sent(),[7];case 16:return[2]}})})},t.prototype.loadViews=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n;return Object(r.d)(this,function(r){switch(r.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return r.sent()?(t=e.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),n='SELECT \"t\".* FROM \"'+this.getTypeormMetadataTableName()+'\" \"t\" INNER JOIN \"sqlite_master\" s ON \"s\".\"name\" = \"t\".\"name\" AND \"s\".\"type\" = \\'view\\' WHERE \"t\".\"type\" = \\'VIEW\\'',0<t.length&&(n+=' AND \"t\".\"name\" IN ('+t+\")\"),[4,this.query(n)]):[2,Promise.resolve([])];case 2:return[2,r.sent().map(function(e){var t=new h.a;return t.name=e.name,t.expression=e.value,t})]}})})},t.prototype.loadTables=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a=this;return Object(r.d)(this,function(s){switch(s.label){case 0:return e&&e.length?(t=e.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),[4,this.query('SELECT * FROM \"sqlite_master\" WHERE \"type\" = \\'table\\' AND \"name\" IN ('+t+\")\")]):[2,[]];case 1:return n=s.sent(),[4,this.query('SELECT * FROM \"sqlite_master\" WHERE \"type\" = \\'index\\' AND \"tbl_name\" IN ('+t+\")\")];case 2:return i=s.sent(),n&&n.length?[2,Promise.all(n.map(function(e){return Object(r.b)(a,void 0,void 0,function(){var t,n,a,s,h,p,f,b,v,g,E,T,N,O,A,C,w,R,S=this;return Object(r.d)(this,function(M){switch(M.label){case 0:return t=new u.a({name:e.name}),n=e.sql,[4,Promise.all([this.query('PRAGMA table_info(\"'+e.name+'\")'),this.query('PRAGMA index_list(\"'+e.name+'\")'),this.query('PRAGMA foreign_key_list(\"'+e.name+'\")')])];case 1:return a=r.e.apply(void 0,[M.sent(),3]),s=a[0],h=a[1],p=a[2],f=void 0,b=e.sql,-1!==(v=b.toUpperCase().indexOf(\"AUTOINCREMENT\"))&&(f=b.substr(0,v),g=f.lastIndexOf(\",\"),E=f.lastIndexOf(\"(\"),-1===g?-1!==E&&(f=(f=(f=f.substr(E)).substr(0,f.lastIndexOf('\"'))).substr(f.indexOf('\"')+1)):f=(f=(f=f.substr(g)).substr(0,f.lastIndexOf('\"'))).substr(f.indexOf('\"')+1)),t.columns=s.map(function(e){var t=new o.a;if(t.name=e.name,t.type=e.type.toLowerCase(),t.default=null!==e.dflt_value&&void 0!==e.dflt_value?e.dflt_value:void 0,t.isNullable=0===e.notnull,t.isPrimary=0<e.pk,t.comment=\"\",t.isGenerated=f===e.name,t.isGenerated&&(t.generationStrategy=\"increment\"),\"varchar\"===t.type){var r=n.match(new RegExp('\"('+t.name+\")\\\" varchar CHECK\\\\s*\\\\(\\\\s*\\\\1\\\\s+IN\\\\s*\\\\(('[^']+'(?:\\\\s*,\\\\s*'[^']+')+)\\\\s*\\\\)\\\\s*\\\\)\"));r&&(t.type=\"simple-enum\",t.enum=r[2].substr(1,r[2].length-2).split(\"','\"))}var i=t.type.indexOf(\"(\");if(-1!==i){var a=t.type,s=a.substr(0,i);if(S.driver.withLengthColumnTypes.find(function(e){return e===s})){var u=parseInt(a.substring(i+1,a.length-1));u&&(t.length=u.toString(),t.type=s)}if(S.driver.withPrecisionColumnTypes.find(function(e){return e===s})){var c=new RegExp(\"^\"+s+\"\\\\((\\\\d+),?\\\\s?(\\\\d+)?\\\\)\"),l=a.match(c);l&&l[1]&&(t.precision=+l[1]),!!S.driver.withScaleColumnTypes.find(function(e){return e===s})&&l&&l[2]&&(t.scale=+l[2]),t.type=s}}return t}),T=m.a.uniq(p,function(e){return e.id}),t.foreignKeys=T.map(function(e){var n=p.filter(function(t){return t.id===e.id&&t.table===e.table}),r=n.map(function(e){return e.from}),i=n.map(function(e){return e.to}),a=S.connection.namingStrategy.foreignKeyName(t,r,e.referencedTableName,e.referencedColumnNames);return new l.a({name:a,columnNames:r,referencedTableName:e.table,referencedColumnNames:i,onDelete:e.on_delete,onUpdate:e.on_update})}),N=h.filter(function(e){return\"u\"===e.origin}).map(function(e){return e.name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(e){return Object(r.b)(S,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=h.find(function(t){return t.name===e}),[4,this.query('PRAGMA index_info(\"'+n.name+'\")')];case 1:return i=r.sent(),1===(a=i.sort(function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)}).map(function(e){return e.name})).length&&((o=t.columns.find(function(e){return!!a.find(function(t){return t===e.name})}))&&(o.isUnique=!0)),[2,new d.a({name:this.connection.namingStrategy.uniqueConstraintName(t,a),columnNames:a})]}})})}),O=t,[4,Promise.all(N)];case 2:for(O.uniques=M.sent(),C=/CONSTRAINT \"([^\"]*)\" CHECK (\\(.*?\\))([,]|[)]$)/g;null!==(A=C.exec(n));)t.checks.push(new y.a({name:A[1],expression:A[2]}));return w=h.filter(function(e){return\"c\"===e.origin}).map(function(e){return e.name}).filter(function(e,t,n){return n.indexOf(e)===t}).map(function(e){return Object(r.b)(S,void 0,void 0,function(){var n,a,o,s,u,l;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=i.find(function(t){return t.name===e}),a=/WHERE (.*)/.exec(n.sql),o=h.find(function(t){return t.name===e}),[4,this.query('PRAGMA index_info(\"'+o.name+'\")')];case 1:return s=r.sent(),u=s.sort(function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)}).map(function(e){return e.name}),l=\"1\"===o.unique||1===o.unique,[2,new c.a({table:t,name:o.name,columnNames:u,isUnique:l,where:a?a[1]:void 0})]}})})}),[4,Promise.all(w)];case 3:return R=M.sent(),t.indices=R.filter(function(e){return!!e}),[2,t]}})})}))]:[2,[]]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.filter(function(e){return e.isPrimary}),i=r.find(function(e){return e.isGenerated&&\"increment\"===e.generationStrategy}),a=1<r.length;if(a&&i)throw new Error(\"Sqlite does not support AUTOINCREMENT on composite primary key\");var o=e.columns.map(function(e){return n.buildCreateColumnSql(e,a)}).join(\", \"),s='CREATE TABLE \"'+e.name+'\" ('+o;(e.columns.filter(function(e){return e.isUnique}).forEach(function(t){e.uniques.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})||e.uniques.push(new d.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))}),0<e.uniques.length)&&(s+=\", \"+e.uniques.map(function(t){return'CONSTRAINT \"'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'\" UNIQUE ('+t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \")+\")\"}).join(\", \"));0<e.checks.length&&(s+=\", \"+e.checks.map(function(t){return'CONSTRAINT \"'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'\" CHECK ('+t.expression+\")\"}).join(\", \"));0<e.foreignKeys.length&&t&&(s+=\", \"+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),a='CONSTRAINT \"'+t.name+'\" FOREIGN KEY ('+r+') REFERENCES \"'+t.referencedTableName+'\" ('+i+\")\";return t.onDelete&&(a+=\" ON DELETE \"+t.onDelete),t.onUpdate&&(a+=\" ON UPDATE \"+t.onUpdate),a}).join(\", \"));1<r.length&&(s+=\", PRIMARY KEY (\"+r.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+\")\");s+=\")\";var u=this.connection.entityMetadatas.find(function(t){return t.tableName===e.name});return u&&u.withoutRowid&&(s+=\" WITHOUT ROWID\"),new p.a(s)},t.prototype.dropTableSql=function(e,t){var n=e instanceof u.a?e.name:e,r=t?'DROP TABLE IF EXISTS \"'+n+'\"':'DROP TABLE \"'+n+'\"';return new p.a(r)},t.prototype.createViewSql=function(e){return\"string\"==typeof e.expression?new p.a('CREATE VIEW \"'+e.name+'\" AS '+e.expression):new p.a('CREATE VIEW \"'+e.name+'\" AS '+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){var t=\"string\"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),n=Object(r.e)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:\"VIEW\",name:e.name,value:t}).getQueryAndParameters(),2),i=n[0],a=n[1];return new p.a(i,a)},t.prototype.dropViewSql=function(e){var t=e instanceof h.a?e.name:e;return new p.a('DROP VIEW \"'+t+'\"')},t.prototype.deleteViewDefinitionSql=function(e){var t=e instanceof h.a?e.name:e,n=this.connection.createQueryBuilder(),i=Object(r.e)(n.delete().from(this.getTypeormMetadataTableName()).where(n.escape(\"type\")+\" = 'VIEW'\").andWhere(n.escape(\"name\")+\" = :name\",{name:t}).getQueryAndParameters(),2),a=i[0],o=i[1];return new p.a(a,o)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");return new p.a(\"CREATE \"+(t.isUnique?\"UNIQUE \":\"\")+'INDEX \"'+t.name+'\" ON \"'+e.name+'\" ('+n+\") \"+(t.where?\"WHERE \"+t.where:\"\"))},t.prototype.dropIndexSql=function(e){var t=e instanceof c.a?e.name:e;return new p.a('DROP INDEX \"'+t+'\"')},t.prototype.buildCreateColumnSql=function(e,t){var n='\"'+e.name+'\"';return n+=e instanceof s.a?\" \"+this.driver.normalizeType(e):\" \"+this.connection.driver.createFullType(e),e.enum&&(n+=\" CHECK( \"+e.name+\" IN (\"+e.enum.map(function(e){return\"'\"+e+\"'\"}).join(\",\")+\") )\"),e.isPrimary&&!t&&(n+=\" PRIMARY KEY\"),!0===e.isGenerated&&\"increment\"===e.generationStrategy&&(n+=\" AUTOINCREMENT\"),e.collation&&(n+=\" COLLATE \"+e.collation),!0!==e.isNullable&&(n+=\" NOT NULL\"),void 0!==e.default&&null!==e.default&&(n+=\" DEFAULT (\"+e.default+\")\"),n},t.prototype.recreateTable=function(e,t,n){return void 0===n&&(n=!0),Object(r.b)(this,void 0,void 0,function(){var i,a,o,s,u=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return i=[],a=[],t.indices.forEach(function(e){i.push(u.dropIndexSql(e)),a.push(u.createIndexSql(t,e))}),e.name=\"temporary_\"+e.name,i.push(this.createTableSql(e,!0)),a.push(this.dropTableSql(e)),n&&(o=e.columns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s=t.columns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),t.columns.length<e.columns.length?o=e.columns.filter(function(e){return t.columns.find(function(t){return t.name===e.name})}).map(function(e){return'\"'+e.name+'\"'}).join(\", \"):t.columns.length>e.columns.length&&(s=t.columns.filter(function(t){return e.columns.find(function(e){return e.name===t.name})}).map(function(e){return'\"'+e.name+'\"'}).join(\", \")),i.push(new p.a('INSERT INTO \"'+e.name+'\"('+o+\") SELECT \"+s+' FROM \"'+t.name+'\"')),a.push(new p.a('INSERT INTO \"'+t.name+'\"('+s+\") SELECT \"+o+' FROM \"'+e.name+'\"'))),i.push(this.dropTableSql(t)),a.push(this.createTableSql(t,!0)),i.push(new p.a('ALTER TABLE \"'+e.name+'\" RENAME TO \"'+t.name+'\"')),a.push(new p.a('ALTER TABLE \"'+t.name+'\" RENAME TO \"'+e.name+'\"')),e.name=t.name,e.indices.forEach(function(t){t.name||(t.name=u.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),i.push(u.createIndexSql(e,t)),a.push(u.dropIndexSql(t))}),[4,this.executeQueries(i,a)];case 1:return r.sent(),this.replaceCachedTable(t,e),[2]}})})},t}(f.a)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(e){this.options=e}},function(e,t,n){\"use strict\";var r=n(0),i=n(1),a=function(){this.upQueries=[],this.downQueries=[]};n.d(t,\"a\",function(){return o});var o=function(){function e(){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.loadedTables=[],this.loadedViews=[],this.sqlMemoryMode=!1,this.sqlInMemory=new a}return e.prototype.getTable=function(e){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(n){switch(n.label){case 0:return t=this,[4,this.loadTables([e])];case 1:return t.loadedTables=n.sent(),[2,0<this.loadedTables.length?this.loadedTables[0]:void 0]}})})},e.prototype.getTables=function(e){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(n){switch(n.label){case 0:return t=this,[4,this.loadTables(e)];case 1:return t.loadedTables=n.sent(),[2,this.loadedTables]}})})},e.prototype.getView=function(e){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(n){switch(n.label){case 0:return t=this,[4,this.loadViews([e])];case 1:return t.loadedViews=n.sent(),[2,0<this.loadedViews.length?this.loadedViews[0]:void 0]}})})},e.prototype.getViews=function(e){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(n){switch(n.label){case 0:return t=this,[4,this.loadViews(e)];case 1:return t.loadedViews=n.sent(),[2,this.loadedViews]}})})},e.prototype.enableSqlMemory=function(){this.sqlInMemory=new a,this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlInMemory=new a,this.sqlMemoryMode=!1},e.prototype.clearSqlMemory=function(){this.sqlInMemory=new a},e.prototype.getMemorySql=function(){return this.sqlInMemory},e.prototype.executeMemoryUpSql=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i,a,o,s,u;return Object(r.d)(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),e=Object(r.g)(this.sqlInMemory.upQueries),t=e.next(),c.label=1;case 1:return t.done?[3,4]:(n=t.value,i=n.query,a=n.parameters,[4,this.query(i,a)]);case 2:c.sent(),c.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{t&&!t.done&&(u=e.return)&&u.call(e)}finally{if(s)throw s.error}return[7];case 7:return[2]}})})},e.prototype.executeMemoryDownSql=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i,a,o,s,u;return Object(r.d)(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),e=Object(r.g)(this.sqlInMemory.downQueries.reverse()),t=e.next(),c.label=1;case 1:return t.done?[3,4]:(n=t.value,i=n.query,a=n.parameters,[4,this.query(i,a)]);case 2:c.sent(),c.label=3;case 3:return t=e.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{t&&!t.done&&(u=e.return)&&u.call(e)}finally{if(s)throw s.error}return[7];case 7:return[2]}})})},e.prototype.getCachedView=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n;return Object(r.d)(this,function(r){switch(r.label){case 0:return(t=this.loadedViews.find(function(t){return t.name===e}))?[2,t]:[4,this.loadViews([e])];case 1:if(0<(n=r.sent()).length)return this.loadedViews.push(n[0]),[2,n[0]];throw new Error('View \"'+e+'\" does not exist.')}})})},e.prototype.getCachedTable=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n;return Object(r.d)(this,function(r){switch(r.label){case 0:return(t=this.loadedTables.find(function(t){return t.name===e}))?[2,t]:[4,this.loadTables([e])];case 1:if(0<(n=r.sent()).length)return this.loadedTables.push(n[0]),[2,n[0]];throw new Error('Table \"'+e+'\" does not exist.')}})})},e.prototype.replaceCachedTable=function(e,t){var n=this.loadedTables.find(function(t){return t.name===e.name});n&&(n.name=t.name,n.columns=t.columns,n.indices=t.indices,n.foreignKeys=t.foreignKeys,n.uniques=t.uniques,n.checks=t.checks,n.justCreated=t.justCreated,n.engine=t.engine)},e.prototype.getTypeormMetadataTableName=function(){var e=this.connection.driver.options;return this.connection.driver.buildTableName(\"typeorm_metadata\",e.schema,e.database)},e.prototype.isColumnChanged=function(e,t,n,r){return e.charset!==t.charset||e.collation!==t.collation||e.precision!==t.precision||e.scale!==t.scale||e.width!==t.width||e.zerofill!==t.zerofill||e.unsigned!==t.unsigned||e.asExpression!==t.asExpression||n&&e.default!==t.default||e.onUpdate!==t.onUpdate||e.isNullable!==t.isNullable||r&&e.comment!==t.comment||e.enum!==t.enum},e.prototype.isDefaultColumnLength=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&r.length)return!1}return this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&this.connection.driver.dataTypeDefaults[t.type].length&&this.connection.driver.dataTypeDefaults[t.type].length.toString()===n.toString()},e.prototype.isDefaultColumnPrecision=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.precision&&void 0!==r.precision)return!1}return this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&null!==this.connection.driver.dataTypeDefaults[t.type].precision&&void 0!==this.connection.driver.dataTypeDefaults[t.type].precision&&this.connection.driver.dataTypeDefaults[t.type].precision===n},e.prototype.isDefaultColumnScale=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.scale&&void 0!==r.scale)return!1}return this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&null!==this.connection.driver.dataTypeDefaults[t.type].scale&&void 0!==this.connection.driver.dataTypeDefaults[t.type].scale&&this.connection.driver.dataTypeDefaults[t.type].scale===n},e.prototype.executeQueries=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,a,o,s,u,c,l,h,p,d;return Object(r.d)(this,function(f){switch(f.label){case 0:if(e instanceof i.a&&(e=[e]),t instanceof i.a&&(t=[t]),(l=this.sqlInMemory.upQueries).push.apply(l,Object(r.f)(e)),(h=this.sqlInMemory.downQueries).push.apply(h,Object(r.f)(t)),!0===this.sqlMemoryMode)return[2,Promise.resolve()];f.label=1;case 1:f.trys.push([1,6,7,8]),n=Object(r.g)(e),a=n.next(),f.label=2;case 2:return a.done?[3,5]:(o=a.value,s=o.query,u=o.parameters,[4,this.query(s,u)]);case 3:f.sent(),f.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return c=f.sent(),p={error:c},[3,8];case 7:try{a&&!a.done&&(d=n.return)&&d.call(n)}finally{if(p)throw p.error}return[7];case 8:return[2]}})})},e}()},function(e,t,n){\"use strict\";function r(e,t,n){var r=[],i={};return function a(o){i[o]=!0,r.push(o),e[o].forEach(function(e){if(i[e]){if(0<=r.indexOf(e))throw r.push(e),new Error(\"Dependency Cycle Found: \"+r.join(\" -> \"))}else a(e)}),r.pop(),t&&0!==e[o].length||-1!==n.indexOf(o)||n.push(o)}}function i(e,t,n){return void 0===n&&(n=[\".js\",\".cjs\",\".ts\"]),[]}function a(e){if(l)try{var t=l.get(e);if(t)return t;if(!h||!h.fallback)return t}catch(e){if(!h||!h.fallbackOnErrors)throw e}return rt.get(e)}function o(){var e=Be.a.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new Et),e.typeormMetadataArgsStorage}function s(){return a(kt)}function u(e){return void 0===e&&(e=\"default\"),s().get(e)}function c(e,t){return void 0===t&&(t=\"default\"),s().get(t).getRepository(e)}var l,h,p=n(0),d=(n(82),n(37)),f=n(34),m=n(3),y=function(){function e(){this.nestedSetColumnNames={left:\"nsleft\",right:\"nsright\"},this.materializedPathColumnName=\"mpath\"}return e.prototype.tableName=function(e,t){return t||Object(f.d)(e)},e.prototype.closureJunctionTableName=function(e){return e+\"_closure\"},e.prototype.columnName=function(e,t,n){var r=t||e;return n.length?Object(f.a)(n.join(\"_\"))+Object(f.e)(r):r},e.prototype.relationName=function(e){return e},e.prototype.primaryKeyName=function(e,t){var n=Object(p.f)(t);n.sort();var r=(e instanceof m.a?e.name:e).replace(\".\",\"_\")+\"_\"+n.join(\"_\");return\"PK_\"+d.a.sha1(r).substr(0,27)},e.prototype.uniqueConstraintName=function(e,t){var n=Object(p.f)(t);n.sort();var r=(e instanceof m.a?e.name:e).replace(\".\",\"_\")+\"_\"+n.join(\"_\");return\"UQ_\"+d.a.sha1(r).substr(0,27)},e.prototype.relationConstraintName=function(e,t,n){var r=Object(p.f)(t);r.sort();var i=(e instanceof m.a?e.name:e).replace(\".\",\"_\")+\"_\"+r.join(\"_\");return n&&(i+=\"_\"+n),\"REL_\"+d.a.sha1(i).substr(0,26)},e.prototype.defaultConstraintName=function(e,t){var n=(e instanceof m.a?e.name:e).replace(\".\",\"_\");return\"DF_\"+d.a.sha1(n+\"_\"+t).substr(0,27)},e.prototype.foreignKeyName=function(e,t){var n=Object(p.f)(t);n.sort();var r=(e instanceof m.a?e.name:e).replace(\".\",\"_\")+\"_\"+n.join(\"_\");return\"FK_\"+d.a.sha1(r).substr(0,27)},e.prototype.indexName=function(e,t,n){var r=Object(p.f)(t);r.sort();var i=(e instanceof m.a?e.name:e).replace(\".\",\"_\")+\"_\"+r.join(\"_\");return n&&(i+=\"_\"+n),\"IDX_\"+d.a.sha1(i).substr(0,26)},e.prototype.checkConstraintName=function(e,t){var n=(e instanceof m.a?e.name:e).replace(\".\",\"_\");return\"CHK_\"+d.a.sha1(n+\"_\"+t).substr(0,26)},e.prototype.exclusionConstraintName=function(e,t){var n=(e instanceof m.a?e.name:e).replace(\".\",\"_\");return\"XCL_\"+d.a.sha1(n+\"_\"+t).substr(0,26)},e.prototype.joinColumnName=function(e,t){return Object(f.a)(e+\"_\"+t)},e.prototype.joinTableName=function(e,t,n){return Object(f.d)(e+\"_\"+n.replace(/\\./gi,\"_\")+\"_\"+t)},e.prototype.joinTableColumnDuplicationPrefix=function(e,t){return e+\"_\"+t},e.prototype.joinTableColumnName=function(e,t,n){return Object(f.a)(e+\"_\"+(n||t))},e.prototype.joinTableInverseColumnName=function(e,t,n){return this.joinTableColumnName(e,t,n)},e.prototype.prefixTableName=function(e,t){return e+t},e.prototype.eagerJoinRelationAlias=function(e,t){return e+\"_\"+t.replace(\".\",\"_\")},e}(),b=function(e){function t(n){var r=e.call(this)||this;return r.name=\"CannotExecuteNotConnectedError\",Object.setPrototypeOf(r,t.prototype),r.message='Cannot execute operation on \"'+n+'\" connection because connection is not yet established.',r}return Object(p.c)(t,e),t}(Error),v=function(e){function t(n){var r=e.call(this)||this;return r.name=\"CannotConnectAlreadyConnectedError\",Object.setPrototypeOf(r,t.prototype),r.message='Cannot create a \"'+n+'\" connection because connection to the database already established.',r}return Object(p.c)(t,e),t}(Error),g=function(e){function t(n){var r,i=e.call(this)||this;return i.name=\"EntityMetadataNotFound\",Object.setPrototypeOf(i,t.prototype),r=n instanceof Nt.a?n.options.name:\"function\"==typeof n?n.name:\"object\"==typeof n&&\"name\"in n?n.name:n,i.message='No metadata for \"'+r+'\" was found.',i}return Object(p.c)(t,e),t}(Error),E=function(e,t,n,r){this.id=e,this.timestamp=t,this.name=n,this.instance=r},T=n(7),N=n(19),O=n(2),A=function(){function e(e,t){this.connection=e,this.queryRunner=t,this.transaction=\"all\";var n=this.connection.driver.options;this.migrationsTableName=e.options.migrationsTableName||\"migrations\",this.migrationsTable=this.connection.driver.buildTableName(this.migrationsTableName,n.schema,n.database)}return e.prototype.executeMigration=function(e){return Object(p.b)(this,void 0,void 0,function(){var t=this;return Object(p.d)(this,function(){return[2,this.withQueryRunner(function(n){return Object(p.b)(t,void 0,void 0,function(){return Object(p.d)(this,function(t){switch(t.label){case 0:return[4,this.createMigrationsTableIfNotExist(n)];case 1:return t.sent(),[4,e.instance.up(n)];case 2:return t.sent(),[4,this.insertExecutedMigration(n,e)];case 3:return t.sent(),[2,e]}})})})]})})},e.prototype.getAllMigrations=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2,Promise.resolve(this.getMigrations())]})})},e.prototype.getExecutedMigrations=function(){return Object(p.b)(this,void 0,void 0,function(){var e=this;return Object(p.d)(this,function(){return[2,this.withQueryRunner(function(t){return Object(p.b)(e,void 0,void 0,function(){return Object(p.d)(this,function(e){switch(e.label){case 0:return[4,this.createMigrationsTableIfNotExist(t)];case 1:return e.sent(),[4,this.loadExecutedMigrations(t)];case 2:return[2,e.sent()]}})})})]})})},e.prototype.getPendingMigrations=function(){return Object(p.b)(this,void 0,void 0,function(){var e,t;return Object(p.d)(this,function(n){switch(n.label){case 0:return[4,this.getAllMigrations()];case 1:return e=n.sent(),[4,this.getExecutedMigrations()];case 2:return t=n.sent(),[2,e.filter(function(e){return!t.find(function(t){return t.name===e.name})})]}})})},e.prototype.insertMigration=function(e){var t=this;return new Promise(function(n,r){t.withQueryRunner(function(i){t.insertExecutedMigration(i,e).then(n).catch(r)})})},e.prototype.deleteMigration=function(e){var t=this;return new Promise(function(n,r){t.withQueryRunner(function(i){t.deleteExecutedMigration(i,e).then(n).catch(r)})})},e.prototype.showMigrations=function(){return Object(p.b)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,s,u,c,l;return Object(p.d)(this,function(h){switch(h.label){case 0:return e=!1,t=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(t)];case 1:return h.sent(),[4,this.loadExecutedMigrations(t)];case 2:n=h.sent(),r=this.getMigrations(),i=function(t){n.find(function(e){return e.name===t.name})?a.connection.logger.logSchemaBuild(\" [X] \"+t.name):(e=!0,a.connection.logger.logSchemaBuild(\" [ ] \"+t.name))},a=this;try{for(o=Object(p.g)(r),s=o.next();!s.done;s=o.next())u=s.value,i(u)}catch(e){c={error:e}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return this.queryRunner?[3,4]:[4,t.release()];case 3:h.sent(),h.label=4;case 4:return[2,e]}})})},e.prototype.executePendingMigrations=function(){return Object(p.b)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,s,u,c,l,h,d,f,m,y,b=this;return Object(p.d)(this,function(v){switch(v.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(e)];case 1:return v.sent(),[4,this.loadExecutedMigrations(e)];case 2:return t=v.sent(),n=this.getLatestTimestampMigration(t),r=this.getMigrations(),i=[],(a=r.filter(function(e){return!t.find(function(t){return t.name===e.name})})).length?[3,5]:(this.connection.logger.logSchemaBuild(\"No migrations are pending\"),this.queryRunner?[3,4]:[4,e.release()]);case 3:v.sent(),v.label=4;case 4:return[2,[]];case 5:return this.connection.logger.logSchemaBuild(t.length+\" migrations are already loaded in the database.\"),this.connection.logger.logSchemaBuild(r.length+\" migrations were found in the source code.\"),n&&this.connection.logger.logSchemaBuild(n.name+\" is the last executed migration. It was executed on \"+new Date(n.timestamp).toString()+\".\"),this.connection.logger.logSchemaBuild(a.length+\" migrations are new migrations that needs to be executed.\"),o=!1,\"all\"!==this.transaction||e.isTransactionActive?[3,7]:[4,e.startTransaction()];case 6:v.sent(),o=!0,v.label=7;case 7:v.trys.push([7,18,23,26]),s=function(t){return Object(p.d)(this,function(n){switch(n.label){case 0:return\"each\"!==u.transaction||e.isTransactionActive?[3,2]:[4,e.startTransaction()];case 1:n.sent(),o=!0,n.label=2;case 2:return[4,t.instance.up(e).then(function(){return Object(p.b)(b,void 0,void 0,function(){return Object(p.d)(this,function(n){switch(n.label){case 0:return[4,this.insertExecutedMigration(e,t)];case 1:return n.sent(),\"each\"===this.transaction&&o?[4,e.commitTransaction()]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})}).then(function(){i.push(t),b.connection.logger.logSchemaBuild(\"Migration \"+t.name+\" has been executed successfully.\")})];case 3:return n.sent(),[2]}})},u=this,v.label=8;case 8:v.trys.push([8,13,14,15]),c=Object(p.g)(a),l=c.next(),v.label=9;case 9:return l.done?[3,12]:(h=l.value,[5,s(h)]);case 10:v.sent(),v.label=11;case 11:return l=c.next(),[3,9];case 12:return[3,15];case 13:return d=v.sent(),m={error:d},[3,15];case 14:try{l&&!l.done&&(y=c.return)&&y.call(c)}finally{if(m)throw m.error}return[7];case 15:return\"all\"===this.transaction&&o?[4,e.commitTransaction()]:[3,17];case 16:v.sent(),v.label=17;case 17:return[3,26];case 18:if(f=v.sent(),!o)return[3,22];v.label=19;case 19:return v.trys.push([19,21,,22]),[4,e.rollbackTransaction()];case 20:return v.sent(),[3,22];case 21:return v.sent(),[3,22];case 22:throw f;case 23:return this.queryRunner?[3,25]:[4,e.release()];case 24:v.sent(),v.label=25;case 25:return[7];case 26:return[2,i]}})})},e.prototype.undoLastMigration=function(){return Object(p.b)(this,void 0,void 0,function(){var e,t,n,r,i,a,o;return Object(p.d)(this,function(s){switch(s.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(e)];case 1:return s.sent(),[4,this.loadExecutedMigrations(e)];case 2:if(t=s.sent(),!(n=this.getLatestExecutedMigration(t)))return this.connection.logger.logSchemaBuild(\"No migrations was found in the database. Nothing to revert!\"),[2];if(r=this.getMigrations(),!(i=r.find(function(e){return e.name===n.name})))throw new Error(\"No migration \"+n.name+\" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.\");return this.connection.logger.logSchemaBuild(t.length+\" migrations are already loaded in the database.\"),this.connection.logger.logSchemaBuild(n.name+\" is the last executed migration. It was executed on \"+new Date(n.timestamp).toString()+\".\"),this.connection.logger.logSchemaBuild(\"Now reverting it...\"),a=!1,\"none\"===this.transaction||e.isTransactionActive?[3,4]:[4,e.startTransaction()];case 3:s.sent(),a=!0,s.label=4;case 4:return s.trys.push([4,9,14,17]),[4,i.instance.down(e)];case 5:return s.sent(),[4,this.deleteExecutedMigration(e,i)];case 6:return s.sent(),this.connection.logger.logSchemaBuild(\"Migration \"+i.name+\" has been reverted successfully.\"),a?[4,e.commitTransaction()]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,17];case 9:if(o=s.sent(),!a)return[3,13];s.label=10;case 10:return s.trys.push([10,12,,13]),[4,e.rollbackTransaction()];case 11:return s.sent(),[3,13];case 12:return s.sent(),[3,13];case 13:throw o;case 14:return this.queryRunner?[3,16]:[4,e.release()];case 15:s.sent(),s.label=16;case 16:return[7];case 17:return[2]}})})},e.prototype.createMigrationsTableIfNotExist=function(e){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(t){switch(t.label){case 0:return this.connection.driver instanceof O.d?[2]:[4,e.hasTable(this.migrationsTable)];case 1:return t.sent()?[3,3]:[4,e.createTable(new m.a({name:this.migrationsTable,columns:[{name:\"id\",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationId}),isGenerated:!0,generationStrategy:\"increment\",isPrimary:!0,isNullable:!1},{name:\"timestamp\",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!1,isNullable:!1},{name:\"name\",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1}]}))];case 2:t.sent(),t.label=3;case 3:return[2]}})})},e.prototype.loadExecutedMigrations=function(e){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(t){switch(t.label){case 0:return this.connection.driver instanceof O.d?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).find().sort({_id:-1}).toArray()]:[3,2];case 1:return[2,t.sent()];case 2:return[4,this.connection.manager.createQueryBuilder(e).select().orderBy(this.connection.driver.escape(\"id\"),\"DESC\").from(this.migrationsTable,this.migrationsTableName).getRawMany()];case 3:return[2,t.sent().map(function(e){return new E(parseInt(e.id),parseInt(e.timestamp),e.name)})]}})})},e.prototype.getMigrations=function(){var e=this.connection.migrations.map(function(e){var t=e.name||e.constructor.name,n=parseInt(t.substr(-13),10);if(!n||isNaN(n))throw new Error(t+\" migration name is wrong. Migration class name should have a JavaScript timestamp appended.\");return new E(void 0,n,t,e)});return this.checkForDuplicateMigrations(e),e.sort(function(e,t){return e.timestamp-t.timestamp})},e.prototype.checkForDuplicateMigrations=function(e){var t=e.map(function(e){return e.name}),n=Array.from(new Set(t.filter(function(e,n){return t.indexOf(e)<n})));if(0<n.length)throw Error(\"Duplicate migrations: \"+n.join(\", \"))},e.prototype.getLatestTimestampMigration=function(e){var t=e.map(function(e){return e}).sort(function(e,t){return-1*(e.timestamp-t.timestamp)});return 0<t.length?t[0]:void 0},e.prototype.getLatestExecutedMigration=function(e){return 0<e.length?e[0]:void 0},e.prototype.insertExecutedMigration=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n;return Object(p.d)(this,function(r){switch(r.label){case 0:return n={},this.connection.driver instanceof T.a?(n.timestamp=new N.a(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new N.a(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),this.connection.driver instanceof O.d?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).insert(n)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,e.manager.createQueryBuilder().insert().into(this.migrationsTable).values(n).execute()];case 3:r.sent(),r.label=4;case 4:return[2]}})})},e.prototype.deleteExecutedMigration=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r;return Object(p.d)(this,function(i){switch(i.label){case 0:return n={},this.connection.driver instanceof T.a?(n.timestamp=new N.a(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new N.a(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),this.connection.driver instanceof O.d?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).deleteOne(n)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,(r=e.manager.createQueryBuilder()).delete().from(this.migrationsTable).where(r.escape(\"timestamp\")+\" = :timestamp\").andWhere(r.escape(\"name\")+\" = :name\").setParameters(n).execute()];case 3:i.sent(),i.label=4;case 4:return[2]}})})},e.prototype.withQueryRunner=function(e){return Object(p.b)(this,void 0,void 0,function(){var t;return Object(p.d)(this,function(n){switch(n.label){case 0:t=this.queryRunner||this.connection.createQueryRunner(),n.label=1;case 1:return n.trys.push([1,,2,5]),[2,e(t)];case 2:return this.queryRunner?[3,4]:[4,t.release()];case 3:n.sent(),n.label=4;case 4:return[7];case 5:return[2]}})})},e}(),C=function(e){function t(n){var r=e.call(this)||this;return r.name=\"MissingPrimaryColumnError\",Object.setPrototypeOf(r,t.prototype),r.message='Entity \"'+n.name+'\" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.',r}return Object(p.c)(t,e),t}(Error),w=function(e){function t(n){var r=e.call(this)||this;return r.name=\"CircularRelationsError\",Object.setPrototypeOf(r,t.prototype),r.message=\"Circular relations detected: \"+n+\". To resolve this issue you need to set nullable: true somewhere in this dependency structure.\",r}return Object(p.c)(t,e),t}(Error),R=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(this.nodes[e]=2===arguments.length?t:e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach(function(t){Object.keys(t).forEach(function(n){var r=t[n].indexOf(e);0<=r&&t[n].splice(r,1)},this)}))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw new Error(\"Node does not exist: \"+e)},e.prototype.setNodeData=function(e,t){if(!this.hasNode(e))throw new Error(\"Node does not exist: \"+e);this.nodes[e]=t},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw new Error(\"Node does not exist: \"+e);if(!this.hasNode(t))throw new Error(\"Node does not exist: \"+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var n;this.hasNode(e)&&(0<=(n=this.outgoingEdges[e].indexOf(t))&&this.outgoingEdges[e].splice(n,1)),this.hasNode(t)&&(0<=(n=this.incomingEdges[t].indexOf(e))&&this.incomingEdges[t].splice(n,1))},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var n=[];r(this.outgoingEdges,t,n)(e);var i=n.indexOf(e);return 0<=i&&n.splice(i,1),n}throw new Error(\"Node does not exist: \"+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var n=[];r(this.incomingEdges,t,n)(e);var i=n.indexOf(e);return 0<=i&&n.splice(i,1),n}throw new Error(\"Node does not exist: \"+e)},e.prototype.overallOrder=function(e){var t=this,n=[],i=Object.keys(this.nodes);if(0===i.length)return n;var a=r(this.outgoingEdges,!1,[]);i.forEach(function(e){a(e)});var o=r(this.outgoingEdges,e,n);return i.filter(function(e){return 0===t.incomingEdges[e].length}).forEach(function(e){o(e)}),n},e}(),S=function(e){function t(n,r,i){var a=e.call(this)||this;a.name=\"DataTypeNotSupportedError\",Object.setPrototypeOf(a,t.prototype);var o=\"string\"==typeof r?r:r.name;return a.message='Data type \"'+o+'\" in \"'+n.entityMetadata.targetName+\".\"+n.propertyName+'\" is not supported by \"'+i+'\" database.',a}return Object(p.c)(t,e),t}(Error),M=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),r.message='Option \"'+n+'\" is not set in your connection options, please define \"'+n+'\" option in your connection options or ormconfig.json',r}return Object(p.c)(t,e),t}(Error),j=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),r.message='Array initializations are not allowed in entity relations. Please remove array initialization (= []) from \"'+n.entityMetadata.targetName+\"#\"+n.propertyPath+'\". This is ORM requirement to make relations to work properly. Refer docs for more information.',r}return Object(p.c)(t,e),t}(Error),P=function(){function e(){}return e.prototype.validateMany=function(e,t){var n=this;e.forEach(function(r){return n.validate(r,e,t)}),this.validateDependencies(e),this.validateEagerRelations(e)},e.prototype.validate=function(e,t,n){if(!e.primaryColumns.length&&!e.isJunction)throw new C(e);if(\"STI\"===e.inheritancePattern){if(!e.discriminatorColumn)throw new Error(\"Entity \"+e.name+\" using single-table inheritance, it should also have a discriminator column. Did you forget to put discriminator column options?\");if(-1!==[\"\",void 0,null].indexOf(e.discriminatorValue))throw new Error(\"Entity \"+e.name+\" has empty discriminator value. Discriminator value should not be empty.\");var r=t.find(function(t){return t!==e&&t.discriminatorValue===e.discriminatorValue});if(r)throw new Error(\"Entities \"+e.name+\" and \"+r.name+\" as equal discriminator values. Make sure their discriminator values are not equal using @DiscriminatorValue decorator.\")}if((e.relationCounts.forEach(function(e){if(e.relation.isManyToOne||e.relation.isOneToOne)throw new Error(\"Relation count can not be implemented on ManyToOne or OneToOne relations.\")}),n instanceof O.d||e.columns.forEach(function(t){var r=n.normalizeType(t);if(-1===n.supportedDataTypes.indexOf(r))throw new S(t,r,n.options.type);if(t.length&&-1===n.withLengthColumnTypes.indexOf(r))throw new Error(\"Column \"+t.propertyName+\" of Entity \"+e.name+\" does not support length property.\")}),n instanceof O.h||n instanceof O.a)&&1<e.columns.filter(function(e){return e.isGenerated&&\"uuid\"!==e.generationStrategy}).length)throw new Error(\"Error in \"+e.name+\" entity. There can be only one auto-increment column in MySql table.\");if(n instanceof O.h&&(0===t.filter(function(e){return e.database}).length&&!n.database))throw new M(\"database\");if(n instanceof T.a&&1<e.columns.filter(function(e){return e.charset}).length)throw new Error(\"Character set specifying is not supported in Sql Server\");var i=e.create();e.relations.forEach(function(e){if(e.isManyToMany||e.isOneToMany){if(!1===e.persistenceEnabled)return;var t=e.getEntityValue(i);if(Array.isArray(t))throw new j(e)}}),e.relations.forEach(function(){}),e.relations.forEach(function(t){if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw new Error(\"Relation \"+e.name+\"#\"+t.propertyName+\" and \"+t.inverseRelation.entityMetadata.name+\"#\"+t.inverseRelation.propertyName+\" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.\")}),e.eagerRelations.forEach(function(){})},e.prototype.validateDependencies=function(e){var t=new R;e.forEach(function(e){t.addNode(e.name)}),e.forEach(function(e){e.relationsWithJoinColumns.filter(function(e){return!e.isNullable}).forEach(function(n){t.addDependency(e.name,n.inverseEntityMetadata.name)})});try{t.overallOrder()}catch(e){throw new w(e.toString().replace(\"Error: Dependency Cycle Found: \",\"\"))}},e.prototype.validateEagerRelations=function(e){e.forEach(function(e){e.eagerRelations.forEach(function(t){if(t.inverseRelation&&t.inverseRelation.isEager)throw new Error(\"Circular eager relations are disallowed. \"+e.targetName+\"#\"+t.propertyPath+' contains \"eager: true\", and its inverse side '+t.inverseEntityMetadata.targetName+\"#\"+t.inverseRelation.propertyPath+' contains \"eager: true\" as well. Remove \"eager: true\" from one side of the relation.')})})},e}(),x=function(e){function t(){var n=e.call(this)||this;return n.name=\"QueryRunnerProviderAlreadyReleasedError\",Object.setPrototypeOf(n,t.prototype),n.message=\"Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.\",n}return Object(p.c)(t,e),t}(Error),I=function(e){function t(n,r){var i=e.call(this)||this;i.name=\"EntityNotFound\",Object.setPrototypeOf(i,t.prototype);var a=n instanceof Nt.a?n.options.name:\"function\"==typeof n?n.name:\"object\"==typeof n&&\"name\"in n?n.name:n,o=i.stringifyCriteria(r);return i.message='Could not find any entity of type \"'+a+'\" matching: '+o,i}return Object(p.c)(t,e),t.prototype.stringifyCriteria=function(e){try{return JSON.stringify(e,null,4)}catch(e){}return\"\"+e},t}(Error),_=function(e){function t(){var n=e.call(this)||this;return n.name=\"NoNeedToReleaseEntityManagerError\",Object.setPrototypeOf(n,t.prototype),n.message=\"Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.\",n}return Object(p.c)(t,e),t}(Error),L=function(){function e(){}return e.prototype.createQueryBuilder=function(e,t){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,t||this.queryRunner)},Object.defineProperty(e.prototype,\"target\",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e.prototype.hasId=function(e){return this.manager.hasId(this.metadata.target,e)},e.prototype.getId=function(e){return this.manager.getId(this.metadata.target,e)},e.prototype.create=function(e){return this.manager.create(this.metadata.target,e)},e.prototype.merge=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(t=this.manager).merge.apply(t,Object(p.f)([this.metadata.target,e],n))},e.prototype.preload=function(e){return this.manager.preload(this.metadata.target,e)},e.prototype.save=function(e,t){return this.manager.save(this.metadata.target,e,t)},e.prototype.remove=function(e,t){return this.manager.remove(this.metadata.target,e,t)},e.prototype.softRemove=function(e,t){return this.manager.softRemove(this.metadata.target,e,t)},e.prototype.recover=function(e,t){return this.manager.recover(this.metadata.target,e,t)},e.prototype.insert=function(e){return this.manager.insert(this.metadata.target,e)},e.prototype.update=function(e,t){return this.manager.update(this.metadata.target,e,t)},e.prototype.delete=function(e){return this.manager.delete(this.metadata.target,e)},e.prototype.softDelete=function(e){return this.manager.softDelete(this.metadata.target,e)},e.prototype.restore=function(e){return this.manager.restore(this.metadata.target,e)},e.prototype.count=function(e){return this.manager.count(this.metadata.target,e)},e.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},e.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},e.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},e.prototype.findOne=function(e,t){return this.manager.findOne(this.metadata.target,e,t)},e.prototype.findOneOrFail=function(e,t){return this.manager.findOneOrFail(this.metadata.target,e,t)},e.prototype.query=function(e,t){return this.manager.query(e,t)},e.prototype.clear=function(){return this.manager.clear(this.metadata.target)},e.prototype.increment=function(e,t,n){return this.manager.increment(this.metadata.target,e,t,n)},e.prototype.decrement=function(e,t,n){return this.manager.decrement(this.metadata.target,e,t,n)},e}(),D=n(15),q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(p.c)(t,e),t.prototype.findTrees=function(){return Object(p.b)(this,void 0,void 0,function(){var e,t=this;return Object(p.d)(this,function(n){switch(n.label){case 0:return[4,this.findRoots()];case 1:return e=n.sent(),[4,Promise.all(e.map(function(e){return t.findDescendantsTree(e)}))];case 2:return n.sent(),[2,e]}})})},t.prototype.findRoots=function(){var e=this,t=this.manager.connection.namingStrategy.joinColumnName(this.metadata.treeParentRelation.propertyName,\"id\");return this.createQueryBuilder(\"treeEntity\").where(e.manager.connection.driver.escape(\"treeEntity\")+\".\"+function(t){return e.manager.connection.driver.escape(t)}(t)+\" IS NULL\").getMany()},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getMany()},t.prototype.findDescendantsTree=function(e){var t=this;return this.createDescendantsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getRawAndEntities().then(function(n){var r=t.createRelationMaps(\"treeEntity\",n.raw);return t.buildChildrenEntityTree(e,n.entities,r),e})},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getCount()},t.prototype.createDescendantsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)};if(\"closure-table\"===this.metadata.treeType){var a=this.metadata.closureJunctionTable.descendantColumns.map(function(n){return i(t)+\".\"+i(n.propertyPath)+\" = \"+i(e)+\".\"+i(n.referencedColumn.propertyPath)}).join(\" AND \"),o={},s=this.metadata.closureJunctionTable.ancestorColumns.map(function(e){return o[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),i(t)+\".\"+i(e.propertyPath)+\" = :\"+e.referencedColumn.propertyName}).join(\" AND \");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(s).setParameters(o)}if(\"nested-set\"===this.metadata.treeType){s=e+\".\"+this.metadata.nestedSetLeftColumn.propertyPath+\" BETWEEN joined.\"+this.metadata.nestedSetLeftColumn.propertyPath+\" AND joined.\"+this.metadata.nestedSetRightColumn.propertyPath;var u={};a=this.metadata.treeParentRelation.joinColumns.map(function(e){var t=e.referencedColumn.propertyPath.replace(\".\",\"_\");return u[t]=e.referencedColumn.getEntityValue(n),\"joined.\"+e.referencedColumn.propertyPath+\" = :\"+t}).join(\" AND \");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,\"joined\",s).where(a,u)}if(\"materialized-path\"===this.metadata.treeType)return this.createQueryBuilder(e).where(function(t){var i=t.subQuery().select(r.metadata.targetName+\".\"+r.metadata.materializedPathColumn.propertyPath,\"path\").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return t.setNativeParameters(i.expressionMap.nativeParameters),r.manager.connection.driver instanceof D.a?e+\".\"+r.metadata.materializedPathColumn.propertyPath+\" LIKE \"+i.getQuery()+\" || '%'\":e+\".\"+r.metadata.materializedPathColumn.propertyPath+\" LIKE CONCAT(\"+i.getQuery()+\", '%')\"});throw new Error(\"Supported only in tree entities\")},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getMany()},t.prototype.findAncestorsTree=function(e){var t=this;return this.createAncestorsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getRawAndEntities().then(function(n){var r=t.createRelationMaps(\"treeEntity\",n.raw);return t.buildParentEntityTree(e,n.entities,r),e})},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder(\"treeEntity\",\"treeClosure\",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,n){var r=this;if(\"closure-table\"===this.metadata.treeType){var i=this.metadata.closureJunctionTable.ancestorColumns.map(function(n){return t+\".\"+n.propertyPath+\" = \"+e+\".\"+n.referencedColumn.propertyPath}).join(\" AND \"),a={},o=this.metadata.closureJunctionTable.descendantColumns.map(function(e){return a[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),t+\".\"+e.propertyPath+\" = :\"+e.referencedColumn.propertyName}).join(\" AND \");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,i).where(o).setParameters(a)}if(\"nested-set\"===this.metadata.treeType){i=\"joined.\"+this.metadata.nestedSetLeftColumn.propertyPath+\" BETWEEN \"+e+\".\"+this.metadata.nestedSetLeftColumn.propertyPath+\" AND \"+e+\".\"+this.metadata.nestedSetRightColumn.propertyPath;var s={};o=this.metadata.treeParentRelation.joinColumns.map(function(e){var t=e.referencedColumn.propertyPath.replace(\".\",\"_\");return s[t]=e.referencedColumn.getEntityValue(n),\"joined.\"+e.referencedColumn.propertyPath+\" = :\"+t}).join(\" AND \");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,\"joined\",i).where(o,s)}if(\"materialized-path\"===this.metadata.treeType)return this.createQueryBuilder(e).where(function(t){var i=t.subQuery().select(r.metadata.targetName+\".\"+r.metadata.materializedPathColumn.propertyPath,\"path\").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return t.setNativeParameters(i.expressionMap.nativeParameters),r.manager.connection.driver instanceof D.a?i.getQuery()+\" LIKE \"+e+\".\"+r.metadata.materializedPathColumn.propertyPath+\" || '%'\":i.getQuery()+\" LIKE CONCAT(\"+e+\".\"+r.metadata.materializedPathColumn.propertyPath+\", '%')\"});throw new Error(\"Supported only in tree entities\")},t.prototype.createRelationMaps=function(e,t){var n=this;return t.map(function(t){var r=n.metadata.treeParentRelation.joinColumns[0],i=r.givenDatabaseName||r.databaseName,a=t[e+\"_\"+n.metadata.primaryColumns[0].databaseName],o=t[e+\"_\"+i];return{id:n.manager.connection.driver.prepareHydratedValue(a,n.metadata.primaryColumns[0]),parentId:n.manager.connection.driver.prepareHydratedValue(o,r)}})},t.prototype.buildChildrenEntityTree=function(e,t,n){var r=this,i=this.metadata.treeChildrenRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.filter(function(e){return e.parentId===a}),s=new Set(o.map(function(e){return e.id}));e[i]=t.filter(function(e){return s.has(e.id)}),e[i].forEach(function(e){r.buildChildrenEntityTree(e,t,n)})},t.prototype.buildParentEntityTree=function(e,t,n){var r=this,i=this.metadata.treeParentRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.find(function(e){return e.id===a}),s=t.find(function(e){return!!o&&e[r.metadata.primaryColumns[0].propertyName]===o.parentId});s&&(e[i]=s,this.buildParentEntityTree(e[i],t,n))},t}(L),B=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),r.message=1===n.length?'Relation \"'+n[0]+'\" was not found; please check if it is correct and really exists in your entity.':\"Relations \"+n.map(function(e){return'\"'+e+'\"'}).join(\", \")+\" were not found; please check if relations are correct and they exist in your entities.\",r}return Object(p.c)(t,e),t}(Error),U=function(){function e(){}return e.isFindOneOptions=function(e){var t=e;return t&&(Array.isArray(t.select)||t.where instanceof Object||\"string\"==typeof t.where||Array.isArray(t.relations)||t.join instanceof Object||t.order instanceof Object||t.cache instanceof Object||\"boolean\"==typeof t.cache||\"number\"==typeof t.cache||t.lock instanceof Object||t.loadRelationIds instanceof Object||\"boolean\"==typeof t.loadRelationIds||\"boolean\"==typeof t.loadEagerRelations||\"boolean\"==typeof t.withDeleted)},e.isFindManyOptions=function(e){var t=e;return t&&(this.isFindOneOptions(t)||\"number\"==typeof t.skip||\"number\"==typeof t.take||\"string\"==typeof t.skip||\"string\"==typeof t.take)},e.extractFindManyOptionsAlias=function(e){return this.isFindManyOptions(e)&&e.join?e.join.alias:void 0},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?e.where(t):e},e.applyOptionsToQueryBuilder=function(e,t){if(!t||!this.isFindOneOptions(t)&&!this.isFindManyOptions(t))return e;if(!e.expressionMap.mainAlias||!e.expressionMap.mainAlias.hasMetadata)return e;var n=e.expressionMap.mainAlias.metadata;if(t.select&&(e.select([]),t.select.forEach(function(t){if(!n.findColumnWithPropertyPath(t+\"\"))throw new Error(t+\" column was not found in the \"+n.name+\" entity.\");e.addSelect(e.alias+\".\"+t)})),t.where&&e.where(t.where),t.skip&&e.skip(t.skip),t.take&&e.take(t.take),t.order&&Object.keys(t.order).forEach(function(r){var i=t.order[r];if(!n.findColumnWithPropertyPath(r))throw new Error(r+\" column was not found in the \"+n.name+\" entity.\");1===i?e.addOrderBy(e.alias+\".\"+r,\"ASC\"):-1===i?e.addOrderBy(e.alias+\".\"+r,\"DESC\"):\"ASC\"===i?e.addOrderBy(e.alias+\".\"+r,\"ASC\"):\"DESC\"===i&&e.addOrderBy(e.alias+\".\"+r,\"DESC\")}),t.relations){var r=t.relations.map(function(e){return e});if(this.applyRelationsRecursively(e,r,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,\"\"),0<r.length)throw new B(r)}if(t.join&&(t.join.leftJoin&&Object.keys(t.join.leftJoin).forEach(function(n){e.leftJoin(t.join.leftJoin[n],n)}),t.join.innerJoin&&Object.keys(t.join.innerJoin).forEach(function(n){e.innerJoin(t.join.innerJoin[n],n)}),t.join.leftJoinAndSelect&&Object.keys(t.join.leftJoinAndSelect).forEach(function(n){e.leftJoinAndSelect(t.join.leftJoinAndSelect[n],n)}),t.join.innerJoinAndSelect&&Object.keys(t.join.innerJoinAndSelect).forEach(function(n){e.innerJoinAndSelect(t.join.innerJoinAndSelect[n],n)})),t.cache)if(t.cache instanceof Object){var i=t.cache;e.cache(i.id,i.milliseconds)}else e.cache(t.cache);return t.lock&&(\"optimistic\"===t.lock.mode?e.setLock(t.lock.mode,t.lock.version):(\"pessimistic_read\"===t.lock.mode||\"pessimistic_write\"===t.lock.mode||\"dirty_read\"===t.lock.mode||\"pessimistic_partial_write\"===t.lock.mode||\"pessimistic_write_or_fail\"===t.lock.mode)&&e.setLock(t.lock.mode)),t.withDeleted&&e.withDeleted(),!0===t.loadRelationIds?e.loadAllRelationIds():t.loadRelationIds instanceof Object&&e.loadAllRelationIds(t.loadRelationIds),e},e.applyRelationsRecursively=function(e,t,n,r,i){var a=this,o=[];if(i){var s=new RegExp(\"^\"+i.replace(\".\",\"\\\\.\")+\"\\\\.\");o=t.filter(function(e){return e.match(s)}).map(function(e){return e.replace(s,\"\")}).filter(function(e){return r.findRelationWithPropertyPath(e)})}else o=t.filter(function(e){return r.findRelationWithPropertyPath(e)});o.forEach(function(o){var s=n+\"__\"+o;e.connection.driver.maxAliasLength&&s.length>e.connection.driver.maxAliasLength&&(s=Object(f.c)(s));var u=n+\".\"+o;e.leftJoinAndSelect(u,s);var c=r.relations.find(function(e){return e.propertyName===o});c&&a.joinEagerRelations(e,s,c.inverseEntityMetadata),t.splice(t.indexOf(i?i+\".\"+o:o),1);var l=e.expressionMap.joinAttributes.find(function(e){return e.entityOrProperty===u});a.applyRelationsRecursively(e,t,l.alias.name,l.metadata,i?i+\".\"+o:o)})},e.joinEagerRelations=function(e,t,n){var r=this;n.eagerRelations.forEach(function(n){var i=e.connection.namingStrategy.eagerJoinRelationAlias(t,n.propertyPath);e.leftJoinAndSelect(t+\".\"+n.propertyPath,i),r.joinEagerRelations(e,i,n.inverseEntityMetadata)})},e}(),F=function(){function e(){}return e.prototype.transform=function(e,t,n,r){return void 0===r&&(r=!1),this.groupAndTransform(e,t,n,r),e},e.prototype.groupAndTransform=function(e,t,n,r){var i=this;void 0===r&&(r=!1),n.nonVirtualColumns.forEach(function(n){var r=n.getEntityValue(t);void 0!==r&&n.setEntityValue(e,r)}),n.relations.length&&n.relations.forEach(function(n){var a=n.getEntityValue(e),o=n.getEntityValue(t,r);if(void 0!==o)if(n.isOneToMany||n.isManyToMany){if(!Array.isArray(o))return;a||(a=[],n.setEntityValue(e,a)),o.forEach(function(e){var t=a.find(function(t){return n.inverseEntityMetadata.compareEntities(e,t)});t||(t=n.inverseEntityMetadata.create(),a.push(t)),i.groupAndTransform(t,e,n.inverseEntityMetadata,r)})}else{if(!(o instanceof Object))return void(a instanceof Object||n.setEntityValue(e,o));a||(a=n.inverseEntityMetadata.create(),n.setEntityValue(e,a)),i.groupAndTransform(a,o,n.inverseEntityMetadata,r)}})},e}(),k=function(){function e(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(e.prototype,\"target\",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"id\",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!0,configurable:!0}),e}(),Q=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,\"mainLoadMapItem\",{get:function(){return this.loadMapItems.find(function(e){return!e.relation&&!e.parentLoadMapItem})},enumerable:!0,configurable:!0}),e.prototype.addLoadMap=function(e){this.loadMapItems.find(function(t){return t.target===e.target&&t.id===e.id})||this.loadMapItems.push(e)},e.prototype.fillEntities=function(e,t){var n=this;t.forEach(function(t){var r=n.loadMapItems.find(function(n){return n.target===e&&n.metadata.compareEntities(t,n.plainEntity)});r&&(r.entity=t)})},e.prototype.groupByTargetIds=function(){var e=[];return this.loadMapItems.forEach(function(t){var n=e.find(function(e){return e.target===t.target});n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)}),e},e}(),V=function(){function e(e){this.manager=e}return e.prototype.transform=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(p.d)(this,function(a){switch(a.label){case 0:return t.hasAllPrimaryKeys(e)?(n=new Q,(r=function(e,i,a,o){var s=new k(e,i,a,o);n.addLoadMap(s),i.extractRelationValuesFromEntity(e,t.relations).filter(function(e){return null!=e}).forEach(function(e){var t=Object(p.e)(e,3),n=t[0],i=t[1],a=t[2];return r(i,a,s,n)})})(e,t),[4,Promise.all(n.groupByTargetIds().map(function(e){return i.manager.findByIds(e.target,e.ids).then(function(t){return n.fillEntities(e.target,t)})}))]):[2,Promise.reject(\"Given object does not have a primary column, cannot transform it to database entity.\")];case 1:return a.sent(),n.loadMapItems.forEach(function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(!e.parentLoadMapItem.entity[e.relation.propertyName]&&(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)}),[2,n.mainLoadMapItem?n.mainLoadMapItem.entity:void 0]}})})},e}(),K=function(e){function t(n){var r=e.call(this)||this;return r.name=\"CustomRepositoryNotFoundError\",Object.setPrototypeOf(r,t.prototype),r.message=\"Custom repository \"+(n instanceof Function?n.name:n.constructor.name)+\" was not found. Did you forgot to put @EntityRepository decorator on it?\",r}return Object(p.c)(t,e),t}(Error),W=function(e){function t(n){var r=e.call(this)||this;return r.name=\"CustomRepositoryDoesNotHaveEntityError\",Object.setPrototypeOf(r,t.prototype),r.message=\"Custom repository \"+(n instanceof Function?n.name:n.constructor.name)+\" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? \",r}return Object(p.c)(t,e),t}(Error),H=function(){function e(){}return Object.defineProperty(e.prototype,\"repository\",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new W(this.constructor);return this.manager.getRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"treeRepository\",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new W(this.constructor);return this.manager.getTreeRepository(e)},enumerable:!0,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new W(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.manager.getTreeRepository(e)},e.prototype.getCustomRepositoryTarget=function(e){var t=o().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new K(e);return t.entity},e}(),Y=function(e){function t(n){var r=e.call(this)||this;return r.name=\"CustomRepositoryCannotInheritRepositoryError\",Object.setPrototypeOf(r,t.prototype),r.message=\"Custom entity repository \"+(n instanceof Function?n.name:n.constructor.name)+\"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.\",r}return Object(p.c)(t,e),t}(Error),z=function(e){function t(n,r){var i,a=e.call(this)||this;return a.name=\"RepositoryNotFoundError\",Object.setPrototypeOf(a,t.prototype),i=r instanceof Nt.a?r.options.name:\"function\"==typeof r?r.name:\"object\"==typeof r&&\"name\"in r?r.name:r,a.message='No repository for \"'+i+'\" was found. Looks like this entity is not registered in current \"'+n+'\" connection?',a}return Object(p.c)(t,e),t}(Error),J=function(e){function t(n){var r,i=e.call(this)||this;return i.name=\"RepositoryNotTreeError\",Object.setPrototypeOf(i,t.prototype),r=n instanceof Nt.a?n.options.name:\"function\"==typeof n?n.name:\"object\"==typeof n&&\"name\"in n?n.name:n,i.message='Repository of the \"'+r+'\" class is not a TreeRepository. Try to apply @Tree decorator on your entity.',i}return Object(p.c)(t,e),t}(Error),G=function(){function e(){}return e.prototype.create=function(e,t,n){if(t.treeType){var r=new q;return Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r}r=void 0;return r=e.connection.driver instanceof O.d?new O.g:new L,Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r},e}(),X=function(e){function t(n){var r=e.call(this)||this;return r.name=\"TreeRepositoryNotSupportedError\",Object.setPrototypeOf(r,t.prototype),r.message=\"Tree repositories are not supported in \"+n.options.type+\" driver.\",r}return Object(p.c)(t,e),t}(Error),Z=function(e){function t(n,r){var i=e.call(this)||this;return i.name=\"MustBeEntityError\",Object.setPrototypeOf(i,t.prototype),i.message=\"Cannot \"+n+', given value must be an entity, instead \"'+r+'\" is given.',i}return Object(p.c)(t,e),t}(Error),$=n(20),ee=function(){function e(e){this.subjects=Object(p.f)(e),this.metadatas=this.getUniqueMetadatas(this.subjects)}return e.prototype.sort=function(e){var t=this;if(!this.metadatas.length)return this.subjects;var n=[];if(\"delete\"===e){var r=this.subjects.filter(function(e){return!e.entity&&!e.databaseEntity});n.push.apply(n,Object(p.f)(r)),this.removeAlreadySorted(r)}var i=this.getNonNullableDependencies(),a=this.toposort(i);\"insert\"===e&&(a=a.reverse()),a.forEach(function(e){var r=t.subjects.filter(function(t){return t.metadata.targetName===e});n.push.apply(n,Object(p.f)(r)),t.removeAlreadySorted(r)});var o=this.getDependencies(),s=this.toposort(o);return\"insert\"===e&&(s=s.reverse()),s.forEach(function(e){var r=t.subjects.filter(function(t){return t.metadata.targetName===e});n.push.apply(n,Object(p.f)(r)),t.removeAlreadySorted(r)}),n.push.apply(n,Object(p.f)(this.subjects)),n},e.prototype.removeAlreadySorted=function(e){var t=this;e.forEach(function(e){t.subjects.splice(t.subjects.indexOf(e),1)})},e.prototype.getUniqueMetadatas=function(e){var t=[];return e.forEach(function(e){-1===t.indexOf(e.metadata)&&t.push(e.metadata)}),t},e.prototype.getNonNullableDependencies=function(){return this.metadatas.reduce(function(e,t){return t.relationsWithJoinColumns.forEach(function(n){n.isNullable||e.push([t.targetName,n.inverseEntityMetadata.targetName])}),e},[])},e.prototype.getDependencies=function(){return this.metadatas.reduce(function(e,t){return t.relationsWithJoinColumns.forEach(function(n){n.inverseEntityMetadata===t||e.push([t.targetName,n.inverseEntityMetadata.targetName])}),e},[])},e.prototype.toposort=function(e){function t(o,s,u){if(0<=u.indexOf(o))throw new Error(\"Cyclic dependency: \"+JSON.stringify(o));if(!~n.indexOf(o))throw new Error(\"Found unknown node. Make sure to provided all involved nodes. Unknown node: \"+JSON.stringify(o));if(!a[s]){a[s]=!0;var c=e.filter(function(e){return e[0]===o});if(s=c.length){var l=u.concat(o);do{var h=c[--s][1];t(h,n.indexOf(h),l)}while(s)}i[--r]=o}}for(var n=function(e){for(var t,n=[],r=0,i=e.length;r<i;r++)t=e[r],0>n.indexOf(t[0])&&n.push(t[0]),0>n.indexOf(t[1])&&n.push(t[1]);return n}(e),r=n.length,i=Array(r),a={},o=r;o--;)a[o]||t(n[o],o,[]);return i},e}(),te=n(5),ne=n(4),re=n(23),ie=function(){function e(){}return e.prototype.compute=function(e){var t=this;e.forEach(function(n){t.computeDiffColumns(n),t.computeDiffRelationalColumns(e,n)})},e.prototype.computeDiffColumns=function(e){e.entity&&e.metadata.columns.forEach(function(t){if(!t.isVirtual&&!t.isDiscriminator){var n=e.changeMaps.find(function(e){return e.column===t});n&&e.changeMaps.splice(e.changeMaps.indexOf(n),1);var r=t.getEntityValue(e.entity);if(void 0!==r){if(e.databaseEntity){var i=t.getEntityValue(e.databaseEntity,!0);if(t.relationMetadata){var a=t.relationMetadata.getEntityValue(e.entity);if(null!=a)return}var o=r;if(null!==r){switch(t.type){case\"date\":o=te.a.mixedDateToDateString(r);break;case\"time\":case\"time with time zone\":case\"time without time zone\":case\"timetz\":o=te.a.mixedDateToTimeString(r);break;case\"datetime\":case\"datetime2\":case Date:case\"timestamp\":case\"timestamp without time zone\":case\"timestamp with time zone\":case\"timestamp with local time zone\":case\"timestamptz\":o=te.a.mixedDateToUtcDatetimeString(r),i=te.a.mixedDateToUtcDatetimeString(i);break;case\"json\":case\"jsonb\":if(ne.a.deepCompare(r,i))return;break;case\"simple-array\":o=te.a.simpleArrayToString(r),i=te.a.simpleArrayToString(i);break;case\"simple-enum\":o=te.a.simpleEnumToString(r),i=te.a.simpleEnumToString(i);break;case\"simple-json\":o=te.a.simpleJsonToString(r),i=te.a.simpleJsonToString(i)}t.transformer&&(o=re.a.transformTo(t.transformer,r))}if(o===i)return}e.diffColumns.push(t),e.changeMaps.push({column:t,value:r})}}})},e.prototype.computeDiffRelationalColumns=function(e,t){t.entity&&t.metadata.relationsWithJoinColumns.forEach(function(n){var r=n.getEntityValue(t.entity);if(void 0!==r){if(t.databaseEntity){var i=r;null!==i&&i instanceof Object&&(i=n.getRelationIdMap(i));var a=n.getEntityValue(t.databaseEntity);if(ne.a.compareIds(i,a))return;t.diffRelations.push(n)}var o=e.find(function(e){return e.mustBeInserted&&e.entity===r});o&&(r=o);var s=t.changeMaps.find(function(e){return e.relation===n});s?s.value=r:t.changeMaps.push({relation:n,value:r})}})},e}(),ae=function(e){function t(n){var r=e.call(this)||this;return r.name=\"SubjectWithoutIdentifierError\",Object.setPrototypeOf(r,t.prototype),r.message=\"Internal error. Subject \"+n.metadata.targetName+\" must have an identifier to perform operation. Please report a github issue if you face this error.\",r}return Object(p.c)(t,e),t}(Error),oe=function(e){function t(n){var r=e.call(this)||this;return r.name=\"SubjectRemovedAndUpdatedError\",Object.setPrototypeOf(r,t.prototype),r.message='Removed entity \"'+n.metadata.name+'\" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).',r}return Object(p.c)(t,e),t}(Error),se=n(27),ue=n(9),ce=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n,r,i,a,o,s,u=this;return Object(p.d)(this,function(c){switch(c.label){case 0:return t=function(e){return u.queryRunner.connection.driver.escape(e)},n=this.getTableName(e.metadata.tablePath),r=t(e.metadata.nestedSetLeftColumn.databaseName),i=t(e.metadata.nestedSetRightColumn.databaseName),!(a=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(a=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),o=e.metadata.getEntityIdMap(a),s=void 0,o?[4,this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+\".\"+e.metadata.nestedSetRightColumn.propertyPath,\"right\").from(e.metadata.target,e.metadata.targetName).whereInIds(o).getRawOne().then(function(e){var t=e?e.right:void 0;return\"string\"==typeof t?parseInt(t):t})]:[3,2];case 1:s=c.sent(),c.label=2;case 2:return void 0===s?[3,4]:[4,this.queryRunner.query(\"UPDATE \"+n+\" SET \"+r+\" = CASE WHEN \"+r+\" > \"+s+\" THEN \"+r+\" + 2 ELSE \"+r+\" END,\"+i+\" = \"+i+\" + 2 WHERE \"+i+\" >= \"+s)];case 3:return c.sent(),ne.a.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(s),e.metadata.nestedSetRightColumn.createValueMap(s+1)),[3,5];case 4:ne.a.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(1),e.metadata.nestedSetRightColumn.createValueMap(2)),c.label=5;case 5:return[2]}})})},e.prototype.getTableName=function(e){var t=this;return e.split(\".\").map(function(e){return\"\"===e?e:t.queryRunner.connection.driver.escape(e)}).join(\".\")},e}(),le=function(e){function t(n){var r=e.call(this)||this;return r.name=\"CannotAttachTreeChildrenEntityError\",Object.setPrototypeOf(r,t.prototype),r.message='Cannot attach entity \"'+n+'\" to its parent. Please make sure parent is saved in the database before saving children nodes.',r}return Object(p.c)(t,e),t}(Error),he=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n,r,i,a,o,s,u,c,l,h=this;return Object(p.d)(this,function(d){switch(d.label){case 0:return t={},e.metadata.closureJunctionTable.ancestorColumns.forEach(function(n){t[n.databaseName]=e.identifier}),e.metadata.closureJunctionTable.descendantColumns.forEach(function(n){t[n.databaseName]=e.identifier}),[4,this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.closureJunctionTable.tablePath).values(t).updateEntity(!1).callListeners(!1).execute()];case 1:return d.sent(),!(n=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(n=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),n?(r=function(e){return h.queryRunner.connection.driver.escape(e)},i=this.getTableName(e.metadata.closureJunctionTable.tablePath),a=e.metadata.closureJunctionTable.ancestorColumns.map(function(e){return r(e.databaseName)}),o=e.metadata.closureJunctionTable.descendantColumns.map(function(e){return r(e.databaseName)}),s=[],u=e.metadata.primaryColumns.map(function(t){return t.getEntityValue(e.insertedValueSet)}),c=e.metadata.primaryColumns.map(function(e,t){return s.push(u[t]),h.queryRunner.connection.driver.createParameter(\"child_entity_\"+e.databaseName,s.length-1)}),l=e.metadata.primaryColumns.map(function(t){var i=r(t.databaseName+\"_descendant\"),a=t.getEntityValue(n);if(!a)throw new le(e.metadata.name);return s.push(a),i+\" = \"+h.queryRunner.connection.driver.createParameter(\"parent_entity_\"+t.databaseName,s.length-1)}).join(\", \"),[4,this.queryRunner.query(\"INSERT INTO \"+i+\" (\"+Object(p.f)(a,o).join(\", \")+\") SELECT \"+a.join(\", \")+\", \"+c.join(\", \")+\" FROM \"+i+\" WHERE \"+l,s)]):[3,3];case 2:d.sent(),d.label=3;case 3:return[2]}})})},e.prototype.getTableName=function(e){var t=this;return e.split(\".\").map(function(e){return\"\"===e?e:t.queryRunner.connection.driver.escape(e)}).join(\".\")},e}(),pe=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n,r,i,a;return Object(p.d)(this,function(o){switch(o.label){case 0:return!(t=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(t=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),n=e.metadata.getEntityIdMap(t),r=\"\",n?[4,this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+\".\"+e.metadata.materializedPathColumn.propertyPath,\"path\").from(e.metadata.target,e.metadata.targetName).whereInIds(n).getRawOne().then(function(e){return e?e.path:void 0})]:[3,2];case 1:r=o.sent(),o.label=2;case 2:return i=e.metadata.treeParentRelation.joinColumns.map(function(t){return t.referencedColumn.getEntityValue(e.insertedValueSet)}).join(\"_\"),[4,this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set((a={},a[e.metadata.materializedPathColumn.propertyPath]=r+i+\".\",a)).where(e.identifier).execute()];case 3:return o.sent(),[2]}})})},e}(),de=function(){function e(e,t,n){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.softRemoveSubjects=[],this.recoverSubjects=[],this.queryRunner=e,this.allSubjects=t,this.options=n,this.validate(),this.recompute()}return e.prototype.execute=function(){return Object(p.b)(this,void 0,void 0,function(){var e;return Object(p.d)(this,function(t){switch(t.label){case 0:return e=void 0,this.options&&!1===this.options.listeners?[3,2]:0<(e=this.broadcastBeforeEventsForAll()).promises.length?[4,Promise.all(e.promises)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e&&0<e.count&&(this.insertSubjects.forEach(function(e){return e.recompute()}),this.updateSubjects.forEach(function(e){return e.recompute()}),this.removeSubjects.forEach(function(e){return e.recompute()}),this.softRemoveSubjects.forEach(function(e){return e.recompute()}),this.recoverSubjects.forEach(function(e){return e.recompute()}),this.recompute()),this.insertSubjects=new ee(this.insertSubjects).sort(\"insert\"),[4,this.executeInsertOperations()];case 3:return t.sent(),this.updateSubjects=this.allSubjects.filter(function(e){return e.mustBeUpdated}),[4,this.executeUpdateOperations()];case 4:return t.sent(),this.removeSubjects=new ee(this.removeSubjects).sort(\"delete\"),[4,this.executeRemoveOperations()];case 5:return t.sent(),this.softRemoveSubjects=this.allSubjects.filter(function(e){return e.mustBeSoftRemoved}),[4,this.executeSoftRemoveOperations()];case 6:return t.sent(),this.recoverSubjects=this.allSubjects.filter(function(e){return e.mustBeRecovered}),[4,this.executeRecoverOperations()];case 7:return t.sent(),[4,this.updateSpecialColumnsInPersistedEntities()];case 8:return t.sent(),this.options&&!1===this.options.listeners?[3,10]:0<(e=this.broadcastAfterEventsForAll()).promises.length?[4,Promise.all(e.promises)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[2]}})})},e.prototype.validate=function(){this.allSubjects.forEach(function(e){if(e.mustBeUpdated&&e.mustBeRemoved)throw new oe(e)})},e.prototype.recompute=function(){(new ie).compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter(function(e){return e.mustBeInserted}),this.updateSubjects=this.allSubjects.filter(function(e){return e.mustBeUpdated}),this.removeSubjects=this.allSubjects.filter(function(e){return e.mustBeRemoved}),this.softRemoveSubjects=this.allSubjects.filter(function(e){return e.mustBeSoftRemoved}),this.recoverSubjects=this.allSubjects.filter(function(e){return e.mustBeRecovered}),this.hasExecutableOperations=0<this.insertSubjects.length||0<this.updateSubjects.length||0<this.removeSubjects.length||0<this.softRemoveSubjects.length||0<this.recoverSubjects.length},e.prototype.broadcastBeforeEventsForAll=function(){var e=this,t=new se.a;return this.insertSubjects.length&&this.insertSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeInsertEvent(t,n.metadata,n.entity)}),this.updateSubjects.length&&this.updateSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.removeSubjects.length&&this.removeSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)}),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.recoverSubjects.length&&this.recoverSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),t},e.prototype.broadcastAfterEventsForAll=function(){var e=this,t=new se.a;return this.insertSubjects.length&&this.insertSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterInsertEvent(t,n.metadata,n.entity)}),this.updateSubjects.length&&this.updateSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.removeSubjects.length&&this.removeSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)}),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.recoverSubjects.length&&this.recoverSubjects.forEach(function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),t},e.prototype.executeInsertOperations=function(){return Object(p.b)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,s,u,c,l,h=this;return Object(p.d)(this,function(d){switch(d.label){case 0:e=Object(p.e)(this.groupBulkSubjects(this.insertSubjects,\"insert\"),2),t=e[0],n=e[1],r=function(e){var n,r,a,o,s,u,c,l,d,f,m,y,b;return Object(p.d)(this,function(v){switch(v.label){case 0:return n=t[e],r=[],a=[],o=[],i.queryRunner.connection.driver instanceof O.d?n.forEach(function(e){e.metadata.createDateColumn&&e.entity&&(e.entity[e.metadata.createDateColumn.databaseName]=new Date),e.metadata.updateDateColumn&&e.entity&&(e.entity[e.metadata.updateDateColumn.databaseName]=new Date),e.createValueSetAndPopChangeMap(),a.push(e),r.push(e.entity)}):i.queryRunner.connection.driver instanceof ue.a?n.forEach(function(e){o.push(e)}):n.forEach(function(e){0===e.changeMaps.length||e.metadata.treeType||h.queryRunner.connection.driver instanceof ue.a||h.queryRunner.connection.driver instanceof $.a?o.push(e):(a.push(e),r.push(e.createValueSetAndPopChangeMap()))}),i.queryRunner instanceof O.f?[4,i.queryRunner.manager.insert(n[0].metadata.target,r)]:[3,2];case 1:return s=v.sent(),n.forEach(function(e,t){e.identifier=s.identifiers[t],e.generatedMap=s.generatedMaps[t],e.insertedValueSet=r[t]}),[3,12];case 2:return 0<r.length?[4,i.queryRunner.manager.createQueryBuilder().insert().into(n[0].metadata.target).values(r).updateEntity(!i.options||!1!==i.options.reload).callListeners(!1).execute()]:[3,4];case 3:u=v.sent(),a.forEach(function(e,t){e.identifier=u.identifiers[t],e.generatedMap=u.generatedMaps[t],e.insertedValueSet=r[t]}),v.label=4;case 4:if(!(0<o.length))return[3,12];c=function(e){return Object(p.d)(this,function(t){switch(t.label){case 0:return e.insertedValueSet=e.createValueSetAndPopChangeMap(),\"nested-set\"===e.metadata.treeType?[4,new ce(i.queryRunner).insert(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,i.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.target).values(e.insertedValueSet).updateEntity(!i.options||!1!==i.options.reload).callListeners(!1).execute().then(function(t){e.identifier=t.identifiers[0],e.generatedMap=t.generatedMaps[0]})];case 3:return t.sent(),\"closure-table\"===e.metadata.treeType?[4,new he(i.queryRunner).insert(e)]:[3,5];case 4:return t.sent(),[3,7];case 5:return\"materialized-path\"===e.metadata.treeType?[4,new pe(i.queryRunner).insert(e)]:[3,7];case 6:t.sent(),t.label=7;case 7:return[2]}})},v.label=5;case 5:v.trys.push([5,10,11,12]),y=void 0,l=Object(p.g)(o),d=l.next(),v.label=6;case 6:return d.done?[3,9]:(f=d.value,[5,c(f)]);case 7:v.sent(),v.label=8;case 8:return d=l.next(),[3,6];case 9:return[3,12];case 10:return m=v.sent(),y={error:m},[3,12];case 11:try{d&&!d.done&&(b=l.return)&&b.call(l)}finally{if(y)throw y.error}return[7];case 12:return n.forEach(function(e){e.generatedMap&&e.metadata.columns.forEach(function(t){var n=t.getEntityValue(e.generatedMap);if(null!=n){var r=h.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,r)}})}),[2]}})},i=this,d.label=1;case 1:d.trys.push([1,6,7,8]),a=Object(p.g)(n),o=a.next(),d.label=2;case 2:return o.done?[3,5]:(s=o.value,[5,r(s)]);case 3:d.sent(),d.label=4;case 4:return o=a.next(),[3,2];case 5:return[3,8];case 6:return u=d.sent(),c={error:u},[3,8];case 7:try{o&&!o.done&&(l=a.return)&&l.call(a)}finally{if(c)throw c.error}return[7];case 8:return[2]}})})},e.prototype.executeUpdateOperations=function(){return Object(p.b)(this,void 0,void 0,function(){var e=this;return Object(p.d)(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.updateSubjects.map(function(t){return Object(p.b)(e,void 0,void 0,function(){var e,n,r,i,a=this;return Object(p.d)(this,function(o){switch(o.label){case 0:if(!t.identifier)throw new ae(t);return this.queryRunner instanceof O.f?(e=ne.a.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)]):[3,2];case 1:return o.sent(),[3,4];case 2:return n=t.createValueSetAndPopChangeMap(),r=this.queryRunner.manager.createQueryBuilder().update(t.metadata.target).set(n).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?r.whereEntity(t.identifier):r.where(t.identifier),[4,r.execute()];case 3:i=o.sent(),t.generatedMap=i.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach(function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=a.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}}),o.label=4;case 4:return[2]}})})}))];case 1:return t.sent(),[2]}})})},e.prototype.executeRemoveOperations=function(){return Object(p.b)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,s,u,c,l;return Object(p.d)(this,function(h){switch(h.label){case 0:e=Object(p.e)(this.groupBulkSubjects(this.removeSubjects,\"delete\"),2),t=e[0],n=e[1],h.label=1;case 1:h.trys.push([1,8,9,10]),r=Object(p.g)(n),i=r.next(),h.label=2;case 2:return i.done?[3,7]:(a=i.value,o=t[a],s=o.map(function(e){if(!e.identifier)throw new ae(e);return e.identifier}),this.queryRunner instanceof O.f?[4,this.queryRunner.manager.delete(o[0].metadata.target,s)]:[3,4]);case 3:return h.sent(),[3,6];case 4:return[4,this.queryRunner.manager.createQueryBuilder().delete().from(o[0].metadata.target).where(s).callListeners(!1).execute()];case 5:h.sent(),h.label=6;case 6:return i=r.next(),[3,2];case 7:return[3,10];case 8:return u=h.sent(),c={error:u},[3,10];case 9:try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(c)throw c.error}return[7];case 10:return[2]}})})},e.prototype.executeSoftRemoveOperations=function(){return Object(p.b)(this,void 0,void 0,function(){var e=this;return Object(p.d)(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.softRemoveSubjects.map(function(t){return Object(p.b)(e,void 0,void 0,function(){var e,n,r,i=this;return Object(p.d)(this,function(a){switch(a.label){case 0:if(!t.identifier)throw new ae(t);return this.queryRunner instanceof O.f?(e=ne.a.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),t.metadata.deleteDateColumn&&t.metadata.deleteDateColumn.propertyName&&(e[t.metadata.deleteDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)]):[3,2];case 1:return a.sent(),[3,4];case 2:return n=this.queryRunner.manager.createQueryBuilder().softDelete().from(t.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?n.whereEntity(t.identifier):n.where(t.identifier),[4,n.execute()];case 3:r=a.sent(),t.generatedMap=r.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach(function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=i.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}}),a.label=4;case 4:return[2]}})})}))];case 1:return t.sent(),[2]}})})},e.prototype.executeRecoverOperations=function(){return Object(p.b)(this,void 0,void 0,function(){var e=this;return Object(p.d)(this,function(t){switch(t.label){case 0:return[4,Promise.all(this.recoverSubjects.map(function(t){return Object(p.b)(e,void 0,void 0,function(){var e,n,r,i=this;return Object(p.d)(this,function(a){switch(a.label){case 0:if(!t.identifier)throw new ae(t);return this.queryRunner instanceof O.f?(e=ne.a.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),t.metadata.deleteDateColumn&&t.metadata.deleteDateColumn.propertyName&&(e[t.metadata.deleteDateColumn.propertyName]=null),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)]):[3,2];case 1:return a.sent(),[3,4];case 2:return n=this.queryRunner.manager.createQueryBuilder().restore().from(t.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?n.whereEntity(t.identifier):n.where(t.identifier),[4,n.execute()];case 3:r=a.sent(),t.generatedMap=r.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach(function(e){var n=e.getEntityValue(t.generatedMap);if(null!=n){var r=i.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}}),a.label=4;case 4:return[2]}})})}))];case 1:return t.sent(),[2]}})})},e.prototype.updateSpecialColumnsInPersistedEntities=function(){var e=this;this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.softRemoveSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.recoverSubjects),this.removeSubjects.length&&this.removeSubjects.forEach(function(e){e.entity&&e.metadata.primaryColumns.forEach(function(t){t.setEntityValue(e.entity,void 0)})}),this.allSubjects.forEach(function(t){t.entity&&(t.metadata.relationIds.forEach(function(e){e.setValue(t.entity)}),e.queryRunner instanceof O.f&&t.metadata.objectIdColumn&&t.metadata.objectIdColumn.databaseName&&t.metadata.objectIdColumn.databaseName!==t.metadata.objectIdColumn.propertyName&&delete t.entity[t.metadata.objectIdColumn.databaseName])})},e.prototype.updateSpecialColumnsInInsertedAndUpdatedEntities=function(e){var t=this;e.forEach(function(e){e.entity&&(e.metadata.columns.forEach(function(t){if(!(0<e.metadata.childEntityMetadatas.length&&-1!==e.metadata.childEntityMetadatas.map(function(e){return e.target}).indexOf(t.target)||t.isVirtual)){if(t.isNullable)void 0===t.getEntityValue(e.entity)&&t.setEntityValue(e.entity,null);0<e.updatedRelationMaps.length&&e.updatedRelationMaps.forEach(function(t){t.relation.joinColumns.forEach(function(n){!0===n.isVirtual||n.setEntityValue(e.entity,t.value instanceof Object?n.referencedColumn.getEntityValue(t.value):t.value)})})}}),e.generatedMap&&t.queryRunner.manager.merge(e.metadata.target,e.entity,e.generatedMap))})},e.prototype.groupBulkSubjects=function(e,t){var n={},r=[],i=\"delete\"===t||this.queryRunner.connection.driver.isReturningSqlSupported();return e.forEach(function(e,t){var a=i||e.metadata.isJunction?e.metadata.name:e.metadata.name+\"_\"+t;n[a]?n[a].push(e):(n[a]=[e],r.push(a))}),[n,r]},e}(),fe=function(e){function t(n){var r=e.call(this)||this;return r.name=\"CannotDetermineEntityError\",Object.setPrototypeOf(r,t.prototype),r.message=\"Cannot \"+n+\", given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.\",r}return Object(p.c)(t,e),t}(Error),me=function(){function e(e){var t;this.identifier=void 0,this.entityWithFulfilledIds=void 0,this.databaseEntityLoaded=!1,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.canBeSoftRemoved=!1,this.canBeRecovered=!1,this.updatedRelationMaps=[],this.diffColumns=[],this.diffRelations=[],this.metadata=e.metadata,this.entity=e.entity,this.parentSubject=e.parentSubject,void 0!==e.canBeInserted&&(this.canBeInserted=e.canBeInserted),void 0!==e.canBeUpdated&&(this.canBeUpdated=e.canBeUpdated),void 0!==e.mustBeRemoved&&(this.mustBeRemoved=e.mustBeRemoved),void 0!==e.canBeSoftRemoved&&(this.canBeSoftRemoved=e.canBeSoftRemoved),void 0!==e.canBeRecovered&&(this.canBeRecovered=e.canBeRecovered),void 0!==e.identifier&&(this.identifier=e.identifier),void 0!==e.changeMaps&&(t=this.changeMaps).push.apply(t,Object(p.f)(e.changeMaps)),this.recompute()}return Object.defineProperty(e.prototype,\"mustBeInserted\",{get:function(){return this.canBeInserted&&!this.databaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mustBeUpdated\",{get:function(){return this.canBeUpdated&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)&&0<this.changeMaps.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mustBeSoftRemoved\",{get:function(){return this.canBeSoftRemoved&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mustBeRecovered\",{get:function(){return this.canBeRecovered&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!0,configurable:!0}),e.prototype.createValueSetAndPopChangeMap=function(){var t=this,n=[],r=this.changeMaps.reduce(function(r,i){var a,o=i.value;if(o instanceof e&&(o=o.insertedValueSet?o.insertedValueSet:o.entity),t.metadata.isJunction&&i.column)a=i.column.createValueMap(i.column.referencedColumn.getEntityValue(o));else if(i.column)a=i.column.createValueMap(o);else if(i.relation)if(o instanceof Object){var s=i.relation.getRelationIdMap(o);if(void 0===s)return n.push(i),t.canBeUpdated=!0,r;a=i.relation.createValueMap(s),t.updatedRelationMaps.push({relation:i.relation,value:s})}else a=i.relation.createValueMap(o),t.updatedRelationMaps.push({relation:i.relation,value:o});return ne.a.mergeDeep(r,a),r},{});return this.changeMaps=n,r},e.prototype.recompute=function(){var e=this;this.entity?(this.entityWithFulfilledIds=Object.assign({},this.entity),this.parentSubject&&this.metadata.primaryColumns.forEach(function(t){t.relationMetadata&&t.relationMetadata.inverseEntityMetadata===e.parentSubject.metadata&&t.setEntityValue(e.entityWithFulfilledIds,e.parentSubject.entity)}),this.identifier=this.metadata.getEntityIdMap(this.entityWithFulfilledIds)):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity))},e}(),ye=n(28),be=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.metadata.oneToManyRelations.forEach(function(n){!1===n.persistenceEnabled||e.buildForSubjectRelation(t,n)})})},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),void 0!==i){var a=[];i.forEach(function(i){var o=t.inverseEntityMetadata.getEntityIdMap(i),s=n.subjects.find(function(e){return e.entity===i});if(s&&(o=s.identifier),!o)return s?void s.changeMaps.push({relation:t.inverseRelation,value:e}):void 0;r.find(function(e){return ne.a.compareIds(o,e)})||(!s&&(s=new me({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:o}),n.subjects.push(s)),s.changeMaps.push({relation:t.inverseRelation,value:e})),a.push(o)}),ye.a.difference(r,a).forEach(function(r){var i=new me({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:r,changeMaps:[{relation:t.inverseRelation,value:null}]});n.subjects.push(i)})}},e}(),ve=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.metadata.oneToOneRelations.forEach(function(n){n.isOwning||!1===n.persistenceEnabled||e.buildForSubjectRelation(t,n)})})},e.prototype.buildForSubjectRelation=function(e,t){var n;e.databaseEntity&&(n=t.getEntityValue(e.databaseEntity));var r=t.getEntityValue(e.entity);if(void 0!==r){if(null===r){if(n){var i=new me({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:n,changeMaps:[{relation:t.inverseRelation,value:null}]});this.subjects.push(i)}return}var a=t.inverseEntityMetadata.getEntityIdMap(r),o=this.subjects.find(function(e){return!!e.entity&&e.entity===r});if(o&&(a=o.identifier),!a){if(!o)return;o.changeMaps.push({relation:t.inverseRelation,value:e})}n&&ne.a.compareIds(a,n)||(!o&&(o=new me({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:a}),this.subjects.push(o)),o.changeMaps.push({relation:t.inverseRelation,value:e}))}},e}(),ge=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach(function(t){t.entity&&t.metadata.manyToManyRelations.forEach(function(n){!1===n.persistenceEnabled||e.buildForSubjectRelation(t,n)})})},e.prototype.buildForAllRemoval=function(e){var t=this;e.databaseEntity&&e.metadata.manyToManyRelations.forEach(function(n){!1!==n.persistenceEnabled&&n.getEntityValue(e.databaseEntity).forEach(function(r){var i=new me({metadata:n.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:t.buildJunctionIdentifier(e,n,r)});t.subjects.push(i)})})},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),Array.isArray(i)){i.forEach(function(i){var a=t.inverseEntityMetadata.getEntityIdMap(i),o=n.subjects.find(function(e){return e.entity===i});if((o&&(a=o.identifier),a||o)&&!r.find(function(e){return ne.a.compareIds(e,a)})){var s=t.isOwning?e:o||i,u=t.isOwning?o||i:e,c=new me({metadata:t.junctionEntityMetadata,parentSubject:e,canBeInserted:!0});n.subjects.push(c),t.junctionEntityMetadata.ownerColumns.forEach(function(e){c.changeMaps.push({column:e,value:s})}),t.junctionEntityMetadata.inverseColumns.forEach(function(e){c.changeMaps.push({column:e,value:u})})}});var a=[];i.forEach(function(e){var r=t.inverseEntityMetadata.getEntityIdMap(e),i=n.subjects.find(function(t){return t.entity===e});i&&(r=i.identifier),null!=r&&a.push(r)}),r.filter(function(e){return!a.find(function(t){return ne.a.compareIds(t,e)})}).forEach(function(r){var i=new me({metadata:t.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:n.buildJunctionIdentifier(e,t,r)});n.subjects.push(i)})}},e.prototype.buildJunctionIdentifier=function(e,t,n){var r=t.isOwning?e.entity:n,i=t.isOwning?n:e.entity,a={};return t.junctionEntityMetadata.ownerColumns.forEach(function(e){ne.a.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(r)))}),t.junctionEntityMetadata.inverseColumns.forEach(function(e){ne.a.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(i)))}),a},e}(),Ee=function(){function e(e,t){this.queryRunner=e,this.subjects=t}return e.prototype.load=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n=this;return Object(p.d)(this,function(r){switch(r.label){case 0:return t=this.groupByEntityTargets().map(function(t){return Object(p.b)(n,void 0,void 0,function(){var n,r,i,a,o,s,u,c,l=this;return Object(p.d)(this,function(h){switch(h.label){case 0:return n=[],r=[],t.subjects.forEach(function(e){e.databaseEntity||!e.identifier||(n.push(e.identifier),r.push(e))}),n.length?(i=[],\"save\"===e||\"soft-remove\"===e||\"recover\"===e?t.subjects.forEach(function(e){e.metadata.relations.forEach(function(t){void 0===t.getEntityValue(e.entityWithFulfilledIds)||-1===i.indexOf(t.propertyPath)&&i.push(t.propertyPath)})}):i.push.apply(i,Object(p.f)(t.subjects[0].metadata.manyToManyRelations.map(function(e){return e.propertyPath}))),a={loadEagerRelations:!1,loadRelationIds:{relations:i,disableMixedMap:!0},withDeleted:!0},[4,this.queryRunner.manager.getRepository(t.target).findByIds(n,a)]):[2];case 1:h.sent().forEach(function(e){l.findByPersistEntityLike(t.target,e).forEach(function(t){t.databaseEntity=e,t.identifier||(t.identifier=t.metadata.hasAllPrimaryKeys(e)?t.metadata.getEntityIdMap(e):void 0)})});try{for(o=Object(p.g)(r),s=o.next();!s.done;s=o.next())s.value.databaseEntityLoaded=!0}catch(e){u={error:e}}finally{try{s&&!s.done&&(c=o.return)&&c.call(o)}finally{if(u)throw u.error}}return[2]}})})}),[4,Promise.all(t)];case 1:return r.sent(),[2]}})})},e.prototype.findByPersistEntityLike=function(e,t){return this.subjects.filter(function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))})},e.prototype.groupByEntityTargets=function(){return this.subjects.reduce(function(e,t){var n=e.find(function(e){return e.target===t.metadata.target});return n||(n={target:t.metadata.target,subjects:[]},e.push(n)),n.subjects.push(t),e},[])},e}(),Te=function(){function e(e){this.allSubjects=e}return e.prototype.build=function(e,t){var n=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).forEach(function(r){var i=Object(p.e)(r,3),a=i[0],o=i[1],s=i[2];if(null!=o&&(a.isCascadeInsert||a.isCascadeUpdate||a.isCascadeSoftRemove||a.isCascadeRecover)&&o instanceof Object){var u=n.findByPersistEntityLike(s.target,o);if(u)return!1===u.canBeInserted&&(u.canBeInserted=!0===a.isCascadeInsert&&\"save\"===t),!1===u.canBeUpdated&&(u.canBeUpdated=!0===a.isCascadeUpdate&&\"save\"===t),!1===u.canBeSoftRemoved&&(u.canBeSoftRemoved=!0===a.isCascadeSoftRemove&&\"soft-remove\"===t),void(!1===u.canBeRecovered&&(u.canBeRecovered=!0===a.isCascadeRecover&&\"recover\"===t));var c=new me({metadata:s,parentSubject:e,entity:o,canBeInserted:!0===a.isCascadeInsert&&\"save\"===t,canBeUpdated:!0===a.isCascadeUpdate&&\"save\"===t,canBeSoftRemoved:!0===a.isCascadeSoftRemove&&\"soft-remove\"===t,canBeRecovered:!0===a.isCascadeRecover&&\"recover\"===t});n.allSubjects.push(c),n.build(c,t)}})},e.prototype.findByPersistEntityLike=function(e,t){return this.allSubjects.find(function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))})},e}(),Ne=function(){function e(e,t,n,r,i,a){this.connection=e,this.queryRunner=t,this.mode=n,this.target=r,this.entity=i,this.options=a}return e.prototype.execute=function(){var e=this;return this.entity&&this.entity instanceof Object?Promise.resolve().then(function(){return Object(p.b)(e,void 0,void 0,function(){var e,t,n,r,i,a,o,s,u,c,l,h,d=this;return Object(p.d)(this,function(f){switch(f.label){case 0:e=this.queryRunner||this.connection.createQueryRunner(),this.options&&this.options.data&&(e.data=this.options.data),f.label=1;case 1:return f.trys.push([1,,21,24]),t=Array.isArray(this.entity)?this.entity:[this.entity],n=this.options&&this.options.chunk&&0<this.options.chunk?ne.a.chunk(t,this.options.chunk):[t],[4,Promise.all(n.map(function(t){return Object(p.b)(d,void 0,void 0,function(){var n,r,i=this;return Object(p.d)(this,function(a){switch(a.label){case 0:return n=[],t.forEach(function(e){var t=i.target?i.target:e.constructor;if(t===Object)throw new fe(i.mode);n.push(new me({metadata:i.connection.getMetadata(t),entity:e,canBeInserted:\"save\"===i.mode,canBeUpdated:\"save\"===i.mode,mustBeRemoved:\"remove\"===i.mode,canBeSoftRemoved:\"soft-remove\"===i.mode,canBeRecovered:\"recover\"===i.mode}))}),r=new Te(n),n.forEach(function(e){r.build(e,i.mode)}),[4,new Ee(e,n).load(this.mode)];case 1:return a.sent(),\"save\"===this.mode||\"soft-remove\"===this.mode||\"recover\"===this.mode?(new be(n).build(),new ve(n).build(),new ge(n).build()):n.forEach(function(e){e.mustBeRemoved&&new ge(n).buildForAllRemoval(e)}),[2,new de(e,n,this.options)]}})})}))];case 2:if(r=f.sent(),0===(i=r.filter(function(e){return e.hasExecutableOperations})).length)return[2];a=!1,f.label=3;case 3:return f.trys.push([3,15,,20]),e.isTransactionActive?[3,5]:this.options&&!1===this.options.transaction?[3,5]:(a=!0,[4,e.startTransaction()]);case 4:f.sent(),f.label=5;case 5:f.trys.push([5,10,11,12]),o=Object(p.g)(i),s=o.next(),f.label=6;case 6:return s.done?[3,9]:[4,s.value.execute()];case 7:f.sent(),f.label=8;case 8:return s=o.next(),[3,6];case 9:return[3,12];case 10:return u=f.sent(),l={error:u},[3,12];case 11:try{s&&!s.done&&(h=o.return)&&h.call(o)}finally{if(l)throw l.error}return[7];case 12:return!0===a?[4,e.commitTransaction()]:[3,14];case 13:f.sent(),f.label=14;case 14:return[3,20];case 15:if(c=f.sent(),!a)return[3,19];f.label=16;case 16:return f.trys.push([16,18,,19]),[4,e.rollbackTransaction()];case 17:return f.sent(),[3,19];case 18:return f.sent(),[3,19];case 19:throw c;case 20:return[3,24];case 21:return this.queryRunner?[3,23]:[4,e.release()];case 22:f.sent(),f.label=23;case 23:return[7];case 24:return[2]}})})}):Promise.reject(new Z(this.mode,this.entity))},e}(),Oe=n(21),Ae=function(){function e(e,t){this.repositories=[],this.plainObjectToEntityTransformer=new F,this.connection=e,t&&(this.queryRunner=t,Oe.a.assign(this.queryRunner,{manager:this}))}return e.prototype.transaction=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o;return Object(p.d)(this,function(s){switch(s.label){case 0:if(n=\"string\"==typeof e?e:void 0,!(r=\"function\"==typeof e?e:t))throw new Error(\"Transaction method requires callback in second paramter if isolation level is supplied.\");if(this.connection.driver instanceof O.d)throw new Error(\"Transactions aren't supported by MongoDB.\");if(this.queryRunner&&this.queryRunner.isReleased)throw new x;if(this.queryRunner&&this.queryRunner.isTransactionActive)throw new Error(\"Cannot start transaction because its already started\");i=this.queryRunner||this.connection.createQueryRunner(),s.label=1;case 1:return s.trys.push([1,8,13,16]),n?[4,i.startTransaction(n)]:[3,3];case 2:return s.sent(),[3,5];case 3:return[4,i.startTransaction()];case 4:s.sent(),s.label=5;case 5:return[4,r(i.manager)];case 6:return a=s.sent(),[4,i.commitTransaction()];case 7:return s.sent(),[2,a];case 8:o=s.sent(),s.label=9;case 9:return s.trys.push([9,11,,12]),[4,i.rollbackTransaction()];case 10:return s.sent(),[3,12];case 11:return s.sent(),[3,12];case 12:throw o;case 13:return this.queryRunner?[3,15]:[4,i.release()];case 14:s.sent(),s.label=15;case 15:return[7];case 16:return[2]}})})},e.prototype.query=function(e,t){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2,this.connection.query(e,t,this.queryRunner)]})})},e.prototype.createQueryBuilder=function(e,t,n){return t?this.connection.createQueryBuilder(e,t,n||this.queryRunner):this.connection.createQueryBuilder(e||n||this.queryRunner)},e.prototype.hasId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).hasId(r)},e.prototype.getId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e;return this.connection.getMetadata(n).getEntityIdMixedMap(r)},e.prototype.create=function(e,t){var n=this,r=this.connection.getMetadata(e);if(!t)return r.create(this.queryRunner);if(Array.isArray(t))return t.map(function(t){return n.create(e,t)});var i=r.create(this.queryRunner);return this.plainObjectToEntityTransformer.transform(i,t,r,!0),i},e.prototype.merge=function(e,t){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=this.connection.getMetadata(e);return r.forEach(function(e){return n.plainObjectToEntityTransformer.transform(t,e,a)}),t},e.prototype.preload=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r;return Object(p.d)(this,function(i){switch(i.label){case 0:return n=this.connection.getMetadata(e),[4,new V(this.connection.manager).transform(t,n)];case 1:return(r=i.sent())?[2,this.merge(e,r,t)]:[2,void 0]}})})},e.prototype.save=function(e,t,n){var r=1<arguments.length&&(e instanceof Function||e instanceof Nt.a||\"string\"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof Nt.a&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new Ne(this.connection,this.queryRunner,\"save\",r,i,a).execute().then(function(){return i})},e.prototype.remove=function(e,t,n){var r=1<arguments.length&&(e instanceof Function||\"string\"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return Array.isArray(i)&&0===i.length?Promise.resolve(i):new Ne(this.connection,this.queryRunner,\"remove\",r,i,a).execute().then(function(){return i})},e.prototype.softRemove=function(e,t,n){var r=1<arguments.length&&(e instanceof Function||e instanceof Nt.a||\"string\"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof Nt.a&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new Ne(this.connection,this.queryRunner,\"soft-remove\",r,i,a).execute().then(function(){return i})},e.prototype.recover=function(e,t,n){var r=1<arguments.length&&(e instanceof Function||e instanceof Nt.a||\"string\"==typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof Nt.a&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new Ne(this.connection,this.queryRunner,\"recover\",r,i,a).execute().then(function(){return i})},e.prototype.insert=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n=this;return Object(p.d)(this,function(r){switch(r.label){case 0:return this.connection.driver instanceof ue.a&&Array.isArray(t)?[4,Promise.all(t.map(function(t){return n.insert(e,t)}))]:[3,2];case 1:return[2,r.sent().reduce(function(e,t){return Object.assign(e,t)},{})];case 2:return[2,this.createQueryBuilder().insert().into(e).values(t).execute()]}})})},e.prototype.update=function(e,t,n){return null==t||\"\"===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error(\"Empty criteria(s) are not allowed for the update method.\")):\"string\"==typeof t||\"number\"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().update(e).set(n).whereInIds(t).execute():this.createQueryBuilder().update(e).set(n).where(t).execute()},e.prototype.delete=function(e,t){return null==t||\"\"===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error(\"Empty criteria(s) are not allowed for the delete method.\")):\"string\"==typeof t||\"number\"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().delete().from(e).whereInIds(t).execute():this.createQueryBuilder().delete().from(e).where(t).execute()},e.prototype.softDelete=function(e,t){return null==t||\"\"===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error(\"Empty criteria(s) are not allowed for the delete method.\")):\"string\"==typeof t||\"number\"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().softDelete().from(e).whereInIds(t).execute():this.createQueryBuilder().softDelete().from(e).where(t).execute()},e.prototype.restore=function(e,t){return null==t||\"\"===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error(\"Empty criteria(s) are not allowed for the delete method.\")):\"string\"==typeof t||\"number\"==typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().restore().from(e).whereInIds(t).execute():this.createQueryBuilder().restore().from(e).where(t).execute()},e.prototype.count=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r;return Object(p.d)(this,function(){return n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,U.extractFindManyOptionsAlias(t)||n.name),[2,U.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getCount()]})})},e.prototype.find=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r;return Object(p.d)(this,function(){return n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,U.extractFindManyOptionsAlias(t)||n.name),U.isFindManyOptions(t)&&!1===t.loadEagerRelations||U.joinEagerRelations(r,r.alias,n),[2,U.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getMany()]})})},e.prototype.findAndCount=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r;return Object(p.d)(this,function(){return n=this.connection.getMetadata(e),r=this.createQueryBuilder(e,U.extractFindManyOptionsAlias(t)||n.name),U.isFindManyOptions(t)&&!1===t.loadEagerRelations||U.joinEagerRelations(r,r.alias,n),[2,U.applyFindManyOptionsOrConditionsToQueryBuilder(r,t).getManyAndCount()]})})},e.prototype.findByIds=function(e,t,n){return Object(p.b)(this,void 0,void 0,function(){var r,i;return Object(p.d)(this,function(){return t.length?(r=this.connection.getMetadata(e),i=this.createQueryBuilder(e,U.extractFindManyOptionsAlias(n)||r.name),U.applyFindManyOptionsOrConditionsToQueryBuilder(i,n),U.isFindManyOptions(n)&&!1===n.loadEagerRelations||U.joinEagerRelations(i,i.alias,r),[2,i.andWhereInIds(t).getMany()]):[2,Promise.resolve([])]})})},e.prototype.findOne=function(e,t,n){return Object(p.b)(this,void 0,void 0,function(){var r,i,a,o,s,u;return Object(p.d)(this,function(){return r=void 0,U.isFindOneOptions(t)?r=t:n&&U.isFindOneOptions(n)&&(r=n),i=void 0,t instanceof Object&&!U.isFindOneOptions(t)&&(i=t),a=this.connection.getMetadata(e),o=a.name,r&&r.join?o=r.join.alias:n&&U.isFindOneOptions(n)&&n.join&&(o=n.join.alias),s=this.createQueryBuilder(e,o),r&&!1===r.loadEagerRelations||U.joinEagerRelations(s,s.alias,s.expressionMap.mainAlias.metadata),(u=\"string\"==typeof t||\"number\"==typeof t||t instanceof Date)||(r=Object(p.a)(Object(p.a)({},r||{}),{take:1})),U.applyOptionsToQueryBuilder(s,r),i?s.where(i):u&&s.andWhereInIds(a.ensureEntityIdMap(t)),[2,s.getOne()]})})},e.prototype.findOneOrFail=function(e,t,n){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2,this.findOne(e,t,n).then(function(n){return void 0===n?Promise.reject(new I(e,t)):Promise.resolve(n)})]})})},e.prototype.clear=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n;return Object(p.d)(this,function(r){switch(r.label){case 0:t=this.connection.getMetadata(e),n=this.queryRunner||this.connection.createQueryRunner(),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,n.clearTable(t.tablePath)];case 2:return[2,r.sent()];case 3:return this.queryRunner?[3,5]:[4,n.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.increment=function(e,t,n,r){return Object(p.b)(this,void 0,void 0,function(){var i,a,o,s=this;return Object(p.d)(this,function(){if(i=this.connection.getMetadata(e),!(a=i.findColumnWithPropertyPath(n)))throw new Error(\"Column \"+n+\" was not found in \"+i.targetName+\" entity.\");if(isNaN(+r))throw new Error('Value \"'+r+'\" is not a number.');return o=n.split(\".\").reduceRight(function(e,t){var n;return(n={})[t]=e,n},function(){return s.connection.driver.escape(a.databaseName)+\" + \"+r}),[2,this.createQueryBuilder(e,\"entity\").update(e).set(o).where(t).execute()]})})},e.prototype.decrement=function(e,t,n,r){return Object(p.b)(this,void 0,void 0,function(){var i,a,o,s=this;return Object(p.d)(this,function(){if(i=this.connection.getMetadata(e),!(a=i.findColumnWithPropertyPath(n)))throw new Error(\"Column \"+n+\" was not found in \"+i.targetName+\" entity.\");if(isNaN(+r))throw new Error('Value \"'+r+'\" is not a number.');return o=n.split(\".\").reduceRight(function(e,t){var n;return(n={})[t]=e,n},function(){return s.connection.driver.escape(a.databaseName)+\" - \"+r}),[2,this.createQueryBuilder(e,\"entity\").update(e).set(o).where(t).execute()]})})},e.prototype.getRepository=function(e){if(!this.connection.hasMetadata(e))throw new z(this.connection.name,e);var t=this.connection.getMetadata(e),n=this.repositories.find(function(e){return e.metadata===t});if(n)return n;var r=(new G).create(this,t,this.queryRunner);return this.repositories.push(r),r},e.prototype.getTreeRepository=function(e){if(!1===this.connection.driver.treeSupport)throw new X(this.connection.driver);var t=this.getRepository(e);if(!(t instanceof q))throw new J(e);return t},e.prototype.getMongoRepository=function(e){return this.connection.getMongoRepository(e)},e.prototype.getCustomRepository=function(e){var t=o().entityRepositories.find(function(t){return t.target===(e instanceof Function?e:e.constructor)});if(!t)throw new K(e);var n=t.entity?this.connection.getMetadata(t.entity):void 0,r=new t.target(this,n);if(r instanceof H&&!r.manager&&(r.manager=this),r instanceof L){if(!n)throw new Y(e);r.manager=this,r.metadata=n}return r},e.prototype.release=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){if(!this.queryRunner)throw new _;return[2,this.queryRunner.release()]})})},e}(),Ce=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.driver=t.driver,r}return Object(p.c)(t,e),t.prototype.loadDatabase=function(e){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(t){switch(t.label){case 0:return[4,this.driver.load(e)];case 1:return t.sent(),[2]}})})},t.prototype.saveDatabase=function(e){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(t){switch(t.label){case 0:return[4,this.driver.save(e)];case 1:return t.sent(),[2]}})})},t.prototype.exportDatabase=function(){return this.driver.export()},t}(Ae),we=n(32),Re=function(){function e(){}return e.prototype.create=function(e,t){return e.driver instanceof O.d?new O.e(e):e.driver instanceof we.a?new Ce(e,t):new Ae(e,t)},e}(),Se=function(e){function t(n){var r=e.call(this)||this;return r.name=\"MissingDriverError\",Object.setPrototypeOf(r,t.prototype),r.message='Wrong driver: \"'+n+'\" given. Supported drivers are: \"cordova\", \"expo\", \"mariadb\", \"mongodb\", \"mssql\", \"mysql\", \"oracle\", \"postgres\", \"sqlite\", \"better-sqlite3\", \"sqljs\", \"react-native\", \"aurora-data-api\", \"aurora-data-api-pg\".',r}return Object(p.c)(t,e),t}(Error),Me=n(14),je=n(24),Pe=n(39),xe=n(25),Ie=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new xe.a(n),n}return Object(p.c)(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new Me.a;return new Promise(function(r,i){return Object(p.b)(n,void 0,void 0,function(){var n,a,o=this;return Object(p.d)(this,function(s){switch(s.label){case 0:return[4,this.connect()];case 1:return n=s.sent(),this.driver.connection.logger.logQuery(e,t,this),a=+new Date,n.executeSql(e,t,function(n){var i=o.driver.connection.options.maxQueryExecutionTime,s=+new Date-a;if(i&&s>i&&o.driver.connection.logger.logQuerySlow(s,e,t,o),\"INSERT INTO\"===e.substr(0,11))r(n.insertId);else{for(var u=[],c=0;c<n.rows.length;c++)u.push(n.rows.item(c));r(u)}},function(n){o.driver.connection.logger.logQueryError(n,e,t,o),i(new je.a(e,t,n))}),[2]}})})})},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e){return'\"'+e+'\"=?'})},t}(Pe.a),_e=n(33),Le=n(29),De=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new _e.a(\"database\");if(!n.options.location)throw new _e.a(\"location\");return n.loadDependencies(),n}return Object(p.c)(t,e),t.prototype.disconnect=function(){return Object(p.b)(this,void 0,void 0,function(){var e=this;return Object(p.d)(this,function(){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)})]})})},t.prototype.createQueryRunner=function(){return this.queryRunner||(this.queryRunner=new Ie(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,function(e){var r=e;r.executeSql(\"PRAGMA foreign_keys = ON;\",[],function(){t(r)},function(e){n(e)})},function(e){n(e)})})},t.prototype.loadDependencies=function(){try{this.sqlite=window.sqlitePlugin}catch(e){throw new Le.a(\"Cordova-SQLite\",\"cordova-sqlite-storage\")}},t}(D.a),qe=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new xe.a(n),n}return Object(p.c)(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new Me.a;return new Promise(function(r,i){return Object(p.b)(n,void 0,void 0,function(){var n,a,o=this;return Object(p.d)(this,function(s){switch(s.label){case 0:return[4,this.connect()];case 1:return n=s.sent(),this.driver.connection.logger.logQuery(e,t,this),a=+new Date,n.executeSql(e,t,function(n){var i=o.driver.connection.options.maxQueryExecutionTime,s=+new Date-a;if(i&&s>i&&o.driver.connection.logger.logQuerySlow(s,e,t,o),\"INSERT INTO\"===e.substr(0,11))r(n.insertId);else{for(var u=[],c=0;c<n.rows.length;c++)u.push(n.rows.item(c));r(u)}},function(n){o.driver.connection.logger.logQueryError(n,e,t,o),i(new je.a(e,t,n))}),[2]}})})})},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e){return'\"'+e+'\"=?'})},t}(Pe.a),Be=n(6),Ue=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new _e.a(\"database\");if(!n.options.location)throw new _e.a(\"location\");return n.loadDependencies(),n}return Object(p.c)(t,e),t.prototype.disconnect=function(){return Object(p.b)(this,void 0,void 0,function(){var e=this;return Object(p.d)(this,function(){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)})]})})},t.prototype.createQueryRunner=function(){return this.queryRunner||(this.queryRunner=new qe(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,function(e){var r=e;r.executeSql(\"PRAGMA foreign_keys = ON;\",[],function(){t(r)},function(e){n(e)})},function(e){n(e)})})},t.prototype.loadDependencies=function(){try{this.sqlite=Be.a.load(\"react-native-sqlite-storage\")}catch(e){throw new Le.a(\"React-Native\",\"react-native-sqlite-storage\")}},t}(D.a),Fe=n(78),ke=n(31),Qe=n(22),Ve=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new xe.a(n),n}return Object(p.c)(t,e),t.prototype.startTransaction=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){if(this.isTransactionActive&&void 0!==this.transaction)throw new ke.a;return this.isTransactionActive=!0,[2]})})},t.prototype.commitTransaction=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){if(!this.isTransactionActive&&void 0===this.transaction)throw new Qe.a;return this.isTransactionActive=!1,this.transaction=void 0,[2]})})},t.prototype.rollbackTransaction=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){if(!this.isTransactionActive&&void 0===this.transaction)throw new Qe.a;return this.isTransactionActive=!1,this.transaction=void 0,[2]})})},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new Me.a;return new Promise(function(r,i){return Object(p.b)(n,void 0,void 0,function(){var n,a,o=this;return Object(p.d)(this,function(s){switch(s.label){case 0:return[4,this.connect()];case 1:return n=s.sent(),this.driver.connection.logger.logQuery(e,t,this),a=+new Date,n.transaction(function(n){void 0===o.transaction&&(o.startTransaction(),o.transaction=n),o.transaction.executeSql(e,t,function(n,i){var s=o.driver.connection.options.maxQueryExecutionTime,u=+new Date-a;if(s&&u>s&&o.driver.connection.logger.logQuerySlow(u,e,t,o),\"INSERT INTO\"===e.substr(0,11))r(i.insertId);else{for(var c=[],l=0;l<i.rows.length;l++)c.push(i.rows.item(l));r(c)}},function(n,r){o.driver.connection.logger.logQueryError(r,e,t,o),i(new je.a(e,t,r))})},function(){o.rollbackTransaction()},function(){o.isTransactionActive=!1,o.transaction=void 0}),[2]}})})})},t}(Pe.a),Ke=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new _e.a(\"database\");if(!n.options.driver)throw new _e.a(\"driver\");return n.sqlite=n.options.driver,n}return Object(p.c)(t,e),t.prototype.disconnect=function(){return Object(p.b)(this,void 0,void 0,function(){var e=this;return Object(p.d)(this,function(){return[2,new Promise(function(t,n){try{e.queryRunner=void 0,e.databaseConnection._db.close(),e.databaseConnection=void 0,t()}catch(e){n(e)}})]})})},t.prototype.createQueryRunner=function(){return this.queryRunner||(this.queryRunner=new Ve(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){try{var r=e.sqlite.openDatabase(e.options.database);r.transaction(function(e){e.executeSql(\"PRAGMA foreign_keys = ON;\",[],function(){t(r)},function(e,t){n({transaction:e,error:t})})},function(e){n(e)})}catch(e){n(e)}})},t}(D.a),We=n(41),He=n(18),Ye=n(8),ze=n(36),Je=n(13),Ge=n(12),Xe=n(10),Ze=n(17),$e=n(1),et=function(e){function t(t,n){return e.call(this,t,n)||this}return Object(p.c)(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(this.databaseConnectionPromise=\"slave\"===this.mode&&this.driver.isReplicated?this.driver.obtainSlaveConnection().then(function(t){var n=Object(p.e)(t,2),r=n[0],i=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=r,e.releaseCallback=i,e.databaseConnection}):this.driver.obtainMasterConnection().then(function(t){var n=Object(p.e)(t,2),r=n[0],i=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=r,e.releaseCallback=i,e.databaseConnection}),this.databaseConnectionPromise)},t.prototype.startTransaction=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new ke.a;return this.isTransactionActive=!0,[4,this.driver.client.startTransaction()];case 1:return e.sent(),[2]}})})},t.prototype.commitTransaction=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new Qe.a;return[4,this.driver.client.commitTransaction()];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.rollbackTransaction=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new Qe.a;return[4,this.driver.client.rollbackTransaction()];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.query=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n;return Object(p.d)(this,function(r){switch(r.label){case 0:if(this.isReleased)throw new Me.a;return[4,this.driver.client.query(e,t)];case 1:return(n=r.sent()).records?[2,n.records]:[2,n]}})})},t}(function(e){function t(t,n){return e.call(this,t,n)||this}return Object(p.c)(t,e),t}(function(e){function t(t,n){var r=e.call(this)||this;return r.driver=t,r.connection=t.connection,r.mode=n,r.broadcaster=new xe.a(r),r}return Object(p.c)(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(this.databaseConnectionPromise=\"slave\"===this.mode&&this.driver.isReplicated?this.driver.obtainSlaveConnection().then(function(t){var n=Object(p.e)(t,2),r=n[0],i=n[1];e.driver.connectedQueryRunners.push(e),e.databaseConnection=r;var a=function(){return e.release()};return e.releaseCallback=function(){e.databaseConnection.removeListener(\"error\",a),i()},e.databaseConnection.on(\"error\",a),e.databaseConnection}):this.driver.obtainMasterConnection().then(function(t){var n=Object(p.e)(t,2),r=n[0],i=n[1];e.driver.connectedQueryRunners.push(e),e.databaseConnection=r;var a=function(){return e.release()};return e.releaseCallback=function(){e.databaseConnection.removeListener(\"error\",a),i()},e.databaseConnection.on(\"error\",a),e.databaseConnection}),this.databaseConnectionPromise)},t.prototype.release=function(){if(this.isReleased)return Promise.resolve();this.isReleased=!0,this.releaseCallback&&this.releaseCallback();var e=this.driver.connectedQueryRunners.indexOf(this);return-1!==e&&this.driver.connectedQueryRunners.splice(e),Promise.resolve()},t.prototype.startTransaction=function(e){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(t){switch(t.label){case 0:if(this.isTransactionActive)throw new ke.a;return this.isTransactionActive=!0,[4,this.query(\"START TRANSACTION\")];case 1:return t.sent(),e?[4,this.query(\"SET TRANSACTION ISOLATION LEVEL \"+e)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.commitTransaction=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new Qe.a;return[4,this.query(\"COMMIT\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.rollbackTransaction=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new Qe.a;return[4,this.query(\"ROLLBACK\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new Me.a;return new Promise(function(r,i){return Object(p.b)(n,void 0,void 0,function(){var n,a,o,s=this;return Object(p.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,this.connect()];case 1:return n=u.sent(),this.driver.connection.logger.logQuery(e,t,this),a=+new Date,n.query(e,t,function(n,o){var u=s.driver.connection.options.maxQueryExecutionTime,c=+new Date-a;if(u&&c>u&&s.driver.connection.logger.logQuerySlow(c,e,t,s),n)s.driver.connection.logger.logQueryError(n,e,t,s),i(new je.a(e,t,n));else switch(o.command){case\"DELETE\":case\"UPDATE\":r([o.rows,o.rowCount]);break;default:r(o.rows)}}),[3,3];case 2:return o=u.sent(),i(o),[3,3];case 3:return[2]}})})})},t.prototype.stream=function(e,t,n,r){var i=this,a=this.driver.loadStreamDependency();if(this.isReleased)throw new Me.a;return new Promise(function(o,s){return Object(p.b)(i,void 0,void 0,function(){var i,u,c;return Object(p.d)(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,this.connect()];case 1:return i=l.sent(),this.driver.connection.logger.logQuery(e,t,this),u=i.query(new a(e,t)),n&&u.on(\"end\",n),r&&u.on(\"error\",r),o(u),[3,3];case 2:return c=l.sent(),s(c),[3,3];case 3:return[2]}})})})},t.prototype.getDatabases=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2,Promise.resolve([])]})})},t.prototype.getSchemas=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2,Promise.resolve([])]})})},t.prototype.hasDatabase=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2,Promise.resolve(!1)]})})},t.prototype.hasSchema=function(e){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(t){switch(t.label){case 0:return[4,this.query('SELECT * FROM \"information_schema\".\"schemata\" WHERE \"schema_name\" = \\''+e+\"'\")];case 1:return[2,!!t.sent().length]}})})},t.prototype.hasTable=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n;return Object(p.d)(this,function(r){switch(r.label){case 0:return t=this.parseTableName(e),n='SELECT * FROM \"information_schema\".\"tables\" WHERE \"table_schema\" = '+t.schema+' AND \"table_name\" = '+t.tableName,[4,this.query(n)];case 1:return[2,!!r.sent().length]}})})},t.prototype.hasColumn=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r;return Object(p.d)(this,function(i){switch(i.label){case 0:return n=this.parseTableName(e),r='SELECT * FROM \"information_schema\".\"columns\" WHERE \"table_schema\" = '+n.schema+' AND \"table_name\" = '+n.tableName+' AND \"column_name\" = \\''+t+\"'\",[4,this.query(r)];case 1:return[2,!!i.sent().length]}})})},t.prototype.createDatabase=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(e){switch(e.label){case 0:return[4,Promise.resolve()];case 1:return e.sent(),[2]}})})},t.prototype.dropDatabase=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2,Promise.resolve()]})})},t.prototype.createSchema=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r;return Object(p.d)(this,function(i){switch(i.label){case 0:return n=t?'CREATE SCHEMA IF NOT EXISTS \"'+e+'\"':'CREATE SCHEMA \"'+e+'\"',r='DROP SCHEMA \"'+e+'\" CASCADE',[4,this.executeQueries(new $e.a(n),new $e.a(r))];case 1:return i.sent(),[2]}})})},t.prototype.dropSchema=function(e,t,n){return Object(p.b)(this,void 0,void 0,function(){var r,i,a;return Object(p.d)(this,function(o){switch(o.label){case 0:return r=-1===e.indexOf(\".\")?e:e.split(\".\")[0],i=t?'DROP SCHEMA IF EXISTS \"'+r+'\" '+(n?\"CASCADE\":\"\"):'DROP SCHEMA \"'+r+'\" '+(n?\"CASCADE\":\"\"),a='CREATE SCHEMA \"'+r+'\"',[4,this.executeQueries(new $e.a(i),new $e.a(a))];case 1:return o.sent(),[2]}})})},t.prototype.createTable=function(e,t,n,r){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===r&&(r=!0),Object(p.b)(this,void 0,void 0,function(){var i,a,o=this;return Object(p.d)(this,function(s){switch(s.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(s.sent())return[2,Promise.resolve()];s.label=2;case 2:return i=[],a=[],[4,Promise.all(e.columns.filter(function(e){return\"enum\"===e.type||\"simple-enum\"===e.type}).map(function(t){return Object(p.b)(o,void 0,void 0,function(){return Object(p.d)(this,function(n){switch(n.label){case 0:return[4,this.hasEnumType(e,t)];case 1:return n.sent()||(i.push(this.createEnumTypeSql(e,t)),a.push(this.dropEnumTypeSql(e,t))),[2,Promise.resolve()]}})})}))];case 3:return s.sent(),i.push(this.createTableSql(e,n)),a.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach(function(t){return a.push(o.dropForeignKeySql(e,t))}),r&&e.indices.forEach(function(t){t.name||(t.name=o.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),i.push(o.createIndexSql(e,t)),a.push(o.dropIndexSql(e,t))}),[4,this.executeQueries(i,a)];case 4:return s.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,r){return void 0===n&&(n=!0),void 0===r&&(r=!0),Object(p.b)(this,void 0,void 0,function(){var i,a,o,s,u,c=this;return Object(p.d)(this,function(l){switch(l.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!l.sent())return[2,Promise.resolve()];l.label=2;case 2:return i=n,a=e instanceof m.a?e.name:e,[4,this.getCachedTable(a)];case 3:return o=l.sent(),s=[],u=[],r&&o.indices.forEach(function(e){s.push(c.dropIndexSql(o,e)),u.push(c.createIndexSql(o,e))}),n&&o.foreignKeys.forEach(function(e){return s.push(c.dropForeignKeySql(o,e))}),s.push(this.dropTableSql(o)),u.push(this.createTableSql(o,i)),[4,this.executeQueries(s,u)];case 4:return l.sent(),[2]}})})},t.prototype.createView=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n,r,i,a,o;return Object(p.d)(this,function(s){switch(s.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),i=(r=t).push,[4,this.insertViewDefinitionSql(e)];case 1:return i.apply(r,[s.sent()]),n.push(this.dropViewSql(e)),o=(a=n).push,[4,this.deleteViewDefinitionSql(e)];case 2:return o.apply(a,[s.sent()]),[4,this.executeQueries(t,n)];case 3:return s.sent(),[2]}})})},t.prototype.dropView=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n,r,i,a,o,s,u;return Object(p.d)(this,function(c){switch(c.label){case 0:return t=e instanceof Ze.a?e.name:e,[4,this.getCachedView(t)];case 1:return n=c.sent(),i=[],o=(a=r=[]).push,[4,this.deleteViewDefinitionSql(n)];case 2:return o.apply(a,[c.sent()]),r.push(this.dropViewSql(n)),u=(s=i).push,[4,this.insertViewDefinitionSql(n)];case 3:return u.apply(s,[c.sent()]),i.push(this.createViewSql(n)),[4,this.executeQueries(r,i)];case 4:return c.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s,u,c,l,h,d,f,y,b,v,g,E,T,N=this;return Object(p.d)(this,function(O){switch(O.label){case 0:return n=[],r=[],e instanceof m.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=O.sent(),O.label=3;case 3:o=(i=a).clone(),s=-1===i.name.indexOf(\".\")?i.name:i.name.split(\".\")[1],u=-1===i.name.indexOf(\".\")?void 0:i.name.split(\".\")[0],o.name=u?u+\".\"+t:t,n.push(new $e.a(\"ALTER TABLE \"+this.escapePath(i)+' RENAME TO \"'+t+'\"')),r.push(new $e.a(\"ALTER TABLE \"+this.escapePath(o)+' RENAME TO \"'+s+'\"')),0<o.primaryColumns.length&&(c=o.primaryColumns.map(function(e){return e.name}),l=this.connection.namingStrategy.primaryKeyName(i,c),h=this.connection.namingStrategy.primaryKeyName(o,c),n.push(new $e.a(\"ALTER TABLE \"+this.escapePath(o)+' RENAME CONSTRAINT \"'+l+'\" TO \"'+h+'\"')),r.push(new $e.a(\"ALTER TABLE \"+this.escapePath(o)+' RENAME CONSTRAINT \"'+h+'\" TO \"'+l+'\"'))),o.uniques.forEach(function(e){var t=N.connection.namingStrategy.uniqueConstraintName(o,e.columnNames);n.push(new $e.a(\"ALTER TABLE \"+N.escapePath(o)+' RENAME CONSTRAINT \"'+e.name+'\" TO \"'+t+'\"')),r.push(new $e.a(\"ALTER TABLE \"+N.escapePath(o)+' RENAME CONSTRAINT \"'+t+'\" TO \"'+e.name+'\"')),e.name=t}),o.indices.forEach(function(e){var t=N.extractSchema(o),i=N.connection.namingStrategy.indexName(o,e.columnNames,e.where),a=t?'ALTER INDEX \"'+t+'\".\"'+e.name+'\" RENAME TO \"'+i+'\"':'ALTER INDEX \"'+e.name+'\" RENAME TO \"'+i+'\"',s=t?'ALTER INDEX \"'+t+'\".\"'+i+'\" RENAME TO \"'+e.name+'\"':'ALTER INDEX \"'+i+'\" RENAME TO \"'+e.name+'\"';n.push(new $e.a(a)),r.push(new $e.a(s)),e.name=i}),o.foreignKeys.forEach(function(e){var t=N.connection.namingStrategy.foreignKeyName(o,e.columnNames,e.referencedTableName,e.referencedColumnNames);n.push(new $e.a(\"ALTER TABLE \"+N.escapePath(o)+' RENAME CONSTRAINT \"'+e.name+'\" TO \"'+t+'\"')),r.push(new $e.a(\"ALTER TABLE \"+N.escapePath(o)+' RENAME CONSTRAINT \"'+t+'\" TO \"'+e.name+'\"')),e.name=t}),d=o.columns.filter(function(e){return\"enum\"===e.type||\"simple-enum\"===e.type}),O.label=4;case 4:O.trys.push([4,9,10,11]),f=Object(p.g)(d),y=f.next(),O.label=5;case 5:return y.done?[3,8]:(b=y.value,[4,this.getEnumTypeName(i,b)]);case 6:v=O.sent(),n.push(new $e.a('ALTER TYPE \"'+v.enumTypeSchema+'\".\"'+v.enumTypeName+'\" RENAME TO '+this.buildEnumName(o,b,!1))),r.push(new $e.a(\"ALTER TYPE \"+this.buildEnumName(o,b)+' RENAME TO \"'+v.enumTypeName+'\"')),O.label=7;case 7:return y=f.next(),[3,5];case 8:return[3,11];case 9:return g=O.sent(),E={error:g},[3,11];case 10:try{y&&!y.done&&(T=f.return)&&T.call(f)}finally{if(E)throw E.error}return[7];case 11:return[4,this.executeQueries(n,r)];case 12:return O.sent(),[2]}})})},t.prototype.addColumn=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s,u,c,l,h,d,f;return Object(p.d)(this,function(p){switch(p.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=p.sent(),p.label=3;case 3:return i=(n=r).clone(),a=[],o=[],\"enum\"!==t.type&&\"simple-enum\"!==t.type?[3,5]:[4,this.hasEnumType(n,t)];case 4:p.sent()||(a.push(this.createEnumTypeSql(n,t)),o.push(this.dropEnumTypeSql(n,t))),p.label=5;case 5:return a.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+\" ADD \"+this.buildCreateColumnSql(n,t))),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP COLUMN \"'+t.name+'\"')),t.isPrimary&&(0<(s=i.primaryColumns).length&&(u=this.connection.namingStrategy.primaryKeyName(i.name,s.map(function(e){return e.name})),c=s.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),a.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+u+'\"')),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+u+'\" PRIMARY KEY ('+c+\")\"))),s.push(t),l=this.connection.namingStrategy.primaryKeyName(i.name,s.map(function(e){return e.name})),h=s.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),a.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+l+'\" PRIMARY KEY ('+h+\")\")),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+l+'\"'))),(d=i.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))&&(a.push(this.createIndexSql(n,d)),o.push(this.dropIndexSql(n,d))),t.isUnique&&(f=new Xe.a({name:this.connection.namingStrategy.uniqueConstraintName(n.name,[t.name]),columnNames:[t.name]}),i.uniques.push(f),a.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+f.name+'\" UNIQUE (\"'+t.name+'\")')),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+f.name+'\"'))),[4,this.executeQueries(a,o)];case 6:return p.sent(),i.addColumn(t),this.replaceCachedTable(n,i),[2]}})})},t.prototype.addColumns=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s;return Object(p.d)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),n=Object(p.g)(t),r=n.next(),u.label=1;case 1:return r.done?[3,4]:(i=r.value,[4,this.addColumn(e,i)]);case 2:u.sent(),u.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return a=u.sent(),o={error:a},[3,7];case 6:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.renameColumn=function(e,t,n){return Object(p.b)(this,void 0,void 0,function(){var r,i,a,o;return Object(p.d)(this,function(s){switch(s.label){case 0:return e instanceof m.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=s.sent(),s.label=3;case 3:if(r=i,!(a=t instanceof Ye.a?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+r.name+'\" table.');return n instanceof Ye.a?o=n:(o=a.clone()).name=n,[2,this.changeColumn(r,a,o)]}})})},t.prototype.changeColumn=function(e,t,n){return Object(p.b)(this,void 0,void 0,function(){var r,i,a,o,s,u,c,l,h,d,f,y,b,v,g,E,T,N,O,A,C,w,R,S,M,j,P,x=this;return Object(p.d)(this,function(p){switch(p.label){case 0:return e instanceof m.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=p.sent(),p.label=3;case 3:if(a=(r=i).clone(),o=[],s=[],!(u=t instanceof Ye.a?t:r.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+r.name+'\" table.');return u.type===n.type&&u.length===n.length?[3,6]:[4,this.dropColumn(r,u)];case 4:return p.sent(),[4,this.addColumn(r,n)];case 5:return p.sent(),a=r.clone(),[3,12];case 6:return u.name===n.name?[3,9]:(o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' RENAME COLUMN \"'+u.name+'\" TO \"'+n.name+'\"')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' RENAME COLUMN \"'+n.name+'\" TO \"'+u.name+'\"')),\"enum\"!==u.type&&\"simple-enum\"!==u.type?[3,8]:[4,this.getEnumTypeName(r,u)]);case 7:c=p.sent(),o.push(new $e.a('ALTER TYPE \"'+c.enumTypeSchema+'\".\"'+c.enumTypeName+'\" RENAME TO '+this.buildEnumName(r,n,!1))),s.push(new $e.a(\"ALTER TYPE \"+this.buildEnumName(r,n)+' RENAME TO \"'+c.enumTypeName+'\"')),p.label=8;case 8:!0===u.isPrimary&&(R=a.primaryColumns,j=R.map(function(e){return e.name}),l=this.connection.namingStrategy.primaryKeyName(a,j),j.splice(j.indexOf(u.name),1),j.push(n.name),h=this.connection.namingStrategy.primaryKeyName(a,j),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' RENAME CONSTRAINT \"'+l+'\" TO \"'+h+'\"')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' RENAME CONSTRAINT \"'+h+'\" TO \"'+l+'\"'))),!0===u.isGenerated&&\"increment\"===n.generationStrategy&&(d=this.extractSchema(r),f=this.buildSequenceName(r,u.name,void 0,!0,!0),y=this.buildSequenceName(r,n.name,void 0,!0,!0),b=d?'ALTER SEQUENCE \"'+d+'\".\"'+f+'\" RENAME TO \"'+y+'\"':'ALTER SEQUENCE \"'+f+'\" RENAME TO \"'+y+'\"',v=d?'ALTER SEQUENCE \"'+d+'\".\"'+y+'\" RENAME TO \"'+f+'\"':'ALTER SEQUENCE \"'+y+'\" RENAME TO \"'+f+'\"',o.push(new $e.a(b)),s.push(new $e.a(v))),a.findColumnUniques(u).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(u.name),1),e.columnNames.push(n.name);var t=x.connection.namingStrategy.uniqueConstraintName(a,e.columnNames);o.push(new $e.a(\"ALTER TABLE \"+x.escapePath(r)+' RENAME CONSTRAINT \"'+e.name+'\" TO \"'+t+'\"')),s.push(new $e.a(\"ALTER TABLE \"+x.escapePath(r)+' RENAME CONSTRAINT \"'+t+'\" TO \"'+e.name+'\"')),e.name=t}),a.findColumnIndices(u).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(u.name),1),e.columnNames.push(n.name);var t=x.extractSchema(r),i=x.connection.namingStrategy.indexName(a,e.columnNames,e.where),c=t?'ALTER INDEX \"'+t+'\".\"'+e.name+'\" RENAME TO \"'+i+'\"':'ALTER INDEX \"'+e.name+'\" RENAME TO \"'+i+'\"',l=t?'ALTER INDEX \"'+t+'\".\"'+i+'\" RENAME TO \"'+e.name+'\"':'ALTER INDEX \"'+i+'\" RENAME TO \"'+e.name+'\"';o.push(new $e.a(c)),s.push(new $e.a(l)),e.name=i}),a.findColumnForeignKeys(u).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(u.name),1),e.columnNames.push(n.name);var t=x.connection.namingStrategy.foreignKeyName(a,e.columnNames,e.referencedTableName,e.referencedColumnNames);o.push(new $e.a(\"ALTER TABLE \"+x.escapePath(r)+' RENAME CONSTRAINT \"'+e.name+'\" TO \"'+t+'\"')),s.push(new $e.a(\"ALTER TABLE \"+x.escapePath(r)+' RENAME CONSTRAINT \"'+t+'\" TO \"'+e.name+'\"')),e.name=t}),g=a.columns.find(function(e){return e.name===u.name}),a.columns[a.columns.indexOf(g)].name=n.name,u.name=n.name,p.label=9;case 9:return(n.precision!==u.precision||n.scale!==u.scale)&&(o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" TYPE '+this.driver.createFullType(n))),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" TYPE '+this.driver.createFullType(u)))),\"enum\"!==n.type&&\"simple-enum\"!==n.type||\"enum\"!==u.type&&\"simple-enum\"!==u.type||ne.a.isArraysEqual(n.enum,u.enum)?[3,11]:(E=this.buildEnumName(r,n),T=n.isArray?\"[]\":\"\",N=this.buildEnumName(r,n,!0,!1,!0),O=this.buildEnumName(r,n,!1,!1,!0),[4,this.getEnumTypeName(r,u)]);case 10:A=p.sent(),o.push(new $e.a('ALTER TYPE \"'+A.enumTypeSchema+'\".\"'+A.enumTypeName+'\" RENAME TO '+O)),s.push(new $e.a(\"ALTER TYPE \"+N+' RENAME TO  \"'+A.enumTypeName+'\"')),o.push(this.createEnumTypeSql(r,n)),s.push(this.dropEnumTypeSql(r,u)),null!==n.default&&void 0!==n.default&&(o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" DROP DEFAULT')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" SET DEFAULT '+n.default))),C=\"\"+E+T+' USING \"'+n.name+'\"::\"text\"::'+E+T,w=\"\"+N+T+' USING \"'+n.name+'\"::\"text\"::'+N+T,o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" TYPE '+C)),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" TYPE '+w)),null!==n.default&&void 0!==n.default&&(o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" SET DEFAULT '+n.default)),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" DROP DEFAULT'))),o.push(this.dropEnumTypeSql(r,n,N)),s.push(this.createEnumTypeSql(r,u,N)),p.label=11;case 11:u.isNullable!==n.isNullable&&(n.isNullable?(o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+u.name+'\" DROP NOT NULL')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+u.name+'\" SET NOT NULL'))):(o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+u.name+'\" SET NOT NULL')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+u.name+'\" DROP NOT NULL')))),u.comment!==n.comment&&(o.push(new $e.a(\"COMMENT ON COLUMN \"+this.escapePath(r)+'.\"'+u.name+\"\\\" IS '\"+n.comment+\"'\")),s.push(new $e.a(\"COMMENT ON COLUMN \"+this.escapePath(r)+'.\"'+n.name+\"\\\" IS '\"+u.comment+\"'\"))),n.isPrimary!==u.isPrimary&&(0<(R=a.primaryColumns).length&&(M=this.connection.namingStrategy.primaryKeyName(a.name,R.map(function(e){return e.name})),j=R.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' DROP CONSTRAINT \"'+M+'\"')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ADD CONSTRAINT \"'+M+'\" PRIMARY KEY ('+j+\")\"))),!0===n.isPrimary?(R.push(n),a.columns.find(function(e){return e.name===n.name}).isPrimary=!0,M=this.connection.namingStrategy.primaryKeyName(a.name,R.map(function(e){return e.name})),j=R.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ADD CONSTRAINT \"'+M+'\" PRIMARY KEY ('+j+\")\")),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' DROP CONSTRAINT \"'+M+'\"'))):(S=R.find(function(e){return e.name===n.name}),R.splice(R.indexOf(S),1),a.columns.find(function(e){return e.name===n.name}).isPrimary=!1,0<R.length&&(M=this.connection.namingStrategy.primaryKeyName(a.name,R.map(function(e){return e.name})),j=R.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ADD CONSTRAINT \"'+M+'\" PRIMARY KEY ('+j+\")\")),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' DROP CONSTRAINT \"'+M+'\"'))))),n.isUnique!==u.isUnique&&(!0===n.isUnique?(P=new Xe.a({name:this.connection.namingStrategy.uniqueConstraintName(r.name,[n.name]),columnNames:[n.name]}),a.uniques.push(P),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ADD CONSTRAINT \"'+P.name+'\" UNIQUE (\"'+n.name+'\")')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' DROP CONSTRAINT \"'+P.name+'\"'))):(P=a.uniques.find(function(e){return 1===e.columnNames.length&&!!e.columnNames.find(function(e){return e===n.name})}),a.uniques.splice(a.uniques.indexOf(P),1),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' DROP CONSTRAINT \"'+P.name+'\"')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ADD CONSTRAINT \"'+P.name+'\" UNIQUE (\"'+n.name+'\")')))),u.isGenerated!==n.isGenerated&&\"uuid\"!==n.generationStrategy&&(!0===n.isGenerated?(o.push(new $e.a(\"CREATE SEQUENCE \"+this.buildSequenceName(r,n)+\" OWNED BY \"+this.escapePath(r)+'.\"'+n.name+'\"')),s.push(new $e.a(\"DROP SEQUENCE \"+this.buildSequenceName(r,n))),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+\"\\\" SET DEFAULT nextval('\"+this.buildSequenceName(r,n,void 0,!0)+\"')\")),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" DROP DEFAULT'))):(o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" DROP DEFAULT')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+\"\\\" SET DEFAULT nextval('\"+this.buildSequenceName(r,n,void 0,!0)+\"')\")),o.push(new $e.a(\"DROP SEQUENCE \"+this.buildSequenceName(r,n))),s.push(new $e.a(\"CREATE SEQUENCE \"+this.buildSequenceName(r,n)+\" OWNED BY \"+this.escapePath(r)+'.\"'+n.name+'\"')))),n.default!==u.default&&(null!==n.default&&void 0!==n.default?(o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" SET DEFAULT '+n.default)),null!==u.default&&void 0!==u.default?s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" SET DEFAULT '+u.default)):s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" DROP DEFAULT'))):null!==u.default&&void 0!==u.default&&(o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" DROP DEFAULT')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" SET DEFAULT '+u.default)))),((n.spatialFeatureType||\"\").toLowerCase()!==(u.spatialFeatureType||\"\").toLowerCase()||n.srid!==u.srid)&&(o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" TYPE '+this.driver.createFullType(n))),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(r)+' ALTER COLUMN \"'+n.name+'\" TYPE '+this.driver.createFullType(u)))),p.label=12;case 12:return[4,this.executeQueries(o,s)];case 13:return p.sent(),this.replaceCachedTable(r,a),[2]}})})},t.prototype.changeColumns=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s,u,c;return Object(p.d)(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,7]),n=Object(p.g)(t),r=n.next(),l.label=1;case 1:return r.done?[3,4]:(i=r.value,a=i.oldColumn,o=i.newColumn,[4,this.changeColumn(e,a,o)]);case 2:l.sent(),l.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return s=l.sent(),u={error:s},[3,7];case 6:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 7:return[2]}})})},t.prototype.dropColumn=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s,u,c,l,h,d,f,y,b,v;return Object(p.d)(this,function(p){switch(p.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=p.sent(),p.label=3;case 3:if(n=r,!(i=t instanceof Ye.a?t:n.findColumnByName(t)))throw new Error('Column \"'+t+'\" was not found in table \"'+n.name+'\"');return a=n.clone(),o=[],s=[],i.isPrimary&&(u=this.connection.namingStrategy.primaryKeyName(a.name,a.primaryColumns.map(function(e){return e.name})),c=a.primaryColumns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(a)+' DROP CONSTRAINT \"'+u+'\"')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(a)+' ADD CONSTRAINT \"'+u+'\" PRIMARY KEY ('+c+\")\")),a.findColumnByName(i.name).isPrimary=!1,0<a.primaryColumns.length&&(l=this.connection.namingStrategy.primaryKeyName(a.name,a.primaryColumns.map(function(e){return e.name})),h=a.primaryColumns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(a)+' ADD CONSTRAINT \"'+l+'\" PRIMARY KEY ('+h+\")\")),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(a)+' DROP CONSTRAINT \"'+l+'\"')))),(d=a.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===i.name}))&&(a.indices.splice(a.indices.indexOf(d),1),o.push(this.dropIndexSql(n,d)),s.push(this.createIndexSql(n,d))),(f=a.checks.find(function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===i.name}))&&(a.checks.splice(a.checks.indexOf(f),1),o.push(this.dropCheckConstraintSql(n,f)),s.push(this.createCheckConstraintSql(n,f))),(y=a.uniques.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===i.name}))&&(a.uniques.splice(a.uniques.indexOf(y),1),o.push(this.dropUniqueConstraintSql(n,y)),s.push(this.createUniqueConstraintSql(n,y))),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP COLUMN \"'+i.name+'\"')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+\" ADD \"+this.buildCreateColumnSql(n,i))),\"enum\"!==i.type&&\"simple-enum\"!==i.type?[3,6]:[4,this.hasEnumType(n,i)];case 4:return p.sent()?[4,this.getEnumTypeName(n,i)]:[3,6];case 5:b=p.sent(),v='\"'+b.enumTypeSchema+'\".\"'+b.enumTypeName+'\"',o.push(this.dropEnumTypeSql(n,i,v)),s.push(this.createEnumTypeSql(n,i,v)),p.label=6;case 6:return[4,this.executeQueries(o,s)];case 7:return p.sent(),a.removeColumn(i),this.replaceCachedTable(n,a),[2]}})})},t.prototype.dropColumns=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s;return Object(p.d)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),n=Object(p.g)(t),r=n.next(),u.label=1;case 1:return r.done?[3,4]:(i=r.value,[4,this.dropColumn(e,i)]);case 2:u.sent(),u.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return a=u.sent(),o={error:a},[3,7];case 6:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.createPrimaryKey=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o;return Object(p.d)(this,function(s){switch(s.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=s.sent(),s.label=3;case 3:return i=(n=r).clone(),a=this.createPrimaryKeySql(n,t),i.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),o=this.dropPrimaryKeySql(i),[4,this.executeQueries(a,o)];case 4:return s.sent(),this.replaceCachedTable(n,i),[2]}})})},t.prototype.updatePrimaryKeys=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s,u,c,l,h,d;return Object(p.d)(this,function(p){switch(p.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=p.sent(),p.label=3;case 3:return i=(n=r).clone(),a=t.map(function(e){return e.name}),o=[],s=[],0<(u=i.primaryColumns).length&&(c=this.connection.namingStrategy.primaryKeyName(i.name,u.map(function(e){return e.name})),l=u.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+c+'\"')),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+c+'\" PRIMARY KEY ('+l+\")\"))),i.columns.filter(function(e){return-1!==a.indexOf(e.name)}).forEach(function(e){return e.isPrimary=!0}),h=this.connection.namingStrategy.primaryKeyName(i.name,a),d=a.map(function(e){return'\"'+e+'\"'}).join(\", \"),o.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+h+'\" PRIMARY KEY ('+d+\")\")),s.push(new $e.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+h+'\"')),[4,this.executeQueries(o,s)];case 4:return p.sent(),this.replaceCachedTable(n,i),[2]}})})},t.prototype.dropPrimaryKey=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n,r,i;return Object(p.d)(this,function(a){switch(a.label){case 0:return e instanceof m.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=a.sent(),a.label=3;case 3:return t=n,r=this.dropPrimaryKeySql(t),i=this.createPrimaryKeySql(t,t.primaryColumns.map(function(e){return e.name})),[4,this.executeQueries(r,i)];case 4:return a.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a;return Object(p.d)(this,function(o){switch(o.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=o.sent(),o.label=3;case 3:return n=r,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n.name,t.columnNames)),i=this.createUniqueConstraintSql(n,t),a=this.dropUniqueConstraintSql(n,t),[4,this.executeQueries(i,a)];case 4:return o.sent(),n.addUniqueConstraint(t),[2]}})})},t.prototype.createUniqueConstraints=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s;return Object(p.d)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),n=Object(p.g)(t),r=n.next(),u.label=1;case 1:return r.done?[3,4]:(i=r.value,[4,this.createUniqueConstraint(e,i)]);case 2:u.sent(),u.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return a=u.sent(),o={error:a},[3,7];case 6:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.dropUniqueConstraint=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o;return Object(p.d)(this,function(s){switch(s.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=s.sent(),s.label=3;case 3:if(n=r,!(i=t instanceof Xe.a?t:n.uniques.find(function(e){return e.name===t})))throw new Error(\"Supplied unique constraint was not found in table \"+n.name);return a=this.dropUniqueConstraintSql(n,i),o=this.createUniqueConstraintSql(n,i),[4,this.executeQueries(a,o)];case 4:return s.sent(),n.removeUniqueConstraint(i),[2]}})})},t.prototype.dropUniqueConstraints=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s;return Object(p.d)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),n=Object(p.g)(t),r=n.next(),u.label=1;case 1:return r.done?[3,4]:(i=r.value,[4,this.dropUniqueConstraint(e,i)]);case 2:u.sent(),u.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return a=u.sent(),o={error:a},[3,7];case 6:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.createCheckConstraint=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a;return Object(p.d)(this,function(o){switch(o.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=o.sent(),o.label=3;case 3:return n=r,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),i=this.createCheckConstraintSql(n,t),a=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(i,a)];case 4:return o.sent(),n.addCheckConstraint(t),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r=this;return Object(p.d)(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.createCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o;return Object(p.d)(this,function(s){switch(s.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=s.sent(),s.label=3;case 3:if(n=r,!(i=t instanceof He.a?t:n.checks.find(function(e){return e.name===t})))throw new Error(\"Supplied check constraint was not found in table \"+n.name);return a=this.dropCheckConstraintSql(n,i),o=this.createCheckConstraintSql(n,i),[4,this.executeQueries(a,o)];case 4:return s.sent(),n.removeCheckConstraint(i),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r=this;return Object(p.d)(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a;return Object(p.d)(this,function(o){switch(o.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=o.sent(),o.label=3;case 3:return n=r,t.name||(t.name=this.connection.namingStrategy.exclusionConstraintName(n.name,t.expression)),i=this.createExclusionConstraintSql(n,t),a=this.dropExclusionConstraintSql(n,t),[4,this.executeQueries(i,a)];case 4:return o.sent(),n.addExclusionConstraint(t),[2]}})})},t.prototype.createExclusionConstraints=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r=this;return Object(p.d)(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.createExclusionConstraint(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},t.prototype.dropExclusionConstraint=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o;return Object(p.d)(this,function(s){switch(s.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=s.sent(),s.label=3;case 3:if(n=r,!(i=t instanceof ze.a?t:n.exclusions.find(function(e){return e.name===t})))throw new Error(\"Supplied exclusion constraint was not found in table \"+n.name);return a=this.dropExclusionConstraintSql(n,i),o=this.createExclusionConstraintSql(n,i),[4,this.executeQueries(a,o)];case 4:return s.sent(),n.removeExclusionConstraint(i),[2]}})})},t.prototype.dropExclusionConstraints=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r=this;return Object(p.d)(this,function(i){switch(i.label){case 0:return n=t.map(function(t){return r.dropExclusionConstraint(e,t)}),[4,Promise.all(n)];case 1:return i.sent(),[2]}})})},t.prototype.createForeignKey=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a;return Object(p.d)(this,function(o){switch(o.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=o.sent(),o.label=3;case 3:return n=r,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames,t.referencedTableName,t.referencedColumnNames)),i=this.createForeignKeySql(n,t),a=this.dropForeignKeySql(n,t),[4,this.executeQueries(i,a)];case 4:return o.sent(),n.addForeignKey(t),[2]}})})},t.prototype.createForeignKeys=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s;return Object(p.d)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),n=Object(p.g)(t),r=n.next(),u.label=1;case 1:return r.done?[3,4]:(i=r.value,[4,this.createForeignKey(e,i)]);case 2:u.sent(),u.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return a=u.sent(),o={error:a},[3,7];case 6:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.dropForeignKey=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o;return Object(p.d)(this,function(s){switch(s.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=s.sent(),s.label=3;case 3:if(n=r,!(i=t instanceof Je.a?t:n.foreignKeys.find(function(e){return e.name===t})))throw new Error(\"Supplied foreign key was not found in table \"+n.name);return a=this.dropForeignKeySql(n,i),o=this.createForeignKeySql(n,i),[4,this.executeQueries(a,o)];case 4:return s.sent(),n.removeForeignKey(i),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s;return Object(p.d)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),n=Object(p.g)(t),r=n.next(),u.label=1;case 1:return r.done?[3,4]:(i=r.value,[4,this.dropForeignKey(e,i)]);case 2:u.sent(),u.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return a=u.sent(),o={error:a},[3,7];case 6:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.createIndex=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a;return Object(p.d)(this,function(o){switch(o.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=o.sent(),o.label=3;case 3:return n=r,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),i=this.createIndexSql(n,t),a=this.dropIndexSql(n,t),[4,this.executeQueries(i,a)];case 4:return o.sent(),n.addIndex(t),[2]}})})},t.prototype.createIndices=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s;return Object(p.d)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),n=Object(p.g)(t),r=n.next(),u.label=1;case 1:return r.done?[3,4]:(i=r.value,[4,this.createIndex(e,i)]);case 2:u.sent(),u.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return a=u.sent(),o={error:a},[3,7];case 6:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.dropIndex=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o;return Object(p.d)(this,function(s){switch(s.label){case 0:return e instanceof m.a?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=s.sent(),s.label=3;case 3:if(n=r,!(i=t instanceof Ge.a?t:n.indices.find(function(e){return e.name===t})))throw new Error(\"Supplied index was not found in table \"+n.name);return a=this.dropIndexSql(n,i),o=this.createIndexSql(n,i),[4,this.executeQueries(a,o)];case 4:return s.sent(),n.removeIndex(i),[2]}})})},t.prototype.dropIndices=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s;return Object(p.d)(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,7]),n=Object(p.g)(t),r=n.next(),u.label=1;case 1:return r.done?[3,4]:(i=r.value,[4,this.dropIndex(e,i)]);case 2:u.sent(),u.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return a=u.sent(),o={error:a},[3,7];case 6:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.clearTable=function(e){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(t){switch(t.label){case 0:return[4,this.query(\"TRUNCATE TABLE \"+this.escapePath(e))];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(){return Object(p.b)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,s=this;return Object(p.d)(this,function(u){switch(u.label){case 0:return e=[],this.connection.entityMetadatas.filter(function(e){return e.schema}).forEach(function(t){!!e.find(function(e){return e===t.schema})||e.push(t.schema)}),e.push(this.driver.options.schema||\"current_schema()\"),t=e.map(function(e){return\"current_schema()\"===e?e:\"'\"+e+\"'\"}).join(\", \"),[4,this.startTransaction()];case 1:u.sent(),u.label=2;case 2:return u.trys.push([2,9,,14]),n='SELECT \\'DROP VIEW IF EXISTS \"\\' || schemaname || \\'\".\"\\' || viewname || \\'\" CASCADE;\\' as \"query\" FROM \"pg_views\" WHERE \"schemaname\" IN ('+t+\") AND \\\"viewname\\\" NOT IN ('geography_columns', 'geometry_columns', 'raster_columns', 'raster_overviews')\",[4,this.query(n)];case 3:return r=u.sent(),[4,Promise.all(r.map(function(e){return s.query(e.query)}))];case 4:return u.sent(),i='SELECT \\'DROP TABLE IF EXISTS \"\\' || schemaname || \\'\".\"\\' || tablename || \\'\" CASCADE;\\' as \"query\" FROM \"pg_tables\" WHERE \"schemaname\" IN ('+t+\") AND \\\"tablename\\\" NOT IN ('spatial_ref_sys')\",[4,this.query(i)];case 5:return a=u.sent(),[4,Promise.all(a.map(function(e){return s.query(e.query)}))];case 6:return u.sent(),[4,this.dropEnumTypes(t)];case 7:return u.sent(),[4,this.commitTransaction()];case 8:return u.sent(),[3,14];case 9:o=u.sent(),u.label=10;case 10:return u.trys.push([10,12,,13]),[4,this.rollbackTransaction()];case 11:return u.sent(),[3,13];case 12:return u.sent(),[3,13];case 13:throw o;case 14:return[2]}})})},t.prototype.loadViews=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n,r,i,a=this;return Object(p.d)(this,function(o){switch(o.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return o.sent()?[4,this.query(\"SELECT * FROM current_schema()\")]:[2,Promise.resolve([])];case 2:return t=o.sent(),n=t[0].current_schema,r=e.map(function(e){var t=Object(p.e)(e.split(\".\"),2),r=t[0],i=t[1];return i||(i=r,r=a.driver.options.schema||n),'(\"t\".\"schema\" = \\''+r+'\\' AND \"t\".\"name\" = \\''+i+\"')\"}).join(\" OR \"),i='SELECT \"t\".*, \"v\".\"check_option\" FROM '+this.escapePath(this.getTypeormMetadataTableName())+' \"t\" INNER JOIN \"information_schema\".\"views\" \"v\" ON \"v\".\"table_schema\" = \"t\".\"schema\" AND \"v\".\"table_name\" = \"t\".\"name\" WHERE \"t\".\"type\" = \\'VIEW\\' '+(r?\"AND (\"+r+\")\":\"\"),[4,this.query(i)];case 3:return[2,o.sent().map(function(e){var t=new Ze.a,r=e.schema!==n||a.driver.options.schema?e.schema:void 0;return t.name=a.driver.buildTableName(e.name,r),t.expression=e.value,t})]}})})},t.prototype.loadTables=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n,r,i,a,o,s,u,c,l,h,d,f,y,b,v,g=this;return Object(p.d)(this,function(E){switch(E.label){case 0:return e&&e.length?[4,this.query(\"SELECT * FROM current_schema()\")]:[2,[]];case 1:return t=E.sent(),n=t[0].current_schema,r=e.map(function(e){var t=Object(p.e)(e.split(\".\"),2),r=t[0],i=t[1];return i||(i=r,r=g.driver.options.schema||n),'(\"table_schema\" = \\''+r+\"' AND \\\"table_name\\\" = '\"+i+\"')\"}).join(\" OR \"),i='SELECT * FROM \"information_schema\".\"tables\" WHERE '+r,a='SELECT *, (\\'\"\\' || \"udt_schema\" || \\'\".\"\\' || \"udt_name\" || \\'\"\\')::\"regtype\" AS \"regtype\" FROM \"information_schema\".\"columns\" WHERE '+r,o=e.map(function(e){var t=Object(p.e)(e.split(\".\"),2),r=t[0],i=t[1];return i||(i=r,r=g.driver.options.schema||n),'(\"ns\".\"nspname\" = \\''+r+'\\' AND \"t\".\"relname\" = \\''+i+\"')\"}).join(\" OR \"),s='SELECT \"ns\".\"nspname\" AS \"table_schema\", \"t\".\"relname\" AS \"table_name\", \"cnst\".\"conname\" AS \"constraint_name\", pg_get_constraintdef(\"cnst\".\"oid\") AS \"expression\", CASE \"cnst\".\"contype\" WHEN \\'p\\' THEN \\'PRIMARY\\' WHEN \\'u\\' THEN \\'UNIQUE\\' WHEN \\'c\\' THEN \\'CHECK\\' WHEN \\'x\\' THEN \\'EXCLUDE\\' END AS \"constraint_type\", \"a\".\"attname\" AS \"column_name\" FROM \"pg_constraint\" \"cnst\" INNER JOIN \"pg_class\" \"t\" ON \"t\".\"oid\" = \"cnst\".\"conrelid\" INNER JOIN \"pg_namespace\" \"ns\" ON \"ns\".\"oid\" = \"cnst\".\"connamespace\" LEFT JOIN \"pg_attribute\" \"a\" ON \"a\".\"attrelid\" = \"cnst\".\"conrelid\" AND \"a\".\"attnum\" = ANY (\"cnst\".\"conkey\") WHERE \"t\".\"relkind\" = \\'r\\' AND ('+o+\")\",u='SELECT \"ns\".\"nspname\" AS \"table_schema\", \"t\".\"relname\" AS \"table_name\", \"i\".\"relname\" AS \"constraint_name\", \"a\".\"attname\" AS \"column_name\", CASE \"ix\".\"indisunique\" WHEN \\'t\\' THEN \\'TRUE\\' ELSE\\'FALSE\\' END AS \"is_unique\", pg_get_expr(\"ix\".\"indpred\", \"ix\".\"indrelid\") AS \"condition\", \"types\".\"typname\" AS \"type_name\" FROM \"pg_class\" \"t\" INNER JOIN \"pg_index\" \"ix\" ON \"ix\".\"indrelid\" = \"t\".\"oid\" INNER JOIN \"pg_attribute\" \"a\" ON \"a\".\"attrelid\" = \"t\".\"oid\"  AND \"a\".\"attnum\" = ANY (\"ix\".\"indkey\") INNER JOIN \"pg_namespace\" \"ns\" ON \"ns\".\"oid\" = \"t\".\"relnamespace\" INNER JOIN \"pg_class\" \"i\" ON \"i\".\"oid\" = \"ix\".\"indexrelid\" INNER JOIN \"pg_type\" \"types\" ON \"types\".\"oid\" = \"a\".\"atttypid\" LEFT JOIN \"pg_constraint\" \"cnst\" ON \"cnst\".\"conname\" = \"i\".\"relname\" WHERE \"t\".\"relkind\" = \\'r\\' AND \"cnst\".\"contype\" IS NULL AND ('+o+\")\",c=e.map(function(e){var t=Object(p.e)(e.split(\".\"),2),r=t[0],i=t[1];return i||(i=r,r=g.driver.options.schema||n),'(\"ns\".\"nspname\" = \\''+r+'\\' AND \"cl\".\"relname\" = \\''+i+\"')\"}).join(\" OR \"),l='SELECT \"con\".\"conname\" AS \"constraint_name\", \"con\".\"nspname\" AS \"table_schema\", \"con\".\"relname\" AS \"table_name\", \"att2\".\"attname\" AS \"column_name\", \"ns\".\"nspname\" AS \"referenced_table_schema\", \"cl\".\"relname\" AS \"referenced_table_name\", \"att\".\"attname\" AS \"referenced_column_name\", \"con\".\"confdeltype\" AS \"on_delete\", \"con\".\"confupdtype\" AS \"on_update\", \"con\".\"condeferrable\" AS \"deferrable\", \"con\".\"condeferred\" AS \"deferred\" FROM ( SELECT UNNEST (\"con1\".\"conkey\") AS \"parent\", UNNEST (\"con1\".\"confkey\") AS \"child\", \"con1\".\"confrelid\", \"con1\".\"conrelid\", \"con1\".\"conname\", \"con1\".\"contype\", \"ns\".\"nspname\", \"cl\".\"relname\", \"con1\".\"condeferrable\", CASE WHEN \"con1\".\"condeferred\" THEN \\'INITIALLY DEFERRED\\' ELSE \\'INITIALLY IMMEDIATE\\' END as condeferred, CASE \"con1\".\"confdeltype\" WHEN \\'a\\' THEN \\'NO ACTION\\' WHEN \\'r\\' THEN \\'RESTRICT\\' WHEN \\'c\\' THEN \\'CASCADE\\' WHEN \\'n\\' THEN \\'SET NULL\\' WHEN \\'d\\' THEN \\'SET DEFAULT\\' END as \"confdeltype\", CASE \"con1\".\"confupdtype\" WHEN \\'a\\' THEN \\'NO ACTION\\' WHEN \\'r\\' THEN \\'RESTRICT\\' WHEN \\'c\\' THEN \\'CASCADE\\' WHEN \\'n\\' THEN \\'SET NULL\\' WHEN \\'d\\' THEN \\'SET DEFAULT\\' END as \"confupdtype\" FROM \"pg_class\" \"cl\" INNER JOIN \"pg_namespace\" \"ns\" ON \"cl\".\"relnamespace\" = \"ns\".\"oid\" INNER JOIN \"pg_constraint\" \"con1\" ON \"con1\".\"conrelid\" = \"cl\".\"oid\" WHERE \"con1\".\"contype\" = \\'f\\' AND ('+c+') ) \"con\" INNER JOIN \"pg_attribute\" \"att\" ON \"att\".\"attrelid\" = \"con\".\"confrelid\" AND \"att\".\"attnum\" = \"con\".\"child\" INNER JOIN \"pg_class\" \"cl\" ON \"cl\".\"oid\" = \"con\".\"confrelid\" INNER JOIN \"pg_namespace\" \"ns\" ON \"cl\".\"relnamespace\" = \"ns\".\"oid\" INNER JOIN \"pg_attribute\" \"att2\" ON \"att2\".\"attrelid\" = \"con\".\"conrelid\" AND \"att2\".\"attnum\" = \"con\".\"parent\"',[4,Promise.all([this.query(i),this.query(a),this.query(s),this.query(u),this.query(l)])];case 2:return h=p.e.apply(void 0,[E.sent(),5]),d=h[0],f=h[1],y=h[2],b=h[3],v=h[4],d.length?[2,Promise.all(d.map(function(e){return Object(p.b)(g,void 0,void 0,function(){var t,i,a,o,s,u,c,l,h,d,g=this;return Object(p.d)(this,function(E){switch(E.label){case 0:return t=new m.a,a=(i=function(e,t){return e[t]!==n||g.driver.options.schema?e[t]:void 0})(e,\"table_schema\"),t.name=this.driver.buildTableName(e.table_name,a),o=this.driver.buildTableName(e.table_name,e.table_schema),s=t,[4,Promise.all(f.filter(function(e){return g.driver.buildTableName(e.table_name,e.table_schema)===o}).map(function(i){return Object(p.b)(g,void 0,void 0,function(){var a,s,u,c,l,h,d,f,m,b,v=this;return Object(p.d)(this,function(p){switch(p.label){case 0:return a=y.filter(function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===o&&e.column_name===i.column_name}),(s=new Ye.a).name=i.column_name,s.type=i.regtype.toLowerCase(),(\"numeric\"===s.type||\"decimal\"===s.type||\"float\"===s.type)&&(null===i.numeric_precision||this.isDefaultColumnPrecision(t,s,i.numeric_precision)?null!==i.numeric_scale&&!this.isDefaultColumnScale(t,s,i.numeric_scale)&&(s.precision=void 0):s.precision=i.numeric_precision,null===i.numeric_scale||this.isDefaultColumnScale(t,s,i.numeric_scale)?null!==i.numeric_precision&&!this.isDefaultColumnPrecision(t,s,i.numeric_precision)&&(s.scale=void 0):s.scale=i.numeric_scale),\"array\"===i.data_type.toLowerCase()&&(s.isArray=!0,u=s.type.replace(\"[]\",\"\"),s.type=this.connection.driver.normalizeType({type:u})),(\"interval\"===s.type||\"time without time zone\"===s.type||\"time with time zone\"===s.type||\"timestamp without time zone\"===s.type||\"timestamp with time zone\"===s.type)&&(s.precision=this.isDefaultColumnPrecision(t,s,i.datetime_precision)?void 0:i.datetime_precision),-1===s.type.indexOf(\"enum\")?[3,2]:(s.type=\"enum\",c='SELECT \"e\".\"enumlabel\" AS \"value\" FROM \"pg_enum\" \"e\" INNER JOIN \"pg_type\" \"t\" ON \"t\".\"oid\" = \"e\".\"enumtypid\" INNER JOIN \"pg_namespace\" \"n\" ON \"n\".\"oid\" = \"t\".\"typnamespace\" WHERE \"n\".\"nspname\" = \\''+e.table_schema+'\\' AND \"t\".\"typname\" = \\''+this.buildEnumName(t,s.name,!1,!0)+\"'\",[4,this.query(c)]);case 1:d=p.sent(),s.enum=d.map(function(e){return e.value}),p.label=2;case 2:return\"geometry\"===s.type?(l='SELECT * FROM (\\n                        SELECT\\n                          \"f_table_schema\" \"table_schema\",\\n                          \"f_table_name\" \"table_name\",\\n                          \"f_geometry_column\" \"column_name\",\\n                          \"srid\",\\n                          \"type\"\\n                        FROM \"geometry_columns\"\\n                      ) AS _\\n                      WHERE ('+r+') AND \"column_name\" = \\''+s.name+\"' AND \\\"table_name\\\" = '\"+e.table_name+\"'\",[4,this.query(l)]):[3,4];case 3:d=p.sent(),s.spatialFeatureType=d[0].type,s.srid=d[0].srid,p.label=4;case 4:return\"geography\"===s.type?(h='SELECT * FROM (\\n                        SELECT\\n                          \"f_table_schema\" \"table_schema\",\\n                          \"f_table_name\" \"table_name\",\\n                          \"f_geography_column\" \"column_name\",\\n                          \"srid\",\\n                          \"type\"\\n                        FROM \"geography_columns\"\\n                      ) AS _\\n                      WHERE ('+r+') AND \"column_name\" = \\''+s.name+\"' AND \\\"table_name\\\" = '\"+e.table_name+\"'\",[4,this.query(h)]):[3,6];case 5:d=p.sent(),s.spatialFeatureType=d[0].type,s.srid=d[0].srid,p.label=6;case 6:return-1!==this.driver.withLengthColumnTypes.indexOf(s.type)&&i.character_maximum_length&&(f=i.character_maximum_length.toString(),s.length=this.isDefaultColumnLength(t,s,f)?\"\":f),s.isNullable=\"YES\"===i.is_nullable,s.isPrimary=!!a.find(function(e){return\"PRIMARY\"===e.constraint_type}),m=a.find(function(e){return\"UNIQUE\"===e.constraint_type}),b=!!m&&!!y.find(function(e){return\"UNIQUE\"===e.constraint_type&&e.constraint_name===m.constraint_name&&e.column_name!==i.column_name}),s.isUnique=!!m&&!b,null!==i.column_default&&void 0!==i.column_default&&(i.column_default.replace(/\"/gi,\"\")===\"nextval('\"+this.buildSequenceName(t,i.column_name,n,!0)+\"'::regclass)\"?(s.isGenerated=!0,s.generationStrategy=\"increment\"):\"gen_random_uuid()\"===i.column_default||/^uuid_generate_v\\d\\(\\)/.test(i.column_default)?(s.isGenerated=!0,s.generationStrategy=\"uuid\"):s.default=i.column_default.replace(/::.*/,\"\")),s.comment=\"\",i.character_set_name&&(s.charset=i.character_set_name),i.collation_name&&(s.collation=i.collation_name),[2,s]}})})}))];case 1:return s.columns=E.sent(),u=ne.a.uniq(y.filter(function(e){return g.driver.buildTableName(e.table_name,e.table_schema)===o&&\"UNIQUE\"===e.constraint_type}),function(e){return e.constraint_name}),t.uniques=u.map(function(e){var t=y.filter(function(t){return t.constraint_name===e.constraint_name});return new Xe.a({name:e.constraint_name,columnNames:t.map(function(e){return e.column_name})})}),c=ne.a.uniq(y.filter(function(e){return g.driver.buildTableName(e.table_name,e.table_schema)===o&&\"CHECK\"===e.constraint_type}),function(e){return e.constraint_name}),t.checks=c.map(function(e){var t=y.filter(function(t){return t.constraint_name===e.constraint_name});return new He.a({name:e.constraint_name,columnNames:t.map(function(e){return e.column_name}),expression:e.expression.replace(/^\\s*CHECK\\s*\\((.*)\\)\\s*$/i,\"$1\")})}),l=ne.a.uniq(y.filter(function(e){return g.driver.buildTableName(e.table_name,e.table_schema)===o&&\"EXCLUDE\"===e.constraint_type}),function(e){return e.constraint_name}),t.exclusions=l.map(function(e){return new ze.a({name:e.constraint_name,expression:e.expression.substring(8)})}),h=ne.a.uniq(v.filter(function(e){return g.driver.buildTableName(e.table_name,e.table_schema)===o}),function(e){return e.constraint_name}),t.foreignKeys=h.map(function(e){var t=v.filter(function(t){return t.constraint_name===e.constraint_name}),n=i(e,\"referenced_table_schema\"),r=g.driver.buildTableName(e.referenced_table_name,n);return new Je.a({name:e.constraint_name,columnNames:t.map(function(e){return e.column_name}),referencedTableName:r,referencedColumnNames:t.map(function(e){return e.referenced_column_name}),onDelete:e.on_delete,onUpdate:e.on_update,deferrable:e.deferrable?e.deferred:void 0})}),d=ne.a.uniq(b.filter(function(e){return g.driver.buildTableName(e.table_name,e.table_schema)===o}),function(e){return e.constraint_name}),t.indices=d.map(function(e){var n=b.filter(function(t){return t.table_schema===e.table_schema&&t.table_name===e.table_name&&t.constraint_name===e.constraint_name});return new Ge.a({table:t,name:e.constraint_name,columnNames:n.map(function(e){return e.column_name}),isUnique:\"TRUE\"===e.is_unique,where:e.condition,isSpatial:n.every(function(e){return 0<=g.driver.spatialTypes.indexOf(e.type_name)}),isFulltext:!1})}),[2,t]}})})}))]:[2,[]]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map(function(t){return n.buildCreateColumnSql(e,t)}).join(\", \"),i=\"CREATE TABLE \"+this.escapePath(e)+\" (\"+r;(e.columns.filter(function(e){return e.isUnique}).forEach(function(t){e.uniques.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})||e.uniques.push(new Xe.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))}),0<e.uniques.length)&&(i+=\", \"+e.uniques.map(function(t){return'CONSTRAINT \"'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'\" UNIQUE ('+t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \")+\")\"}).join(\", \"));0<e.checks.length&&(i+=\", \"+e.checks.map(function(t){return'CONSTRAINT \"'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'\" CHECK ('+t.expression+\")\"}).join(\", \"));0<e.exclusions.length&&(i+=\", \"+e.exclusions.map(function(t){return'CONSTRAINT \"'+(t.name?t.name:n.connection.namingStrategy.exclusionConstraintName(e.name,t.expression))+'\" EXCLUDE '+t.expression}).join(\", \"));0<e.foreignKeys.length&&t&&(i+=\", \"+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),a='CONSTRAINT \"'+t.name+'\" FOREIGN KEY ('+r+\") REFERENCES \"+n.escapePath(t.referencedTableName)+\" (\"+i+\")\";return t.onDelete&&(a+=\" ON DELETE \"+t.onDelete),t.onUpdate&&(a+=\" ON UPDATE \"+t.onUpdate),t.deferrable&&(a+=\" DEFERRABLE \"+t.deferrable),a}).join(\", \"));var a=e.columns.filter(function(e){return e.isPrimary});0<a.length&&(i+=', CONSTRAINT \"'+this.connection.namingStrategy.primaryKeyName(e.name,a.map(function(e){return e.name}))+'\" PRIMARY KEY ('+a.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+\")\");return i+=\")\",new $e.a(i)},t.prototype.dropTableSql=function(e){return new $e.a(\"DROP TABLE \"+this.escapePath(e))},t.prototype.createViewSql=function(e){var t=e.materialized?\"MATERIALIZED \":\"\",n=this.escapePath(e);return\"string\"==typeof e.expression?new $e.a(\"CREATE \"+t+\"VIEW \"+n+\" AS \"+e.expression):new $e.a(\"CREATE \"+t+\"VIEW \"+n+\" AS \"+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n,r,i,a,o,s,u,c;return Object(p.d)(this,function(l){switch(l.label){case 0:return[4,this.query(\"SELECT * FROM current_schema()\")];case 1:return t=l.sent(),n=t[0].current_schema,r=e.name.split(\".\"),i=this.driver.options.schema||n,a=e.name,2===r.length&&(i=r[0],a=r[1]),o=\"string\"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),s=Object(p.e)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:\"VIEW\",schema:i,name:a,value:o}).getQueryAndParameters(),2),u=s[0],c=s[1],[2,new $e.a(u,c)]}})})},t.prototype.dropViewSql=function(e){return new $e.a(\"DROP VIEW \"+this.escapePath(e))},t.prototype.deleteViewDefinitionSql=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n,r,i,a,o,s,u,c,l;return Object(p.d)(this,function(h){switch(h.label){case 0:return[4,this.query(\"SELECT * FROM current_schema()\")];case 1:return t=h.sent(),n=t[0].current_schema,r=e instanceof Ze.a?e.name:e,i=r.split(\".\"),a=this.driver.options.schema||n,o=r,2===i.length&&(a=i[0],o=i[1]),s=this.connection.createQueryBuilder(),u=Object(p.e)(s.delete().from(this.getTypeormMetadataTableName()).where(s.escape(\"type\")+\" = 'VIEW'\").andWhere(s.escape(\"schema\")+\" = :schema\",{schema:a}).andWhere(s.escape(\"name\")+\" = :name\",{name:o}).getQueryAndParameters(),2),c=u[0],l=u[1],[2,new $e.a(c,l)]}})})},t.prototype.extractSchema=function(e){var t=e instanceof m.a?e.name:e;return-1===t.indexOf(\".\")?this.driver.options.schema:t.split(\".\")[0]},t.prototype.dropEnumTypes=function(e){return Object(p.b)(this,void 0,void 0,function(){var t,n,r=this;return Object(p.d)(this,function(i){switch(i.label){case 0:return t='SELECT \\'DROP TYPE IF EXISTS \"\\' || n.nspname || \\'\".\"\\' || t.typname || \\'\" CASCADE;\\' as \"query\" FROM \"pg_type\" \"t\" INNER JOIN \"pg_enum\" \"e\" ON \"e\".\"enumtypid\" = \"t\".\"oid\" INNER JOIN \"pg_namespace\" \"n\" ON \"n\".\"oid\" = \"t\".\"typnamespace\" WHERE \"n\".\"nspname\" IN ('+e+') GROUP BY \"n\".\"nspname\", \"t\".\"typname\"',[4,this.query(t)];case 1:return n=i.sent(),[4,Promise.all(n.map(function(e){return r.query(e.query)}))];case 2:return i.sent(),[2]}})})},t.prototype.hasEnumType=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i;return Object(p.d)(this,function(a){switch(a.label){case 0:return n=this.parseTableName(e).schema,r=this.buildEnumName(e,t,!1,!0),i='SELECT \"n\".\"nspname\", \"t\".\"typname\" FROM \"pg_type\" \"t\" INNER JOIN \"pg_namespace\" \"n\" ON \"n\".\"oid\" = \"t\".\"typnamespace\" WHERE \"n\".\"nspname\" = '+n+' AND \"t\".\"typname\" = \\''+r+\"'\",[4,this.query(i)];case 1:return[2,!!a.sent().length]}})})},t.prototype.createEnumTypeSql=function(e,t,n){n||(n=this.buildEnumName(e,t));var r=t.enum.map(function(e){return\"'\"+e.replace(\"'\",\"''\")+\"'\"}).join(\", \");return new $e.a(\"CREATE TYPE \"+n+\" AS ENUM(\"+r+\")\")},t.prototype.dropEnumTypeSql=function(e,t,n){return n||(n=this.buildEnumName(e,t)),new $e.a(\"DROP TYPE \"+n)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");return new $e.a(\"CREATE \"+(t.isUnique?\"UNIQUE \":\"\")+'INDEX \"'+t.name+'\" ON '+this.escapePath(e)+\" \"+(t.isSpatial?\"USING GiST \":\"\")+\"(\"+n+\") \"+(t.where?\"WHERE \"+t.where:\"\"))},t.prototype.dropIndexSql=function(e,t){var n=t instanceof Ge.a?t.name:t,r=this.extractSchema(e);return r?new $e.a('DROP INDEX \"'+r+'\".\"'+n+'\"'):new $e.a('DROP INDEX \"'+n+'\"')},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map(function(e){return'\"'+e+'\"'}).join(\", \");return new $e.a(\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+n+'\" PRIMARY KEY ('+r+\")\")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map(function(e){return e.name}),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return new $e.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");return new $e.a(\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+t.name+'\" UNIQUE ('+n+\")\")},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof Xe.a?t.name:t;return new $e.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.createCheckConstraintSql=function(e,t){return new $e.a(\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+t.name+'\" CHECK ('+t.expression+\")\")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof He.a?t.name:t;return new $e.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.createExclusionConstraintSql=function(e,t){return new $e.a(\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+t.name+'\" EXCLUDE '+t.expression)},t.prototype.dropExclusionConstraintSql=function(e,t){var n=t instanceof ze.a?t.name:t;return new $e.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),r=t.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\",\"),i=\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+t.name+'\" FOREIGN KEY ('+n+\") REFERENCES \"+this.escapePath(t.referencedTableName)+\"(\"+r+\")\";return t.onDelete&&(i+=\" ON DELETE \"+t.onDelete),t.onUpdate&&(i+=\" ON UPDATE \"+t.onUpdate),t.deferrable&&(i+=\" DEFERRABLE \"+t.deferrable),new $e.a(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof Je.a?t.name:t;return new $e.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.buildSequenceName=function(e,t,n,r,i){var a=t instanceof Ye.a?t.name:t,o=void 0,s=void 0;return-1===e.name.indexOf(\".\")?s=e.name:(o=e.name.split(\".\")[0],s=e.name.split(\".\")[1]),o&&o!==n&&!i?r?o+\".\"+s+\"_\"+a+\"_seq\":'\"'+o+'\".\"'+s+\"_\"+a+'_seq\"':r?s+\"_\"+a+\"_seq\":'\"'+s+\"_\"+a+'_seq\"'},t.prototype.buildEnumName=function(e,t,n,r,i){if(void 0===n&&(n=!0),t instanceof Ye.a&&t.enumName){var a=t.enumName;return i&&(a+=\"_old\"),r?a:'\"'+a+'\"'}var o=t instanceof Ye.a?t.name:t,s=-1===e.name.indexOf(\".\")?this.driver.options.schema:e.name.split(\".\")[0],u=-1===e.name.indexOf(\".\")?e.name:e.name.split(\".\")[1],c=s&&n?s+\".\"+u+\"_\"+o.toLowerCase()+\"_enum\":u+\"_\"+o.toLowerCase()+\"_enum\";return i&&(c+=\"_old\"),c.split(\".\").map(function(e){return r?e:'\"'+e+'\"'}).join(\".\")},t.prototype.getEnumTypeName=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n,r,i,a,o,s;return Object(p.d)(this,function(u){switch(u.label){case 0:return[4,this.query(\"SELECT * FROM current_schema()\")];case 1:return n=u.sent(),r=n[0].current_schema,i=Object(p.e)(e.name.split(\".\"),2),a=i[0],(o=i[1])||(o=a,a=this.driver.options.schema||r),[4,this.query('SELECT \"udt_schema\", \"udt_name\" FROM \"information_schema\".\"columns\" WHERE \"table_schema\" = \\''+a+\"' AND \\\"table_name\\\" = '\"+o+\"' AND \\\"column_name\\\"='\"+t.name+\"'\")];case 2:return[2,{enumTypeSchema:(s=u.sent())[0].udt_schema,enumTypeName:s[0].udt_name}]}})})},t.prototype.escapePath=function(e,t){var n=e instanceof m.a||e instanceof Ze.a?e.name:e;return(n=-1===n.indexOf(\".\")&&this.driver.options.schema?this.driver.options.schema+\".\"+n:n).split(\".\").map(function(e){return t?e:'\"'+e+'\"'}).join(\".\")},t.prototype.parseTableName=function(e){var t=e instanceof m.a?e.name:e;return-1===t.indexOf(\".\")?{schema:this.driver.options.schema?\"'\"+this.driver.options.schema+\"'\":\"current_schema()\",tableName:\"'\"+t+\"'\"}:{schema:\"'\"+t.split(\".\")[0]+\"'\",tableName:\"'\"+t.split(\".\")[1]+\"'\"}},t.prototype.buildCreateColumnSql=function(e,t){var n='\"'+t.name+'\"';return!0===t.isGenerated&&\"uuid\"!==t.generationStrategy&&((\"integer\"===t.type||\"int\"===t.type||\"int4\"===t.type)&&(n+=\" SERIAL\"),(\"smallint\"===t.type||\"int2\"===t.type)&&(n+=\" SMALLSERIAL\"),(\"bigint\"===t.type||\"int8\"===t.type)&&(n+=\" BIGSERIAL\")),\"enum\"===t.type||\"simple-enum\"===t.type?(n+=\" \"+this.buildEnumName(e,t),t.isArray&&(n+=\" array\")):(!t.isGenerated||\"uuid\"===t.type)&&(n+=\" \"+this.connection.driver.createFullType(t)),t.charset&&(n+=' CHARACTER SET \"'+t.charset+'\"'),t.collation&&(n+=' COLLATE \"'+t.collation+'\"'),!0!==t.isNullable&&(n+=\" NOT NULL\"),void 0!==t.default&&null!==t.default&&(n+=\" DEFAULT \"+t.default),t.isGenerated&&\"uuid\"===t.generationStrategy&&!t.default&&(n+=\" DEFAULT \"+this.driver.uuidGenerator),n},t}(We.a))),tt=function(e){function t(t){var n=e.call(this)||this;return n.connection=t,n.options=t.options,n.isReplicated=!1,n.loadDependencies(),n.client=new n.DataApiDriver(n.options.region,n.options.secretArn,n.options.resourceArn,n.options.database,function(e,t){return n.connection.logger.logQuery(e,t)},n.options.serviceConfigOptions,n.options.formatOptions),n}return Object(p.c)(t,e),t.prototype.connect=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2]})})},t.prototype.disconnect=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2]})})},t.prototype.createQueryRunner=function(e){return new et(this,e)},t.prototype.loadDependencies=function(){var e=Be.a.load(\"typeorm-aurora-data-api-driver\").pg;this.DataApiDriver=e},t.prototype.executeQuery=function(e,t){return this.client.query(t)},t.prototype.afterConnect=function(){return Object(p.b)(this,void 0,void 0,function(){var e;return Object(p.d)(this,function(t){switch(t.label){case 0:return[4,this.checkMetadataForExtensions()];case 1:return(e=t.sent()).hasExtensions?[4,this.enableExtensions(e,this.connection)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2,Promise.resolve()]}})})},t}(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(p.c)(t,e),t}(O.i)),nt=function(){function e(){}return e.prototype.create=function(e){var t=e.options.type;switch(t){case\"mysql\":return new O.h(e);case\"postgres\":return new O.i(e);case\"cockroachdb\":return new O.c(e);case\"sap\":return new $.a(e);case\"mariadb\":return new O.h(e);case\"sqlite\":return new O.j(e);case\"better-sqlite3\":return new O.b(e);case\"cordova\":return new De(e);case\"nativescript\":return new Fe.a(e);case\"react-native\":return new Ue(e);case\"sqljs\":return new we.a(e);case\"oracle\":return new ue.a(e);case\"mssql\":return new T.a(e);case\"mongodb\":return new O.d(e);case\"expo\":return new Ke(e);case\"aurora-data-api\":return new O.a(e);case\"aurora-data-api-pg\":return new tt(e);default:throw new Se(t)}},e}(),rt=new(function(){function e(){this.instances=[]}return e.prototype.get=function(e){var t=this.instances.find(function(t){return t.type===e});return t||(t={type:e,object:new e},this.instances.push(t)),t.object},e}()),it=n(26),at=function(){function e(e){this.isUnique=!1,this.isSpatial=!1,this.isFulltext=!1,this.synchronize=!0,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,null!==e.args.synchronize&&void 0!==e.args.synchronize&&(this.synchronize=e.args.synchronize),this.isUnique=!!e.args.unique,this.isSpatial=!!e.args.spatial,this.isFulltext=!!e.args.fulltext,this.parser=e.args.parser,this.where=e.args.where,this.isSparse=e.args.sparse,this.isBackground=e.args.background,this.expireAfterSeconds=e.args.expireAfterSeconds,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this;if(!1===this.synchronize)return this.name=this.givenName,this;var n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map(function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+\".\"+e:e})).forEach(function(e){return n[e]=1});else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map(function(e){return e+\"\"})).forEach(function(e){return n[e]=1}):(r=Object.keys(i).map(function(e){return e+\"\"}),Object.keys(i).forEach(function(e){return n[e]=i[e]}))}this.columns=r.map(function(e){var n=t.entityMetadata.columns.find(function(t){return t.propertyPath===e});if(n)return[n];var r=t.entityMetadata.relations.find(function(t){return t.isWithJoinColumn&&t.propertyName===e});if(r)return r.joinColumns;var i=t.givenName?'\"'+t.givenName+'\" ':\"\",a=t.entityMetadata.targetName;throw new Error(\"Index \"+i+\"contains column that is missing in the entity (\"+a+\"): \"+e)}).reduce(function(e,t){return e.concat(t)})}return this.columnNamesWithOrderingMap=Object.keys(n).reduce(function(e,r){var i=t.entityMetadata.columns.find(function(e){return e.propertyPath===r});return i&&(e[i.databasePath]=n[r]),e},{}),this.name=this.givenName?this.givenName:e.indexName(this.entityMetadata.tablePath,this.columns.map(function(e){return e.databaseName}),this.where),this},e}(),ot=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isCascadeSoftRemove=!1,this.isCascadeRecover=!1,this.isNullable=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;var t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf(\"insert\"),this.isCascadeUpdate=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf(\"update\"),this.isCascadeRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf(\"remove\"),this.isCascadeSoftRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf(\"soft-remove\"),this.isCascadeRecover=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf(\"recover\"),this.isPrimary=t.options.primary||!1,this.isNullable=!1!==t.options.nullable&&!this.isPrimary,this.onDelete=t.options.onDelete,this.onUpdate=t.options.onUpdate,this.deferrable=t.options.deferrable,this.isEager=t.options.eager||!1,this.persistenceEnabled=!1!==t.options.persistence,this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,this.type=t.type instanceof Function?t.type():t.type,this.isOneToOne=\"one-to-one\"===this.relationType,this.isOneToMany=\"one-to-many\"===this.relationType,this.isManyToOne=\"many-to-one\"===this.relationType,this.isManyToMany=\"many-to-many\"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return e.prototype.getRelationIdMap=function(e){var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(function(e){return e.referencedColumn});return ye.a.getValueMap(e,t)},e.prototype.ensureRelationIdMap=function(e){if(e instanceof Object)return e;var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(function(e){return e.referencedColumn});if(1<t.length)throw new Error(\"Cannot create relation id map for a single value because relation contains multiple referenced columns.\");return t[0].createValueMap(e)},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),null!=e){if(this.embeddedMetadata){var n=Object(p.f)(this.embeddedMetadata.parentPropertyNames),r=function(e,t){var n=e.shift();return n?t[n]?r(e,t[n]):void 0:t},i=r(n,e);return this.isLazy?void 0===i[\"__\"+this.propertyName+\"__\"]?!0===t?i[this.propertyName]:void 0:i[\"__\"+this.propertyName+\"__\"]:i?i[this.isLazy?\"__\"+this.propertyName+\"__\":this.propertyName]:void 0}return this.isLazy?void 0===e[\"__\"+this.propertyName+\"__\"]?!0===t?e[this.propertyName]:void 0:e[\"__\"+this.propertyName+\"__\"]:e[this.propertyName]}},e.prototype.setEntityValue=function(e,t){var n=this.isLazy?\"__\"+this.propertyName+\"__\":this.propertyName;if(this.embeddedMetadata){var r=function(e,i){var a=e.shift();return a?(i[a.propertyName]||(i[a.propertyName]=a.create()),r(e,i[a.propertyName]),i):(i[n]=t,i)};return r(Object(p.f)(this.embeddedMetadata.embeddedMetadataTree),e)}e[n]=t},e.prototype.createValueMap=function(e){var t,n=this;if(this.embeddedMetadata){var r=Object(p.f)(this.embeddedMetadata.parentPropertyNames),i=function(t,r){var a=t.shift();return a?(r[a]={},i(t,r[a]),r):(r[n.propertyName]=e,r)};return i(r,{})}return(t={})[this.propertyName]=e,t},e.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},e.prototype.registerForeignKeys=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.foreignKeys).push.apply(e,Object(p.f)(t)),this.joinColumns=this.foreignKeys[0]?this.foreignKeys[0].columns:[],this.inverseJoinColumns=this.foreignKeys[1]?this.foreignKeys[1].columns:[],this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&0<this.joinColumns.length,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner},e.prototype.registerJunctionEntityMetadata=function(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)},e.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){var e=this.inverseEntityMetadata.propertiesMap;if(\"function\"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if(\"string\"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return\"\"},e.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(\".\")+\".\"+this.propertyName:this.propertyName},e}(),st=function(){function e(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.uniques=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.uniquesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}return e.prototype.create=function(){return new this.type},e.prototype.build=function(e){return this.embeddeds.forEach(function(t){return t.build(e)}),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join(\".\"),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.uniquesFromTree=this.buildUniquesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),this},e.prototype.buildPartialPrefix=function(){if(void 0===this.customPrefix||!0===this.customPrefix)return[this.propertyName];if(\"\"===this.customPrefix||!1===this.customPrefix)return[];if(\"string\"==typeof this.customPrefix)return[this.customPrefix];throw new Error(\"Invalid prefix option given for \"+this.entityMetadata.targetName+\"#\"+this.propertyName)},e.prototype.buildPrefix=function(e){if(e.driver instanceof O.d)return this.propertyName;var t=[];return this.parentEmbeddedMetadata&&t.push(this.parentEmbeddedMetadata.buildPrefix(e)),t.push.apply(t,Object(p.f)(this.buildPartialPrefix())),t.join(\"_\")},e.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},e.prototype.buildParentPrefixes=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPrefixes().concat(this.buildPartialPrefix()):this.buildPartialPrefix()},e.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},e.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildColumnsFromTree())},this.columns)},e.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationsFromTree())},this.relations)},e.prototype.buildListenersFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildListenersFromTree())},this.listeners)},e.prototype.buildIndicesFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildIndicesFromTree())},this.indices)},e.prototype.buildUniquesFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildUniquesFromTree())},this.uniques)},e.prototype.buildRelationIdsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationIdsFromTree())},this.relationIds)},e.prototype.buildRelationCountsFromTree=function(){return this.embeddeds.reduce(function(e,t){return e.concat(t.buildRelationCountsFromTree())},this.relationCounts)},e}(),ut=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.setValue=function(e){var t=this,n=this.relation.getEntityValue(e);if(Array.isArray(n))e[this.propertyName]=n.map(function(e){return t.relation.inverseEntityMetadata.getEntityIdMixedMap(e)}).filter(function(e){return null!=e});else{var r=this.relation.inverseEntityMetadata.getEntityIdMixedMap(n);void 0!==r&&(e[this.propertyName]=r)}},e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error(\"Cannot find relation \"+e+\". Wrong relation specified for @RelationId decorator.\");this.relation=t},e}(),ct=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error(\"Cannot find relation \"+e+\". Wrong relation specified for @RelationCount decorator.\");this.relation=t},e}(),lt=function(){function e(){}return e.getInheritanceTree=function(e){var t=[e],n=function(e){var r=Object.getPrototypeOf(e);r&&r.name&&(t.push(r),n(r))};return n(e),t},e.isInherited=function(e,t){return e.prototype instanceof t},e.filterByTarget=function(e,t){return t?e.filter(function(e){return e.target&&-1!==t.indexOf(e.target)}):e},e}(),ht=function(){function e(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete||\"NO ACTION\",this.onUpdate=e.onUpdate||\"NO ACTION\",this.deferrable=e.deferrable,e.namingStrategy&&this.build(e.namingStrategy)}return e.prototype.build=function(e){this.columnNames=this.columns.map(function(e){return e.databaseName}),this.referencedColumnNames=this.referencedColumns.map(function(e){return e.databaseName}),this.referencedTablePath=this.referencedEntityMetadata.tablePath,this.name=e.foreignKeyName(this.entityMetadata.tablePath,this.columnNames,this.referencedTablePath,this.referencedColumnNames)},e}(),pt=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this,r=this.collectReferencedColumns(e,t),i=this.collectInverseReferencedColumns(e,t),a=t.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:\"\"),o=new ye.a({connection:this.connection,args:{target:\"\",name:a,type:\"junction\",database:t.database||e.entityMetadata.database,schema:t.schema||e.entityMetadata.schema}});o.build();var s=r.map(function(r){var i=t.joinColumns?t.joinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)}):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new it.a({connection:n.connection,entityMetadata:o,referencedColumn:r,args:{target:\"\",mode:\"virtual\",propertyName:a,options:{name:a,length:r.length||!(n.connection.driver instanceof O.h||n.connection.driver instanceof O.a)||\"uuid\"!==r.generationStrategy&&\"uuid\"!==r.type?r.length:\"36\",width:r.width,type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,nullable:!1,primary:!0}}})}),u=i.map(function(r){var i=t.inverseJoinColumns?t.inverseJoinColumns.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==r.propertyName||!e.name)}):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableInverseColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new it.a({connection:n.connection,entityMetadata:o,referencedColumn:r,args:{target:\"\",mode:\"virtual\",propertyName:a,options:{length:r.length||!(n.connection.driver instanceof O.h||n.connection.driver instanceof O.a)||\"uuid\"!==r.generationStrategy&&\"uuid\"!==r.type?r.length:\"36\",width:r.width,type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,name:a,nullable:!1,primary:!0}}})});return this.changeDuplicatedColumnNames(s,u),o.ownerColumns=s,o.inverseColumns=u,o.ownColumns=Object(p.f)(s,u),o.ownColumns.forEach(function(t){return t.relationMetadata=e}),o.foreignKeys=[new ht({entityMetadata:o,referencedEntityMetadata:e.entityMetadata,columns:s,referencedColumns:r,onDelete:e.onDelete||\"CASCADE\"}),new ht({entityMetadata:o,referencedEntityMetadata:e.inverseEntityMetadata,columns:u,referencedColumns:i,onDelete:e.onDelete||\"CASCADE\"})],o.ownIndices=[new at({entityMetadata:o,columns:s,args:{target:o.target,synchronize:!0}}),new at({entityMetadata:o,columns:u,args:{target:o.target,synchronize:!0}})],o},e.prototype.collectReferencedColumns=function(e,t){var n=!!t.joinColumns&&t.joinColumns.find(function(e){return!!e.referencedColumnName});return!t.joinColumns||t.joinColumns&&!n?e.entityMetadata.columns.filter(function(e){return e.isPrimary}):t.joinColumns.map(function(t){var n=e.entityMetadata.columns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw new Error(\"Referenced column \"+t.referencedColumnName+\" was not found in entity \"+e.entityMetadata.name);return n})},e.prototype.collectInverseReferencedColumns=function(e,t){var n=!!t.inverseJoinColumns,r=!!n&&t.inverseJoinColumns.find(function(e){return!!e.referencedColumnName});return!n||n&&!r?e.inverseEntityMetadata.primaryColumns:t.inverseJoinColumns.map(function(t){var n=e.inverseEntityMetadata.ownColumns.find(function(e){return e.propertyName===t.referencedColumnName});if(!n)throw new Error(\"Referenced column \"+t.referencedColumnName+\" was not found in entity \"+e.inverseEntityMetadata.name);return n})},e.prototype.changeDuplicatedColumnNames=function(e,t){var n=this;e.forEach(function(e){t.forEach(function(t){if(e.givenDatabaseName===t.givenDatabaseName){var r=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(e.propertyName,1);e.propertyName=r,e.givenDatabaseName=r;var i=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(t.propertyName,2);t.propertyName=i,t.givenDatabaseName=i}})})},e}(),dt=function(){function e(e){this.connection=e}return e.prototype.build=function(e){var t=this,n=new ye.a({parentClosureEntityMetadata:e,connection:this.connection,args:{target:\"\",name:e.tableNameWithoutPrefix,type:\"closure-junction\"}});return n.build(),e.primaryColumns.forEach(function(e){n.ownColumns.push(new it.a({connection:t.connection,entityMetadata:n,closureType:\"ancestor\",referencedColumn:e,args:{target:\"\",mode:\"virtual\",propertyName:e.propertyName+\"_ancestor\",options:{primary:!0,length:e.length,type:e.type}}})),n.ownColumns.push(new it.a({connection:t.connection,entityMetadata:n,closureType:\"descendant\",referencedColumn:e,args:{target:\"\",mode:\"virtual\",propertyName:e.propertyName+\"_descendant\",options:{primary:!0,length:e.length,type:e.type}}}))}),n.ownIndices=[new at({entityMetadata:n,columns:[n.ownColumns[0]],args:{target:n.target,synchronize:!0}}),new at({entityMetadata:n,columns:[n.ownColumns[1]],args:{target:n.target,synchronize:!0}})],e.treeLevelColumn&&n.ownColumns.push(new it.a({connection:this.connection,entityMetadata:n,args:{target:\"\",mode:\"virtual\",propertyName:\"level\",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),n.foreignKeys=[new ht({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[0]],referencedColumns:e.primaryColumns}),new ht({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[1]],referencedColumns:e.primaryColumns})],n},e}(),ft=function(){function e(e){this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this,n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map(function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+\".\"+e:e})).forEach(function(e){return n[e]=1});else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map(function(e){return e+\"\"})).forEach(function(e){return n[e]=1}):(r=Object.keys(i).map(function(e){return e+\"\"}),Object.keys(i).forEach(function(e){return n[e]=i[e]}))}this.columns=r.map(function(e){var n=t.entityMetadata.columns.find(function(t){return t.propertyPath===e});if(n)return[n];var r=t.entityMetadata.relations.find(function(t){return t.isWithJoinColumn&&t.propertyName===e});if(r)return r.joinColumns;var i=t.givenName?'\"'+t.givenName+'\" ':\"\",a=t.entityMetadata.targetName;throw new Error(\"Unique constraint \"+i+\"contains column that is missing in the entity (\"+a+\"): \"+e)}).reduce(function(e,t){return e.concat(t)})}return this.columnNamesWithOrderingMap=Object.keys(n).reduce(function(e,r){var i=t.entityMetadata.columns.find(function(e){return e.propertyPath===r});return i&&(e[i.databasePath]=n[r]),e},{}),this.name=this.givenName?this.givenName:e.uniqueConstraintName(this.entityMetadata.tablePath,this.columns.map(function(e){return e.databaseName})),this},e}(),mt=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this.collectReferencedColumns(e,t);if(!n.length)return{foreignKey:void 0,uniqueConstraint:void 0};var r=this.collectColumns(e,t,n),i=new ht({entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:r,referencedColumns:n,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable});if(this.connection.driver instanceof ue.a&&r.every(function(e){return e.isPrimary}))return{foreignKey:i,uniqueConstraint:void 0};if(0<n.length&&t.isOneToOne){var a=new ft({entityMetadata:t.entityMetadata,columns:i.columns,args:{name:this.connection.namingStrategy.relationConstraintName(t.entityMetadata.tablePath,i.columns.map(function(e){return e.databaseName})),target:t.entityMetadata.target}});return a.build(this.connection.namingStrategy),{foreignKey:i,uniqueConstraint:a}}return{foreignKey:i,uniqueConstraint:void 0}},e.prototype.collectReferencedColumns=function(e,t){var n=e.find(function(e){return!!e.referencedColumnName}),r=0===e.length&&t.isManyToOne,i=0<e.length&&!n;return r||i?t.inverseEntityMetadata.primaryColumns:e.map(function(e){var n=t.inverseEntityMetadata.ownColumns.find(function(t){return t.propertyName===e.referencedColumnName});if(!n)throw new Error(\"Referenced column \"+e.referencedColumnName+\" was not found in entity \"+t.inverseEntityMetadata.name);return n})},e.prototype.collectColumns=function(e,t,n){var r=this;return n.map(function(n){var i=e.find(function(e){return!(e.referencedColumnName&&e.referencedColumnName!==n.propertyName||!e.name)}),a=i?i.name:r.connection.namingStrategy.joinColumnName(t.propertyName,n.propertyName),o=t.entityMetadata.ownColumns.find(function(e){return e.databaseName===a});return o||(o=new it.a({connection:r.connection,entityMetadata:t.entityMetadata,args:{target:\"\",mode:\"virtual\",propertyName:t.propertyName,options:{name:a,type:n.type,length:n.length||!(r.connection.driver instanceof O.h||r.connection.driver instanceof O.a)||\"uuid\"!==n.generationStrategy&&\"uuid\"!==n.type?n.length:\"36\",width:n.width,charset:n.charset,collation:n.collation,precision:n.precision,scale:n.scale,zerofill:n.zerofill,unsigned:n.unsigned,comment:n.comment,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(o)),o.referencedColumn=n,o.type=n.type,o.relationMetadata=t,o.build(r.connection),o})},e}(),yt=function(){function e(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}return e.prototype.isAllowed=function(e){return this.entityMetadata.target===e.constructor||this.entityMetadata.target instanceof Function&&e.constructor.prototype instanceof this.entityMetadata.target},e.prototype.execute=function(e){return this.embeddedMetadata?void this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split(\".\")):e[this.propertyName]()},e.prototype.callEntityEmbeddedMethod=function(e,t){var n=t.shift();n&&e[n]&&(0===t.length?e[n][this.propertyName]():e[n]&&this.callEntityEmbeddedMethod(e[n],t))},e}(),bt=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.checkConstraintName(this.entityMetadata.tablePath,this.expression),this},e}(),vt=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.exclusionConstraintName(this.entityMetadata.tablePath,this.expression),this},e}(),gt=function(){function e(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new pt(e),this.closureJunctionEntityMetadataBuilder=new dt(e),this.relationJoinColumnBuilder=new mt(e)}return e.prototype.build=function(e){var t=this,n=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter(function(e){return\"regular\"===e.type||\"closure\"===e.type||\"entity-child\"===e.type||\"view\"===e.type}).map(function(e){return t.createEntityMetadata(e)});return n.forEach(function(e){return t.computeParentEntityMetadata(n,e)}),n.forEach(function(e){e.childEntityMetadatas=n.filter(function(t){return e.target instanceof Function&&t.target instanceof Function&&lt.isInherited(t.target,e.target)})}),n.filter(function(e){return\"entity-child\"!==e.tableType}).forEach(function(e){return e.build()}),n.filter(function(e){return\"entity-child\"===e.tableType}).forEach(function(e){return e.build()}),n.filter(function(e){return\"entity-child\"!==e.tableType}).forEach(function(e){return t.computeEntityMetadataStep1(n,e)}),n.filter(function(e){return\"entity-child\"===e.tableType}).forEach(function(e){return t.computeEntityMetadataStep1(n,e)}),n.forEach(function(e){return t.computeEntityMetadataStep2(e)}),n.forEach(function(e){return t.computeInverseProperties(e,n)}),n.filter(function(e){return\"entity-child\"!==e.tableType}).forEach(function(e){e.relations.filter(function(e){return e.isOneToOne||e.isManyToOne}).forEach(function(n){var r=t.metadataArgsStorage.filterJoinColumns(n.target,n.propertyName),i=t.relationJoinColumnBuilder.build(r,n),a=i.foreignKey,o=i.uniqueConstraint;if(a&&(n.registerForeignKeys(a),e.foreignKeys.push(a)),o)if(t.connection.driver instanceof O.h||t.connection.driver instanceof O.a||t.connection.driver instanceof T.a||t.connection.driver instanceof $.a){var s=new at({entityMetadata:o.entityMetadata,columns:o.columns,args:{target:o.target,name:o.name,unique:!0,synchronize:!0}});t.connection.driver instanceof T.a&&(s.where=s.columns.map(function(e){return t.connection.driver.escape(e.databaseName)+\" IS NOT NULL\"}).join(\" AND \")),n.embeddedMetadata?n.embeddedMetadata.indices.push(s):n.entityMetadata.ownIndices.push(s),t.computeEntityMetadataStep2(e)}else n.embeddedMetadata?n.embeddedMetadata.uniques.push(o):n.entityMetadata.ownUniques.push(o),t.computeEntityMetadataStep2(e);if(a&&t.connection.driver instanceof O.c){s=new at({entityMetadata:n.entityMetadata,columns:a.columns,args:{target:n.entityMetadata.target,synchronize:!0}});n.embeddedMetadata?n.embeddedMetadata.indices.push(s):n.entityMetadata.ownIndices.push(s),t.computeEntityMetadataStep2(e)}}),e.relations.filter(function(e){return e.isManyToMany}).forEach(function(e){var r=t.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(r){var i=t.junctionEntityMetadataBuilder.build(e,r);e.registerForeignKeys.apply(e,Object(p.f)(i.foreignKeys)),e.registerJunctionEntityMetadata(i),t.computeEntityMetadataStep2(i),t.computeInverseProperties(i,n),n.push(i)}})}),n.forEach(function(e){e.relationsWithJoinColumns=e.relations.filter(function(e){return e.isWithJoinColumn}),e.hasNonNullableRelations=e.relationsWithJoinColumns.some(function(e){return!e.isNullable||e.isPrimary})}),n.filter(function(e){return\"closure-table\"===e.treeType}).forEach(function(e){var r=t.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=r,t.computeEntityMetadataStep2(r),t.computeInverseProperties(r,n),n.push(r)}),n.filter(function(e){return\"STI\"===e.inheritancePattern&&e.discriminatorColumn}).forEach(function(e){return t.createKeysForTableInheritance(e)}),n.forEach(function(e){e.indices.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.forEach(function(e){e.uniques.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.forEach(function(e){e.checks.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.forEach(function(e){e.exclusions.forEach(function(e){return e.build(t.connection.namingStrategy)})}),n.filter(function(e){return e.target instanceof Function}).forEach(function(e){e.relations.filter(function(e){return e.isLazy}).forEach(function(n){t.connection.relationLoader.enableLazyLoad(n,e.target.prototype)})}),n.forEach(function(e){e.columns.forEach(function(n){var r=t.metadataArgsStorage.findGenerated(n.target,n.propertyName);r&&(n.isGenerated=!0,n.generationStrategy=r.strategy,n.type=\"uuid\"===r.strategy?\"uuid\":\"rowid\"===r.strategy?\"int\":n.type||Number,n.build(t.connection),t.computeEntityMetadataStep2(e))})}),n},e.prototype.createEntityMetadata=function(e){var t,n=e.target instanceof Function?lt.getInheritanceTree(e.target):[e.target],r=this.metadataArgsStorage.findInheritanceType(e.target),i=this.metadataArgsStorage.findTree(e.target);return(r&&\"STI\"===r.pattern||\"entity-child\"===e.type)&&(t=this.metadataArgsStorage.filterSingleTableChildren(e.target).map(function(e){return e.target}).filter(function(e){return e instanceof Function}),n.push.apply(n,Object(p.f)(t))),new ye.a({connection:this.connection,args:e,inheritanceTree:n,tableTree:i,inheritancePattern:r?r.pattern:void 0})},e.prototype.computeParentEntityMetadata=function(e,t){\"entity-child\"===t.tableType&&(t.parentEntityMetadata=e.find(function(e){return-1!==e.inheritanceTree.indexOf(t.target)&&\"STI\"===e.inheritancePattern}))},e.prototype.computeEntityMetadataStep1=function(e,t){var n,r,i,a=this,o=this.metadataArgsStorage.findInheritanceType(t.target),s=this.metadataArgsStorage.findDiscriminatorValue(t.target);if(t.discriminatorValue=s?s.value:t.target.name,t.embeddeds=this.createEmbeddedsRecursively(t,this.metadataArgsStorage.filterEmbeddeds(t.inheritanceTree)).map(function(e){return\"STI\"===t.inheritancePattern&&(e.columns=e.columns.map(function(e){return e.isNullable=!0,e})),e}),t.ownColumns=this.metadataArgsStorage.filterColumns(t.inheritanceTree).map(function(n){if(\"entity-child\"===t.tableType)return t.parentEntityMetadata.ownColumns.find(function(e){return e.propertyName===n.propertyName});var r=new it.a({connection:a.connection,entityMetadata:t,args:n});return e.find(function(e){return\"entity-child\"===e.tableType&&e.target===n.target})&&(r.isNullable=!0),r}),o&&o.column){var u=o.column&&o.column.name?o.column.name:\"type\",c=t.ownColumns.find(function(e){return e.propertyName===u});c?c.isDiscriminator=!0:((c=new it.a({connection:this.connection,entityMetadata:t,args:{target:t.target,mode:\"virtual\",propertyName:u,options:o.column||{name:u,type:\"varchar\",nullable:!1}}})).isVirtual=!0,c.isDiscriminator=!0,t.ownColumns.push(c))}if(\"entity-child\"===t.tableType){var l=t.parentEntityMetadata.ownColumns.find(function(e){return e.isDiscriminator});l&&!t.ownColumns.find(function(e){return e===l})&&t.ownColumns.push(l)}var h=this.connection.namingStrategy;if(\"materialized-path\"===t.treeType)t.ownColumns.push(new it.a({connection:this.connection,entityMetadata:t,materializedPath:!0,args:{target:t.target,mode:\"virtual\",propertyName:\"mpath\",options:{name:h.materializedPathColumnName,type:\"varchar\",nullable:!0,default:\"\"}}}));else if(\"nested-set\"===t.treeType){var d=h.nestedSetColumnNames,f=d.left,m=d.right;t.ownColumns.push(new it.a({connection:this.connection,entityMetadata:t,nestedSetLeft:!0,args:{target:t.target,mode:\"virtual\",propertyName:f,options:{name:f,type:\"integer\",nullable:!1,default:1}}})),t.ownColumns.push(new it.a({connection:this.connection,entityMetadata:t,nestedSetRight:!0,args:{target:t.target,mode:\"virtual\",propertyName:m,options:{name:m,type:\"integer\",nullable:!1,default:2}}}))}if(t.ownRelations=this.metadataArgsStorage.filterRelations(t.inheritanceTree).map(function(e){return\"entity-child\"===t.tableType?t.parentEntityMetadata.ownRelations.find(function(t){return t.propertyName===e.propertyName}):new ot({entityMetadata:t,args:e})}),t.relationIds=this.metadataArgsStorage.filterRelationIds(t.inheritanceTree).map(function(e){return\"entity-child\"===t.tableType?t.parentEntityMetadata.relationIds.find(function(t){return t.propertyName===e.propertyName}):new ut({entityMetadata:t,args:e})}),t.relationCounts=this.metadataArgsStorage.filterRelationCounts(t.inheritanceTree).map(function(e){return\"entity-child\"===t.tableType?t.parentEntityMetadata.relationCounts.find(function(t){return t.propertyName===e.propertyName}):new ct({entityMetadata:t,args:e})}),t.ownListeners=this.metadataArgsStorage.filterListeners(t.inheritanceTree).map(function(e){return new yt({entityMetadata:t,args:e})}),t.checks=this.metadataArgsStorage.filterChecks(t.inheritanceTree).map(function(e){return new bt({entityMetadata:t,args:e})}),this.connection.driver instanceof O.i&&(t.exclusions=this.metadataArgsStorage.filterExclusions(t.inheritanceTree).map(function(e){return new vt({entityMetadata:t,args:e})})),this.connection.driver instanceof O.c){t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter(function(e){return!e.unique}).map(function(e){return new at({entityMetadata:t,args:e})});var y=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter(function(e){return e.unique}).map(function(e){return new ft({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns}})});(n=t.ownUniques).push.apply(n,Object(p.f)(y))}else t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).map(function(e){return new at({entityMetadata:t,args:e})});if(this.connection.driver instanceof O.h||this.connection.driver instanceof O.a||this.connection.driver instanceof $.a){var b=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map(function(e){return new at({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns,unique:!0,synchronize:!0}})});(r=t.ownIndices).push.apply(r,Object(p.f)(b))}else{y=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map(function(e){return new ft({entityMetadata:t,args:e})});(i=t.ownUniques).push.apply(i,Object(p.f)(y))}},e.prototype.createEmbeddedsRecursively=function(e,t){var n=this;return t.map(function(t){var r=new st({entityMetadata:e,args:t}),i=lt.getInheritanceTree(r.type);return r.columns=n.metadataArgsStorage.filterColumns(i).map(function(t){return new it.a({connection:n.connection,entityMetadata:e,embeddedMetadata:r,args:t})}),r.relations=n.metadataArgsStorage.filterRelations(i).map(function(t){return new ot({entityMetadata:e,embeddedMetadata:r,args:t})}),r.listeners=n.metadataArgsStorage.filterListeners(i).map(function(t){return new yt({entityMetadata:e,embeddedMetadata:r,args:t})}),r.indices=n.metadataArgsStorage.filterIndices(i).map(function(t){return new at({entityMetadata:e,embeddedMetadata:r,args:t})}),r.uniques=n.metadataArgsStorage.filterUniques(i).map(function(t){return new ft({entityMetadata:e,embeddedMetadata:r,args:t})}),r.relationIds=n.metadataArgsStorage.filterRelationIds(i).map(function(t){return new ut({entityMetadata:e,args:t})}),r.relationCounts=n.metadataArgsStorage.filterRelationCounts(i).map(function(t){return new ct({entityMetadata:e,args:t})}),r.embeddeds=n.createEmbeddedsRecursively(e,n.metadataArgsStorage.filterEmbeddeds(i)),r.embeddeds.forEach(function(e){return e.parentEmbeddedMetadata=r}),e.allEmbeddeds.push(r),r})},e.prototype.computeEntityMetadataStep2=function(e){var t=this;e.embeddeds.forEach(function(e){return e.build(t.connection)}),e.embeddeds.forEach(function(e){e.columnsFromTree.forEach(function(e){return e.build(t.connection)}),e.relationsFromTree.forEach(function(e){return e.build()})}),e.ownColumns.forEach(function(e){return e.build(t.connection)}),e.ownRelations.forEach(function(e){return e.build()}),e.relations=e.embeddeds.reduce(function(e,t){return e.concat(t.relationsFromTree)},e.ownRelations),e.eagerRelations=e.relations.filter(function(e){return e.isEager}),e.lazyRelations=e.relations.filter(function(e){return e.isLazy}),e.oneToOneRelations=e.relations.filter(function(e){return e.isOneToOne}),e.oneToManyRelations=e.relations.filter(function(e){return e.isOneToMany}),e.manyToOneRelations=e.relations.filter(function(e){return e.isManyToOne}),e.manyToManyRelations=e.relations.filter(function(e){return e.isManyToMany}),e.ownerOneToOneRelations=e.relations.filter(function(e){return e.isOneToOneOwner}),e.ownerManyToManyRelations=e.relations.filter(function(e){return e.isManyToManyOwner}),e.treeParentRelation=e.relations.find(function(e){return e.isTreeParent}),e.treeChildrenRelation=e.relations.find(function(e){return e.isTreeChildren}),e.columns=e.embeddeds.reduce(function(e,t){return e.concat(t.columnsFromTree)},e.ownColumns),e.listeners=e.embeddeds.reduce(function(e,t){return e.concat(t.listenersFromTree)},e.ownListeners),e.afterLoadListeners=e.listeners.filter(function(e){return\"after-load\"===e.type}),e.afterInsertListeners=e.listeners.filter(function(e){return\"after-insert\"===e.type}),e.afterUpdateListeners=e.listeners.filter(function(e){return\"after-update\"===e.type}),e.afterRemoveListeners=e.listeners.filter(function(e){return\"after-remove\"===e.type}),e.beforeInsertListeners=e.listeners.filter(function(e){return\"before-insert\"===e.type}),e.beforeUpdateListeners=e.listeners.filter(function(e){return\"before-update\"===e.type}),e.beforeRemoveListeners=e.listeners.filter(function(e){return\"before-remove\"===e.type}),e.indices=e.embeddeds.reduce(function(e,t){return e.concat(t.indicesFromTree)},e.ownIndices),e.uniques=e.embeddeds.reduce(function(e,t){return e.concat(t.uniquesFromTree)},e.ownUniques),e.primaryColumns=e.columns.filter(function(e){return e.isPrimary}),e.nonVirtualColumns=e.columns.filter(function(e){return!e.isVirtual}),e.ancestorColumns=e.columns.filter(function(e){return\"ancestor\"===e.closureType}),e.descendantColumns=e.columns.filter(function(e){return\"descendant\"===e.closureType}),e.hasMultiplePrimaryKeys=1<e.primaryColumns.length,e.generatedColumns=e.columns.filter(function(e){return e.isGenerated||e.isObjectId}),e.hasUUIDGeneratedColumns=0<e.columns.filter(function(e){return e.isGenerated||\"uuid\"===e.generationStrategy}).length,e.createDateColumn=e.columns.find(function(e){return e.isCreateDate}),e.updateDateColumn=e.columns.find(function(e){return e.isUpdateDate}),e.deleteDateColumn=e.columns.find(function(e){return e.isDeleteDate}),e.versionColumn=e.columns.find(function(e){return e.isVersion}),e.discriminatorColumn=e.columns.find(function(e){return e.isDiscriminator}),e.treeLevelColumn=e.columns.find(function(e){return e.isTreeLevel}),e.nestedSetLeftColumn=e.columns.find(function(e){return e.isNestedSetLeft}),e.nestedSetRightColumn=e.columns.find(function(e){return e.isNestedSetRight}),e.materializedPathColumn=e.columns.find(function(e){return e.isMaterializedPath}),e.objectIdColumn=e.columns.find(function(e){return e.isObjectId}),e.foreignKeys.forEach(function(e){return e.build(t.connection.namingStrategy)}),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach(function(e){return e.build()}),e.relationCounts.forEach(function(e){return e.build()}),e.embeddeds.forEach(function(e){e.relationIdsFromTree.forEach(function(e){return e.build()}),e.relationCountsFromTree.forEach(function(e){return e.build()})})},e.prototype.computeInverseProperties=function(e,t){e.relations.forEach(function(n){var r=t.find(function(e){return e.target===n.type||\"string\"==typeof n.type&&e.targetName===n.type});if(!r)throw new Error(\"Entity metadata for \"+e.name+\"#\"+n.propertyPath+\" was not found. Check if you specified a correct entity object and if it's connected in the connection options.\");n.inverseEntityMetadata=r,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=r.relations.find(function(e){return e.propertyPath===n.inverseSidePropertyPath})})},e.prototype.createKeysForTableInheritance=function(e){e.indices.push(new at({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}))},e}(),Et=function(){function e(){this.tables=[],this.trees=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return e.prototype.filterTables=function(e){return this.filterByTarget(this.tables,e)},e.prototype.filterColumns=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)},e.prototype.findGenerated=function(e,t){return this.generations.find(function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.propertyName===t})},e.prototype.findTree=function(e){return this.trees.find(function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterRelations=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relations,e)},e.prototype.filterRelationIds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)},e.prototype.filterRelationCounts=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)},e.prototype.filterIndices=function(e){return this.indices.filter(function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterUniques=function(e){return this.uniques.filter(function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterChecks=function(e){return this.checks.filter(function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterExclusions=function(e){return this.exclusions.filter(function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e})},e.prototype.filterListeners=function(e){return this.filterByTarget(this.entityListeners,e)},e.prototype.filterEmbeddeds=function(e){return this.filterByTargetAndWithoutDuplicateEmbeddedProperties(this.embeddeds,e)},e.prototype.findJoinTable=function(e,t){return this.joinTables.find(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterJoinColumns=function(e,t){return this.joinColumns.filter(function(n){return n.target===e&&n.propertyName===t})},e.prototype.filterSubscribers=function(e){return this.filterByTarget(this.entitySubscribers,e)},e.prototype.filterNamingStrategies=function(e){return this.filterByTarget(this.namingStrategies,e)},e.prototype.filterTransactionEntityManagers=function(e,t){return this.transactionEntityManagers.filter(function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t})},e.prototype.filterTransactionRepository=function(e,t){return this.transactionRepositories.filter(function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t})},e.prototype.filterSingleTableChildren=function(e){return this.tables.filter(function(t){return t.target instanceof Function&&e instanceof Function&&lt.isInherited(t.target,e)&&\"entity-child\"===t.type})},e.prototype.findInheritanceType=function(e){return this.inheritances.find(function(t){return t.target===e})},e.prototype.findDiscriminatorValue=function(e){return this.discriminatorValues.find(function(t){return t.target===e})},e.prototype.filterByTarget=function(e,t){return e.filter(function(e){return Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t})},e.prototype.filterByTargetAndWithoutDuplicateProperties=function(e,t){var n=[];return e.forEach(function(e){(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t)&&!n.find(function(t){return t.propertyName===e.propertyName})&&n.push(e)}),n},e.prototype.filterByTargetAndWithoutDuplicateEmbeddedProperties=function(e,t){var n=[];return e.forEach(function(e){(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t)&&(n.find(function(t){return t.prefix===e.prefix&&t.propertyName===e.propertyName})||n.push(e))}),n},e}(),Tt=function(){function e(){}return e.prototype.transform=function(e){var t=new Et;return e.forEach(function(e){var n=e.options,r={target:n.target||n.name,name:n.tableName,database:n.database,schema:n.schema,type:n.type||\"regular\",orderBy:n.orderBy,synchronize:n.synchronize,expression:n.expression};t.tables.push(r),Object.keys(n.columns).forEach(function(e){var r=n.columns[e],i=\"regular\";r.createDate&&(i=\"createDate\"),r.updateDate&&(i=\"updateDate\"),r.deleteDate&&(i=\"deleteDate\"),r.version&&(i=\"version\"),r.treeChildrenCount&&(i=\"treeChildrenCount\"),r.treeLevel&&(i=\"treeLevel\"),r.objectId&&(i=\"objectId\");var a={target:n.target||n.name,mode:i,propertyName:e,options:{type:r.type,name:r.objectId?\"_id\":r.name,length:r.length,width:r.width,nullable:r.nullable,readonly:r.readonly,update:r.update,select:r.select,insert:r.insert,primary:r.primary,unique:r.unique,comment:r.comment,default:r.default,onUpdate:r.onUpdate,precision:r.precision,scale:r.scale,zerofill:r.zerofill,unsigned:r.unsigned,charset:r.charset,collation:r.collation,enum:r.enum,asExpression:r.asExpression,generatedType:r.generatedType,hstoreType:r.hstoreType,array:r.array,transformer:r.transformer,spatialFeatureType:r.spatialFeatureType,srid:r.srid}};if(t.columns.push(a),r.generated){var o={target:n.target||n.name,propertyName:e,strategy:\"string\"==typeof r.generated?r.generated:\"increment\"};t.generations.push(o)}r.unique&&t.uniques.push({target:n.target||n.name,columns:[e]})}),n.relations&&Object.keys(n.relations).forEach(function(e){var r,i,a=n.relations[e],o={target:n.target||n.name,propertyName:e,relationType:a.type,isLazy:a.lazy||!1,type:a.target,inverseSideProperty:a.inverseSide,isTreeParent:a.treeParent,isTreeChildren:a.treeChildren,options:{eager:a.eager||!1,cascade:a.cascade,nullable:a.nullable,onDelete:a.onDelete,onUpdate:a.onUpdate,deferrable:a.deferrable,primary:a.primary,persistence:a.persistence}};if(t.relations.push(o),a.joinColumn)if(\"boolean\"==typeof a.joinColumn){var s={target:n.target||n.name,propertyName:e};t.joinColumns.push(s)}else{var u=Array.isArray(a.joinColumn)?a.joinColumn:[a.joinColumn];try{for(var c=Object(p.g)(u),l=c.next();!l.done;l=c.next()){var h=l.value;s={target:n.target||n.name,propertyName:e,name:h.name,referencedColumnName:h.referencedColumnName};t.joinColumns.push(s)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}if(a.joinTable)if(\"boolean\"==typeof a.joinTable){var d={target:n.target||n.name,propertyName:e};t.joinTables.push(d)}else{d={target:n.target||n.name,propertyName:e,name:a.joinTable.name,database:a.joinTable.database,schema:a.joinTable.schema,joinColumns:a.joinTable.joinColumn?[a.joinTable.joinColumn]:a.joinTable.joinColumns,inverseJoinColumns:a.joinTable.inverseJoinColumn?[a.joinTable.inverseJoinColumn]:a.joinTable.inverseJoinColumns};t.joinTables.push(d)}}),n.indices&&n.indices.forEach(function(e){var r={target:n.target||n.name,name:e.name,unique:!0===e.unique,spatial:!0===e.spatial,fulltext:!0===e.fulltext,parser:e.parser,synchronize:!1!==e.synchronize,where:e.where,sparse:e.sparse,columns:e.columns};t.indices.push(r)}),n.uniques&&n.uniques.forEach(function(e){var r={target:n.target||n.name,name:e.name,columns:e.columns};t.uniques.push(r)}),n.checks&&n.checks.forEach(function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.checks.push(r)}),n.exclusions&&n.exclusions.forEach(function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.exclusions.push(r)})}),t},e}(),Nt=n(40),Ot=function(){function e(e){this.connection=e}return e.prototype.buildMigrations=function(e){var t=Object(p.e)(ne.a.splitClassesAndStrings(e),2),n=t[0];t[1];return Object(p.f)(n,i(this.connection.logger)).map(function(e){return a(e)})},e.prototype.buildSubscribers=function(e){var t=Object(p.e)(ne.a.splitClassesAndStrings(e||[]),2),n=t[0],r=(t[1],Object(p.f)(n,i(this.connection.logger)));return o().filterSubscribers(r).map(function(e){return a(e.target)})},e.prototype.buildEntityMetadatas=function(e){var t=Object(p.e)(ne.a.splitClassesAndStrings(e||[]),2),n=t[0],r=(t[1],n.filter(function(e){return 0==e instanceof Nt.a})),a=n.filter(function(e){return e instanceof Nt.a}),s=Object(p.f)(r,i(this.connection.logger));s.forEach(function(e){e instanceof Nt.a&&(a.push(e),s.slice(s.indexOf(e),1))});var u=new gt(this.connection,o()).build(s),c=(new Tt).transform(a),l=new gt(this.connection,c).build();return Object(p.f)(u,l)},e}(),At=n(50),Ct=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t){if(\"all\"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"query\")){var n=e+(t&&t.length?\" -- PARAMETERS: \"+this.stringifyParams(t):\"\");console.log(\"query: \"+n)}},e.prototype.logQueryError=function(e,t,n){if(\"all\"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"error\")){var r=t+(n&&n.length?\" -- PARAMETERS: \"+this.stringifyParams(n):\"\");console.log(\"query failed: \"+r),console.log(\"error:\",e)}},e.prototype.logQuerySlow=function(e,t,n){var r=t+(n&&n.length?\" -- PARAMETERS: \"+this.stringifyParams(n):\"\");console.log(\"query is slow: \"+r),console.log(\"execution time: \"+e)},e.prototype.logSchemaBuild=function(e){(\"all\"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"schema\"))&&console.log(e)},e.prototype.logMigration=function(e){console.log(e)},e.prototype.log=function(e,t){\"log\"===e?(\"all\"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"log\"))&&console.log(t):\"info\"===e?(\"all\"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"info\"))&&console.info(t):\"warn\"===e&&(\"all\"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"warn\"))&&console.warn(t)},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),wt=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t){if(\"all\"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"query\")){var n=e+(t&&t.length?\" -- PARAMETERS: \"+this.stringifyParams(t):\"\");Be.a.logInfo(\"query:\",Be.a.highlightSql(n))}},e.prototype.logQueryError=function(e,t,n){if(\"all\"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"error\")){var r=t+(n&&n.length?\" -- PARAMETERS: \"+this.stringifyParams(n):\"\");Be.a.logError(\"query failed:\",Be.a.highlightSql(r)),Be.a.logError(\"error:\",e)}},e.prototype.logQuerySlow=function(e,t,n){var r=t+(n&&n.length?\" -- PARAMETERS: \"+this.stringifyParams(n):\"\");Be.a.logWarn(\"query is slow:\",Be.a.highlightSql(r)),Be.a.logWarn(\"execution time:\",e)},e.prototype.logSchemaBuild=function(e){(\"all\"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"schema\"))&&Be.a.log(e)},e.prototype.logMigration=function(e){Be.a.log(e)},e.prototype.log=function(e,t){\"log\"===e?(\"all\"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"log\"))&&Be.a.log(t):\"info\"===e?(\"all\"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"info\"))&&Be.a.logInfo(\"INFO:\",t):\"warn\"===e&&(\"all\"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf(\"warn\"))&&console.warn(Be.a.warn(t))},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),Rt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(p.c)(t,e),t}(function(){function e(){}return e.prototype.logQuery=function(){throw new Error(\"This logger is not applicable in a browser context\")},e.prototype.logQueryError=function(){throw new Error(\"This logger is not applicable in a browser context\")},e.prototype.logQuerySlow=function(){throw new Error(\"This logger is not applicable in a browser context\")},e.prototype.logSchemaBuild=function(){throw new Error(\"This logger is not applicable in a browser context\")},e.prototype.logMigration=function(){throw new Error(\"This logger is not applicable in a browser context\")},e.prototype.log=function(){throw new Error(\"This logger is not applicable in a browser context\")},e}()),St=n(43),Mt=n.n(St),jt=function(){function e(){this.debugQueryLog=Mt()(\"typeorm:query:log\"),this.debugQueryError=Mt()(\"typeorm:query:error\"),this.debugQuerySlow=Mt()(\"typeorm:query:slow\"),this.debugSchemaBuild=Mt()(\"typeorm:schema\"),this.debugMigration=Mt()(\"typeorm:migration\"),this.debugLog=Mt()(\"typeorm:log\"),this.debugInfo=Mt()(\"typeorm:info\"),this.debugWarn=Mt()(\"typeorm:warn\")}return e.prototype.logQuery=function(e,t){this.debugQueryLog.enabled&&(this.debugQueryLog(Be.a.highlightSql(e)+\";\"),t&&t.length&&this.debugQueryLog(\"parameters:\",t))},e.prototype.logQueryError=function(e,t,n){this.debugQueryError.enabled&&(this.debugQueryError(Be.a.highlightSql(t)+\";\"),n&&n.length&&this.debugQueryError(\"parameters:\",n),this.debugQueryError(\"error: \",e))},e.prototype.logQuerySlow=function(e,t,n){this.debugQuerySlow.enabled&&(this.debugQuerySlow(Be.a.highlightSql(t)+\";\"),n&&n.length&&this.debugQuerySlow(\"parameters:\",n),this.debugQuerySlow(\"execution time:\",e))},e.prototype.logSchemaBuild=function(e){this.debugSchemaBuild.enabled&&this.debugSchemaBuild(e)},e.prototype.logMigration=function(e){this.debugMigration.enabled&&this.debugMigration(e)},e.prototype.log=function(e,t){\"log\"===e?this.debugLog.enabled&&this.debugLog(t):\"info\"===e?this.debugInfo.enabled&&this.debugInfo(t):\"warn\"===e&&this.debugWarn.enabled&&this.debugWarn(t)},e}(),Pt=function(){function e(){}return e.prototype.create=function(e,t){if(e instanceof Object)return e;if(e)switch(e){case\"simple-console\":return new Ct(t);case\"file\":return new Rt(t);case\"advanced-console\":return new wt(t);case\"debug\":return new jt}return new wt(t)},e}(),xt=function(){function e(e,t){this.connection=e,this.clientType=t,this.redis=this.loadRedis()}return e.prototype.connect=function(){return Object(p.b)(this,void 0,void 0,function(){var e;return Object(p.d)(this,function(){if(e=this.connection.options.cache,\"redis\"===this.clientType)this.client=e&&e.options?this.redis.createClient(e.options):this.redis.createClient();else if(\"ioredis\"===this.clientType)this.client=e&&e.options?new this.redis(e.options):new this.redis;else if(\"ioredis/cluster\"===this.clientType)if(e&&e.options&&Array.isArray(e.options))this.client=new this.redis.Cluster(e.options);else{if(!(e&&e.options&&e.options.startupNodes))throw new Error(\"options.startupNodes required for \"+this.clientType+\".\");this.client=new this.redis.Cluster(e.options.startupNodes,e.options.options)}return[2]})})},e.prototype.disconnect=function(){return Object(p.b)(this,void 0,void 0,function(){var e=this;return Object(p.d)(this,function(){return[2,new Promise(function(t,n){e.client.quit(function(r){return r?n(r):(t(),void(e.client=void 0))})})]})})},e.prototype.synchronize=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2]})})},e.prototype.getFromCache=function(e){var t=this;return new Promise(function(n,r){e.identifier?t.client.get(e.identifier,function(e,t){return e?r(e):void n(JSON.parse(t))}):e.query?t.client.get(e.query,function(e,t){return e?r(e):void n(JSON.parse(t))}):n(void 0)})},e.prototype.isExpired=function(e){return e.time+e.duration<(new Date).getTime()},e.prototype.storeInCache=function(e){return Object(p.b)(this,void 0,void 0,function(){var t=this;return Object(p.d)(this,function(){return[2,new Promise(function(n,r){e.identifier?t.client.set(e.identifier,JSON.stringify(e),\"PX\",e.duration,function(e){return e?r(e):void n()}):e.query&&t.client.set(e.query,JSON.stringify(e),\"PX\",e.duration,function(e){return e?r(e):void n()})})]})})},e.prototype.clear=function(){return Object(p.b)(this,void 0,void 0,function(){var e=this;return Object(p.d)(this,function(){return[2,new Promise(function(t,n){e.client.flushdb(function(e){return e?n(e):void t()})})]})})},e.prototype.remove=function(e){return Object(p.b)(this,void 0,void 0,function(){var t=this;return Object(p.d)(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(e){return t.deleteKey(e)}))];case 1:return n.sent(),[2]}})})},e.prototype.deleteKey=function(e){var t=this;return new Promise(function(n,r){t.client.del(e,function(e){return e?r(e):void n()})})},e.prototype.loadRedis=function(){try{return\"ioredis/cluster\"===this.clientType?Be.a.load(\"ioredis\"):Be.a.load(this.clientType)}catch(e){throw new Error(\"Cannot use cache because \"+this.clientType+' is not installed. Please run \"npm i '+this.clientType+' --save\".')}},e}(),It=function(){function e(e){this.connection=e;var t=this.connection.driver.options,n=(\"object\"==typeof this.connection.options.cache?this.connection.options.cache:{}).tableName||\"query-result-cache\";this.queryResultCacheTable=this.connection.driver.buildTableName(n,t.schema,t.database)}return e.prototype.connect=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2]})})},e.prototype.disconnect=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2]})})},e.prototype.synchronize=function(e){return Object(p.b)(this,void 0,void 0,function(){var t;return Object(p.d)(this,function(n){switch(n.label){case 0:return e=this.getQueryRunner(e),t=this.connection.driver,[4,e.hasTable(this.queryResultCacheTable)];case 1:return n.sent()?[2]:[4,e.createTable(new m.a({name:this.queryResultCacheTable,columns:[{name:\"id\",isPrimary:!0,isNullable:!1,type:t.normalizeType({type:t.mappedDataTypes.cacheId}),generationStrategy:\"increment\",isGenerated:!0},{name:\"identifier\",type:t.normalizeType({type:t.mappedDataTypes.cacheIdentifier}),isNullable:!0},{name:\"time\",type:t.normalizeType({type:t.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1},{name:\"duration\",type:t.normalizeType({type:t.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1},{name:\"query\",type:t.normalizeType({type:t.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1},{name:\"result\",type:t.normalizeType({type:t.mappedDataTypes.cacheResult}),isNullable:!1}]}))];case 2:return n.sent(),[2]}})})},e.prototype.getFromCache=function(e,t){t=this.getQueryRunner(t);var n=this.connection.createQueryBuilder(t).select().from(this.queryResultCacheTable,\"cache\");return e.identifier?n.where(n.escape(\"cache\")+\".\"+n.escape(\"identifier\")+\" = :identifier\").setParameters({identifier:this.connection.driver instanceof T.a?new N.a(e.identifier,\"nvarchar\"):e.identifier}).getRawOne():e.query?this.connection.driver instanceof ue.a?n.where(\"dbms_lob.compare(\"+n.escape(\"cache\")+\".\"+n.escape(\"query\")+\", :query) = 0\",{query:e.query}).getRawOne():n.where(n.escape(\"cache\")+\".\"+n.escape(\"query\")+\" = :query\").setParameters({query:this.connection.driver instanceof T.a?new N.a(e.query,\"nvarchar\"):e.query}).getRawOne():Promise.resolve(void 0)},e.prototype.isExpired=function(e){var t=\"string\"==typeof e.duration?parseInt(e.duration):e.duration;return(\"string\"==typeof e.time?parseInt(e.time):e.time)+t<(new Date).getTime()},e.prototype.storeInCache=function(e,t,n){return Object(p.b)(this,void 0,void 0,function(){var r,i;return Object(p.d)(this,function(a){switch(a.label){case 0:return n=this.getQueryRunner(n),r=e,this.connection.driver instanceof T.a&&(r={identifier:new N.a(e.identifier,\"nvarchar\"),time:new N.a(e.time,\"bigint\"),duration:new N.a(e.duration,\"int\"),query:new N.a(e.query,\"nvarchar\"),result:new N.a(e.result,\"nvarchar\")}),t&&t.identifier?((i=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(r)).where(i.escape(\"identifier\")+\" = :condition\",{condition:r.identifier}),[4,i.execute()]):[3,2];case 1:return a.sent(),[3,6];case 2:return t&&t.query?(i=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(r),this.connection.driver instanceof ue.a?i.where('dbms_lob.compare(\"query\", :condition) = 0',{condition:r.query}):i.where(i.escape(\"query\")+\" = :condition\",{condition:r.query}),[4,i.execute()]):[3,4];case 3:return a.sent(),[3,6];case 4:return[4,n.manager.createQueryBuilder().insert().into(this.queryResultCacheTable).values(r).execute()];case 5:a.sent(),a.label=6;case 6:return[2]}})})},e.prototype.clear=function(e){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2,this.getQueryRunner(e).clearTable(this.queryResultCacheTable)]})})},e.prototype.remove=function(e,t){return Object(p.b)(this,void 0,void 0,function(){var n=this;return Object(p.d)(this,function(r){switch(r.label){case 0:return[4,Promise.all(e.map(function(e){var r=n.getQueryRunner(t).manager.createQueryBuilder();return r.delete().from(n.queryResultCacheTable).where(r.escape(\"identifier\")+\" = :identifier\",{identifier:e}).execute()}))];case 1:return r.sent(),[2]}})})},e.prototype.getQueryRunner=function(e){return e||this.connection.createQueryRunner()},e}(),_t=function(){function e(e){this.connection=e}return e.prototype.create=function(){if(!this.connection.options.cache)throw new Error(\"To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }\");var e=this.connection.options.cache;return e.provider&&\"function\"==typeof e.provider?e.provider(this.connection):\"redis\"===e.type||\"ioredis\"===e.type||\"ioredis/cluster\"===e.type?new xt(this.connection,e.type):new It(this.connection)},e}(),Lt=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t,n){return n&&n.isReleased&&(n=void 0),e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t,n):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t,n):e.isManyToManyOwner?this.loadManyToManyOwner(e,t,n):this.loadManyToManyNotOwner(e,t,n)},e.prototype.loadManyToOneOrOneToOneOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.entityMetadata.primaryColumns,a=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map(function(t){return e.entityMetadata.name+\".\"+t.propertyName+\" = \"+e.propertyName+\".\"+t.referencedColumn.propertyName}).join(\" AND \"),o=e.entityMetadata.name,s=this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName).innerJoin(e.entityMetadata.target,o,a);if(1===i.length)s.where(o+\".\"+i[0].propertyPath+\" IN (:...\"+o+\"_\"+i[0].propertyName+\")\"),s.setParameter(o+\"_\"+i[0].propertyName,r.map(function(e){return i[0].getEntityValue(e)}));else{var u=r.map(function(e,t){return i.map(function(n,r){var i=o+\"_entity_\"+t+\"_\"+r;return s.setParameter(i,n.getEntityValue(e)),o+\".\"+n.propertyPath+\" = :\"+i}).join(\" AND \")}).map(function(e){return\"(\"+e+\")\"}).join(\" OR \");s.where(u)}return s.getMany()},e.prototype.loadOneToManyOrOneToOneNotOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.propertyName,a=e.inverseRelation.joinColumns,o=this.connection.createQueryBuilder(n).select(i).from(e.inverseRelation.entityMetadata.target,i);if(1===a.length)o.where(i+\".\"+a[0].propertyPath+\" IN (:...\"+i+\"_\"+a[0].propertyName+\")\"),o.setParameter(i+\"_\"+a[0].propertyName,r.map(function(e){return a[0].referencedColumn.getEntityValue(e)}));else{var s=r.map(function(e,t){return a.map(function(n,r){var a=i+\"_entity_\"+t+\"_\"+r;return o.setParameter(a,n.referencedColumn.getEntityValue(e)),i+\".\"+n.propertyPath+\" = :\"+a}).join(\" AND \")}).map(function(e){return\"(\"+e+\")\"}).join(\" OR \");o.where(s)}return o.getMany()},e.prototype.loadManyToManyOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.propertyName,a=e.junctionEntityMetadata.tableName,o=e.joinColumns.map(function(e){return a+\".\"+e.propertyName+\" IN (:...\"+e.propertyName+\")\"}),s=e.inverseJoinColumns.map(function(e){return a+\".\"+e.propertyName+\"=\"+i+\".\"+e.referencedColumn.propertyName}),u=e.joinColumns.reduce(function(e,t){return e[t.propertyName]=r.map(function(e){return t.referencedColumn.getEntityValue(e)}),e},{});return this.connection.createQueryBuilder(n).select(i).from(e.type,i).innerJoin(a,a,Object(p.f)(o,s).join(\" AND \")).setParameters(u).getMany()},e.prototype.loadManyToManyNotOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.propertyName,a=e.junctionEntityMetadata.tableName,o=e.inverseRelation.joinColumns.map(function(e){return a+\".\"+e.propertyName+\" = \"+i+\".\"+e.referencedColumn.propertyName}),s=e.inverseRelation.inverseJoinColumns.map(function(e){return a+\".\"+e.propertyName+\" IN (:...\"+e.propertyName+\")\"}),u=e.inverseRelation.inverseJoinColumns.reduce(function(e,t){return e[t.propertyName]=r.map(function(e){return t.referencedColumn.getEntityValue(e)}),e},{});return this.connection.createQueryBuilder(n).select(i).from(e.type,i).innerJoin(a,a,Object(p.f)(o,s).join(\" AND \")).setParameters(u).getMany()},e.prototype.enableLazyLoad=function(e,t,n){var r=this,i=\"__\"+e.propertyName+\"__\",a=\"__promise_\"+e.propertyName+\"__\",o=\"__has_\"+e.propertyName+\"__\",s=function(e,t){return e[i]=t,e[o]=!0,delete e[a],t},u=function(e,t){return delete e[o],delete e[i],e[a]=t,t.then(function(n){return e[a]===t?s(e,n):n}),t};Object.defineProperty(t,e.propertyName,{get:function(){if(!0===this[o]||void 0!==this[i])return Promise.resolve(this[i]);if(this[a])return this[a];var t=r.load(e,this,n).then(function(t){return e.isOneToOne||e.isManyToOne?t[0]:t});return u(this,t)},set:function(e){e instanceof Promise?u(this,e):s(this,e)},configurable:!0})},e}(),Dt=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t,n,r){return Object(p.b)(this,void 0,void 0,function(){var i,a,o,s;return Object(p.d)(this,function(){if(e instanceof ot)i=e,a=Array.isArray(t)?t:[t],o=Array.isArray(n)?n:n?[n]:void 0;else{if(s=this.connection.getMetadata(e),!(i=s.findRelationWithPropertyPath(t)))throw new Error('Relation \"'+i+'\" was not found in \"'+s.name+'\".');a=Array.isArray(n)?n:[n],o=Array.isArray(r)?r:r?[r]:void 0}return i.isManyToMany?[2,this.loadForManyToMany(i,a,o)]:i.isManyToOne||i.isOneToOneOwner?[2,this.loadForManyToOneAndOneToOneOwner(i,a,o)]:[2,this.loadForOneToManyAndOneToOneNotOwner(i,a,o)]})})},e.prototype.loadManyToManyRelationIdsAndGroup=function(e,t,n){return Object(p.b)(this,void 0,void 0,function(){var r,i,a,o,s,u;return Object(p.d)(this,function(c){switch(c.label){case 0:return r=e.isManyToMany||e.isOneToMany,i=Array.isArray(t)?t:[t],n?[3,2]:[4,this.connection.relationLoader.load(e,t)];case 1:if(!(n=c.sent()).length)return[2,i.map(function(e){return{entity:e,related:r?[]:void 0}})];c.label=2;case 2:return[4,this.load(e,t,n)];case 3:return a=c.sent(),o=Array.isArray(n)?n:[n],e.isManyToManyOwner?(s=e.junctionEntityMetadata.inverseColumns.map(function(e){return e.referencedColumn}),u=e.junctionEntityMetadata.ownerColumns.map(function(e){return e.referencedColumn})):e.isManyToManyNotOwner?(s=e.junctionEntityMetadata.ownerColumns.map(function(e){return e.referencedColumn}),u=e.junctionEntityMetadata.inverseColumns.map(function(e){return e.referencedColumn})):e.isManyToOne||e.isOneToOneOwner?(s=e.joinColumns.map(function(e){return e.referencedColumn}),u=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(s=e.inverseRelation.entityMetadata.primaryColumns,u=e.inverseRelation.joinColumns.map(function(e){return e.referencedColumn})),[2,i.map(function(t){var n={entity:t,related:r?[]:void 0};return a.forEach(function(i){u.every(function(e){return e.getEntityValue(t)===i[e.entityMetadata.name+\"_\"+e.propertyPath.replace(\".\",\"_\")]})&&o.forEach(function(t){s.every(function(n){return n.getEntityValue(t)===i[n.entityMetadata.name+\"_\"+e.propertyPath.replace(\".\",\"_\")+\"_\"+n.propertyPath.replace(\".\",\"_\")]})&&(r?n.related.push(t):n.related=t)})}),n})]}})})},e.prototype.loadForManyToMany=function(e,t,n){var r=e.junctionEntityMetadata,i=r.name,a=e.isOwning?r.ownerColumns:r.inverseColumns,o=e.isOwning?r.inverseColumns:r.ownerColumns,s=this.connection.createQueryBuilder();r.ownerColumns.forEach(function(e){var t=e.referencedColumn.entityMetadata.name+\"_\"+e.referencedColumn.propertyPath.replace(\".\",\"_\");s.addSelect(i+\".\"+e.propertyPath,t)}),r.inverseColumns.forEach(function(t){var n=t.referencedColumn.entityMetadata.name+\"_\"+e.propertyPath.replace(\".\",\"_\")+\"_\"+t.referencedColumn.propertyPath.replace(\".\",\"_\");s.addSelect(i+\".\"+t.propertyPath,n)});var u=\"\";1===a.length?(s.setParameter(\"values1\",t.map(function(e){return a[0].referencedColumn.getEntityValue(e)})),u=i+\".\"+a[0].propertyPath+\" IN (:...values1)\"):u=\"(\"+t.map(function(e,t){return a.map(function(n){var r=\"entity1_\"+t+\"_\"+n.propertyName;return s.setParameter(r,n.referencedColumn.getEntityValue(e)),i+\".\"+n.propertyPath+\" = :\"+r}).join(\" AND \")}).map(function(e){return\"(\"+e+\")\"}).join(\" OR \")+\")\";var c=\"\";return n&&(1===o.length?(s.setParameter(\"values2\",n.map(function(e){return o[0].referencedColumn.getEntityValue(e)})),c=i+\".\"+o[0].propertyPath+\" IN (:...values2)\"):c=\"(\"+n.map(function(e,t){return o.map(function(n){var r=\"entity2_\"+t+\"_\"+n.propertyName;return s.setParameter(r,n.referencedColumn.getEntityValue(e)),i+\".\"+n.propertyPath+\" = :\"+r}).join(\" AND \")}).map(function(e){return\"(\"+e+\")\"}).join(\" OR \")+\")\"),s.from(r.target,i).where(u+(c?\" AND \"+c:\"\")).getRawMany()},e.prototype.loadForManyToOneAndOneToOneOwner=function(e,t){var n=e.entityMetadata.targetName,r=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach(function(e){var t=e.entityMetadata.name+\"_\"+e.propertyPath.replace(\".\",\"_\");r.addSelect(n+\".\"+e.propertyPath,t)}),e.joinColumns.forEach(function(t){var i=t.referencedColumn.entityMetadata.name+\"_\"+e.propertyPath.replace(\".\",\"_\")+\"_\"+t.referencedColumn.propertyPath.replace(\".\",\"_\");r.addSelect(n+\".\"+t.propertyPath,i)});var i=\"\";return 1===e.entityMetadata.primaryColumns.length?(r.setParameter(\"values\",t.map(function(t){return e.entityMetadata.primaryColumns[0].getEntityValue(t)})),i=n+\".\"+e.entityMetadata.primaryColumns[0].propertyPath+\" IN (:...values)\"):i=t.map(function(t,i){return e.entityMetadata.primaryColumns.map(function(e,a){var o=\"entity\"+i+\"_\"+a;return r.setParameter(o,e.getEntityValue(t)),n+\".\"+e.propertyPath+\" = :\"+o}).join(\" AND \")}).map(function(e){return\"(\"+e+\")\"}).join(\" OR \"),r.from(e.entityMetadata.target,n).where(i).getRawMany()},e.prototype.loadForOneToManyAndOneToOneNotOwner=function(e,t){var n=(e=e.inverseRelation).entityMetadata.targetName,r=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach(function(t){var i=t.entityMetadata.name+\"_\"+e.inverseRelation.propertyPath.replace(\".\",\"_\")+\"_\"+t.propertyPath.replace(\".\",\"_\");r.addSelect(n+\".\"+t.propertyPath,i)}),e.joinColumns.forEach(function(e){var t=e.referencedColumn.entityMetadata.name+\"_\"+e.referencedColumn.propertyPath.replace(\".\",\"_\");r.addSelect(n+\".\"+e.propertyPath,t)});var i=\"\";return 1===e.joinColumns.length?(r.setParameter(\"values\",t.map(function(t){return e.joinColumns[0].referencedColumn.getEntityValue(t)})),i=n+\".\"+e.joinColumns[0].propertyPath+\" IN (:...values)\"):i=t.map(function(t,i){return e.joinColumns.map(function(e,a){var o=\"entity\"+i+\"_\"+a;return r.setParameter(o,e.referencedColumn.getEntityValue(t)),n+\".\"+e.propertyPath+\" = :\"+o}).join(\" AND \")}).map(function(e){return\"(\"+e+\")\"}).join(\" OR \"),r.from(e.entityMetadata.target,n).where(i).getRawMany()},e}(),qt=n(16),Bt=function(){function e(e){this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||\"default\",this.options=e,this.logger=(new Pt).create(this.options.logger,this.options.logging),this.driver=(new nt).create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new y,this.queryResultCache=e.cache?new _t(this).create():void 0,this.relationLoader=new Lt(this),this.relationIdLoader=new Dt(this),this.isConnected=!1}return Object.defineProperty(e.prototype,\"mongoManager\",{get:function(){if(!(this.manager instanceof O.e))throw new Error(\"MongoEntityManager is only available for MongoDB databases.\");return this.manager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"sqljsManager\",{get:function(){if(!(this.manager instanceof Ce))throw new Error(\"SqljsEntityManager is only available for Sqljs databases.\");return this.manager},enumerable:!0,configurable:!0}),e.prototype.connect=function(){return Object(p.b)(this,void 0,void 0,function(){var e;return Object(p.d)(this,function(t){switch(t.label){case 0:if(this.isConnected)throw new v(this.name);return[4,this.driver.connect()];case 1:return t.sent(),this.queryResultCache?[4,this.queryResultCache.connect()]:[3,3];case 2:t.sent(),t.label=3;case 3:Oe.a.assign(this,{isConnected:!0}),t.label=4;case 4:return t.trys.push([4,12,,14]),this.buildMetadatas(),[4,this.driver.afterConnect()];case 5:return t.sent(),this.options.dropSchema?[4,this.dropDatabase()]:[3,7];case 6:t.sent(),t.label=7;case 7:return this.options.synchronize?[4,this.synchronize()]:[3,9];case 8:t.sent(),t.label=9;case 9:return this.options.migrationsRun?[4,this.runMigrations({transaction:this.options.migrationsTransactionMode})]:[3,11];case 10:t.sent(),t.label=11;case 11:return[3,14];case 12:return e=t.sent(),[4,this.close()];case 13:throw t.sent(),e;case 14:return[2,this]}})})},e.prototype.close=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new b(this.name);return[4,this.driver.disconnect()];case 1:return e.sent(),this.queryResultCache?[4,this.queryResultCache.disconnect()]:[3,3];case 2:e.sent(),e.label=3;case 3:return Oe.a.assign(this,{isConnected:!1}),[2]}})})},e.prototype.synchronize=function(e){return void 0===e&&(e=!1),Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(t){switch(t.label){case 0:if(!this.isConnected)throw new b(this.name);return e?[4,this.dropDatabase()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,this.driver.createSchemaBuilder().build()];case 3:return t.sent(),[2]}})})},e.prototype.dropDatabase=function(){return Object(p.b)(this,void 0,void 0,function(){var e,t,n,r,i,a,o,s;return Object(p.d)(this,function(u){switch(u.label){case 0:e=this.createQueryRunner(),u.label=1;case 1:if(u.trys.push([1,,13,15]),!(this.driver instanceof T.a||this.driver instanceof O.h||this.driver instanceof O.a))return[3,10];t=this.driver.database?[this.driver.database]:[],this.entityMetadatas.forEach(function(e){e.database&&-1===t.indexOf(e.database)&&t.push(e.database)}),u.label=2;case 2:u.trys.push([2,7,8,9]),n=Object(p.g)(t),r=n.next(),u.label=3;case 3:return r.done?[3,6]:(i=r.value,[4,e.clearDatabase(i)]);case 4:u.sent(),u.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return a=u.sent(),o={error:a},[3,9];case 8:try{r&&!r.done&&(s=n.return)&&s.call(n)}finally{if(o)throw o.error}return[7];case 9:return[3,12];case 10:return[4,e.clearDatabase()];case 11:u.sent(),u.label=12;case 12:return[3,15];case 13:return[4,e.release()];case 14:return u.sent(),[7];case 15:return[2]}})})},e.prototype.runMigrations=function(e){return Object(p.b)(this,void 0,void 0,function(){var t;return Object(p.d)(this,function(n){switch(n.label){case 0:if(!this.isConnected)throw new b(this.name);return(t=new A(this)).transaction=e&&e.transaction||\"all\",[4,t.executePendingMigrations()];case 1:return[2,n.sent()]}})})},e.prototype.undoLastMigration=function(e){return Object(p.b)(this,void 0,void 0,function(){var t;return Object(p.d)(this,function(n){switch(n.label){case 0:if(!this.isConnected)throw new b(this.name);return(t=new A(this)).transaction=e&&e.transaction||\"all\",[4,t.undoLastMigration()];case 1:return n.sent(),[2]}})})},e.prototype.showMigrations=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new b(this.name);return[4,new A(this).showMigrations()];case 1:return[2,e.sent()]}})})},e.prototype.hasMetadata=function(e){return!!this.findMetadata(e)},e.prototype.getMetadata=function(e){var t=this.findMetadata(e);if(!t)throw new g(e);return t},e.prototype.getRepository=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepository=function(e){return this.manager.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof O.d))throw new Error(\"You can use getMongoRepository only for MongoDB connections.\");return this.manager.getRepository(e)},e.prototype.getCustomRepository=function(e){return this.manager.getCustomRepository(e)},e.prototype.transaction=function(e,t){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){return[2,this.manager.transaction(e,t)]})})},e.prototype.query=function(e,t,n){return Object(p.b)(this,void 0,void 0,function(){var r;return Object(p.d)(this,function(i){switch(i.label){case 0:if(this instanceof O.e)throw new Error(\"Queries aren't supported by MongoDB.\");if(n&&n.isReleased)throw new x;r=n||this.createQueryRunner(),i.label=1;case 1:return i.trys.push([1,,3,6]),[4,r.query(e,t)];case 2:return[2,i.sent()];case 3:return n?[3,5]:[4,r.release()];case 4:i.sent(),i.label=5;case 5:return[7];case 6:return[2]}})})},e.prototype.createQueryBuilder=function(e,t,n){if(this instanceof O.e)throw new Error(\"Query Builder is not supported by MongoDB.\");if(t){var r=this.getMetadata(e);return new At.SelectQueryBuilder(this,n).select(t).from(r.target,t)}return new At.SelectQueryBuilder(this,e)},e.prototype.createQueryRunner=function(e){void 0===e&&(e=\"master\");var t=this.driver.createQueryRunner(e),n=this.createEntityManager(t);return Object.assign(t,{manager:n}),t},e.prototype.getManyToManyMetadata=function(e,t){var n=this.getMetadata(e).findRelationWithPropertyPath(t);if(!n)throw new Error('Relation \"'+t+'\" was not found in '+e+\" entity.\");if(!n.isManyToMany)throw new Error('Relation \"'+e+\"#\"+t+'\" does not have a many-to-many relationship.You can use this method only on many-to-many relations.');return n.junctionEntityMetadata},e.prototype.createEntityManager=function(e){return(new Re).create(this,e)},e.prototype.findMetadata=function(e){return this.entityMetadatas.find(function(t){return t.target===e||(e instanceof Nt.a?t.name===e.options.name:\"string\"==typeof e&&(-1===e.indexOf(\".\")?t.name===e||t.tableName===e:t.tablePath===e))})},e.prototype.buildMetadatas=function(){var e=new Ot(this),t=new P,n=e.buildSubscribers(this.options.subscribers||[]);Oe.a.assign(this,{subscribers:n});var r=e.buildEntityMetadatas(this.options.entities||[]);Oe.a.assign(this,{entityMetadatas:r});var i=e.buildMigrations(this.options.migrations||[]);Oe.a.assign(this,{migrations:i}),this.driver.database=this.getDatabaseName(),t.validateMany(this.entityMetadatas.filter(function(e){return\"view\"!==e.tableType}),this.driver)},e.prototype.getDatabaseName=function(){var e=this.options;switch(e.type){case\"mysql\":case\"mariadb\":case\"postgres\":case\"cockroachdb\":case\"mssql\":case\"oracle\":return qt.a.buildDriverOptions(e.replication?e.replication.master:e).database;default:return qt.a.buildDriverOptions(e).database}},e}(),Ut=function(e){function t(n){var r=e.call(this)||this;return r.name=\"ConnectionNotFoundError\",Object.setPrototypeOf(r,t.prototype),r.message='Connection \"'+n+'\" was not found.',r}return Object(p.c)(t,e),t}(Error),Ft=function(e){function t(n){var r=e.call(this)||this;return r.name=\"AlreadyHasActiveConnectionError\",Object.setPrototypeOf(r,t.prototype),r.message='Cannot create a new connection named \"'+n+'\", because connection with such name already exist and it now has an active connection session.',r}return Object(p.c)(t,e),t}(Error),kt=function(){function e(){this.connections=[]}return e.prototype.has=function(e){return!!this.connections.find(function(t){return t.name===e})},e.prototype.get=function(e){void 0===e&&(e=\"default\");var t=this.connections.find(function(t){return t.name===e});if(!t)throw new Ut(e);return t},e.prototype.create=function(e){var t=this.connections.find(function(t){return t.name===(e.name||\"default\")});if(t){if(t.isConnected)throw new Ft(e.name||\"default\");this.connections.splice(this.connections.indexOf(t),1)}var n=new Bt(e);return this.connections.push(n),n},e}();(function(){function e(){}e.prototype.read=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){throw new Error(\"Cannot read connection options in a browser context.\")})})}})(),function(){function e(){}e.prototype.read=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){throw new Error(\"Cannot read connection options in a browser context.\")})})}}(),function(){function e(){}e.prototype.read=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){throw new Error(\"Cannot read connection options in a browser context.\")})})}}(),function(){function e(){}e.prototype.all=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){throw new Error(\"Cannot read connection options in a browser context.\")})})},e.prototype.get=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){throw new Error(\"Cannot read connection options in a browser context.\")})})},e.prototype.has=function(){return Object(p.b)(this,void 0,void 0,function(){return Object(p.d)(this,function(){throw new Error(\"Cannot read connection options in a browser context.\")})})}}(),function(e){function t(n,r){var i=e.call(this)||this;return i.name=\"ColumnTypeUndefinedError\",Object.setPrototypeOf(i,t.prototype),i.message=\"Column type for \"+n.constructor.name+\"#\"+r+' is not defined and cannot be guessed. Make sure you have turned on an \"emitDecoratorMetadata\": true option in tsconfig.json. Also make sure you have imported \"reflect-metadata\" on top of the main entry file in your application (before any entity imported).If you are using JavaScript instead of TypeScript you must explicitly provide a column type.',i}Object(p.c)(t,e)}(Error),function(e){function t(n,r){var i=e.call(this)||this;return i.name=\"PrimaryColumnCannotBeNullableError\",Object.setPrototypeOf(i,t.prototype),i.message=\"Primary column \"+n.constructor.name+\"#\"+r+\" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.\",i}Object(p.c)(t,e)}(Error),function(){function e(){}e.AFTER_LOAD=\"after-load\",e.BEFORE_INSERT=\"before-insert\",e.AFTER_INSERT=\"after-insert\",e.BEFORE_UPDATE=\"before-update\",e.AFTER_UPDATE=\"after-update\",e.BEFORE_REMOVE=\"before-remove\",e.AFTER_REMOVE=\"after-remove\"}(),function(e){function t(n,r){var i=e.call(this)||this;return i.name=\"CannotReflectMethodParameterTypeError\",Object.setPrototypeOf(i,t.prototype),i.message='Cannot get reflected type for a \"'+r+'\" method\\'s parameter of \"'+n.name+'\" class. Make sure you have turned on an \"emitDecoratorMetadata\": true option in tsconfig.json. Also make sure you have imported \"reflect-metadata\" on top of the main entry file in your application.',i}Object(p.c)(t,e)}(Error),n(11),n(58),function(){function e(){}e.prototype.hasId=function(){return this.constructor.getRepository().hasId(this)},e.prototype.save=function(e){return this.constructor.getRepository().save(this,e)},e.prototype.remove=function(e){return this.constructor.getRepository().remove(this,e)},e.prototype.softRemove=function(e){return this.constructor.getRepository().softRemove(this,e)},e.prototype.recover=function(e){return this.constructor.getRepository().recover(this,e)},e.prototype.reload=function(){return Object(p.b)(this,void 0,void 0,function(){var e,t;return Object(p.d)(this,function(n){switch(n.label){case 0:return[4,(e=this.constructor).getRepository().findOneOrFail(e.getId(this))];case 1:return t=n.sent(),Oe.a.assign(this,t),[2]}})})},e.useConnection=function(e){this.usedConnection=e},e.getRepository=function(){return(this.usedConnection||u()).getRepository(this)},Object.defineProperty(e,\"target\",{get:function(){return this.getRepository().target},enumerable:!0,configurable:!0}),e.hasId=function(e){return this.getRepository().hasId(e)},e.getId=function(e){return this.getRepository().getId(e)},e.createQueryBuilder=function(e){return this.getRepository().createQueryBuilder(e)},e.create=function(e){return this.getRepository().create(e)},e.merge=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(t=this.getRepository()).merge.apply(t,Object(p.f)([e],n))},e.preload=function(e){return this.getRepository().preload(e)},e.save=function(e,t){return this.getRepository().save(e,t)},e.remove=function(e,t){return this.getRepository().remove(e,t)},e.softRemove=function(e,t){return this.getRepository().softRemove(e,t)},e.insert=function(e,t){return this.getRepository().insert(e,t)},e.update=function(e,t,n){return this.getRepository().update(e,t,n)},e.delete=function(e,t){return this.getRepository().delete(e,t)},e.count=function(e){return this.getRepository().count(e)},e.find=function(e){return this.getRepository().find(e)},e.findAndCount=function(e){return this.getRepository().findAndCount(e)},e.findByIds=function(e,t){return this.getRepository().findByIds(e,t)},e.findOne=function(e,t){return this.getRepository().findOne(e,t)},e.findOneOrFail=function(e,t){return this.getRepository().findOneOrFail(e,t)},e.query=function(e,t){return this.getRepository().query(e,t)},e.clear=function(){return this.getRepository().clear()}}(),n(30),n(66),n(68),n(65),n(67),n(57),n(55),n(49),n(59);n.d(t,\"g\",function(){return o}),n.d(t,\"f\",function(){return u}),n.d(t,\"h\",function(){return c}),n.d(t,\"c\",function(){return je.a}),n.d(t,\"d\",function(){return L}),n.d(t,\"e\",function(){return q}),n.d(t,\"b\",function(){return O.g}),n.d(t,\"a\",function(){return Nt.a})},function(e,t,n){(function(r){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&\"env\"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(90)).log=function(){return\"object\"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?\"%c\":\"\")+this.namespace+(n?\" %c\":\" \")+e[0]+(n?\"%c \":\" \")+\"+\"+t.humanize(this.diff),n){var r=\"color: \"+this.color;e.splice(1,0,r,\"color: inherit\");var i=0,a=0;e[0].replace(/%[a-zA-Z%]/g,function(e){\"%%\"===e||(i++,\"%c\"===e&&(a=i))}),e.splice(a,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem(\"debug\"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){return\"undefined\"!=typeof window&&window.process&&\"renderer\"===window.process.type||\"undefined\"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||\"undefined\"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&31<=parseInt(RegExp.$1,10)||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/)},t.storage=\"undefined\"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=[\"lightseagreen\",\"forestgreen\",\"goldenrod\",\"dodgerblue\",\"darkorchid\",\"crimson\"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return\"[UnexpectedJSONParseError]: \"+e.message}},t.enable(i())}).call(this,n(69))},function(e,t,n){\"use strict\";function r(e,t){return e.name===t.name&&e.referencedTableName===t.referencedTablePath}n.d(t,\"a\",function(){return m});var i=n(0),a=n(2),o=n(3),s=n(8),u=n(13),c=n(12),l=n(54),h=n(10),p=n(18),d=n(36),f=n(17),m=function(){function e(e){this.connection=e}return e.prototype.build=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t;return Object(i.d)(this,function(n){switch(n.label){case 0:return this.queryRunner=this.connection.createQueryRunner(),this.connection.driver instanceof a.c?[3,2]:[4,this.queryRunner.startTransaction()];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,12,18,20]),e=this.entityToSyncMetadatas.map(function(e){return e.tablePath}),0<this.viewEntityToSyncMetadatas.length?[4,this.createTypeormMetadataTable()]:[3,4];case 3:n.sent(),n.label=4;case 4:return[4,this.queryRunner.getTables(e)];case 5:return n.sent(),[4,this.queryRunner.getViews([])];case 6:return n.sent(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 7:return n.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,9];case 8:n.sent(),n.label=9;case 9:return this.connection.driver instanceof a.c?[3,11]:[4,this.queryRunner.commitTransaction()];case 10:n.sent(),n.label=11;case 11:return[3,20];case 12:t=n.sent(),n.label=13;case 13:return n.trys.push([13,16,,17]),this.connection.driver instanceof a.c?[3,15]:[4,this.queryRunner.rollbackTransaction()];case 14:n.sent(),n.label=15;case 15:return[3,17];case 16:return n.sent(),[3,17];case 17:throw t;case 18:return[4,this.queryRunner.release()];case 19:return n.sent(),[7];case 20:return[2]}})})},e.prototype.log=function(){return Object(i.b)(this,void 0,void 0,function(){var e;return Object(i.d)(this,function(t){switch(t.label){case 0:this.queryRunner=this.connection.createQueryRunner(),t.label=1;case 1:return t.trys.push([1,,9,11]),e=this.entityToSyncMetadatas.map(function(e){return e.tablePath}),0<this.viewEntityToSyncMetadatas.length?[4,this.createTypeormMetadataTable()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.queryRunner.getTables(e)];case 4:return t.sent(),[4,this.queryRunner.getViews([])];case 5:return t.sent(),this.queryRunner.enableSqlMemory(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 6:return t.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,8];case 7:t.sent(),t.label=8;case 8:return[2,this.queryRunner.getMemorySql()];case 9:return this.queryRunner.disableSqlMemory(),[4,this.queryRunner.release()];case 10:return t.sent(),[7];case 11:return[2]}})})},Object.defineProperty(e.prototype,\"entityToSyncMetadatas\",{get:function(){return this.connection.entityMetadatas.filter(function(e){return e.synchronize&&\"entity-child\"!==e.tableType&&\"view\"!==e.tableType})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"viewEntityToSyncMetadatas\",{get:function(){return this.connection.entityMetadatas.filter(function(e){return\"view\"===e.tableType&&e.synchronize})},enumerable:!0,configurable:!0}),e.prototype.executeSchemaSyncOperationsInProperOrder=function(){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(e){switch(e.label){case 0:return[4,this.dropOldViews()];case 1:return e.sent(),[4,this.dropOldForeignKeys()];case 2:return e.sent(),[4,this.dropOldIndices()];case 3:return e.sent(),[4,this.dropOldChecks()];case 4:return e.sent(),[4,this.dropOldExclusions()];case 5:return e.sent(),[4,this.dropCompositeUniqueConstraints()];case 6:return e.sent(),[4,this.renameColumns()];case 7:return e.sent(),[4,this.createNewTables()];case 8:return e.sent(),[4,this.dropRemovedColumns()];case 9:return e.sent(),[4,this.addNewColumns()];case 10:return e.sent(),[4,this.updatePrimaryKeys()];case 11:return e.sent(),[4,this.updateExistColumns()];case 12:return e.sent(),[4,this.createNewIndices()];case 13:return e.sent(),[4,this.createNewChecks()];case 14:return e.sent(),[4,this.createNewExclusions()];case 15:return e.sent(),[4,this.createCompositeUniqueConstraints()];case 16:return e.sent(),[4,this.createForeignKeys()];case 17:return e.sent(),[4,this.createViews()];case 18:return e.sent(),[2]}})})},e.prototype.dropOldForeignKeys=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,a,o,s,u,c;return Object(i.d)(this,function(l){switch(l.label){case 0:e=function(e){var n,a;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?0===(a=n.foreignKeys.filter(function(t){var n=e.foreignKeys.find(function(e){return r(t,e)});return!n||n.onDelete&&n.onDelete!==t.onDelete||n.onUpdate&&n.onUpdate!==t.onUpdate})).length?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"dropping old foreign keys of \"+n.name+\": \"+a.map(function(e){return e.name}).join(\", \")),[4,t.queryRunner.dropForeignKeys(n,a)]):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),a=n.next(),l.label=2;case 2:return a.done?[3,5]:(o=a.value,[5,e(o)]);case 3:l.sent(),l.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return s=l.sent(),u={error:s},[3,8];case 7:try{a&&!a.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}})})},e.prototype.renameTables=function(){return Object(i.b)(this,void 0,void 0,function(){return Object(i.d)(this,function(){return[2]})})},e.prototype.renameColumns=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,s,u,c=this;return Object(i.d)(this,function(l){switch(l.label){case 0:e=function(e){var n,r,a,o;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))&&e.columns.length===n.columns.length?0===(r=e.columns.filter(function(e){return!n.columns.find(function(t){return t.name===e.databaseName&&t.type===c.connection.driver.normalizeType(e)&&t.isNullable===e.isNullable&&t.isUnique===c.connection.driver.normalizeIsUnique(e)})})).length||1<r.length?[2,\"continue\"]:0===(a=n.columns.filter(function(t){return!e.columns.find(function(e){return e.databaseName===t.name&&c.connection.driver.normalizeType(e)===t.type&&e.isNullable===t.isNullable&&c.connection.driver.normalizeIsUnique(e)===t.isUnique})})).length||1<a.length?[2,\"continue\"]:((o=a[0].clone()).name=r[0].databaseName,t.connection.logger.logSchemaBuild('renaming column \"'+a[0].name+'\" in to \"'+o.name+'\"'),[4,t.queryRunner.renameColumn(n,a[0],o)]):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),l.label=2;case 2:return r.done?[3,5]:(a=r.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},e.prototype.dropOldIndices=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,s,u,c=this;return Object(i.d)(this,function(l){switch(l.label){case 0:e=function(e){var n,r;return Object(i.d)(this,function(a){switch(a.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?(r=n.indices.filter(function(t){var n=e.indices.find(function(e){return e.name===t.name});return!n||!1!==n.synchronize&&(n.isUnique!==t.isUnique||n.isSpatial!==t.isSpatial||c.connection.driver.isFullTextColumnTypeSupported()&&n.isFulltext!==t.isFulltext||n.columns.length!==t.columnNames.length||!n.columns.every(function(e){return-1!==t.columnNames.indexOf(e.databaseName)}))}).map(function(e){return Object(i.b)(c,void 0,void 0,function(){return Object(i.d)(this,function(t){switch(t.label){case 0:return this.connection.logger.logSchemaBuild('dropping an index: \"'+e.name+'\" from table '+n.name),[4,this.queryRunner.dropIndex(n,e)];case 1:return t.sent(),[2]}})})}),[4,Promise.all(r)]):[2,\"continue\"];case 1:return a.sent(),[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),l.label=2;case 2:return r.done?[3,5]:(a=r.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},e.prototype.dropOldChecks=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,o,s,u,c;return Object(i.d)(this,function(l){switch(l.label){case 0:if(this.connection.driver instanceof a.h||this.connection.driver instanceof a.a)return[2];e=function(e){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?0===(r=n.checks.filter(function(t){return!e.checks.find(function(e){return e.name===t.name})})).length?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"dropping old check constraint: \"+r.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+' from table \"'+n.name+'\"'),[4,t.queryRunner.dropCheckConstraints(n,r)]):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),l.label=2;case 2:return r.done?[3,5]:(o=r.value,[5,e(o)]);case 3:l.sent(),l.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return s=l.sent(),u={error:s},[3,8];case 7:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}})})},e.prototype.dropCompositeUniqueConstraints=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,s,u;return Object(i.d)(this,function(c){switch(c.label){case 0:e=function(e){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?0===(r=n.uniques.filter(function(t){return 1<t.columnNames.length&&!e.uniques.find(function(e){return e.name===t.name})})).length?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"dropping old unique constraint: \"+r.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+' from table \"'+n.name+'\"'),[4,t.queryRunner.dropUniqueConstraints(n,r)]):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,c.label=1;case 1:c.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),c.label=2;case 2:return r.done?[3,5]:(a=r.value,[5,e(a)]);case 3:c.sent(),c.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},e.prototype.dropOldExclusions=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,o,s,u,c;return Object(i.d)(this,function(l){switch(l.label){case 0:if(!(this.connection.driver instanceof a.i))return[2];e=function(e){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?0===(r=n.exclusions.filter(function(t){return!e.exclusions.find(function(e){return e.name===t.name})})).length?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"dropping old exclusion constraint: \"+r.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+' from table \"'+n.name+'\"'),[4,t.queryRunner.dropExclusionConstraints(n,r)]):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),l.label=2;case 2:return r.done?[3,5]:(o=r.value,[5,e(o)]);case 3:l.sent(),l.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return s=l.sent(),u={error:s},[3,8];case 7:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}})})},e.prototype.createNewTables=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,a,s,u,c,l=this;return Object(i.d)(this,function(h){switch(h.label){case 0:e=function(e){var n;return Object(i.d)(this,function(r){switch(r.label){case 0:return t.queryRunner.loadedTables.find(function(t){var n=e.database&&e.database!==l.connection.driver.database?e.database:void 0,r=e.schema||l.connection.driver.options.schema,i=l.connection.driver.buildTableName(e.tableName,r,n);return t.name===i})?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"creating a new table: \"+e.tablePath),n=o.a.create(e,t.connection.driver),[4,t.queryRunner.createTable(n,!1,!1)]);case 1:return r.sent(),t.queryRunner.loadedTables.push(n),[2]}})},t=this,h.label=1;case 1:h.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),h.label=2;case 2:return r.done?[3,5]:(a=r.value,[5,e(a)]);case 3:h.sent(),h.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return s=h.sent(),u={error:s},[3,8];case 7:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}})})},e.prototype.createViews=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,s,u,c=this;return Object(i.d)(this,function(l){switch(l.label){case 0:e=function(e){var n;return Object(i.d)(this,function(r){switch(r.label){case 0:return t.queryRunner.loadedViews.find(function(t){var n=e.database&&e.database!==c.connection.driver.database?e.database:void 0,r=e.schema||c.connection.driver.options.schema,i=c.connection.driver.buildTableName(e.tableName,r,n),a=\"string\"==typeof t.expression?t.expression.trim():t.expression(c.connection).getQuery(),o=\"string\"==typeof e.expression?e.expression.trim():e.expression(c.connection).getQuery();return t.name===i&&a===o})?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"creating a new view: \"+e.tablePath),n=f.a.create(e,t.connection.driver),[4,t.queryRunner.createView(n)]);case 1:return r.sent(),t.queryRunner.loadedViews.push(n),[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=Object(i.g)(this.viewEntityToSyncMetadatas),r=n.next(),l.label=2;case 2:return r.done?[3,5]:(a=r.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},e.prototype.dropOldViews=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,s,u,c=this;return Object(i.d)(this,function(l){switch(l.label){case 0:e=function(e){return Object(i.d)(this,function(n){switch(n.label){case 0:return t.viewEntityToSyncMetadatas.find(function(t){var n=t.database&&t.database!==c.connection.driver.database?t.database:void 0,r=t.schema||c.connection.driver.options.schema,i=c.connection.driver.buildTableName(t.tableName,r,n),a=\"string\"==typeof e.expression?e.expression.trim():e.expression(c.connection).getQuery(),o=\"string\"==typeof t.expression?t.expression.trim():t.expression(c.connection).getQuery();return e.name===i&&a===o})?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"dropping an old view: \"+e.name),[4,t.queryRunner.dropView(e)]);case 1:return n.sent(),t.queryRunner.loadedViews.splice(t.queryRunner.loadedViews.indexOf(e),1),[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=Object(i.g)(this.queryRunner.loadedViews),r=n.next(),l.label=2;case 2:return r.done?[3,5]:(a=r.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},e.prototype.dropRemovedColumns=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,s,u;return Object(i.d)(this,function(c){switch(c.label){case 0:e=function(e){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?0===(r=n.columns.filter(function(t){return!e.columns.find(function(e){return e.databaseName===t.name})})).length?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"columns dropped in \"+n.name+\": \"+r.map(function(e){return e.name}).join(\", \")),[4,t.queryRunner.dropColumns(n,r)]):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,c.label=1;case 1:c.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),c.label=2;case 2:return r.done?[3,5]:(a=r.value,[5,e(a)]);case 3:c.sent(),c.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},e.prototype.addNewColumns=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,u,c;return Object(i.d)(this,function(l){switch(l.label){case 0:e=function(e){var n,r,a,o;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?0===(r=e.columns.filter(function(e){return!n.columns.find(function(t){return t.name===e.databaseName})})).length?[2,\"continue\"]:(a=t.metadataColumnsToTableColumnOptions(r),0===(o=a.map(function(e){return new s.a(e)})).length?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"new columns added: \"+r.map(function(e){return e.databaseName}).join(\", \")),[4,t.queryRunner.addColumns(n,o)])):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),l.label=2;case 2:return r.done?[3,5]:(a=r.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),u={error:o},[3,8];case 7:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}})})},e.prototype.updatePrimaryKeys=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,u,c,h=this;return Object(i.d)(this,function(p){switch(p.label){case 0:e=function(e){var n,r,a;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?(r=e.columns.filter(function(e){return e.isPrimary}),n.columns.filter(function(e){return e.isPrimary}).length!==r.length&&1<r.length?(a=r.map(function(e){return new s.a(l.a.createTableColumnOptions(e,h.connection.driver))}),[4,t.queryRunner.updatePrimaryKeys(n,a)]):[3,2]):[2,\"continue\"];case 1:i.sent(),i.label=2;case 2:return[2]}})},t=this,p.label=1;case 1:p.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),p.label=2;case 2:return r.done?[3,5]:(a=r.value,[5,e(a)]);case 3:p.sent(),p.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return o=p.sent(),u={error:o},[3,8];case 7:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}})})},e.prototype.updateExistColumns=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,o,u,c,h,p=this;return Object(i.d)(this,function(d){switch(d.label){case 0:e=function(e){var n,r,o,u,c,h,d,f,m,y,b,v,g,E,T,N,O,A,C;return Object(i.d)(this,function(w){switch(w.label){case 0:if(!(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath})))return[2,\"continue\"];if(0===(r=t.connection.driver.findChangedColumns(n.columns,e.columns)).length)return[2,\"continue\"];w.label=1;case 1:w.trys.push([1,6,7,8]),E=void 0,o=Object(i.g)(r),u=o.next(),w.label=2;case 2:return u.done?[3,5]:(b=u.value,[4,t.dropColumnReferencedForeignKeys(e.tablePath,b.databaseName)]);case 3:w.sent(),w.label=4;case 4:return u=o.next(),[3,2];case 5:return[3,8];case 6:return c=w.sent(),E={error:c},[3,8];case 7:try{u&&!u.done&&(T=o.return)&&T.call(o)}finally{if(E)throw E.error}return[7];case 8:w.trys.push([8,13,14,15]),N=void 0,h=Object(i.g)(r),d=h.next(),w.label=9;case 9:return d.done?[3,12]:(b=d.value,[4,t.dropColumnCompositeIndices(e.tablePath,b.databaseName)]);case 10:w.sent(),w.label=11;case 11:return d=h.next(),[3,9];case 12:return[3,15];case 13:return f=w.sent(),N={error:f},[3,15];case 14:try{d&&!d.done&&(O=h.return)&&O.call(h)}finally{if(N)throw N.error}return[7];case 15:if(t.connection.driver instanceof a.h||t.connection.driver instanceof a.a)return[3,23];w.label=16;case 16:w.trys.push([16,21,22,23]),A=void 0,m=Object(i.g)(r),y=m.next(),w.label=17;case 17:return y.done?[3,20]:(b=y.value,[4,t.dropColumnCompositeUniques(e.tablePath,b.databaseName)]);case 18:w.sent(),w.label=19;case 19:return y=m.next(),[3,17];case 20:return[3,23];case 21:return v=w.sent(),A={error:v},[3,23];case 22:try{y&&!y.done&&(C=m.return)&&C.call(m)}finally{if(A)throw A.error}return[7];case 23:return 0===(g=r.map(function(e){var t=n.columns.find(function(t){return t.name===e.databaseName}),r=l.a.createTableColumnOptions(e,p.connection.driver);return{oldColumn:t,newColumn:new s.a(r)}})).length?[2,\"continue\"]:(t.connection.logger.logSchemaBuild('columns changed in \"'+n.name+'\". updating: '+r.map(function(e){return e.databaseName}).join(\", \")),[4,t.queryRunner.changeColumns(n,g)]);case 24:return w.sent(),[2]}})},t=this,d.label=1;case 1:d.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),d.label=2;case 2:return r.done?[3,5]:(o=r.value,[5,e(o)]);case 3:d.sent(),d.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return u=d.sent(),c={error:u},[3,8];case 7:try{r&&!r.done&&(h=n.return)&&h.call(n)}finally{if(c)throw c.error}return[7];case 8:return[2]}})})},e.prototype.createNewIndices=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,s,u;return Object(i.d)(this,function(l){switch(l.label){case 0:e=function(e){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?0===(r=e.indices.filter(function(e){return!n.indices.find(function(t){return t.name===e.name})&&!0===e.synchronize}).map(function(e){return c.a.create(e)})).length?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"adding new indices \"+r.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+' in table \"'+n.name+'\"'),[4,t.queryRunner.createIndices(n,r)]):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),l.label=2;case 2:return r.done?[3,5]:(a=r.value,[5,e(a)]);case 3:l.sent(),l.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},e.prototype.createNewChecks=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,o,s,u,c;return Object(i.d)(this,function(l){switch(l.label){case 0:if(this.connection.driver instanceof a.h||this.connection.driver instanceof a.a)return[2];e=function(e){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?0===(r=e.checks.filter(function(e){return!n.checks.find(function(t){return t.name===e.name})}).map(function(e){return p.a.create(e)})).length?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"adding new check constraints: \"+r.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+' in table \"'+n.name+'\"'),[4,t.queryRunner.createCheckConstraints(n,r)]):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),l.label=2;case 2:return r.done?[3,5]:(o=r.value,[5,e(o)]);case 3:l.sent(),l.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return s=l.sent(),u={error:s},[3,8];case 7:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}})})},e.prototype.createCompositeUniqueConstraints=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,a,o,s,u;return Object(i.d)(this,function(c){switch(c.label){case 0:e=function(e){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?0===(r=e.uniques.filter(function(e){return 1<e.columns.length&&!n.uniques.find(function(t){return t.name===e.name})}).map(function(e){return h.a.create(e)})).length?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"adding new unique constraints: \"+r.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+' in table \"'+n.name+'\"'),[4,t.queryRunner.createUniqueConstraints(n,r)]):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,c.label=1;case 1:c.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),c.label=2;case 2:return r.done?[3,5]:(a=r.value,[5,e(a)]);case 3:c.sent(),c.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{r&&!r.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},e.prototype.createNewExclusions=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,r,o,s,u,c;return Object(i.d)(this,function(l){switch(l.label){case 0:if(!(this.connection.driver instanceof a.i))return[2];e=function(e){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?0===(r=e.exclusions.filter(function(e){return!n.exclusions.find(function(t){return t.name===e.name})}).map(function(e){return d.a.create(e)})).length?[2,\"continue\"]:(t.connection.logger.logSchemaBuild(\"adding new exclusion constraints: \"+r.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+' in table \"'+n.name+'\"'),[4,t.queryRunner.createExclusionConstraints(n,r)]):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,l.label=1;case 1:l.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),r=n.next(),l.label=2;case 2:return r.done?[3,5]:(o=r.value,[5,e(o)]);case 3:l.sent(),l.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return s=l.sent(),u={error:s},[3,8];case 7:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2]}})})},e.prototype.createForeignKeys=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t,n,a,o,s,c,l;return Object(i.d)(this,function(h){switch(h.label){case 0:e=function(e){var n,a,o;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=t.queryRunner.loadedTables.find(function(t){return t.name===e.tablePath}))?0===(a=e.foreignKeys.filter(function(e){return!n.foreignKeys.find(function(t){return r(t,e)})})).length?[2,\"continue\"]:(o=a.map(function(e){return u.a.create(e)}),t.connection.logger.logSchemaBuild(\"creating a foreign keys: \"+a.map(function(e){return e.name}).join(\", \")+' on table \"'+n.name+'\"'),[4,t.queryRunner.createForeignKeys(n,o)]):[2,\"continue\"];case 1:return i.sent(),[2]}})},t=this,h.label=1;case 1:h.trys.push([1,6,7,8]),n=Object(i.g)(this.entityToSyncMetadatas),a=n.next(),h.label=2;case 2:return a.done?[3,5]:(o=a.value,[5,e(o)]);case 3:h.sent(),h.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return s=h.sent(),c={error:s},[3,8];case 7:try{a&&!a.done&&(l=n.return)&&l.call(n)}finally{if(c)throw c.error}return[7];case 8:return[2]}})})},e.prototype.dropColumnReferencedForeignKeys=function(e,t){return Object(i.b)(this,void 0,void 0,function(){var n,r,a,o,s,u,c,l,h,p;return Object(i.d)(this,function(d){switch(d.label){case 0:if(!(n=this.queryRunner.loadedTables.find(function(t){return t.name===e})))return[2];if(r=[],(a=n.foreignKeys.find(function(e){return-1!==e.columnNames.indexOf(t)}))&&((o=n.clone()).foreignKeys=[a],r.push(o),n.removeForeignKey(a)),this.queryRunner.loadedTables.forEach(function(n){var i=n.foreignKeys.filter(function(n){return n.referencedTableName===e&&-1!==n.referencedColumnNames.indexOf(t)});if(0<i.length){var a=n.clone();a.foreignKeys=i,r.push(a),i.forEach(function(e){return n.removeForeignKey(e)})}}),!(0<r.length))return[3,8];d.label=1;case 1:d.trys.push([1,6,7,8]),s=Object(i.g)(r),u=s.next(),d.label=2;case 2:return u.done?[3,5]:(c=u.value,this.connection.logger.logSchemaBuild(\"dropping related foreign keys of \"+c.name+\": \"+c.foreignKeys.map(function(e){return e.name}).join(\", \")),[4,this.queryRunner.dropForeignKeys(c,c.foreignKeys)]);case 3:d.sent(),d.label=4;case 4:return u=s.next(),[3,2];case 5:return[3,8];case 6:return l=d.sent(),h={error:l},[3,8];case 7:try{u&&!u.done&&(p=s.return)&&p.call(s)}finally{if(h)throw h.error}return[7];case 8:return[2]}})})},e.prototype.dropColumnCompositeIndices=function(e,t){return Object(i.b)(this,void 0,void 0,function(){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=this.queryRunner.loadedTables.find(function(t){return t.name===e}))?0===(r=n.indices.filter(function(e){return 1<e.columnNames.length&&-1!==e.columnNames.indexOf(t)})).length?[2]:(this.connection.logger.logSchemaBuild('dropping related indices of \"'+e+'\".\"'+t+'\": '+r.map(function(e){return e.name}).join(\", \")),[4,this.queryRunner.dropIndices(n,r)]):[2];case 1:return i.sent(),[2]}})})},e.prototype.dropColumnCompositeUniques=function(e,t){return Object(i.b)(this,void 0,void 0,function(){var n,r;return Object(i.d)(this,function(i){switch(i.label){case 0:return(n=this.queryRunner.loadedTables.find(function(t){return t.name===e}))?0===(r=n.uniques.filter(function(e){return 1<e.columnNames.length&&-1!==e.columnNames.indexOf(t)})).length?[2]:(this.connection.logger.logSchemaBuild('dropping related unique constraints of \"'+e+'\".\"'+t+'\": '+r.map(function(e){return e.name}).join(\", \")),[4,this.queryRunner.dropUniqueConstraints(n,r)]):[2];case 1:return i.sent(),[2]}})})},e.prototype.metadataColumnsToTableColumnOptions=function(e){var t=this;return e.map(function(e){return l.a.createTableColumnOptions(e,t.connection.driver)})},e.prototype.createTypeormMetadataTable=function(){return Object(i.b)(this,void 0,void 0,function(){var e,t;return Object(i.d)(this,function(n){switch(n.label){case 0:return e=this.connection.driver.options,t=this.connection.driver.buildTableName(\"typeorm_metadata\",e.schema,e.database),[4,this.queryRunner.createTable(new o.a({name:t,columns:[{name:\"type\",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataType}),isNullable:!1},{name:\"database\",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataDatabase}),isNullable:!0},{name:\"schema\",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataSchema}),isNullable:!0},{name:\"table\",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataTable}),isNullable:!0},{name:\"name\",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataName}),isNullable:!0},{name:\"value\",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataValue}),isNullable:!0}]}),!0)];case 1:return n.sent(),[2]}})})},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name=\"ReturningStatementNotSupportedError\",Object.setPrototypeOf(n,t.prototype),n.message=\"OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL databases.\",n}return Object(r.c)(t,e),t}(Error)},function(e,t,n){function r(e,t){for(var n in e)t[n]=e[n]}function i(e,t,n){return o(e,t,n)}var a=n(38),o=a.Buffer;o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=a:(r(a,t),t.Buffer=i),i.prototype=Object.create(o.prototype),r(o,i),i.from=function(e,t,n){if(\"number\"==typeof e)throw new TypeError(\"Argument must not be a number\");return o(e,t,n)},i.alloc=function(e,t,n){if(\"number\"!=typeof e)throw new TypeError(\"Argument must be a number\");var r=o(e);return void 0===t?r.fill(0):\"string\"==typeof n?r.fill(t,n):r.fill(t),r},i.allocUnsafe=function(e){if(\"number\"!=typeof e)throw new TypeError(\"Argument must be a number\");return o(e)},i.allocUnsafeSlow=function(e){if(\"number\"!=typeof e)throw new TypeError(\"Argument must be a number\");return a.SlowBuffer(e)}},function(e){e.exports=\"function\"==typeof Object.create?function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},function(e,t,n){function r(e,t){this._block=i.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}var i=n(46).Buffer;r.prototype.update=function(e,t){\"string\"==typeof e&&(t=t||\"utf8\",e=i.from(e,t));for(var n=this._block,r=this._blockSize,a=e.length,o=this._len,s=0;s<a;){for(var u=o%r,c=Math.min(a-s,r-u),l=0;l<c;l++)n[u+l]=e[s+l];s+=c,0==(o+=c)%r&&this._update(n)}return this._len+=a,this},r.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(4294967295>=n)this._block.writeUInt32BE(n,this._blockSize-4);else{var r=(4294967295&n)>>>0;this._block.writeUInt32BE((n-r)/4294967296,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var i=this._hash();return e?i.toString(e):i},r.prototype._update=function(){throw new Error(\"_update must be implemented by subclass\")},e.exports=r},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){this.generatedMaps=[]}},function(e,t,n){\"use strict\";n.r(t);var r=n(0),i=n(20),a=n(80),o=n(7),s=function(e){function t(){var n=e.call(this)||this;return n.name=\"PessimisticLockTransactionRequiredError\",Object.setPrototypeOf(n,t.prototype),n.message=\"An open transaction is required for pessimistic lock.\",n}return Object(r.c)(t,e),t}(Error),u=function(e){function t(n){var r=e.call(this)||this;return r.name=\"NoVersionOrUpdateDateColumnError\",Object.setPrototypeOf(r,t.prototype),r.message=\"Entity \"+n+\" does not have version or update date columns.\",r}return Object(r.c)(t,e),t}(Error),c=function(e){function t(n,r,i){var a=e.call(this)||this;return a.name=\"OptimisticLockVersionMismatchError\",Object.setPrototypeOf(a,t.prototype),a.message=\"The optimistic lock on entity \"+n+\" failed, version \"+r+\" was expected, but is actually \"+i+\".\",a}return Object(r.c)(t,e),t}(Error),l=function(e){function t(){var n=e.call(this)||this;return n.name=\"OptimisticLockCanNotBeUsedError\",Object.setPrototypeOf(n,t.prototype),n.message=\"The optimistic lock can be used only with getOne() method.\",n}return Object(r.c)(t,e),t}(Error),h=n(61),p=n(51),d=n(52),f=n(16),m=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}return e.prototype.load=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n=this;return Object(r.d)(this,function(){return t=this.relationIdAttributes.map(function(t){return Object(r.b)(n,void 0,void 0,function(){var n,i,a,o,s,u,c,l,h,p,d,m,y,b,v,g,E,T,N,O,A,C=this;return Object(r.d)(this,function(w){switch(w.label){case 0:if(!t.relation.isManyToOne&&!t.relation.isOneToOneOwner)return[3,1];if(t.queryBuilderFactory)throw new Error(\"Additional condition can not be used with ManyToOne or OneToOne owner relations.\");return A=e.map(function(e){var n={};return t.relation.joinColumns.forEach(function(r){n[r.databaseName]=C.connection.driver.prepareHydratedValue(e[f.a.buildColumnAlias(C.connection.driver,t.parentAlias,r.databaseName)],r.referencedColumn)}),t.relation.entityMetadata.primaryColumns.forEach(function(r){n[r.databaseName]=C.connection.driver.prepareHydratedValue(e[f.a.buildColumnAlias(C.connection.driver,t.parentAlias,r.databaseName)],r)}),n}),[2,{relationIdAttribute:t,results:A}];case 1:return t.relation.isOneToMany||t.relation.isOneToOneNotOwner?(n=t.relation,i=n.isOwning?n.joinColumns:n.inverseRelation.joinColumns,a=n.inverseEntityMetadata.target,o=n.inverseEntityMetadata.tableName,s=t.alias||o,u={},(N=e.map(function(e,n){return i.map(function(r){var i=r.databaseName+n;return u[i]=e[f.a.buildColumnAlias(C.connection.driver,t.parentAlias,r.referencedColumn.databaseName)],s+\".\"+r.propertyPath+\" = :\"+i}).join(\" AND \")}).map(function(e){return\"(\"+e+\")\"}).join(\" OR \"))?(c=this.connection.createQueryBuilder(this.queryRunner),i.forEach(function(e){c.addSelect(s+\".\"+e.propertyPath,e.databaseName)}),n.inverseRelation.entityMetadata.primaryColumns.forEach(function(e){c.addSelect(s+\".\"+e.propertyPath,e.databaseName)}),c.from(a,s).where(\"(\"+N+\")\").setParameters(u),t.queryBuilderFactory&&t.queryBuilderFactory(c),[4,c.getRawMany()]):[2,{relationIdAttribute:t,results:[]}]):[3,3];case 2:return(A=w.sent()).forEach(function(e){i.forEach(function(t){e[t.databaseName]=C.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)}),n.inverseRelation.entityMetadata.primaryColumns.forEach(function(t){e[t.databaseName]=C.connection.driver.prepareHydratedValue(e[t.databaseName],t)})}),[2,{relationIdAttribute:t,results:A}];case 3:return l=t.relation,h=l.isOwning?l.joinColumns:l.inverseRelation.inverseJoinColumns,p=l.isOwning?l.inverseJoinColumns:l.inverseRelation.joinColumns,d=t.junctionAlias,m=t.joinInverseSideMetadata.tableName,y=t.alias||m,b=l.isOwning?l.junctionEntityMetadata.tableName:l.inverseRelation.junctionEntityMetadata.tableName,0===(v=e.map(function(e){return h.reduce(function(n,r){return n[r.propertyPath]=e[f.a.buildColumnAlias(C.connection.driver,t.parentAlias,r.referencedColumn.databaseName)],n},{})})).length?[2,{relationIdAttribute:t,results:[]}]:(g={},E=v.map(function(e,t){return Object.keys(e).map(function(n){var r=n+t;return g[r]=e[n],d+\".\"+n+\" = :\"+r}).join(\" AND \")}),T=p.map(function(e){return d+\".\"+e.propertyPath+\" = \"+y+\".\"+e.referencedColumn.propertyPath}).join(\" AND \"),N=E.map(function(e){return\"(\"+e+\" AND \"+T+\")\"}).join(\" OR \"),O=this.connection.createQueryBuilder(this.queryRunner),p.forEach(function(e){O.addSelect(d+\".\"+e.propertyPath,e.databaseName).addOrderBy(d+\".\"+e.propertyPath)}),h.forEach(function(e){O.addSelect(d+\".\"+e.propertyPath,e.databaseName).addOrderBy(d+\".\"+e.propertyPath)}),O.from(m,y).innerJoin(b,d,N).setParameters(g),t.queryBuilderFactory&&t.queryBuilderFactory(O),[4,O.getRawMany()]);case 4:return(A=w.sent()).forEach(function(e){Object(r.f)(h,p).forEach(function(t){e[t.databaseName]=C.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)})}),[2,{relationIdAttribute:t,results:A}]}})})}),[2,Promise.all(t)]})})},e}(),y=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationIdAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){!t.metadata||t.metadata.isJunction||t.metadata.relationIds.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationIdAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new p.a(this.expressionMap,{relationName:e+\".\"+t.relation.propertyName,mapToProperty:e+\".\"+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),b=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationCountAttributes=n}return e.prototype.load=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i=this;return Object(r.d)(this,function(){return t=function(e,t,n){return n.indexOf(e)===t},n=this.relationCountAttributes.map(function(n){return Object(r.b)(i,void 0,void 0,function(){var i,a,o,s,u,c,l,h,p,d,f,m,y,b,v,g,E,T;return Object(r.d)(this,function(r){switch(r.label){case 0:return n.relation.isOneToMany?(i=n.relation,a=i.inverseRelation,o=a.joinColumns[0].referencedColumn.propertyName,s=i.inverseEntityMetadata.target,y=i.inverseEntityMetadata.tableName,b=n.alias||y,u=a.propertyName,0===(f=(f=e.map(function(e){return e[n.parentAlias+\"_\"+o]}).filter(function(e){return!!e})).filter(t)).length?[2,{relationCountAttribute:n,results:[]}]:((E=this.connection.createQueryBuilder(this.queryRunner)).select(b+\".\"+u,\"parentId\").addSelect(\"COUNT(*)\",\"cnt\").from(s,b).where(b+\".\"+u+\" IN (:...ids)\").addGroupBy(b+\".\"+u).setParameter(\"ids\",f),n.queryBuilderFactory&&n.queryBuilderFactory(E),c={relationCountAttribute:n},[4,E.getRawMany()])):[3,2];case 1:return[2,(c.results=r.sent(),c)];case 2:return h=void 0,p=void 0,d=void 0,n.relation.isOwning?(l=n.relation.joinColumns[0].referencedColumn.databaseName,h=n.relation.inverseJoinColumns[0].referencedColumn.databaseName,p=n.relation.junctionEntityMetadata.columns[0],d=n.relation.junctionEntityMetadata.columns[1]):(l=n.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,h=n.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,p=n.relation.junctionEntityMetadata.columns[1],d=n.relation.junctionEntityMetadata.columns[0]),0===(f=(f=e.map(function(e){return e[n.parentAlias+\"_\"+l]}).filter(function(e){return!!e})).filter(t)).length?[2,{relationCountAttribute:n,results:[]}]:(m=n.junctionAlias,y=n.joinInverseSideMetadata.tableName,b=n.alias||y,v=n.relation.junctionEntityMetadata.tableName,g=m+\".\"+p.propertyName+\" IN (\"+f.map(function(e){return isNaN(e)?\"'\"+e+\"'\":e})+\") AND \"+m+\".\"+d.propertyName+\" = \"+b+\".\"+h,(E=this.connection.createQueryBuilder(this.queryRunner)).select(m+\".\"+p.propertyName,\"parentId\").addSelect(\"COUNT(\"+E.escape(b)+\".\"+E.escape(h)+\")\",\"cnt\").from(y,b).innerJoin(v,m,g).addGroupBy(m+\".\"+p.propertyName),n.queryBuilderFactory&&n.queryBuilderFactory(E),T={relationCountAttribute:n},[4,E.getRawMany()]);case 3:return[2,(T.results=r.sent(),T)]}})})}),[2,Promise.all(n)]})})},e}(),v=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationCountAttributes.push(n)}),this.expressionMap.joinAttributes.forEach(function(t){!t.metadata||t.metadata.isJunction||t.metadata.relationCounts.forEach(function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationCountAttributes.push(r)})})},e.prototype.metadataToAttribute=function(e,t){return new d.a(this.expressionMap,{relationName:e+\".\"+t.relation.propertyName,mapToProperty:e+\".\"+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),g=n(30),E=function(e){function t(){var n=e.call(this)||this;return n.name=\"LockNotSupportedOnGivenDriverError\",Object.setPrototypeOf(n,t.prototype),n.message=\"Locking not supported on given driver.\",n}return Object(r.c)(t,e),t}(Error),T=n(2),N=n(9),O=n(15),A=function(e){function t(){var n=e.call(this)||this;return n.name=\"OffsetWithoutLimitNotSupportedError\",Object.setPrototypeOf(n,t.prototype),n.message=\"RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).\",n}return Object(r.c)(t,e),t}(Error),C=n(27),w=n(21);n.d(t,\"SelectQueryBuilder\",function(){return R});var R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.c)(t,e),t.prototype.getQuery=function(){var e=this.createSelectExpression();return e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e=(e+=this.createLockExpression()).trim(),this.expressionMap.subQuery&&(e=\"(\"+e+\")\"),e},t.prototype.subQuery=function(){var e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.expressionMap.parentQueryBuilder=this,e},t.prototype.select=function(e,t){if(this.expressionMap.queryType=\"select\",Array.isArray(e))this.expressionMap.selects=e.map(function(e){return{selection:e}});else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);return this},t.prototype.addSelect=function(e,t){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map(function(e){return{selection:e}}));else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&this.expressionMap.selects.push({selection:e,aliasName:t});return this},t.prototype.distinct=function(e){return void 0===e&&(e=!0),this.expressionMap.selectDistinct=e,this},t.prototype.distinctOn=function(e){return this.expressionMap.selectDistinctOn=e,this},t.prototype.from=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.addFrom=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(n),this},t.prototype.innerJoin=function(e,t,n,r){return void 0===n&&(n=\"\"),this.join(\"INNER\",e,t,n,r),this},t.prototype.leftJoin=function(e,t,n,r){return void 0===n&&(n=\"\"),this.join(\"LEFT\",e,t,n,r),this},t.prototype.innerJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=\"\"),this.addSelect(t),this.innerJoin(e,t,n,r),this},t.prototype.leftJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=\"\"),this.addSelect(t),this.leftJoin(e,t,n,r),this},t.prototype.innerJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=\"\"),this.addSelect(n),this.join(\"INNER\",t,n,r,i,e,!0),this},t.prototype.innerJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=\"\"),this.addSelect(n),this.join(\"INNER\",t,n,r,i,e,!1),this},t.prototype.leftJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=\"\"),this.addSelect(n),this.join(\"LEFT\",t,n,r,i,e,!0),this},t.prototype.leftJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=\"\"),this.addSelect(n),this.join(\"LEFT\",t,n,r,i,e,!1),this},t.prototype.loadRelationIdAndMap=function(e,t,n,r){var i=new p.a(this.expressionMap);return i.mapToProperty=e,i.relationName=t,\"string\"==typeof n&&(i.alias=n),n instanceof Object&&n.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=r,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:\"other\",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadRelationCountAndMap=function(e,t,n,r){var i=new d.a(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=n,i.queryBuilderFactory=r,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({type:\"other\",name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:\"other\",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadAllRelationIds=function(e){var t=this;return this.expressionMap.mainAlias.metadata.relations.forEach(function(n){void 0!==e&&void 0!==e.relations&&-1===e.relations.indexOf(n.propertyPath)||t.loadRelationIdAndMap(t.expressionMap.mainAlias.name+\".\"+n.propertyPath,t.expressionMap.mainAlias.name+\".\"+n.propertyPath,e)}),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:\"simple\",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:\"and\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:\"or\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.having=function(e,t){return this.expressionMap.havings.push({type:\"simple\",condition:e}),t&&this.setParameters(t),this},t.prototype.andHaving=function(e,t){return this.expressionMap.havings.push({type:\"and\",condition:e}),t&&this.setParameters(t),this},t.prototype.orHaving=function(e,t){return this.expressionMap.havings.push({type:\"or\",condition:e}),t&&this.setParameters(t),this},t.prototype.groupBy=function(e){return this.expressionMap.groupBys=e?[e]:[],this},t.prototype.addGroupBy=function(e){return this.expressionMap.groupBys.push(e),this},t.prototype.orderBy=function(e,t,n){var r,i;if(void 0===t&&(t=\"ASC\"),void 0!==t&&\"ASC\"!==t&&\"DESC\"!==t)throw new Error('SelectQueryBuilder.addOrderBy \"order\" can accept only \"ASC\" and \"DESC\" values.');if(void 0!==n&&\"NULLS FIRST\"!==n&&\"NULLS LAST\"!==n)throw new Error('SelectQueryBuilder.addOrderBy \"nulls\" can accept only \"NULLS FIRST\" and \"NULLS LAST\" values.');return this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){if(void 0===t&&(t=\"ASC\"),void 0!==t&&\"ASC\"!==t&&\"DESC\"!==t)throw new Error('SelectQueryBuilder.addOrderBy \"order\" can accept only \"ASC\" and \"DESC\" values.');if(void 0!==n&&\"NULLS FIRST\"!==n&&\"NULLS LAST\"!==n)throw new Error('SelectQueryBuilder.addOrderBy \"nulls\" can accept only \"NULLS FIRST\" and \"NULLS LAST\" values.');return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){if(this.expressionMap.limit=this.normalizeNumber(e),void 0!==this.expressionMap.limit&&isNaN(this.expressionMap.limit))throw new Error('Provided \"limit\" value is not a number. Please provide a numeric value.');return this},t.prototype.offset=function(e){if(this.expressionMap.offset=this.normalizeNumber(e),void 0!==this.expressionMap.offset&&isNaN(this.expressionMap.offset))throw new Error('Provided \"offset\" value is not a number. Please provide a numeric value.');return this},t.prototype.take=function(e){if(this.expressionMap.take=this.normalizeNumber(e),void 0!==this.expressionMap.take&&isNaN(this.expressionMap.take))throw new Error('Provided \"take\" value is not a number. Please provide a numeric value.');return this},t.prototype.skip=function(e){if(this.expressionMap.skip=this.normalizeNumber(e),void 0!==this.expressionMap.skip&&isNaN(this.expressionMap.skip))throw new Error('Provided \"skip\" value is not a number. Please provide a numeric value.');return this},t.prototype.setLock=function(e,t){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this},t.prototype.withDeleted=function(){return this.expressionMap.withDeleted=!0,this},t.prototype.getRawOne=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:return[4,this.getRawMany()];case 1:return[2,e.sent()[0]]}})})},t.prototype.getRawMany=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:if(\"optimistic\"===this.expressionMap.lockMode)throw new l;this.expressionMap.queryEntity=!1,e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return[4,this.loadRawResults(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return r.sent(),[3,11];case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getRawAndEntities=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return r.sent(),[3,11];case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getOne=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:return[4,this.getRawAndEntities()];case 1:if(e=r.sent(),(t=e.entities[0])&&\"optimistic\"===this.expressionMap.lockMode&&this.expressionMap.lockVersion)if(n=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if((i=n.updateDateColumn.getEntityValue(t)).getTime()!==this.expressionMap.lockVersion.getTime())throw new c(n.name,this.expressionMap.lockVersion,i)}else if((i=n.versionColumn.getEntityValue(t))!==this.expressionMap.lockVersion)throw new c(n.name,this.expressionMap.lockVersion,i);return[2,t]}})})},t.prototype.getMany=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:if(\"optimistic\"===this.expressionMap.lockMode)throw new l;return[4,this.getRawAndEntities()];case 1:return[2,e.sent().entities]}})})},t.prototype.getCount=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:if(\"optimistic\"===this.expressionMap.lockMode)throw new l;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return r.sent(),[3,11];case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}})})},t.prototype.getManyAndCount=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:if(\"optimistic\"===this.expressionMap.lockMode)throw new l;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,8,13,16]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return n=r.sent(),this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 5:return i=r.sent(),a=[n.entities,i],t?[4,e.commitTransaction()]:[3,7];case 6:r.sent(),r.label=7;case 7:return[2,a];case 8:if(o=r.sent(),!t)return[3,12];r.label=9;case 9:return r.trys.push([9,11,,12]),[4,e.rollbackTransaction()];case 10:return r.sent(),[3,12];case 11:return r.sent(),[3,12];case 12:throw o;case 13:return e===this.queryRunner?[3,15]:[4,e.release()];case 14:r.sent(),r.label=15;case 15:return[7];case 16:return[2]}})})},t.prototype.stream=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i,a,o,s,u,c=this;return Object(r.d)(this,function(l){switch(l.label){case 0:this.expressionMap.queryEntity=!1,e=Object(r.e)(this.getQueryAndParameters(),2),t=e[0],n=e[1],i=this.obtainQueryRunner(),a=!1,l.label=1;case 1:return l.trys.push([1,6,11,14]),!0!==this.expressionMap.useTransaction||!1!==i.isTransactionActive?[3,3]:[4,i.startTransaction()];case 2:l.sent(),a=!0,l.label=3;case 3:return o=function(){return i===c.queryRunner?void 0:i.release()},s=i.stream(t,n,o,o),a?[4,i.commitTransaction()]:[3,5];case 4:l.sent(),l.label=5;case 5:return[2,s];case 6:if(u=l.sent(),!a)return[3,10];l.label=7;case 7:return l.trys.push([7,9,,10]),[4,i.rollbackTransaction()];case 8:return l.sent(),[3,10];case 9:return l.sent(),[3,10];case 10:throw u;case 11:return i===this.queryRunner?[3,13]:[4,i.release()];case 12:l.sent(),l.label=13;case 13:return[7];case 14:return[2]}})})},t.prototype.cache=function(e,t){return\"boolean\"==typeof e?this.expressionMap.cache=e:\"number\"==typeof e?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):(\"string\"==typeof e||\"number\"==typeof e)&&(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),t&&(this.expressionMap.cacheDuration=t),this},t.prototype.setOption=function(e){return this.expressionMap.options.push(e),this},t.prototype.join=function(e,t,n,r,i,a,o){this.setParameters(i||{});var s=new h.a(this.connection,this.expressionMap);if(s.direction=e,s.mapToProperty=a,s.isMappingMany=o,s.entityOrProperty=t,s.condition=r,this.expressionMap.joinAttributes.push(s),s.metadata)s.alias=this.expressionMap.createAlias({type:\"join\",name:n,metadata:s.metadata}),s.relation&&s.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:\"join\",name:s.junctionAlias,metadata:s.relation.junctionEntityMetadata});else{var u=\"\";if(t instanceof Function){var c=t(this.subQuery());this.setParameters(c.getParameters()),u=c.getQuery()}else u=t;var l=t instanceof Function||\"(\"===t.substr(0,1)&&\")\"===t.substr(-1);s.alias=this.expressionMap.createAlias({type:\"join\",name:n,tablePath:0==l?t:void 0,subQuery:1==l?u:void 0})}},t.prototype.createSelectExpression=function(){var e=this;if(!this.expressionMap.mainAlias)throw new Error(\"Cannot build query because main alias is not set (call qb#from method)\");var t=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){var i=this.expressionMap.mainAlias.metadata;t.push.apply(t,Object(r.f)(this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,i))),n.push.apply(n,Object(r.f)(this.findEntityColumnSelects(this.expressionMap.mainAlias.name,i)))}this.expressionMap.joinAttributes.forEach(function(i){if(i.metadata)t.push.apply(t,Object(r.f)(e.buildEscapedEntityColumnSelects(i.alias.name,i.metadata))),n.push.apply(n,Object(r.f)(e.findEntityColumnSelects(i.alias.name,i.metadata)));else if(e.expressionMap.selects.some(function(e){return e.selection===i.alias.name})){t.push({selection:e.escape(i.alias.name)+\".*\"});var a=e.expressionMap.selects.find(function(e){return e.selection===i.alias.name});n.push(a)}}),this.expressionMap.selects.filter(function(e){return-1===n.indexOf(e)}).forEach(function(n){return t.push({selection:e.replacePropertyNames(n.selection),aliasName:n.aliasName})}),0===t.length&&t.push({selection:\"*\"});var a=\"\";if(this.connection.driver instanceof o.a)switch(this.expressionMap.lockMode){case\"pessimistic_read\":a=\" WITH (HOLDLOCK, ROWLOCK)\";break;case\"pessimistic_write\":a=\" WITH (UPDLOCK, ROWLOCK)\";break;case\"dirty_read\":a=\" WITH (NOLOCK)\"}var s=this.expressionMap.aliases.filter(function(e){return\"from\"===e.type&&(e.tablePath||e.subQuery)}).map(function(t){return t.subQuery?t.subQuery+\" \"+e.escape(t.name):e.getTableName(t.tablePath)+\" \"+e.escape(t.name)});return this.createSelectDistinctExpression()+t.map(function(t){return t.selection+(t.aliasName?\" AS \"+e.escape(t.aliasName):\"\")}).join(\", \")+\" FROM \"+s.join(\", \")+a},t.prototype.createSelectDistinctExpression=function(){var e=this,t=this.expressionMap,n=t.selectDistinct,r=t.selectDistinctOn,i=\"SELECT \";this.connection.driver instanceof T.i&&0<r.length?i=\"SELECT DISTINCT ON (\"+r.map(function(t){return e.replacePropertyNames(t)}).join(\", \")+\") \":n&&(i=\"SELECT DISTINCT \");return i},t.prototype.createJoinExpression=function(){var e=this;return this.expressionMap.joinAttributes.map(function(t){var n=t.relation,r=t.tablePath,i=t.alias.name,a=t.condition?\" AND (\"+t.condition+\")\":\"\",o=t.parentAlias;if(!o||!n){var s=t.alias.subQuery?t.alias.subQuery:e.getTableName(r);return\" \"+t.direction+\" JOIN \"+s+\" \"+e.escape(i)+(t.condition?\" ON \"+e.replacePropertyNames(t.condition):\"\")}if(n.isManyToOne||n.isOneToOneOwner){var u=n.joinColumns.map(function(e){return i+\".\"+e.referencedColumn.propertyPath+\"=\"+o+\".\"+n.propertyPath+\".\"+e.referencedColumn.propertyPath}).join(\" AND \");return\" \"+t.direction+\" JOIN \"+e.getTableName(r)+\" \"+e.escape(i)+\" ON \"+e.replacePropertyNames(u+a)}if(n.isOneToMany||n.isOneToOneNotOwner){u=n.inverseRelation.joinColumns.map(function(e){return i+\".\"+n.inverseRelation.propertyPath+\".\"+e.referencedColumn.propertyPath+\"=\"+o+\".\"+e.referencedColumn.propertyPath}).join(\" AND \");return\" \"+t.direction+\" JOIN \"+e.getTableName(r)+\" \"+e.escape(i)+\" ON \"+e.replacePropertyNames(u+a)}var c=n.junctionEntityMetadata.tablePath,l=t.junctionAlias,h=\"\",p=\"\";return n.isOwning?(h=n.joinColumns.map(function(e){return l+\".\"+e.propertyPath+\"=\"+o+\".\"+e.referencedColumn.propertyPath}).join(\" AND \"),p=n.inverseJoinColumns.map(function(e){return i+\".\"+e.referencedColumn.propertyPath+\"=\"+l+\".\"+e.propertyPath}).join(\" AND \")):(h=n.inverseRelation.inverseJoinColumns.map(function(e){return l+\".\"+e.propertyPath+\"=\"+o+\".\"+e.referencedColumn.propertyPath}).join(\" AND \"),p=n.inverseRelation.joinColumns.map(function(e){return i+\".\"+e.referencedColumn.propertyPath+\"=\"+l+\".\"+e.propertyPath}).join(\" AND \")),\" \"+t.direction+\" JOIN \"+e.getTableName(c)+\" \"+e.escape(l)+\" ON \"+e.replacePropertyNames(h)+\" \"+t.direction+\" JOIN \"+e.getTableName(r)+\" \"+e.escape(i)+\" ON \"+e.replacePropertyNames(p+a)}).join(\" \")},t.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?\" GROUP BY \"+this.replacePropertyNames(this.expressionMap.groupBys.join(\", \")):\"\"},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.allOrderBys;return 0<Object.keys(t).length?\" ORDER BY \"+Object.keys(t).map(function(n){return\"string\"==typeof t[n]?e.replacePropertyNames(n)+\" \"+t[n]:e.replacePropertyNames(n)+\" \"+t[n].order+\" \"+t[n].nulls}).join(\", \"):\"\"},t.prototype.createLimitOffsetExpression=function(){var e=this.expressionMap.offset,t=this.expressionMap.limit;if(e||t||0!==this.expressionMap.joinAttributes.length||(e=this.expressionMap.skip,t=this.expressionMap.take),this.connection.driver instanceof o.a){var n=\"\";if((t||e)&&0>=Object.keys(this.expressionMap.allOrderBys).length&&(n=\" ORDER BY (SELECT NULL)\"),t&&e)return n+\" OFFSET \"+e+\" ROWS FETCH NEXT \"+t+\" ROWS ONLY\";if(t)return n+\" OFFSET 0 ROWS FETCH NEXT \"+t+\" ROWS ONLY\";if(e)return n+\" OFFSET \"+e+\" ROWS\"}else if(this.connection.driver instanceof T.h||this.connection.driver instanceof T.a||this.connection.driver instanceof i.a){if(t&&e)return\" LIMIT \"+t+\" OFFSET \"+e;if(t)return\" LIMIT \"+t;if(e)throw new A}else if(this.connection.driver instanceof O.a){if(t&&e)return\" LIMIT \"+t+\" OFFSET \"+e;if(t)return\" LIMIT \"+t;if(e)return\" LIMIT -1 OFFSET \"+e}else if(this.connection.driver instanceof N.a){if(t&&e)return\" OFFSET \"+e+\" ROWS FETCH NEXT \"+t+\" ROWS ONLY\";if(t)return\" FETCH NEXT \"+t+\" ROWS ONLY\";if(e)return\" OFFSET \"+e+\" ROWS\"}else{if(t&&e)return\" LIMIT \"+t+\" OFFSET \"+e;if(t)return\" LIMIT \"+t;if(e)return\" OFFSET \"+e}return\"\"},t.prototype.createLockExpression=function(){var e=this.connection.driver;switch(this.expressionMap.lockMode){case\"pessimistic_read\":if(e instanceof T.h||e instanceof T.a)return\" LOCK IN SHARE MODE\";if(e instanceof T.i)return\" FOR SHARE\";if(e instanceof N.a)return\" FOR UPDATE\";if(e instanceof o.a)return\"\";throw new E;case\"pessimistic_write\":if(e instanceof T.h||e instanceof T.a||e instanceof T.i||e instanceof N.a)return\" FOR UPDATE\";if(e instanceof o.a)return\"\";throw new E;case\"pessimistic_partial_write\":if(e instanceof T.i)return\" FOR UPDATE SKIP LOCKED\";throw new E;case\"pessimistic_write_or_fail\":if(e instanceof T.i)return\" FOR UPDATE NOWAIT\";throw new E;case\"for_no_key_update\":if(e instanceof T.i)return\" FOR NO KEY UPDATE\";throw new E;default:return\"\"}},t.prototype.createHavingExpression=function(){var e=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return\"\";var t=this.expressionMap.havings.map(function(t,n){switch(t.type){case\"and\":return(0<n?\"AND \":\"\")+e.replacePropertyNames(t.condition);case\"or\":return(0<n?\"OR \":\"\")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}}).join(\" \");return t.length?\" HAVING \"+t:\"\"},t.prototype.buildEscapedEntityColumnSelects=function(e,t){var n=this,i=this.expressionMap.selects.some(function(t){return t.selection===e}),a=[];if(i&&a.push.apply(a,Object(r.f)(t.columns.filter(function(e){return!0===e.isSelect}))),a.push.apply(a,Object(r.f)(t.columns.filter(function(t){return n.expressionMap.selects.some(function(n){return n.selection===e+\".\"+t.propertyPath})}))),0===a.length)return[];var s=this.expressionMap.queryEntity?t.primaryColumns.filter(function(e){return-1===a.indexOf(e)}):[];return Object(r.f)(a,s).map(function(t){var r=n.expressionMap.selects.find(function(n){return n.selection===e+\".\"+t.propertyPath}),a=n.escape(e)+\".\"+n.escape(t.databaseName);if(-1!==n.connection.driver.spatialTypes.indexOf(t.type)){if(n.connection.driver instanceof T.h||n.connection.driver instanceof T.a)a=(n.connection.driver.options.legacySpatialSupport?\"AsText\":\"ST_AsText\")+\"(\"+a+\")\";n.connection.driver instanceof T.i&&(a=\"ST_AsGeoJSON(\"+a+\")::json\"),n.connection.driver instanceof o.a&&(a+=\".ToString()\")}return{selection:a,aliasName:r&&r.aliasName?r.aliasName:f.a.buildColumnAlias(n.connection.driver,e,t.databaseName),virtual:r?!0===r.virtual:!i}})},t.prototype.findEntityColumnSelects=function(e,t){var n=this.expressionMap.selects.find(function(t){return t.selection===e});return n?[n]:this.expressionMap.selects.filter(function(n){return t.columns.some(function(t){return n.selection===e+\".\"+t.propertyPath})})},t.prototype.executeCountQuery=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return t=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata,i=this.escape(t),\"\",a=n.hasMultiplePrimaryKeys?this.connection.driver instanceof O.a?\"COUNT(DISTINCT(\"+n.primaryColumns.map(function(e){var t=s.escape(e.databaseName);return i+\".\"+t}).join(\" || \")+')) as \"cnt\"':this.connection.driver instanceof T.c?\"COUNT(DISTINCT(CONCAT(\"+n.primaryColumns.map(function(e){var t=s.escape(e.databaseName);return i+\".\"+t+\"::text\"}).join(\", \")+'))) as \"cnt\"':this.connection.driver instanceof N.a?\"COUNT(DISTINCT(\"+n.primaryColumns.map(function(e){var t=s.escape(e.databaseName);return i+\".\"+t}).join(\" || \")+')) as \"cnt\"':\"COUNT(DISTINCT(CONCAT(\"+n.primaryColumns.map(function(e){var t=s.escape(e.databaseName);return i+\".\"+t}).join(\", \")+'))) as \"cnt\"':\"COUNT(DISTINCT(\"+n.primaryColumns.map(function(e){var t=s.escape(e.databaseName);return i+\".\"+t}).join(\", \")+')) as \"cnt\"',[4,this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(a).setOption(\"disable-global-order\").loadRawResults(e)];case 1:return(o=r.sent())&&o[0]&&o[0].cnt?[2,parseInt(o[0].cnt)]:[2,0]}})})},t.prototype.executeEntitiesAndRawResults=function(e){return Object(r.b)(this,void 0,void 0,function(){var n,i,o,c,l,h,p,d,g,E,T,N,O,A,w,R,S,M,j,P=this;return Object(r.d)(this,function(x){switch(x.label){case 0:if(!this.expressionMap.mainAlias)throw new Error('Alias is not set. Use \"from\" method to set an alias.');if((\"pessimistic_read\"===this.expressionMap.lockMode||\"pessimistic_write\"===this.expressionMap.lockMode||\"pessimistic_partial_write\"===this.expressionMap.lockMode||\"pessimistic_write_or_fail\"===this.expressionMap.lockMode||\"for_no_key_update\"===this.expressionMap.lockMode)&&!e.isTransactionActive)throw new s;if(\"optimistic\"===this.expressionMap.lockMode&&(!(n=this.expressionMap.mainAlias.metadata).versionColumn&&!n.updateDateColumn))throw new u(n.name);return i=new m(this.connection,e,this.expressionMap.relationIdAttributes),o=new b(this.connection,e,this.expressionMap.relationCountAttributes),new y(this.expressionMap).transform(),new v(this.expressionMap).transform(),c=[],l=[],(this.expressionMap.skip||this.expressionMap.take)&&0<this.expressionMap.joinAttributes.length?(h=Object(r.e)(this.createOrderByCombinedWithSelectExpression(\"distinctAlias\"),2),p=h[0],d=h[1],g=this.expressionMap.mainAlias.metadata,E=this.expressionMap.mainAlias.name,T=g.primaryColumns.map(function(e){var t=P.escape(\"distinctAlias\"),n=P.escape(f.a.buildColumnAlias(P.connection.driver,E,e.databaseName));return d[n]||(d[n]=\"ASC\"),t+\".\"+n+' as \"'+f.a.buildColumnAlias(P.connection.driver,\"ids_\"+E,e.databaseName)+'\"'}),[4,new t(this.connection,e).select(\"DISTINCT \"+T.join(\", \")).addSelect(p).from(\"(\"+this.clone().orderBy().getQuery()+\")\",\"distinctAlias\").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(d).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany()]):[3,4];case 1:return 0<(c=x.sent()).length?(N=\"\",O={},g.hasMultiplePrimaryKeys?N=c.map(function(e,t){return g.primaryColumns.map(function(n){var r=\"orm_distinct_ids_\"+t+\"_\"+n.databaseName;return O[r]=e[\"ids_\"+E+\"_\"+n.databaseName],E+\".\"+n.propertyPath+\"=:\"+r}).join(\" AND \")}).join(\" OR \"):(A=f.a.buildColumnAlias(this.connection.driver,\"ids_\"+E,g.primaryColumns[0].databaseName),w=c.map(function(e){return e[A]}),w.every(function(e){return\"number\"==typeof e})?N=E+\".\"+g.primaryColumns[0].propertyPath+\" IN (\"+w.join(\", \")+\")\":(O.orm_distinct_ids=w,N=E+\".\"+g.primaryColumns[0].propertyPath+\" IN (:...orm_distinct_ids)\")),[4,this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:N}).setParameters(O).loadRawResults(e)]):[3,3];case 2:c=x.sent(),x.label=3;case 3:return[3,6];case 4:return[4,this.loadRawResults(e)];case 5:c=x.sent(),x.label=6;case 6:return 0<c.length?[4,i.load(c)]:[3,10];case 7:return R=x.sent(),[4,o.load(c)];case 8:return S=x.sent(),M=new a.a(this.expressionMap,this.connection.driver,R,S,this.queryRunner),l=M.transform(c,this.expressionMap.mainAlias),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(j=new C.a,e.broadcaster.broadcastLoadEventsForAll(j,this.expressionMap.mainAlias.metadata,l),0<j.promises.length?[4,Promise.all(j.promises)]:[3,10]):[3,10];case 9:x.sent(),x.label=10;case 10:return[2,{raw:c,entities:l}]}})})},t.prototype.createOrderByCombinedWithSelectExpression=function(e){var t=this,n=this.expressionMap.allOrderBys,i=Object.keys(n).map(function(n){if(-1!==n.indexOf(\".\")){var i=Object(r.e)(n.split(\".\"),2),a=i[0],o=i[1],s=t.expressionMap.findAliasByName(a).metadata.findColumnWithPropertyName(o);return t.escape(e)+\".\"+t.escape(f.a.buildColumnAlias(t.connection.driver,a,s.databaseName))}return t.expressionMap.selects.find(function(e){return e.selection===n||e.aliasName===n})?t.escape(e)+\".\"+n:\"\"}).join(\", \"),a={};return Object.keys(n).forEach(function(i){if(-1!==i.indexOf(\".\")){var o=Object(r.e)(i.split(\".\"),2),s=o[0],u=o[1],c=t.expressionMap.findAliasByName(s).metadata.findColumnWithPropertyName(u);a[t.escape(e)+\".\"+t.escape(f.a.buildColumnAlias(t.connection.driver,s,c.databaseName))]=n[i]}else t.expressionMap.selects.find(function(e){return e.selection===i||e.aliasName===i})?a[t.escape(e)+\".\"+i]=n[i]:a[i]=n[i]}),[i,a]},t.prototype.loadRawResults=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s,u;return Object(r.d)(this,function(c){switch(c.label){case 0:return t=Object(r.e)(this.getQueryAndParameters(),2),n=t[0],i=t[1],a=n+\" -- PARAMETERS: \"+JSON.stringify(i),o=\"object\"==typeof this.connection.options.cache?this.connection.options.cache:{},s=void 0,this.connection.queryResultCache&&(this.expressionMap.cache||o.alwaysEnabled)?[4,this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:a,duration:this.expressionMap.cacheDuration||o.duration||1e3},e)]:[3,2];case 1:if((s=c.sent())&&!this.connection.queryResultCache.isExpired(s))return[2,JSON.parse(s.result)];c.label=2;case 2:return[4,e.query(n,i)];case 3:return u=c.sent(),this.connection.queryResultCache&&(this.expressionMap.cache||o.alwaysEnabled)?[4,this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:a,time:(new Date).getTime(),duration:this.expressionMap.cacheDuration||o.duration||1e3,result:JSON.stringify(u)},s,e)]:[3,5];case 4:c.sent(),c.label=5;case 5:return[2,u]}})})},t.prototype.mergeExpressionMap=function(e){return w.a.assign(this.expressionMap,e),this},t.prototype.normalizeNumber=function(e){return\"number\"==typeof e||null==e?e:+e},t.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner(\"slave\")},t}(g.a)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return o});var r=n(0),i=n(35),a=n(21),o=function(){function e(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,a.a.assign(this,t||{})}return Object.defineProperty(e.prototype,\"joinInverseSideMetadata\",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"parentAlias\",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error(\"Given value must be a string representation of alias property\");return this.relationName.substr(0,this.relationName.indexOf(\".\"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"relationPropertyPath\",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error(\"Given value must be a string representation of alias property\");return this.relationName.substr(this.relationName.indexOf(\".\")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"relation\",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error(\"Given value must be a string representation of alias property\");var e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error(\"Relation with property path \"+this.relationPropertyPath+\" in entity was not found.\");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"junctionAlias\",{get:function(){var e=Object(r.e)(this.relationName.split(\".\"),2);return e[0]+\"_\"+e[1]+\"_rid\"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"junctionMetadata\",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mapToPropertyParentAlias\",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf(\".\"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mapToPropertyPropertyPath\",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(\".\")+1)},enumerable:!0,configurable:!0}),e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return o});var r=n(0),i=n(35),a=n(21),o=function(){function e(e,t){this.expressionMap=e,a.a.assign(this,t||{})}return Object.defineProperty(e.prototype,\"joinInverseSideMetadata\",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"parentAlias\",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error(\"Given value must be a string representation of alias property\");return this.relationName.split(\".\")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"relationProperty\",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error(\"Given value is a string representation of alias property\");return this.relationName.split(\".\")[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"junctionAlias\",{get:function(){var e=Object(r.e)(this.relationName.split(\".\"),2);return e[0]+\"_\"+e[1]+\"_rc\"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"relation\",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error(\"Given value is a string representation of alias property\");var e=Object(r.e)(this.relationName.split(\".\"),2),t=e[0],n=e[1],a=this.expressionMap.findAliasByName(t).metadata.findRelationWithPropertyPath(n);if(!a)throw new Error(\"Relation with property path \"+n+\" in entity was not found.\");return a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"metadata\",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error(\"Given value is a string representation of alias property\");var e=this.relationName.split(\".\")[0];return this.expressionMap.findAliasByName(e).metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mapToPropertyPropertyName\",{get:function(){return this.mapToProperty.split(\".\")[1]},enumerable:!0,configurable:!0}),e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return o});var r=n(0),i=n(4),a=n(9),o=function(){function e(e,t){this.queryRunner=e,this.expressionMap=t}return e.prototype.update=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(o){switch(o.label){case 0:return n=this.expressionMap.mainAlias.metadata,[4,Promise.all(t.map(function(t,o){return Object(r.b)(i,void 0,void 0,function(){var i,s,u,c,l=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return this.queryRunner.connection.driver.isReturningSqlSupported()?(this.queryRunner.connection.driver instanceof a.a&&Array.isArray(e.raw)&&0<this.expressionMap.extraReturningColumns.length&&(e.raw=e.raw.reduce(function(e,t,n){return e[l.expressionMap.extraReturningColumns[n].databaseName]=t[0],e},{})),i=Array.isArray(e.raw)?e.raw[o]:e.raw,(s=this.queryRunner.connection.driver.createGeneratedMap(n,i))&&(this.queryRunner.manager.merge(n.target,t,s),e.generatedMaps.push(s)),[3,3]):[3,1];case 1:if(!(0<this.getUpdationReturningColumns().length))return[3,3];if(!(u=this.expressionMap.mainAlias.metadata.getEntityIdMap(t)))throw new Error(\"Cannot update entity because entity id is not set in the entity.\");return[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map(function(e){return n.targetName+\".\"+e.propertyPath})).addSelect(this.getUpdationReturningColumns().map(function(e){return n.targetName+\".\"+e.propertyPath})).from(n.target,n.targetName).where(u).setOption(\"create-pojo\").getOne()];case 2:(c=r.sent())&&(this.queryRunner.manager.merge(n.target,t,c),e.generatedMaps.push(c)),r.label=3;case 3:return[2]}})})}))];case 1:return o.sent(),[2]}})})},e.prototype.insert=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,o,s,u,c,l=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=this.expressionMap.mainAlias.metadata,o=this.getInsertionReturningColumns(),s=t.map(function(r,o){l.queryRunner.connection.driver instanceof a.a&&Array.isArray(e.raw)&&0<l.expressionMap.extraReturningColumns.length&&(e.raw=e.raw.reduce(function(e,t,n){return e[l.expressionMap.extraReturningColumns[n].databaseName]=t[0],e},{}));var s=Array.isArray(e.raw)?e.raw[o]:e.raw,u=l.queryRunner.connection.driver.createGeneratedMap(n,s,o,t.length)||{};return!1===l.queryRunner.connection.driver.isUUIDGenerationSupported()&&n.generatedColumns.forEach(function(e){if(\"uuid\"===e.generationStrategy){var t=e.getEntityValue(r);t||(t=l.expressionMap.nativeParameters[\"uuid_\"+e.databaseName+o]),i.a.mergeDeep(u,e.createValueMap(t))}}),l.queryRunner.manager.merge(n.target,r,u),u}),!1===this.queryRunner.connection.driver.isReturningSqlSupported()&&0<o.length?(u=t.map(function(e){var t=n.getEntityIdMap(e);if(!t)throw new Error(\"Cannot update entity because entity id is not set in the entity.\");return t}),[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map(function(e){return n.targetName+\".\"+e.propertyPath})).addSelect(o.map(function(e){return n.targetName+\".\"+e.propertyPath})).from(n.target,n.targetName).where(u).setOption(\"create-pojo\").getMany()]):[3,2];case 1:c=r.sent(),t.forEach(function(e,t){l.queryRunner.manager.merge(n.target,s[t],c[t])}),r.label=2;case 2:return t.forEach(function(t,r){var i=n.getEntityIdMap(t);e.identifiers.push(i),e.generatedMaps.push(s[r]),l.queryRunner.manager.merge(l.expressionMap.mainAlias.metadata.target,t,s[r],s[r])}),[2]}})})},e.prototype.getInsertionReturningColumns=function(){var e=this.queryRunner.connection.driver.isReturningSqlSupported();return this.expressionMap.mainAlias.metadata.columns.filter(function(t){return void 0!==t.default||e&&t.isGenerated||t.isCreateDate||t.isUpdateDate||t.isDeleteDate||t.isVersion})},e.prototype.getUpdationReturningColumns=function(){return this.expressionMap.mainAlias.metadata.columns.filter(function(e){return e.isUpdateDate||e.isVersion})},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){function e(){}return e.createTableColumnOptions=function(e,t){return{name:e.databaseName,length:e.length,width:e.width,charset:e.charset,collation:e.collation,precision:e.precision,scale:e.scale,zerofill:e.zerofill,unsigned:e.unsigned,asExpression:e.asExpression,generatedType:e.generatedType,default:t.normalizeDefault(e),onUpdate:e.onUpdate,comment:e.comment,isGenerated:e.isGenerated,generationStrategy:e.generationStrategy,isNullable:e.isNullable,type:t.normalizeType(e),isPrimary:e.isPrimary,isUnique:t.normalizeIsUnique(e),isArray:e.isArray||!1,enum:e.enum?e.enum.map(function(e){return e+\"\"}):e.enum,enumName:e.enumName,spatialFeatureType:e.spatialFeatureType,srid:e.srid}},e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){this.identifiers=[],this.generatedMaps=[]}},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name=\"UpdateValuesMissingError\",Object.setPrototypeOf(n,t.prototype),n.message='Cannot perform update query because update values are not defined. Call \"qb.set(...)\" method to specify updated values.',n}return Object(r.c)(t,e),t}(Error)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(e){this.whereFactory=e}},function(e,t,n){\"use strict\";function r(e){return new i.a(\"in\",e,!0,!0)}n.d(t,\"a\",function(){return r});var i=n(11)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return r});var r=function(){}},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(e){function t(n){var r=e.call(this)||this;return r.name=\"ConnectionIsNotSetError\",Object.setPrototypeOf(r,t.prototype),r.message=\"Connection with \"+n+\" database is not established. Check connection configuration.\",r}return Object(r.c)(t,e),t}(Error)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return o});var r=n(0),i=n(35),a=n(21),o=function(){function e(e,t,n){this.connection=e,this.queryExpressionMap=t,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,a.a.assign(this,n||{})}return Object.defineProperty(e.prototype,\"isMany\",{get:function(){return void 0===this.isMappingMany?!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany):this.isMappingMany},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"isSelected\",{get:function(){var e=this;if(!this.isSelectedEvaluated){this.isSelectedCache=function(){var t,n,i=function(t){return t.selection===e.alias.name?{value:!0}:e.metadata&&e.metadata.columns.find(function(n){return t.selection===e.alias.name+\".\"+n.propertyPath})?{value:!0}:void 0};try{for(var a=Object(r.g)(e.queryExpressionMap.selects),o=a.next();!o.done;o=a.next()){var s=i(o.value);if(\"object\"==typeof s)return s.value}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1}(),this.isSelectedEvaluated=!0}return this.isSelectedCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"tablePath\",{get:function(){return this.metadata?this.metadata.tablePath:this.entityOrProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"parentAlias\",{get:function(){return i.a.isAliasProperty(this.entityOrProperty)?this.entityOrProperty.substr(0,this.entityOrProperty.indexOf(\".\")):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"relationPropertyPath\",{get:function(){return i.a.isAliasProperty(this.entityOrProperty)?this.entityOrProperty.substr(this.entityOrProperty.indexOf(\".\")+1):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"relation\",{get:function(){var e=this;if(!this.relationEvaluated){this.relationCache=function(){if(i.a.isAliasProperty(e.entityOrProperty)){var t=e.queryExpressionMap.findAliasByName(e.parentAlias),n=t.metadata.findRelationWithPropertyPath(e.relationPropertyPath);if(n)return n;if(t.metadata.parentEntityMetadata&&(n=t.metadata.parentEntityMetadata.findRelationWithPropertyPath(e.relationPropertyPath)))return n;throw new Error(\"Relation with property path \"+e.relationPropertyPath+\" in entity was not found.\")}}.bind(this)(),this.relationEvaluated=!0}return this.relationCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"metadata\",{get:function(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"junctionAlias\",{get:function(){if(!this.relation)throw new Error(\"Cannot get junction table for join without relation.\");return this.relation.isOwning?this.parentAlias+\"_\"+this.alias.name:this.alias.name+\"_\"+this.parentAlias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mapToPropertyParentAlias\",{get:function(){return this.mapToProperty?this.mapToProperty.split(\".\")[0]:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,\"mapToPropertyPropertyName\",{get:function(){return this.mapToProperty?this.mapToProperty.split(\".\")[1]:void 0},enumerable:!0,configurable:!0}),e}()},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(e){function t(n){var r=e.call(this)||this;return r.name=\"EntityColumnNotFound\",Object.setPrototypeOf(r,t.prototype),r.message='No entity column \"'+n+'\" was found.',r}return Object(r.c)(t,e),t}(Error)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return i});var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name=\"LimitOnUpdateNotSupportedError\",Object.setPrototypeOf(n,t.prototype),n.message=\"Your database does not support LIMIT on UPDATE statements.\",n}return Object(r.c)(t,e),t}(Error)},function(e){var t=function(){return this}();try{t=t||new Function(\"return this\")()}catch(e){\"object\"==typeof window&&(t=window)}e.exports=t},function(e,t,n){\"use strict\";n.r(t),n.d(t,\"UpdateQueryBuilder\",function(){return g});var r=n(0),i=n(2),a=n(20),o=n(30),s=n(7),u=n(28),c=n(49),l=n(45),h=n(53),p=n(32),d=n(27),f=n(15),m=n(63),y=n(9),b=n(56),v=n(62),g=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return Object(r.c)(t,e),t.prototype.getQuery=function(){var e=this.createUpdateExpression();return e+=this.createOrderByExpression(),(e+=this.createLimitExpression()).trim()},t.prototype.execute=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,a,o,u,l,f,m,y,b,v,g;return Object(r.d)(this,function(E){switch(E.label){case 0:e=this.obtainQueryRunner(),t=!1,E.label=1;case 1:return E.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:E.sent(),t=!0,E.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(v=new d.a,e.broadcaster.broadcastBeforeUpdateEvent(v,this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),0<v.promises.length?[4,Promise.all(v.promises)]:[3,5]):[3,5];case 4:E.sent(),E.label=5;case 5:return n=null,a=null,o=new h.a(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&0<this.expressionMap.whereEntities.length&&(this.expressionMap.extraReturningColumns=o.getUpdationReturningColumns(),0<this.expressionMap.extraReturningColumns.length&&this.connection.driver instanceof s.a&&(n=this.connection.driver.buildTableVariableDeclaration(\"@OutputTable\",this.expressionMap.extraReturningColumns),a=\"SELECT * FROM @OutputTable\")),u=Object(r.e)(this.getQueryAndParameters(),2),l=u[0],f=u[1],m=new c.a,y=[n,l,a],[4,e.query(y.filter(function(e){return null!=e}).join(\";\\n\\n\"),f)];case 6:return b=E.sent(),this.connection.driver instanceof i.i?(m.raw=b[0],m.affected=b[1]):this.connection.driver instanceof i.h?(m.raw=b,m.affected=b.affectedRows):this.connection.driver instanceof i.b?(m.raw=b,m.affected=b.changes):m.raw=b,!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&0<this.expressionMap.whereEntities.length?[4,o.update(m,this.expressionMap.whereEntities)]:[3,8];case 7:E.sent(),E.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(v=new d.a,e.broadcaster.broadcastAfterUpdateEvent(v,this.expressionMap.mainAlias.metadata),0<v.promises.length?[4,Promise.all(v.promises)]:[3,10]):[3,10];case 9:E.sent(),E.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:E.sent(),E.label=12;case 12:return[2,m];case 13:if(g=E.sent(),!t)return[3,17];E.label=14;case 14:return E.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:return E.sent(),[3,17];case 16:return E.sent(),[3,17];case 17:throw g;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:E.sent(),E.label=20;case 20:return this.connection.driver instanceof p.a&&!e.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:E.sent(),E.label=22;case 22:return[7];case 23:return[2]}})})},t.prototype.set=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:\"simple\",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:\"and\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:\"or\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new l.a;return this.expressionMap.returning=e,this},t.prototype.orderBy=function(e,t,n){var r,i;return void 0===t&&(t=\"ASC\"),this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t=\"ASC\"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new Error(\".whereEntity method can only be used on queries which update real entity table.\");this.expressionMap.wheres=[];var n=Array.isArray(e)?e:[e];return n.forEach(function(e){var n=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!n)throw new Error(\"Provided entity does not have ids set, cannot perform operation.\");t.orWhereInIds(n)}),this.expressionMap.whereEntities=n,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this,t=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r=[],o=[],c={},l=this.connection.driver instanceof i.h||this.connection.driver instanceof i.a||this.connection.driver instanceof y.a||this.connection.driver instanceof f.a||this.connection.driver instanceof a.a?0:Object.keys(this.expressionMap.nativeParameters).length;if(n?(u.a.createPropertyPath(n,t).forEach(function(u){var h=n.findColumnsWithPropertyPath(u);if(0>=h.length)throw new v.a(u);h.forEach(function(n){if(n.isUpdate){o.push(n);var u=\"upd_\"+n.databaseName,h=n.getEntityValue(t);if(n.referencedColumn&&h instanceof Object?h=n.referencedColumn.getEntityValue(h):!(h instanceof Function)&&(h=e.connection.driver.preparePersistentValue(h,n)),h instanceof Function)r.push(e.escape(n.databaseName)+\" = \"+h());else if(e.connection.driver instanceof a.a&&null===h)r.push(e.escape(n.databaseName)+\" = NULL\");else{e.connection.driver instanceof s.a&&(h=e.connection.driver.parametrizeValue(n,h)),e.connection.driver instanceof i.h||e.connection.driver instanceof i.a||e.connection.driver instanceof y.a||e.connection.driver instanceof f.a||e.connection.driver instanceof a.a?c[u]=h:e.expressionMap.nativeParameters[u]=h;var p=null;if((e.connection.driver instanceof i.h||e.connection.driver instanceof i.a)&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)){var d=e.connection.driver.options.legacySpatialSupport?\"GeomFromText\":\"ST_GeomFromText\";p=null==n.srid?d+\"(\"+e.connection.driver.createParameter(u,l)+\")\":d+\"(\"+e.connection.driver.createParameter(u,l)+\", \"+n.srid+\")\"}else p=e.connection.driver instanceof i.i&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?null==n.srid?\"ST_GeomFromGeoJSON(\"+e.connection.driver.createParameter(u,l)+\")::\"+n.type:\"ST_SetSRID(ST_GeomFromGeoJSON(\"+e.connection.driver.createParameter(u,l)+\"), \"+n.srid+\")::\"+n.type:e.connection.driver instanceof s.a&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?n.type+\"::STGeomFromText(\"+e.connection.driver.createParameter(u,l)+\", \"+(n.srid||\"0\")+\")\":e.connection.driver.createParameter(u,l);r.push(e.escape(n.databaseName)+\" = \"+p),l++}}})}),n.versionColumn&&-1===o.indexOf(n.versionColumn)&&r.push(this.escape(n.versionColumn.databaseName)+\" = \"+this.escape(n.versionColumn.databaseName)+\" + 1\"),n.updateDateColumn&&-1===o.indexOf(n.updateDateColumn)&&r.push(this.escape(n.updateDateColumn.databaseName)+\" = CURRENT_TIMESTAMP\")):Object.keys(t).map(function(n){var o=t[n];o instanceof Function?r.push(e.escape(n)+\" = \"+o()):e.connection.driver instanceof a.a&&null===o?r.push(e.escape(n)+\" = NULL\"):(e.connection.driver instanceof i.h||e.connection.driver instanceof i.a||e.connection.driver instanceof y.a||e.connection.driver instanceof f.a||e.connection.driver instanceof a.a?c[n]=o:e.expressionMap.nativeParameters[n]=o,r.push(e.escape(n)+\" = \"+e.connection.driver.createParameter(n,l)),l++)}),0>=r.length)throw new b.a;(this.connection.driver instanceof i.h||this.connection.driver instanceof i.a||this.connection.driver instanceof y.a||this.connection.driver instanceof f.a||this.connection.driver instanceof a.a)&&(this.expressionMap.nativeParameters=Object.assign(c,this.expressionMap.nativeParameters));var h=this.createWhereExpression(),p=this.createReturningExpression();return p&&(this.connection.driver instanceof i.i||this.connection.driver instanceof y.a||this.connection.driver instanceof i.c)?\"UPDATE \"+this.getTableName(this.getMainTableName())+\" SET \"+r.join(\", \")+h+\" RETURNING \"+p:p&&this.connection.driver instanceof s.a?\"UPDATE \"+this.getTableName(this.getMainTableName())+\" SET \"+r.join(\", \")+\" OUTPUT \"+p+h:\"UPDATE \"+this.getTableName(this.getMainTableName())+\" SET \"+r.join(\", \")+h},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return 0<Object.keys(t).length?\" ORDER BY \"+Object.keys(t).map(function(n){return\"string\"==typeof t[n]?e.replacePropertyNames(n)+\" \"+t[n]:e.replacePropertyNames(n)+\" \"+t[n].order+\" \"+t[n].nulls}).join(\", \"):\"\"},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof i.h||this.connection.driver instanceof i.a)return\" LIMIT \"+e;throw new m.a}return\"\"},t.prototype.getValueSet=function(){if(this.expressionMap.valuesSet instanceof Object)return this.expressionMap.valuesSet;throw new b.a},t}(o.a)},function(e,t,n){\"use strict\";n.r(t),n.d(t,\"DeleteQueryBuilder\",function(){return d});var r=n(0),i=n(2),a=n(9),o=n(30),s=n(7),u=n(59),c=n(45),l=n(32),h=n(27),p=n(42),d=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return Object(r.c)(t,e),t.prototype.getQuery=function(){return this.createDeleteExpression().trim()},t.prototype.execute=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,o,c,p,d,f,m,y;return Object(r.d)(this,function(b){switch(b.label){case 0:e=Object(r.e)(this.getQueryAndParameters(),2),t=e[0],n=e[1],o=this.obtainQueryRunner(),c=!1,b.label=1;case 1:return b.trys.push([1,11,16,21]),!0!==this.expressionMap.useTransaction||!1!==o.isTransactionActive?[3,3]:[4,o.startTransaction()];case 2:b.sent(),c=!0,b.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(m=new h.a,o.broadcaster.broadcastBeforeRemoveEvent(m,this.expressionMap.mainAlias.metadata),0<m.promises.length?[4,Promise.all(m.promises)]:[3,5]):[3,5];case 4:b.sent(),b.label=5;case 5:return p=new u.a,[4,o.query(t,n)];case 6:return d=b.sent(),(f=o.connection.driver)instanceof i.h||f instanceof i.a?(p.raw=d,p.affected=d.affectedRows):f instanceof s.a||f instanceof i.i||f instanceof i.c?(p.raw=d[0]?d[0]:null,p.affected=\"number\"==typeof d[1]?d[1]:null):f instanceof a.a?p.affected=d:f instanceof i.b?(p.raw=d,p.affected=d.changes):p.raw=d,!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(m=new h.a,o.broadcaster.broadcastAfterRemoveEvent(m,this.expressionMap.mainAlias.metadata),0<m.promises.length?[4,Promise.all(m.promises)]:[3,8]):[3,8];case 7:b.sent(),b.label=8;case 8:return c?[4,o.commitTransaction()]:[3,10];case 9:b.sent(),b.label=10;case 10:return[2,p];case 11:if(y=b.sent(),!c)return[3,15];b.label=12;case 12:return b.trys.push([12,14,,15]),[4,o.rollbackTransaction()];case 13:return b.sent(),[3,15];case 14:return b.sent(),[3,15];case 15:throw y;case 16:return o===this.queryRunner?[3,18]:[4,o.release()];case 17:b.sent(),b.label=18;case 18:return this.connection.driver instanceof l.a&&!o.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,20];case 19:b.sent(),b.label=20;case 20:return[7];case 21:return[2]}})})},t.prototype.from=function(e,t){e=e instanceof p.a?e.options.name:e;var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:\"simple\",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:\"and\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:\"or\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new c.a;return this.expressionMap.returning=e,this},t.prototype.createDeleteExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createWhereExpression(),n=this.createReturningExpression();return n&&(this.connection.driver instanceof i.i||this.connection.driver instanceof i.c)?\"DELETE FROM \"+e+t+\" RETURNING \"+n:\"\"!==n&&this.connection.driver instanceof s.a?\"DELETE FROM \"+e+\" OUTPUT \"+n+t:\"DELETE FROM \"+e+t},t}(o.a)},function(e,t,n){\"use strict\";n.r(t);var r=n(0),i=n(30),a=n(20),o=n(9),s=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.update=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,s,u,c,l,h,p,d,f,m,y,b=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return(t=this.expressionMap.relationMetadata).isManyToOne||t.isOneToOneOwner?(l=t.joinColumns.reduce(function(t,n){var r=e instanceof Object?n.referencedColumn.getEntityValue(e):e;return n.setEntityValue(t,r),t},{}),!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.entityMetadata.target).set(l).whereInIds(this.expressionMap.of).execute()]):[3,2];case 1:return r.sent(),[3,10];case 2:return(t.isOneToOneNotOwner||t.isOneToMany)&&null===e?(n={},t.inverseRelation.joinColumns.forEach(function(e){n[e.propertyName]=null}),p=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i={},s=[],p.forEach(function(e,n){t.inverseRelation.joinColumns.map(function(t,r){var a=\"joinColumn_\"+n+\"_\"+r;i[a]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,s.push(t.propertyPath+\" = :\"+a)})}),(u=s.map(function(e){return\"(\"+e+\")\"}).join(\" OR \"))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(n).where(u).setParameters(i).execute()]:[2]):[3,4];case 3:return r.sent(),[3,10];case 4:if(!t.isOneToOneNotOwner&&!t.isOneToMany)return[3,6];if(Array.isArray(this.expressionMap.of))throw new Error(\"You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.\");return c=this.expressionMap.of,l=t.inverseRelation.joinColumns.reduce(function(e,t){var n=c instanceof Object?t.referencedColumn.getEntityValue(c):c;return t.setEntityValue(e,n),e},{}),!e||Array.isArray(e)&&!e.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(l).whereInIds(e).execute()];case 5:return r.sent(),[3,10];case 6:return h=t.junctionEntityMetadata,p=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],d=Array.isArray(e)?e:[e],f=t.isManyToManyOwner?p:d,m=t.isManyToManyOwner?d:p,y=[],f.forEach(function(e){m.forEach(function(t){var n={};h.ownerColumns.forEach(function(t){n[t.databaseName]=e instanceof Object?t.referencedColumn.getEntityValue(e):e}),h.inverseColumns.forEach(function(e){n[e.databaseName]=t instanceof Object?e.referencedColumn.getEntityValue(t):t}),y.push(n)})}),y.length?this.queryBuilder.connection.driver instanceof o.a||this.queryBuilder.connection.driver instanceof a.a?[4,Promise.all(y.map(function(e){return b.queryBuilder.createQueryBuilder().insert().into(h.tableName).values(e).execute()}))]:[3,8]:[2];case 7:return r.sent(),[3,10];case 8:return[4,this.queryBuilder.createQueryBuilder().insert().into(h.tableName).values(y).execute()];case 9:r.sent(),r.label=10;case 10:return[2]}})})},e}(),u=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.remove=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c,l,h,p,d,f;return Object(r.d)(this,function(m){switch(m.label){case 0:return(t=this.expressionMap.relationMetadata).isOneToMany?(u=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],n=Array.isArray(e)?e:[e],i={},t.inverseRelation.joinColumns.forEach(function(e){i[e.propertyName]=null}),a={},o=[],u.forEach(function(e,i){o.push.apply(o,Object(r.f)(n.map(function(n,o){return Object(r.f)(t.inverseRelation.joinColumns.map(function(t,n){var r=\"joinColumn_\"+i+\"_\"+o+\"_\"+n;return a[r]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,t.propertyPath+\" = :\"+r}),t.inverseRelation.entityMetadata.primaryColumns.map(function(e,t){var r=\"primaryColumn_\"+o+\"_\"+o+\"_\"+t;return a[r]=n instanceof Object?e.getEntityValue(n):n,e.propertyPath+\" = :\"+r})).join(\" AND \")})))}),(f=o.map(function(e){return\"(\"+e+\")\"}).join(\" OR \"))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(i).where(f).setParameters(a).execute()]:[2]):[3,2];case 1:return m.sent(),[3,4];case 2:return s=t.junctionEntityMetadata,u=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],c=Array.isArray(e)?e:[e],l=t.isManyToManyOwner?u:c,h=t.isManyToManyOwner?c:u,p={},d=[],l.forEach(function(e,t){d.push.apply(d,Object(r.f)(h.map(function(n,i){return Object(r.f)(s.ownerColumns.map(function(n,r){var a=\"firstValue_\"+t+\"_\"+i+\"_\"+r;return p[a]=e instanceof Object?n.referencedColumn.getEntityValue(e):e,n.databaseName+\" = :\"+a}),s.inverseColumns.map(function(e,r){var a=\"secondValue_\"+t+\"_\"+i+\"_\"+r;return p[a]=n instanceof Object?e.referencedColumn.getEntityValue(n):n,e.databaseName+\" = :\"+a})).join(\" AND \")})))}),f=d.map(function(e){return\"(\"+e+\")\"}).join(\" OR \"),[4,this.queryBuilder.createQueryBuilder().delete().from(s.tableName).where(f).setParameters(p).execute()];case 3:m.sent(),m.label=4;case 4:return[2]}})})},e}();n.d(t,\"RelationQueryBuilder\",function(){return c});var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.c)(t,e),t.prototype.getQuery=function(){return\"\"},t.prototype.of=function(e){return this.expressionMap.of=e,this},t.prototype.set=function(e){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(){if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error(\"Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.\");if(t.isManyToMany||t.isOneToMany)throw new Error('Set operation is only supported for many-to-one and one-to-one relations. However given \"'+t.propertyPath+'\" has '+t.relationType+\" relation. Use .add() method instead.\");if(t.joinColumns&&1<t.joinColumns.length&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: \"...\", lastName: \"...\" })');return[2,new s(this,this.expressionMap).update(e)]})})},t.prototype.add=function(e){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(){if(Array.isArray(e)&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error(\"Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.\");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given \"'+t.propertyPath+'\" has '+t.relationType+\" relation. Use .set() method instead.\");if(t.joinColumns&&1<t.joinColumns.length&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: \"...\", lastName: \"...\" })');return[2,new s(this,this.expressionMap).update(e)]})})},t.prototype.remove=function(e){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(){if(Array.isArray(e)&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error(\"Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.\");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given \"'+t.propertyPath+'\" has '+t.relationType+\" relation. Use .set(null) method instead.\");return[2,new u(this,this.expressionMap).remove(e)]})})},t.prototype.addAndRemove=function(e,t){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(n){switch(n.label){case 0:return[4,this.remove(t)];case 1:return n.sent(),[4,this.add(e)];case 2:return n.sent(),[2]}})})},t.prototype.loadOne=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,this.loadMany().then(function(e){return e[0]})]})})},t.prototype.loadMany=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t;return Object(r.d)(this,function(){if(!((e=this.expressionMap.of)instanceof Object)){if((t=this.expressionMap.mainAlias.metadata).hasMultiplePrimaryKeys)throw new Error(\"Cannot load entity because only one primary key was specified, however entity contains multiple primary keys\");e=t.primaryColumns[0].createValueMap(e)}return[2,this.connection.relationLoader.load(this.expressionMap.relationMetadata,e)]})})},t}(i.a)},function(e,t,n){\"use strict\";n.r(t);var r=n(0),i=n(2),a=n(20),o=n(30),s=n(7),u=n(37),c=n(55),l=n(45),h=function(e){function t(){var n=e.call(this)||this;return n.name=\"InsertValuesMissingError\",Object.setPrototypeOf(n,t.prototype),n.message='Cannot perform insert query because values are not defined. Call \"qb.values(...)\" method to specify inserted values.',n}return Object(r.c)(t,e),t}(Error),p=n(53),d=n(15),f=n(32),m=n(27),y=n(40),b=n(9);n.d(t,\"InsertQueryBuilder\",function(){return v});var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.c)(t,e),t.prototype.getQuery=function(){return this.createInsertExpression().trim()},t.prototype.execute=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i,a,o,u,l,h,d,y,b,v,g,E,T=this;return Object(r.d)(this,function(N){switch(N.label){case 0:if(0===(e=this.getValueSets()).length)return[2,new c.a];t=this.obtainQueryRunner(),n=!1,N.label=1;case 1:return N.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==t.isTransactionActive?[3,3]:[4,t.startTransaction()];case 2:N.sent(),n=!0,N.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(i=new m.a,e.forEach(function(e){t.broadcaster.broadcastBeforeInsertEvent(i,T.expressionMap.mainAlias.metadata,e)}),0<i.promises.length?[4,Promise.all(i.promises)]:[3,5]):[3,5];case 4:N.sent(),N.label=5;case 5:return a=null,o=null,u=new p.a(t,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.extraReturningColumns=u.getInsertionReturningColumns(),0<this.expressionMap.extraReturningColumns.length&&this.connection.driver instanceof s.a&&(a=this.connection.driver.buildTableVariableDeclaration(\"@OutputTable\",this.expressionMap.extraReturningColumns),o=\"SELECT * FROM @OutputTable\")),l=Object(r.e)(this.getQueryAndParameters(),2),h=l[0],d=l[1],y=new c.a,b=[a,h,o],v=y,[4,t.query(b.filter(function(e){return null!=e}).join(\";\\n\\n\"),d)];case 6:return v.raw=N.sent(),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata?[4,u.insert(y,e)]:[3,8];case 7:N.sent(),N.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(g=new m.a,e.forEach(function(e){t.broadcaster.broadcastAfterInsertEvent(g,T.expressionMap.mainAlias.metadata,e)}),0<g.promises.length?[4,Promise.all(g.promises)]:[3,10]):[3,10];case 9:N.sent(),N.label=10;case 10:return n?[4,t.commitTransaction()]:[3,12];case 11:N.sent(),N.label=12;case 12:return[2,y];case 13:if(E=N.sent(),!n)return[3,17];N.label=14;case 14:return N.trys.push([14,16,,17]),[4,t.rollbackTransaction()];case 15:return N.sent(),[3,17];case 16:return N.sent(),[3,17];case 17:throw E;case 18:return t===this.queryRunner?[3,20]:[4,t.release()];case 19:N.sent(),N.label=20;case 20:return this.connection.driver instanceof f.a&&!t.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:N.sent(),N.label=22;case 22:return[7];case 23:return[2]}})})},t.prototype.into=function(e,t){e=e instanceof y.a?e.options.name:e;var n=this.createFromAlias(e);return this.expressionMap.setMainAlias(n),this.expressionMap.insertColumns=t||[],this},t.prototype.values=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new l.a;return this.expressionMap.returning=e,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.onConflict=function(e){return this.expressionMap.onConflict=e,this},t.prototype.orIgnore=function(e){return void 0===e&&(e=!0),this.expressionMap.onIgnore=e,this},t.prototype.orUpdate=function(e){return this.expressionMap.onUpdate={},e&&Array.isArray(e.conflict_target)&&(this.expressionMap.onUpdate.conflict=\" ( \"+e.conflict_target.join(\", \")+\" ) \"),e&&\"string\"==typeof e.conflict_target&&(this.expressionMap.onUpdate.conflict=\" ON CONSTRAINT \"+e.conflict_target+\" \"),e&&Array.isArray(e.columns)&&(this.expressionMap.onUpdate.columns=e.columns.map(function(e){return e+\" = :\"+e}).join(\", \")),e&&Array.isArray(e.overwrite)&&(this.connection.driver instanceof i.h||this.connection.driver instanceof i.a?this.expressionMap.onUpdate.overwrite=e.overwrite.map(function(e){return e+\" = VALUES(\"+e+\")\"}).join(\", \"):(this.connection.driver instanceof i.i||this.connection.driver instanceof d.a||this.connection.driver instanceof i.c)&&(this.expressionMap.onUpdate.overwrite=e.overwrite.map(function(e){return e+\" = EXCLUDED.\"+e}).join(\", \"))),this},t.prototype.createInsertExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createValuesExpression(),n=this.createReturningExpression(),r=this.createColumnNamesExpression(),a=\"INSERT \";if((this.connection.driver instanceof i.h||this.connection.driver instanceof i.a)&&(a+=this.expressionMap.onIgnore?\" IGNORE \":\"\"),a+=\"INTO \"+e,r?a+=\"(\"+r+\")\":!t&&(this.connection.driver instanceof i.h||this.connection.driver instanceof i.a)&&(a+=\"()\"),n&&this.connection.driver instanceof s.a&&(a+=\" OUTPUT \"+n),a+=t?\" VALUES \"+t:this.connection.driver instanceof i.h||this.connection.driver instanceof i.a?\" VALUES ()\":\" DEFAULT VALUES\",this.connection.driver instanceof i.i||this.connection.driver instanceof d.a||this.connection.driver instanceof i.c){if(a+=this.expressionMap.onIgnore?\" ON CONFLICT DO NOTHING \":\"\",a+=this.expressionMap.onConflict?\" ON CONFLICT \"+this.expressionMap.onConflict:\"\",this.expressionMap.onUpdate){var o=this.expressionMap.onUpdate,u=o.overwrite,c=o.columns,l=o.conflict;a+=c?\" ON CONFLICT \"+l+\" DO UPDATE SET \"+c:\"\",a+=u?\" ON CONFLICT \"+l+\" DO UPDATE SET \"+u:\"\"}}else if((this.connection.driver instanceof i.h||this.connection.driver instanceof i.a)&&this.expressionMap.onUpdate){var h=this.expressionMap.onUpdate;u=h.overwrite;a+=(c=h.columns)?\" ON DUPLICATE KEY UPDATE \"+c:\"\",a+=u?\" ON DUPLICATE KEY UPDATE \"+u:\"\"}return n&&(this.connection.driver instanceof i.i||this.connection.driver instanceof b.a||this.connection.driver instanceof i.c)&&(a+=\" RETURNING \"+n),a},t.prototype.getInsertedColumns=function(){var e=this;return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(function(t){return e.expressionMap.insertColumns.length?-1!==e.expressionMap.insertColumns.indexOf(t.propertyPath):!!t.isInsert&&(!t.isGenerated||\"increment\"!==t.generationStrategy||e.connection.driver instanceof b.a||e.connection.driver instanceof d.a||e.connection.driver instanceof i.h||e.connection.driver instanceof i.a)}):[]},t.prototype.createColumnNamesExpression=function(){var e=this,t=this.getInsertedColumns();if(0<t.length)return t.map(function(t){return e.escape(t.databaseName)}).join(\", \");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){var n=this.getValueSets();if(1===n.length)return Object.keys(n[0]).map(function(t){return e.escape(t)}).join(\", \")}return this.expressionMap.insertColumns.map(function(t){return e.escape(t)}).join(\", \")},t.prototype.createValuesExpression=function(){var e=this,t=this.getValueSets(),n=this.getInsertedColumns();if(0<n.length){var r=\"\",o=Object.keys(this.expressionMap.nativeParameters).length;return t.forEach(function(c,l){n.forEach(function(h,p){0===p&&(r+=\"(\");var f=\"i\"+l+\"_\"+h.databaseName,m=h.getEntityValue(c);if(m instanceof Function||(m=e.connection.driver.preparePersistentValue(m,h)),h.isVersion&&void 0===m)r+=\"1\";else if(h.isDiscriminator)e.expressionMap.nativeParameters[\"discriminator_value_\"+o]=e.expressionMap.mainAlias.metadata.discriminatorValue,r+=e.connection.driver.createParameter(\"discriminator_value_\"+o,o),o++;else if(h.isGenerated&&\"uuid\"===h.generationStrategy&&!e.connection.driver.isUUIDGenerationSupported()&&void 0===m){var y=\"uuid_\"+h.databaseName+l;m=u.a.uuid4(),e.expressionMap.nativeParameters[y]=m,r+=e.connection.driver.createParameter(y,o),o++}else if(void 0===m)r+=e.connection.driver instanceof d.a||e.connection.driver instanceof a.a?void 0===h.default?\"NULL\":e.connection.driver.normalizeDefault(h):\"DEFAULT\";else if(m instanceof Function)r+=m();else{if(e.connection.driver instanceof s.a&&(m=e.connection.driver.parametrizeValue(h,m)),e.expressionMap.nativeParameters[f]=m,(e.connection.driver instanceof i.h||e.connection.driver instanceof i.a)&&-1!==e.connection.driver.spatialTypes.indexOf(h.type)){var b=e.connection.driver.options.legacySpatialSupport?\"GeomFromText\":\"ST_GeomFromText\";r+=null==h.srid?b+\"(\"+e.connection.driver.createParameter(f,o)+\")\":b+\"(\"+e.connection.driver.createParameter(f,o)+\", \"+h.srid+\")\"}else r+=e.connection.driver instanceof i.i&&-1!==e.connection.driver.spatialTypes.indexOf(h.type)?null==h.srid?\"ST_GeomFromGeoJSON(\"+e.connection.driver.createParameter(f,o)+\")::\"+h.type:\"ST_SetSRID(ST_GeomFromGeoJSON(\"+e.connection.driver.createParameter(f,o)+\"), \"+h.srid+\")::\"+h.type:e.connection.driver instanceof s.a&&-1!==e.connection.driver.spatialTypes.indexOf(h.type)?h.type+\"::STGeomFromText(\"+e.connection.driver.createParameter(f,o)+\", \"+(h.srid||\"0\")+\")\":e.connection.driver.createParameter(f,o);o++}r+=p===n.length-1?l===t.length-1?\")\":\"), \":\", \"})}),\"()\"===r?\"\":r}var c=\"\",l=Object.keys(this.expressionMap.nativeParameters).length;return t.forEach(function(n,r){Object.keys(n).forEach(function(i,o){0===o&&(c+=\"(\");var s=\"i\"+r+\"_\"+i,u=n[i];u instanceof Function?c+=u():void 0===u?e.connection.driver instanceof d.a||e.connection.driver instanceof a.a?c+=\"NULL\":c+=\"DEFAULT\":(e.expressionMap.nativeParameters[s]=u,c+=e.connection.driver.createParameter(s,l),l++),c+=o===Object.keys(n).length-1?r===t.length-1?\")\":\"), \":\", \"})}),\"()\"===c?\"\":c},t.prototype.getValueSets=function(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(this.expressionMap.valuesSet instanceof Object)return[this.expressionMap.valuesSet];throw new h},t}(o.a)},function(e){function t(){throw new Error(\"setTimeout has not been defined\")}function n(){throw new Error(\"clearTimeout has not been defined\")}function r(e){if(u===setTimeout)return setTimeout(e,0);if((u===t||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function i(){d&&h&&(d=!1,h.length?p=h.concat(p):f=-1,p.length&&a())}function a(){if(!d){var e=r(i);d=!0;for(var t=p.length;t;){for(h=p,p=[];++f<t;)h&&h[f].run();f=-1,t=p.length}h=null,d=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===n||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(e)}}function o(e,t){this.fun=e,this.array=t}function s(){}var u,c,l=e.exports={};!function(){try{u=\"function\"==typeof setTimeout?setTimeout:t}catch(e){u=t}try{c=\"function\"==typeof clearTimeout?clearTimeout:n}catch(e){c=n}}();var h,p=[],d=!1,f=-1;l.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new o(e,t)),1!==p.length||d||r(a)},o.prototype.run=function(){this.fun.apply(null,this.array)},l.title=\"browser\",l.browser=!0,l.env={},l.argv=[],l.version=\"\",l.versions={},l.on=s,l.addListener=s,l.once=s,l.off=s,l.removeListener=s,l.removeAllListeners=s,l.emit=s,l.prependListener=s,l.prependOnceListener=s,l.listeners=function(){return[]},l.binding=function(){throw new Error(\"process.binding is not supported\")},l.cwd=function(){return\"/\"},l.chdir=function(){throw new Error(\"process.chdir is not supported\")},l.umask=function(){return 0}},function(e,t,n){function r(){this.init(),this._w=f,h.call(this,64,56)}function i(e,t,n){return n^e&(t^n)}function a(e,t,n){return e&t|n&(e|t)}function o(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function s(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function u(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}function c(e){return(e>>>17|e<<15)^(e>>>19|e<<13)^e>>>10}var l=n(47),h=n(48),p=n(46).Buffer,d=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],f=Array(64);l(r,h),r.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},r.prototype._update=function(e){for(var t=this._w,n=0|this._a,r=0|this._b,l=0|this._c,h=0|this._d,p=0|this._e,f=0|this._f,m=0|this._g,y=0|this._h,b=0;16>b;++b)t[b]=e.readInt32BE(4*b);for(;64>b;++b)t[b]=0|c(t[b-2])+t[b-7]+u(t[b-15])+t[b-16];for(var v=0;64>v;++v){var g=0|y+s(p)+i(p,f,m)+d[v]+t[v],E=0|o(n)+a(n,r,l);y=m,m=f,f=p,p=0|h+g,h=l,l=r,r=n,n=0|g+E}this._a=0|n+this._a,this._b=0|r+this._b,this._c=0|l+this._c,this._d=0|h+this._d,this._e=0|p+this._e,this._f=0|f+this._f,this._g=0|m+this._g,this._h=0|y+this._h},r.prototype._hash=function(){var e=p.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=r},function(e,t,n){function r(){this.init(),this._w=b,f.call(this,128,112)}function i(e,t,n){return n^e&(t^n)}function a(e,t,n){return e&t|n&(e|t)}function o(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function s(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function u(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function c(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function l(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function h(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function p(e,t){return e>>>0<t>>>0?1:0}var d=n(47),f=n(48),m=n(46).Buffer,y=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],b=Array(160);d(r,f),r.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},r.prototype._update=function(e){for(var t=this._w,n=0|this._ah,r=0|this._bh,d=0|this._ch,f=0|this._dh,m=0|this._eh,b=0|this._fh,v=0|this._gh,g=0|this._hh,E=0|this._al,T=0|this._bl,N=0|this._cl,O=0|this._dl,A=0|this._el,C=0|this._fl,w=0|this._gl,R=0|this._hl,S=0;32>S;S+=2)t[S]=e.readInt32BE(4*S),t[S+1]=e.readInt32BE(4*S+4);for(;160>S;S+=2){var M=t[S-30],j=t[S-30+1],P=u(M,j),x=c(j,M),I=l(M=t[S-4],j=t[S-4+1]),_=h(j,M),L=t[S-14],D=t[S-14+1],q=t[S-32],B=t[S-32+1],U=0|x+D,F=0|P+L+p(U,x);F=0|(F=0|F+I+p(U=0|U+_,_))+q+p(U=0|U+B,B),t[S]=F,t[S+1]=U}for(var k=0;160>k;k+=2){F=t[k],U=t[k+1];var Q=a(n,r,d),V=a(E,T,N),K=o(n,E),W=o(E,n),H=s(m,A),Y=s(A,m),z=y[k],J=y[k+1],G=i(m,b,v),X=i(A,C,w),Z=0|R+Y,$=0|g+H+p(Z,R);$=0|($=0|($=0|$+G+p(Z=0|Z+X,X))+z+p(Z=0|Z+J,J))+F+p(Z=0|Z+U,U);var ee=0|W+V,te=0|K+Q+p(ee,W);g=v,R=w,v=b,w=C,b=m,C=A,m=0|f+$+p(A=0|O+Z,O),f=d,O=N,d=r,N=T,r=n,T=E,n=0|$+te+p(E=0|Z+ee,Z)}this._al=0|this._al+E,this._bl=0|this._bl+T,this._cl=0|this._cl+N,this._dl=0|this._dl+O,this._el=0|this._el+A,this._fl=0|this._fl+C,this._gl=0|this._gl+w,this._hl=0|this._hl+R,this._ah=0|this._ah+n+p(this._al,E),this._bh=0|this._bh+r+p(this._bl,T),this._ch=0|this._ch+d+p(this._cl,N),this._dh=0|this._dh+f+p(this._dl,O),this._eh=0|this._eh+m+p(this._el,A),this._fh=0|this._fh+b+p(this._fl,C),this._gh=0|this._gh+v+p(this._gl,w),this._hh=0|this._hh+g+p(this._hl,R)},r.prototype._hash=function(){function e(e,n,r){t.writeInt32BE(e,r),t.writeInt32BE(n,r+4)}var t=m.allocUnsafe(64);return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),e(this._gh,this._gl,48),e(this._hh,this._hl,56),t},e.exports=r},function(e,t,n){\"use strict\";n.r(t);var r=n(0),i=n(2),a=n(30),o=n(7),s=n(49),u=n(45),c=n(53),l=n(32),h=n(27),p=n(15),d=n(63),f=function(e){function t(n){var r=e.call(this)||this;return r.name=\"MissingDeleteDateColumnError\",Object.setPrototypeOf(r,t.prototype),r.message='Entity \"'+n.name+'\" does not have delete date columns.',r}return Object(r.c)(t,e),t}(Error),m=n(9),y=n(56),b=n(40);n.d(t,\"SoftDeleteQueryBuilder\",function(){return v});var v=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return Object(r.c)(t,e),t.prototype.getQuery=function(){var e=this.createUpdateExpression();return e+=this.createOrderByExpression(),(e+=this.createLimitExpression()).trim()},t.prototype.execute=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,a,o,u,p,d,f,m;return Object(r.d)(this,function(y){switch(y.label){case 0:e=this.obtainQueryRunner(),t=!1,y.label=1;case 1:return y.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:y.sent(),t=!0,y.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(f=new h.a,e.broadcaster.broadcastBeforeUpdateEvent(f,this.expressionMap.mainAlias.metadata),0<f.promises.length?[4,Promise.all(f.promises)]:[3,5]):[3,5];case 4:y.sent(),y.label=5;case 5:return n=new c.a(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&0<this.expressionMap.whereEntities.length&&(this.expressionMap.extraReturningColumns=n.getUpdationReturningColumns()),a=Object(r.e)(this.getQueryAndParameters(),2),o=a[0],u=a[1],p=new s.a,[4,e.query(o,u)];case 6:return d=y.sent(),e.connection.driver instanceof i.i?(p.raw=d[0],p.affected=d[1]):p.raw=d,!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&0<this.expressionMap.whereEntities.length?[4,n.update(p,this.expressionMap.whereEntities)]:[3,8];case 7:y.sent(),y.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(f=new h.a,e.broadcaster.broadcastAfterUpdateEvent(f,this.expressionMap.mainAlias.metadata),0<f.promises.length?[4,Promise.all(f.promises)]:[3,10]):[3,10];case 9:y.sent(),y.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:y.sent(),y.label=12;case 12:return[2,p];case 13:if(m=y.sent(),!t)return[3,17];y.label=14;case 14:return y.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:return y.sent(),[3,17];case 16:return y.sent(),[3,17];case 17:throw m;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:y.sent(),y.label=20;case 20:return this.connection.driver instanceof l.a&&!e.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:y.sent(),y.label=22;case 22:return[7];case 23:return[2]}})})},t.prototype.from=function(e,t){e=e instanceof b.a?e.options.name:e;var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:\"simple\",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:\"and\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:\"or\",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new u.a;return this.expressionMap.returning=e,this},t.prototype.orderBy=function(e,t,n){var r,i;return void 0===t&&(t=\"ASC\"),this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t=\"ASC\"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new Error(\".whereEntity method can only be used on queries which update real entity table.\");this.expressionMap.wheres=[];var n=Array.isArray(e)?e:[e];return n.forEach(function(e){var n=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!n)throw new Error(\"Provided entity does not have ids set, cannot perform operation.\");t.orWhereInIds(n)}),this.expressionMap.whereEntities=n,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new Error('Cannot get entity metadata for the given alias \"'+this.expressionMap.mainAlias+'\"');if(!e.deleteDateColumn)throw new f(e);var t=[];switch(this.expressionMap.queryType){case\"soft-delete\":t.push(this.escape(e.deleteDateColumn.databaseName)+\" = CURRENT_TIMESTAMP\");break;case\"restore\":t.push(this.escape(e.deleteDateColumn.databaseName)+\" = NULL\");break;default:throw new Error('The queryType must be \"soft-delete\" or \"restore\"')}if(e.versionColumn&&t.push(this.escape(e.versionColumn.databaseName)+\" = \"+this.escape(e.versionColumn.databaseName)+\" + 1\"),e.updateDateColumn&&t.push(this.escape(e.updateDateColumn.databaseName)+\" = CURRENT_TIMESTAMP\"),0>=t.length)throw new y.a;(this.connection.driver instanceof i.h||this.connection.driver instanceof m.a||this.connection.driver instanceof p.a)&&(this.expressionMap.nativeParameters=Object.assign({},this.expressionMap.nativeParameters));var n=this.createWhereExpression(),r=this.createReturningExpression();return r&&(this.connection.driver instanceof i.i||this.connection.driver instanceof m.a||this.connection.driver instanceof i.c)?\"UPDATE \"+this.getTableName(this.getMainTableName())+\" SET \"+t.join(\", \")+n+\" RETURNING \"+r:r&&this.connection.driver instanceof o.a?\"UPDATE \"+this.getTableName(this.getMainTableName())+\" SET \"+t.join(\", \")+\" OUTPUT \"+r+n:\"UPDATE \"+this.getTableName(this.getMainTableName())+\" SET \"+t.join(\", \")+n},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return 0<Object.keys(t).length?\" ORDER BY \"+Object.keys(t).map(function(n){return\"string\"==typeof t[n]?e.replacePropertyNames(n)+\" \"+t[n]:e.replacePropertyNames(n)+\" \"+t[n].order+\" \"+t[n].nulls}).join(\", \"):\"\"},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof i.h)return\" LIMIT \"+e;throw new d.a}return\"\"},t}(a.a)},function(e,t,n){(t=e.exports=function(e){e=e.toLowerCase();var n=t[e];if(!n)throw new Error(e+\" is not supported (we accept pull requests)\");return new n}).sha=n(83),t.sha1=n(87),t.sha224=n(88),t.sha256=n(70),t.sha384=n(89),t.sha512=n(71)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return E});var r=n(0),i=n(24),a=n(14),o=n(31),s=n(22),u=n(41),c=n(3),l=n(18),h=n(8),p=n(13),d=n(12),f=n(10),m=n(17),y=n(25),b=n(4),v=n(1),g=n(19),E=function(e){function t(t,n){var r=e.call(this)||this;return r.queryResponsibilityChain=[],r.driver=t,r.connection=t.connection,r.broadcaster=new y.a(r),r.mode=n,r}return Object(r.c)(t,e),t.prototype.connect=function(){return Promise.resolve()},t.prototype.release=function(){return this.isReleased=!0,Promise.resolve()},t.prototype.startTransaction=function(e){return Object(r.b)(this,void 0,void 0,function(){var t=this;return Object(r.d)(this,function(){if(this.isReleased)throw new a.a;if(this.isTransactionActive)throw new o.a;return[2,new Promise(function(n,i){return Object(r.b)(t,void 0,void 0,function(){var t,a,o=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return this.isTransactionActive=!0,[4,\"slave\"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return t=r.sent(),this.databaseConnection=t.transaction(),a=function(t){return t?(o.isTransactionActive=!1,i(t)):(n(),o.connection.logger.logQuery(\"BEGIN TRANSACTION\"),void(e&&o.connection.logger.logQuery(\"SET TRANSACTION ISOLATION LEVEL \"+e)))},e?this.databaseConnection.begin(this.convertIsolationLevel(e),a):this.databaseConnection.begin(a),[2]}})})})]})})},t.prototype.commitTransaction=function(){return Object(r.b)(this,void 0,void 0,function(){var e=this;return Object(r.d)(this,function(){if(this.isReleased)throw new a.a;if(!this.isTransactionActive)throw new s.a;return[2,new Promise(function(t,n){e.databaseConnection.commit(function(r){return r?n(r):(e.isTransactionActive=!1,e.databaseConnection=null,t(),void e.connection.logger.logQuery(\"COMMIT\"))})})]})})},t.prototype.rollbackTransaction=function(){return Object(r.b)(this,void 0,void 0,function(){var e=this;return Object(r.d)(this,function(){if(this.isReleased)throw new a.a;if(!this.isTransactionActive)throw new s.a;return[2,new Promise(function(t,n){e.databaseConnection.rollback(function(r){return r?n(r):(e.isTransactionActive=!1,e.databaseConnection=null,t(),void e.connection.logger.logQuery(\"ROLLBACK\"))})})]})})},t.prototype.query=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,o,s,u,c=this;return Object(r.d)(this,function(l){switch(l.label){case 0:if(this.isReleased)throw new a.a;return o=new Promise(function(e){return n=e}),this.queryResponsibilityChain.length?(s=Object(r.f)(this.queryResponsibilityChain),this.queryResponsibilityChain.push(o),[4,Promise.all(s)]):[3,2];case 1:l.sent(),l.label=2;case 2:return u=new Promise(function(a,s){return Object(r.b)(c,void 0,void 0,function(){var c,l,h,p,d=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(e,t,this),[4,\"slave\"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return c=r.sent(),l=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:c),t&&t.length&&t.forEach(function(e,t){if(e instanceof g.a){var n=d.mssqlParameterToNativeParameter(e);n?l.input(t,n,e.value):l.input(t,e.value)}else l.input(t,e)}),h=+new Date,l.query(e,function(r,c){var l=d.driver.connection.options.maxQueryExecutionTime,p=+new Date-h;l&&p>l&&d.driver.connection.logger.logQuerySlow(p,e,t,d);var f=function(){-1!==m&&d.queryResponsibilityChain.splice(m,1),-1!==y&&d.queryResponsibilityChain.splice(y,1),n()},m=d.queryResponsibilityChain.indexOf(u),y=d.queryResponsibilityChain.indexOf(o);if(r)return d.driver.connection.logger.logQueryError(r,e,t,d),f(),s(new i.a(e,t,r));var b=e.slice(0,e.indexOf(\" \"));a(\"DELETE\"===b?[c.recordset,c.rowsAffected[0]]:c.recordset),f()}),[3,3];case 2:return p=r.sent(),s(p),[3,3];case 3:return[2]}})})}),this.queryResponsibilityChain.push(u),[2,u]}})})},t.prototype.stream=function(e,t,n,i){return Object(r.b)(this,void 0,void 0,function(){var o,s,u,c,l=this;return Object(r.d)(this,function(h){switch(h.label){case 0:if(this.isReleased)throw new a.a;return s=new Promise(function(e){return o=e}),this.queryResponsibilityChain.length?(u=Object(r.f)(this.queryResponsibilityChain),this.queryResponsibilityChain.push(s),[4,Promise.all(u)]):[3,2];case 1:h.sent(),h.label=2;case 2:return c=new Promise(function(a,u){return Object(r.b)(l,void 0,void 0,function(){var l,h,p=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return this.driver.connection.logger.logQuery(e,t,this),[4,\"slave\"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return l=r.sent(),(h=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:l)).stream=!0,t&&t.length&&t.forEach(function(e,t){e instanceof g.a?h.input(t,p.mssqlParameterToNativeParameter(e),e.value):h.input(t,e)}),h.query(e,function(n,r){var i=function(){-1!==l&&p.queryResponsibilityChain.splice(l,1),-1!==h&&p.queryResponsibilityChain.splice(h,1),o()},l=p.queryResponsibilityChain.indexOf(c),h=p.queryResponsibilityChain.indexOf(s);return n?(p.driver.connection.logger.logQueryError(n,e,t,p),i(),u(n)):(a(r.recordset),void i())}),n&&h.on(\"done\",n),i&&h.on(\"error\",i),a(h),[2]}})})}),this.isTransactionActive&&this.queryResponsibilityChain.push(c),[2,c]}})})},t.prototype.getDatabases=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:return[4,this.query(\"EXEC sp_databases\")];case 1:return[2,e.sent().map(function(e){return e.DATABASE_NAME})]}})})},t.prototype.getSchemas=function(e){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(n){switch(n.label){case 0:return t=e?'SELECT * FROM \"'+e+'\".\"sys\".\"schema\"':'SELECT * FROM \"sys\".\"schemas\"',[4,this.query(t)];case 1:return[2,n.sent().map(function(e){return e.name})]}})})},t.prototype.hasDatabase=function(e){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(n){switch(n.label){case 0:return[4,this.query(\"SELECT DB_ID('\"+e+'\\') as \"db_id\"')];case 1:return t=n.sent(),[2,!!t[0].db_id]}})})},t.prototype.hasSchema=function(e){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(n){switch(n.label){case 0:return[4,this.query(\"SELECT SCHEMA_ID('\"+e+'\\') as \"schema_id\"')];case 1:return t=n.sent(),[2,!!t[0].schema_id]}})})},t.prototype.hasTable=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:return t=this.parseTableName(e),n=\"SCHEMA_NAME()\"===t.schema?t.schema:\"'\"+t.schema+\"'\",i='SELECT * FROM \"'+t.database+'\".\"INFORMATION_SCHEMA\".\"TABLES\" WHERE \"TABLE_NAME\" = \\''+t.name+'\\' AND \"TABLE_SCHEMA\" = '+n,[4,this.query(i)];case 1:return[2,!!r.sent().length]}})})},t.prototype.hasColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=this.parseTableName(e),i=\"SCHEMA_NAME()\"===n.schema?n.schema:\"'\"+n.schema+\"'\",a='SELECT * FROM \"'+n.database+'\".\"INFORMATION_SCHEMA\".\"COLUMNS\" WHERE \"TABLE_NAME\" = \\''+n.name+\"' AND \\\"COLUMN_NAME\\\" = '\"+t+'\\' AND \"TABLE_SCHEMA\" = '+i,[4,this.query(a)];case 1:return[2,!!r.sent().length]}})})},t.prototype.createDatabase=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t?\"IF DB_ID('\"+e+\"') IS NULL CREATE DATABASE \\\"\"+e+'\"':'CREATE DATABASE \"'+e+'\"',i='DROP DATABASE \"'+e+'\"',[4,this.executeQueries(new v.a(n),new v.a(i))];case 1:return r.sent(),[2]}})})},t.prototype.dropDatabase=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t?\"IF DB_ID('\"+e+\"') IS NOT NULL DROP DATABASE \\\"\"+e+'\"':'DROP DATABASE \"'+e+'\"',i='CREATE DATABASE \"'+e+'\"',[4,this.executeQueries(new v.a(n),new v.a(i))];case 1:return r.sent(),[2]}})})},t.prototype.createSchema=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=[],i=[],-1!==e.indexOf(\".\")?[3,1]:(u=t?\"IF SCHEMA_ID('\"+e+\"') IS NULL BEGIN EXEC ('CREATE SCHEMA \\\"\"+e+\"\\\"') END\":'CREATE SCHEMA \"'+e+'\"',n.push(new v.a(u)),i.push(new v.a('DROP SCHEMA \"'+e+'\"')),[3,3]);case 1:return a=e.split(\".\")[0],o=e.split(\".\")[1],[4,this.getCurrentDatabase()];case 2:s=r.sent(),n.push(new v.a('USE \"'+a+'\"')),i.push(new v.a('USE \"'+s+'\"')),u=t?\"IF SCHEMA_ID('\"+o+\"') IS NULL BEGIN EXEC ('CREATE SCHEMA \\\"\"+o+\"\\\"') END\":'CREATE SCHEMA \"'+o+'\"',n.push(new v.a(u)),i.push(new v.a('DROP SCHEMA \"'+o+'\"')),n.push(new v.a('USE \"'+s+'\"')),i.push(new v.a('USE \"'+a+'\"')),r.label=3;case 3:return[4,this.executeQueries(n,i)];case 4:return r.sent(),[2]}})})},t.prototype.dropSchema=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=[],i=[],-1!==e.indexOf(\".\")?[3,1]:(u=t?\"IF SCHEMA_ID('\"+e+\"') IS NULL BEGIN EXEC ('DROP SCHEMA \\\"\"+e+\"\\\"') END\":'DROP SCHEMA \"'+e+'\"',n.push(new v.a(u)),i.push(new v.a('CREATE SCHEMA \"'+e+'\"')),[3,3]);case 1:return a=e.split(\".\")[0],o=e.split(\".\")[1],[4,this.getCurrentDatabase()];case 2:s=r.sent(),n.push(new v.a('USE \"'+a+'\"')),i.push(new v.a('USE \"'+s+'\"')),u=t?\"IF SCHEMA_ID('\"+o+\"') IS NULL BEGIN EXEC ('DROP SCHEMA \\\"\"+o+\"\\\"') END\":'DROP SCHEMA \"'+o+'\"',n.push(new v.a(u)),i.push(new v.a('CREATE SCHEMA \"'+o+'\"')),n.push(new v.a('USE \"'+s+'\"')),i.push(new v.a('USE \"'+a+'\"')),r.label=3;case 3:return[4,this.executeQueries(n,i)];case 4:return r.sent(),[2]}})})},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),Object(r.b)(this,void 0,void 0,function(){var a,o,s=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return o=[],(a=[]).push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach(function(t){return o.push(s.dropForeignKeySql(e,t))}),i&&e.indices.forEach(function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(e,t))}),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),Object(r.b)(this,void 0,void 0,function(){var a,o,s,u,l,h=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof c.a?(s=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,u=[],l=[],i&&o.indices.forEach(function(e){u.push(h.dropIndexSql(o,e)),l.push(h.createIndexSql(o,e))}),n&&o.foreignKeys.forEach(function(e){return u.push(h.dropForeignKeySql(o,e))}),u.push(this.dropTableSql(o)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(u,l)];case 6:return r.sent(),[2]}})})},t.prototype.createView=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),a=(i=t).push,[4,this.insertViewDefinitionSql(e)];case 1:return a.apply(i,[r.sent()]),n.push(this.dropViewSql(e)),s=(o=n).push,[4,this.deleteViewDefinitionSql(e)];case 2:return s.apply(o,[r.sent()]),[4,this.executeQueries(t,n)];case 3:return r.sent(),[2]}})})},t.prototype.dropView=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c;return Object(r.d)(this,function(r){switch(r.label){case 0:return t=e instanceof m.a?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],s=(o=i=[]).push,[4,this.deleteViewDefinitionSql(n)];case 2:return s.apply(o,[r.sent()]),i.push(this.dropViewSql(n)),c=(u=a).push,[4,this.insertViewDefinitionSql(n)];case 3:return c.apply(u,[r.sent()]),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 4:return r.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u,l,h,p,d,f,m,y,b=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=[],i=[],e instanceof c.a?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return s=(a=o).clone(),u=void 0,l=void 0,h=a.name,3===(p=a.name.split(\".\")).length?(u=p[0],h=p[2],\"\"!==p[1]&&(l=p[1])):2===p.length&&(l=p[0],h=p[1]),s.name=this.driver.buildTableName(t,l,u),[4,this.getCurrentDatabase()];case 4:return d=r.sent(),u&&u!==d&&(n.push(new v.a('USE \"'+u+'\"')),i.push(new v.a('USE \"'+d+'\"'))),n.push(new v.a('EXEC sp_rename \"'+this.escapePath(a,!0)+'\", \"'+t+'\"')),i.push(new v.a('EXEC sp_rename \"'+this.escapePath(s,!0)+'\", \"'+h+'\"')),0<s.primaryColumns.length&&(f=s.primaryColumns.map(function(e){return e.name}),m=this.connection.namingStrategy.primaryKeyName(a,f),y=this.connection.namingStrategy.primaryKeyName(s,f),n.push(new v.a('EXEC sp_rename \"'+this.escapePath(s,!0)+\".\"+m+'\", \"'+y+'\"')),i.push(new v.a('EXEC sp_rename \"'+this.escapePath(s,!0)+\".\"+y+'\", \"'+m+'\"'))),s.uniques.forEach(function(e){var t=b.connection.namingStrategy.uniqueConstraintName(s,e.columnNames);n.push(new v.a('EXEC sp_rename \"'+b.escapePath(s,!0)+\".\"+e.name+'\", \"'+t+'\"')),i.push(new v.a('EXEC sp_rename \"'+b.escapePath(s,!0)+\".\"+t+'\", \"'+e.name+'\"')),e.name=t}),s.indices.forEach(function(e){var t=b.connection.namingStrategy.indexName(s,e.columnNames,e.where);n.push(new v.a('EXEC sp_rename \"'+b.escapePath(s,!0)+\".\"+e.name+'\", \"'+t+'\", \"INDEX\"')),i.push(new v.a('EXEC sp_rename \"'+b.escapePath(s,!0)+\".\"+t+'\", \"'+e.name+'\", \"INDEX\"')),e.name=t}),s.foreignKeys.forEach(function(e){var t=b.connection.namingStrategy.foreignKeyName(s,e.columnNames,e.referencedTableName,e.referencedColumnNames);n.push(new v.a('EXEC sp_rename \"'+b.buildForeignKeyName(e.name,l,u)+'\", \"'+t+'\"')),i.push(new v.a('EXEC sp_rename \"'+b.buildForeignKeyName(t,l,u)+'\", \"'+e.name+'\"')),e.name=t}),u&&u!==d&&(n.push(new v.a('USE \"'+d+'\"')),i.push(new v.a('USE \"'+u+'\"'))),[4,this.executeQueries(n,i)];case 5:return r.sent(),a.name=s.name,this.replaceCachedTable(a,s),[2]}})})},t.prototype.addColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u,l,h,p,d,m,y,b;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),s=[],(o=[]).push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+\" ADD \"+this.buildCreateColumnSql(n,t,!1,!0))),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP COLUMN \"'+t.name+'\"')),t.isPrimary&&(0<(u=a.primaryColumns).length&&(l=this.connection.namingStrategy.primaryKeyName(a.name,u.map(function(e){return e.name})),h=u.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),o.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+l+'\"')),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+l+'\" PRIMARY KEY ('+h+\")\"))),u.push(t),p=this.connection.namingStrategy.primaryKeyName(a.name,u.map(function(e){return e.name})),d=u.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),o.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+p+'\" PRIMARY KEY ('+d+\")\")),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+p+'\"'))),(m=a.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))&&(o.push(this.createIndexSql(n,m)),s.push(this.dropIndexSql(n,m))),t.isUnique&&(y=new f.a({name:this.connection.namingStrategy.uniqueConstraintName(n.name,[t.name]),columnNames:[t.name]}),a.uniques.push(y),o.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+y.name+'\" UNIQUE (\"'+t.name+'\")')),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+y.name+'\"'))),null!==t.default&&void 0!==t.default&&(b=this.connection.namingStrategy.defaultConstraintName(n.name,t.name),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+b+'\"'))),[4,this.executeQueries(o,s)];case 4:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}})})},t.prototype.addColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u;return Object(r.d)(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=Object(r.g)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.addColumn(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}})})},t.prototype.renameColumn=function(e,t,n){return Object(r.b)(this,void 0,void 0,function(){var i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(o=t instanceof h.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+i.name+'\" table.');return s=void 0,n instanceof h.a?s=n:(s=o.clone()).name=n,[4,this.changeColumn(i,o,s)];case 4:return r.sent(),[2]}})})},t.prototype.changeColumn=function(e,t,n){return Object(r.b)(this,void 0,void 0,function(){var i,a,o,s,u,l,p,d,m,y,b,g,E,T,N,O,A,C,w,R,S,M=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(o=(i=a).clone(),s=[],u=[],!(l=t instanceof h.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+i.name+'\" table.');return n.isGenerated!==l.isGenerated&&\"uuid\"!==n.generationStrategy||n.type!==l.type||n.length!==l.length?[4,this.dropColumn(i,l)]:[3,6];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),o=i.clone(),[3,10];case 6:return n.name===l.name?[3,8]:(p=void 0,d=void 0,3===(m=i.name.split(\".\")).length?(p=m[0],\"\"!==m[1]&&(d=m[1])):2===m.length&&(d=m[0]),[4,this.getCurrentDatabase()]);case 7:y=r.sent(),p&&p!==y&&(s.push(new v.a('USE \"'+p+'\"')),u.push(new v.a('USE \"'+y+'\"'))),s.push(new v.a('EXEC sp_rename \"'+this.escapePath(i,!0)+\".\"+l.name+'\", \"'+n.name+'\"')),u.push(new v.a('EXEC sp_rename \"'+this.escapePath(i,!0)+\".\"+n.name+'\", \"'+l.name+'\"')),!0===l.isPrimary&&(O=o.primaryColumns,w=O.map(function(e){return e.name}),b=this.connection.namingStrategy.primaryKeyName(o,w),w.splice(w.indexOf(l.name),1),w.push(n.name),g=this.connection.namingStrategy.primaryKeyName(o,w),s.push(new v.a('EXEC sp_rename \"'+this.escapePath(o,!0)+\".\"+b+'\", \"'+g+'\"')),u.push(new v.a('EXEC sp_rename \"'+this.escapePath(o,!0)+\".\"+g+'\", \"'+b+'\"'))),o.findColumnIndices(l).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=M.connection.namingStrategy.indexName(o,e.columnNames,e.where);s.push(new v.a('EXEC sp_rename \"'+M.escapePath(o,!0)+\".\"+e.name+'\", \"'+t+'\", \"INDEX\"')),u.push(new v.a('EXEC sp_rename \"'+M.escapePath(o,!0)+\".\"+t+'\", \"'+e.name+'\", \"INDEX\"')),e.name=t}),o.findColumnForeignKeys(l).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=M.connection.namingStrategy.foreignKeyName(o,e.columnNames,e.referencedTableName,e.referencedColumnNames);s.push(new v.a('EXEC sp_rename \"'+M.buildForeignKeyName(e.name,d,p)+'\", \"'+t+'\"')),u.push(new v.a('EXEC sp_rename \"'+M.buildForeignKeyName(t,d,p)+'\", \"'+e.name+'\"')),e.name=t}),o.findColumnChecks(l).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=M.connection.namingStrategy.checkConstraintName(o,e.expression);s.push(new v.a('EXEC sp_rename \"'+M.escapePath(o,!0)+\".\"+e.name+'\", \"'+t+'\"')),u.push(new v.a('EXEC sp_rename \"'+M.escapePath(o,!0)+\".\"+t+'\", \"'+e.name+'\"')),e.name=t}),o.findColumnUniques(l).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=M.connection.namingStrategy.uniqueConstraintName(o,e.columnNames);s.push(new v.a('EXEC sp_rename \"'+M.escapePath(o,!0)+\".\"+e.name+'\", \"'+t+'\"')),u.push(new v.a('EXEC sp_rename \"'+M.escapePath(o,!0)+\".\"+t+'\", \"'+e.name+'\"')),e.name=t}),null!==l.default&&void 0!==l.default&&(E=this.connection.namingStrategy.defaultConstraintName(i.name,l.name),T=this.connection.namingStrategy.defaultConstraintName(i.name,n.name),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+E+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+E+'\" DEFAULT '+l.default+' FOR \"'+n.name+'\"')),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+T+'\" DEFAULT '+l.default+' FOR \"'+n.name+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+T+'\"'))),p&&p!==y&&(s.push(new v.a('USE \"'+y+'\"')),u.push(new v.a('USE \"'+p+'\"'))),N=o.columns.find(function(e){return e.name===l.name}),o.columns[o.columns.indexOf(N)].name=n.name,l.name=n.name,r.label=8;case 8:return this.isColumnChanged(l,n,!1)&&(s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+\" ALTER COLUMN \"+this.buildCreateColumnSql(i,n,!0,!1))),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+\" ALTER COLUMN \"+this.buildCreateColumnSql(i,l,!0,!1)))),n.isPrimary!==l.isPrimary&&(0<(O=o.primaryColumns).length&&(C=this.connection.namingStrategy.primaryKeyName(o.name,O.map(function(e){return e.name})),w=O.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+C+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+C+'\" PRIMARY KEY ('+w+\")\"))),!0===n.isPrimary?(O.push(n),o.columns.find(function(e){return e.name===n.name}).isPrimary=!0,C=this.connection.namingStrategy.primaryKeyName(o.name,O.map(function(e){return e.name})),w=O.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+C+'\" PRIMARY KEY ('+w+\")\")),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+C+'\"'))):(A=O.find(function(e){return e.name===n.name}),O.splice(O.indexOf(A),1),o.columns.find(function(e){return e.name===n.name}).isPrimary=!1,0<O.length&&(C=this.connection.namingStrategy.primaryKeyName(o.name,O.map(function(e){return e.name})),w=O.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+C+'\" PRIMARY KEY ('+w+\")\")),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+C+'\"'))))),n.isUnique!==l.isUnique&&(!0===n.isUnique?(R=new f.a({name:this.connection.namingStrategy.uniqueConstraintName(i.name,[n.name]),columnNames:[n.name]}),o.uniques.push(R),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+R.name+'\" UNIQUE (\"'+n.name+'\")')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+R.name+'\"'))):(R=o.uniques.find(function(e){return 1===e.columnNames.length&&!!e.columnNames.find(function(e){return e===n.name})}),o.uniques.splice(o.uniques.indexOf(R),1),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+R.name+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+R.name+'\" UNIQUE (\"'+n.name+'\")')))),n.default!==l.default&&(null!==l.default&&void 0!==l.default&&(S=this.connection.namingStrategy.defaultConstraintName(i.name,l.name),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+S+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+S+'\" DEFAULT '+l.default+' FOR \"'+l.name+'\"'))),null!==n.default&&void 0!==n.default&&(S=this.connection.namingStrategy.defaultConstraintName(i.name,n.name),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+S+'\" DEFAULT '+n.default+' FOR \"'+n.name+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+S+'\"')))),[4,this.executeQueries(s,u)];case 9:r.sent(),this.replaceCachedTable(i,o),r.label=10;case 10:return[2]}})})},t.prototype.changeColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l;return Object(r.d)(this,function(h){switch(h.label){case 0:h.trys.push([0,5,6,7]),n=Object(r.g)(t),i=n.next(),h.label=1;case 1:return i.done?[3,4]:(a=i.value,o=a.oldColumn,s=a.newColumn,[4,this.changeColumn(e,o,s)]);case 2:h.sent(),h.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return u=h.sent(),c={error:u},[3,7];case 6:try{i&&!i.done&&(l=n.return)&&l.call(n)}finally{if(c)throw c.error}return[7];case 7:return[2]}})})},t.prototype.dropColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u,l,p,d,f,m,y,b,g;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof h.a?t:n.findColumnByName(t)))throw new Error('Column \"'+t+'\" was not found in table \"'+n.name+'\"');return o=n.clone(),s=[],u=[],a.isPrimary&&(l=this.connection.namingStrategy.primaryKeyName(o.name,o.primaryColumns.map(function(e){return e.name})),p=o.primaryColumns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(o)+' DROP CONSTRAINT \"'+l+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(o)+' ADD CONSTRAINT \"'+l+'\" PRIMARY KEY ('+p+\")\")),o.findColumnByName(a.name).isPrimary=!1,0<o.primaryColumns.length&&(d=this.connection.namingStrategy.primaryKeyName(o.name,o.primaryColumns.map(function(e){return e.name})),f=o.primaryColumns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(o)+' ADD CONSTRAINT \"'+d+'\" PRIMARY KEY ('+f+\")\")),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(o)+' DROP CONSTRAINT \"'+d+'\"')))),(m=o.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(o.indices.splice(o.indices.indexOf(m),1),s.push(this.dropIndexSql(n,m)),u.push(this.createIndexSql(n,m))),(y=o.checks.find(function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(o.checks.splice(o.checks.indexOf(y),1),s.push(this.dropCheckConstraintSql(n,y)),u.push(this.createCheckConstraintSql(n,y))),(b=o.uniques.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(o.uniques.splice(o.uniques.indexOf(b),1),s.push(this.dropUniqueConstraintSql(n,b)),u.push(this.createUniqueConstraintSql(n,b))),null!==a.default&&void 0!==a.default&&(g=this.connection.namingStrategy.defaultConstraintName(n.name,a.name),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+g+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+g+'\" DEFAULT '+a.default+' FOR \"'+a.name+'\"'))),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP COLUMN \"'+a.name+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+\" ADD \"+this.buildCreateColumnSql(n,a,!1,!1))),[4,this.executeQueries(s,u)];case 4:return r.sent(),o.removeColumn(a),this.replaceCachedTable(n,o),[2]}})})},t.prototype.dropColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u;return Object(r.d)(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=Object(r.g)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.dropColumn(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}})})},t.prototype.createPrimaryKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),s=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,s)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}})})},t.prototype.updatePrimaryKeys=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u,l,h,p,d,f;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=t.map(function(e){return e.name}),s=[],u=[],0<(l=a.primaryColumns).length&&(h=this.connection.namingStrategy.primaryKeyName(a.name,l.map(function(e){return e.name})),p=l.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+h+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+h+'\" PRIMARY KEY ('+p+\")\"))),a.columns.filter(function(e){return-1!==o.indexOf(e.name)}).forEach(function(e){return e.isPrimary=!0}),d=this.connection.namingStrategy.primaryKeyName(a.name,o),f=o.map(function(e){return'\"'+e+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+d+'\" PRIMARY KEY ('+f+\")\")),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+d+'\"')),[4,this.executeQueries(s,u)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}})})},t.prototype.dropPrimaryKey=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map(function(e){return e.name})),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n.name,t.columnNames)),a=this.createUniqueConstraintSql(n,t),o=this.dropUniqueConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addUniqueConstraint(t),[2]}})})},t.prototype.createUniqueConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createUniqueConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof f.a?t:n.uniques.find(function(e){return e.name===t})))throw new Error(\"Supplied unique constraint was not found in table \"+n.name);return o=this.dropUniqueConstraintSql(n,a),s=this.createUniqueConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeUniqueConstraint(a),[2]}})})},t.prototype.dropUniqueConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropUniqueConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createCheckConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof l.a?t:n.checks.find(function(e){return e.name===t})))throw new Error(\"Supplied check constraint was not found in table \"+n.name);return o=this.dropCheckConstraintSql(n,a),s=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SqlServer does not support exclusion constraints.\")})})},t.prototype.createExclusionConstraints=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SqlServer does not support exclusion constraints.\")})})},t.prototype.dropExclusionConstraint=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SqlServer does not support exclusion constraints.\")})})},t.prototype.dropExclusionConstraints=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SqlServer does not support exclusion constraints.\")})})},t.prototype.createForeignKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames,t.referencedTableName,t.referencedColumnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}})})},t.prototype.createForeignKeys=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof p.a?t:n.foreignKeys.find(function(e){return e.name===t})))throw new Error(\"Supplied foreign key was not found in table \"+n.name);return o=this.dropForeignKeySql(n,a),s=this.createForeignKeySql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeForeignKey(a),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createIndex=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}})})},t.prototype.createIndices=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropIndex=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof d.a?t:n.indices.find(function(e){return e.name===t})))throw new Error(\"Supplied index was not found in table \"+n.name);return o=this.dropIndexSql(n,a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}})})},t.prototype.dropIndices=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.clearTable=function(e){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(t){switch(t.label){case 0:return[4,this.query(\"TRUNCATE TABLE \"+this.escapePath(e))];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s=this;return Object(r.d)(this,function(u){switch(u.label){case 0:return e?[4,this.hasDatabase(e)]:[3,2];case 1:if(!u.sent())return[2,Promise.resolve()];u.label=2;case 2:return[4,this.startTransaction()];case 3:u.sent(),u.label=4;case 4:return u.trys.push([4,11,,16]),t=e?'SELECT * FROM \"'+e+'\".\"INFORMATION_SCHEMA\".\"VIEWS\"':'SELECT * FROM \"INFORMATION_SCHEMA\".\"VIEWS\"',[4,this.query(t)];case 5:return n=u.sent(),[4,Promise.all(n.map(function(e){var t='DROP VIEW \"'+e.TABLE_SCHEMA+'\".\"'+e.TABLE_NAME+'\"';return s.query(t)}))];case 6:return u.sent(),i=e?'SELECT * FROM \"'+e+'\".\"INFORMATION_SCHEMA\".\"TABLES\" WHERE \"TABLE_TYPE\" = \\'BASE TABLE\\'':'SELECT * FROM \"INFORMATION_SCHEMA\".\"TABLES\" WHERE \"TABLE_TYPE\" = \\'BASE TABLE\\'',[4,this.query(i)];case 7:return a=u.sent(),[4,Promise.all(a.map(function(e){return Object(r.b)(s,void 0,void 0,function(){var t,n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return t=\"SELECT 'ALTER TABLE \\\"\"+e.TABLE_CATALOG+'\".\"\\' + OBJECT_SCHEMA_NAME(\"fk\".\"parent_object_id\", DB_ID(\\''+e.TABLE_CATALOG+'\\')) + \\'\".\"\\' + OBJECT_NAME(\"fk\".\"parent_object_id\", DB_ID(\\''+e.TABLE_CATALOG+'\\')) + \\'\" DROP CONSTRAINT \"\\' + \"fk\".\"name\" + \\'\"\\' as \"query\" FROM \"'+e.TABLE_CATALOG+'\".\"sys\".\"foreign_keys\" AS \"fk\" WHERE \"fk\".\"referenced_object_id\" = OBJECT_ID(\\'\"'+e.TABLE_CATALOG+'\".\"'+e.TABLE_SCHEMA+'\".\"'+e.TABLE_NAME+\"\\\"')\",[4,this.query(t)];case 1:return n=r.sent(),[2,Promise.all(n.map(function(e){return e.query}).map(function(e){return i.query(e)}))]}})})}))];case 8:return u.sent(),[4,Promise.all(a.map(function(e){if(!e.TABLE_NAME.startsWith(\"#\")){var t='DROP TABLE \"'+e.TABLE_CATALOG+'\".\"'+e.TABLE_SCHEMA+'\".\"'+e.TABLE_NAME+'\"';return s.query(t)}}))];case 9:return u.sent(),[4,this.commitTransaction()];case 10:return u.sent(),[3,16];case 11:o=u.sent(),u.label=12;case 12:return u.trys.push([12,14,,15]),[4,this.rollbackTransaction()];case 13:return u.sent(),[3,15];case 14:return u.sent(),[3,15];case 15:throw o;case 16:return[2]}})})},t.prototype.getCurrentDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:return[4,this.query('SELECT DB_NAME() AS \"db_name\"')];case 1:return[2,e.sent()[0].db_name]}})})},t.prototype.getCurrentSchema=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:return[4,this.query('SELECT SCHEMA_NAME() AS \"schema_name\"')];case 1:return[2,e.sent()[0].schema_name]}})})},t.prototype.loadViews=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s,u=this;return Object(r.d)(this,function(c){switch(c.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return c.sent()?[4,this.getCurrentSchema()]:[2,Promise.resolve([])];case 2:return t=c.sent(),[4,this.getCurrentDatabase()];case 3:return n=c.sent(),i=function(e){var n=Object(r.e)(e.split(\".\"),3),i=n[0],a=n[1],o=n[2];return o?\"\"===a&&(a=u.driver.options.schema||t):a?(o=a,a=i):(o=i,a=u.driver.options.schema||t),[a,o]},a=e.filter(function(e){return 3===e.split(\".\").length}).map(function(e){return e.split(\".\")[0]}),this.driver.database&&!a.find(function(e){return e===u.driver.database})&&a.push(this.driver.database),o=e.map(function(e){var t=Object(r.e)(i(e),2);return'(\"T\".\"SCHEMA\" = \\''+t[0]+'\\' AND \"T\".\"NAME\" = \\''+t[1]+\"')\"}).join(\" OR \"),s=a.map(function(e){return'SELECT \"T\".*, \"V\".\"CHECK_OPTION\" FROM '+u.escapePath(u.getTypeormMetadataTableName())+' \"t\" INNER JOIN \"'+e+'\".\"INFORMATION_SCHEMA\".\"VIEWS\" \"V\" ON \"V\".\"TABLE_SCHEMA\" = \"T\".\"SCHEMA\" AND \"v\".\"TABLE_NAME\" = \"T\".\"NAME\" WHERE \"T\".\"TYPE\" = \\'VIEW\\' '+(o?\"AND (\"+o+\")\":\"\")}).join(\" UNION ALL \"),[4,this.query(s)];case 4:return[2,c.sent().map(function(e){var r=new m.a,i=e.TABLE_CATALOG===n?void 0:e.TABLE_CATALOG,a=e.schema!==t||u.driver.options.schema?e.schema:void 0;return r.name=u.driver.buildTableName(e.name,a,i),r.expression=e.value,r})]}})})},t.prototype.loadTables=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,m,y,v,g,E,T,N,O,A,C,w,R,S,M,j,P=this;return Object(r.d)(this,function(x){switch(x.label){case 0:return e&&e.length?(t=[],[4,this.getCurrentSchema()]):[2,[]];case 1:return n=x.sent(),[4,this.getCurrentDatabase()];case 2:return i=x.sent(),a=function(e){var t=Object(r.e)(e.split(\".\"),3),i=t[0],a=t[1],o=t[2];return o?\"\"===a&&(a=P.driver.options.schema||n):a?(o=a,a=i):(o=i,a=P.driver.options.schema||n),[a,o]},e.filter(function(e){return-1!==e.indexOf(\".\")}).forEach(function(e){3===e.split(\".\").length?\"\"!==e.split(\".\")[1]&&t.push(e.split(\".\")[1]):t.push(e.split(\".\")[0])}),t.push(this.driver.options.schema||n),o=e.filter(function(e){return 3===e.split(\".\").length}).map(function(e){return e.split(\".\")[0]}),this.driver.database&&!o.find(function(e){return e===P.driver.database})&&o.push(this.driver.database),s=t.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),u=e.map(function(e){var t=Object(r.e)(a(e),2);return'(\"TABLE_SCHEMA\" = \\''+t[0]+\"' AND \\\"TABLE_NAME\\\" = '\"+t[1]+\"')\"}).join(\" OR \"),m=o.map(function(e){return'SELECT * FROM \"'+e+'\".\"INFORMATION_SCHEMA\".\"TABLES\" WHERE '+u}).join(\" UNION ALL \"),y=o.map(function(e){return'SELECT * FROM \"'+e+'\".\"INFORMATION_SCHEMA\".\"COLUMNS\" WHERE '+u}).join(\" UNION ALL \"),v=e.map(function(e){var t=Object(r.e)(a(e),2),n=t[0],i=t[1];return'(\"columnUsages\".\"TABLE_SCHEMA\" = \\''+n+'\\' AND \"columnUsages\".\"TABLE_NAME\" = \\''+i+'\\' AND \"tableConstraints\".\"TABLE_SCHEMA\" = \\''+n+'\\' AND \"tableConstraints\".\"TABLE_NAME\" = \\''+i+\"')\"}).join(\" OR \"),g=o.map(function(e){return'SELECT \"columnUsages\".*, \"tableConstraints\".\"CONSTRAINT_TYPE\", \"chk\".\"definition\" FROM \"'+e+'\".\"INFORMATION_SCHEMA\".\"CONSTRAINT_COLUMN_USAGE\" \"columnUsages\" INNER JOIN \"'+e+'\".\"INFORMATION_SCHEMA\".\"TABLE_CONSTRAINTS\" \"tableConstraints\" ON \"tableConstraints\".\"CONSTRAINT_NAME\" = \"columnUsages\".\"CONSTRAINT_NAME\" LEFT JOIN \"'+e+'\".\"sys\".\"check_constraints\" \"chk\" ON \"chk\".\"name\" = \"columnUsages\".\"CONSTRAINT_NAME\" WHERE ('+v+\") AND \\\"tableConstraints\\\".\\\"CONSTRAINT_TYPE\\\" IN ('PRIMARY KEY', 'UNIQUE', 'CHECK')\"}).join(\" UNION ALL \"),E=o.map(function(e){return'SELECT \"fk\".\"name\" AS \"FK_NAME\", \\''+e+'\\' AS \"TABLE_CATALOG\", \"s1\".\"name\" AS \"TABLE_SCHEMA\", \"t1\".\"name\" AS \"TABLE_NAME\", \"col1\".\"name\" AS \"COLUMN_NAME\", \"s2\".\"name\" AS \"REF_SCHEMA\", \"t2\".\"name\" AS \"REF_TABLE\", \"col2\".\"name\" AS \"REF_COLUMN\", \"fk\".\"delete_referential_action_desc\" AS \"ON_DELETE\", \"fk\".\"update_referential_action_desc\" AS \"ON_UPDATE\" FROM \"'+e+'\".\"sys\".\"foreign_keys\" \"fk\" INNER JOIN \"'+e+'\".\"sys\".\"foreign_key_columns\" \"fkc\" ON \"fkc\".\"constraint_object_id\" = \"fk\".\"object_id\" INNER JOIN \"'+e+'\".\"sys\".\"tables\" \"t1\" ON \"t1\".\"object_id\" = \"fk\".\"parent_object_id\" INNER JOIN \"'+e+'\".\"sys\".\"schemas\" \"s1\" ON \"s1\".\"schema_id\" = \"t1\".\"schema_id\" INNER JOIN \"'+e+'\".\"sys\".\"tables\" \"t2\" ON \"t2\".\"object_id\" = \"fk\".\"referenced_object_id\" INNER JOIN \"'+e+'\".\"sys\".\"schemas\" \"s2\" ON \"s2\".\"schema_id\" = \"t2\".\"schema_id\" INNER JOIN \"'+e+'\".\"sys\".\"columns\" \"col1\" ON \"col1\".\"column_id\" = \"fkc\".\"parent_column_id\" AND \"col1\".\"object_id\" = \"fk\".\"parent_object_id\" INNER JOIN \"'+e+'\".\"sys\".\"columns\" \"col2\" ON \"col2\".\"column_id\" = \"fkc\".\"referenced_column_id\" AND \"col2\".\"object_id\" = \"fk\".\"referenced_object_id\"'}).join(\" UNION ALL \"),T=o.map(function(e){return'SELECT \"TABLE_CATALOG\", \"TABLE_SCHEMA\", \"COLUMN_NAME\", \"TABLE_NAME\" FROM \"'+e+'\".\"INFORMATION_SCHEMA\".\"COLUMNS\" WHERE COLUMNPROPERTY(object_id(\"TABLE_CATALOG\" + \\'.\\' + \"TABLE_SCHEMA\" + \\'.\\' + \"TABLE_NAME\"), \"COLUMN_NAME\", \\'IsIdentity\\') = 1 AND \"TABLE_SCHEMA\" IN ('+s+\")\"}).join(\" UNION ALL \"),'SELECT \"NAME\", \"COLLATION_NAME\" FROM \"sys\".\"databases\"',N=o.map(function(e){return\"SELECT '\"+e+'\\' AS \"TABLE_CATALOG\", \"s\".\"name\" AS \"TABLE_SCHEMA\", \"t\".\"name\" AS \"TABLE_NAME\", \"ind\".\"name\" AS \"INDEX_NAME\", \"col\".\"name\" AS \"COLUMN_NAME\", \"ind\".\"is_unique\" AS \"IS_UNIQUE\", \"ind\".\"filter_definition\" as \"CONDITION\" FROM \"'+e+'\".\"sys\".\"indexes\" \"ind\" INNER JOIN \"'+e+'\".\"sys\".\"index_columns\" \"ic\" ON \"ic\".\"object_id\" = \"ind\".\"object_id\" AND \"ic\".\"index_id\" = \"ind\".\"index_id\" INNER JOIN \"'+e+'\".\"sys\".\"columns\" \"col\" ON \"col\".\"object_id\" = \"ic\".\"object_id\" AND \"col\".\"column_id\" = \"ic\".\"column_id\" INNER JOIN \"'+e+'\".\"sys\".\"tables\" \"t\" ON \"t\".\"object_id\" = \"ind\".\"object_id\" INNER JOIN \"'+e+'\".\"sys\".\"schemas\" \"s\" ON \"s\".\"schema_id\" = \"t\".\"schema_id\" WHERE \"ind\".\"is_primary_key\" = 0 AND \"ind\".\"is_unique_constraint\" = 0 AND \"t\".\"is_ms_shipped\" = 0'}).join(\" UNION ALL \"),[4,Promise.all([this.query(m),this.query(y),this.query(g),this.query(E),this.query(T),this.query('SELECT \"NAME\", \"COLLATION_NAME\" FROM \"sys\".\"databases\"'),this.query(N)])];case 3:return O=r.e.apply(void 0,[x.sent(),7]),A=O[0],C=O[1],w=O[2],R=O[3],S=O[4],M=O[5],j=O[6],A.length?[4,Promise.all(A.map(function(e){return Object(r.b)(P,void 0,void 0,function(){var t,a,o,s,u,m,y,v,g,E=this;return Object(r.d)(this,function(){return t=new c.a,a=e.TABLE_CATALOG===i?void 0:e.TABLE_CATALOG,o=e.TABLE_SCHEMA!==n||this.driver.options.schema?e.TABLE_SCHEMA:void 0,t.name=this.driver.buildTableName(e.TABLE_NAME,o,a),s=this.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG),u=M.find(function(t){return t.NAME===e.TABLE_CATALOG}),t.columns=C.filter(function(e){return E.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG)===s}).map(function(e){var n,i,a=w.filter(function(t){return E.driver.buildTableName(t.TABLE_NAME,t.CONSTRAINT_SCHEMA,t.CONSTRAINT_CATALOG)===s&&t.COLUMN_NAME===e.COLUMN_NAME}),o=a.find(function(e){return\"UNIQUE\"===e.CONSTRAINT_TYPE}),c=!!o&&!!w.find(function(t){return\"UNIQUE\"===t.CONSTRAINT_TYPE&&t.CONSTRAINT_NAME===o.CONSTRAINT_NAME&&t.COLUMN_NAME!==e.COLUMN_NAME}),l=!!a.find(function(e){return\"PRIMARY KEY\"===e.CONSTRAINT_TYPE}),p=!!S.find(function(t){return E.driver.buildTableName(t.TABLE_NAME,t.TABLE_SCHEMA,t.TABLE_CATALOG)===s&&t.COLUMN_NAME===e.COLUMN_NAME}),d=new h.a;if(d.name=e.COLUMN_NAME,d.type=e.DATA_TYPE.toLowerCase(),-1!==E.driver.withLengthColumnTypes.indexOf(d.type)&&e.CHARACTER_MAXIMUM_LENGTH){var f=e.CHARACTER_MAXIMUM_LENGTH.toString();d.length=\"-1\"===f?\"MAX\":E.isDefaultColumnLength(t,d,f)?\"\":f}if((\"decimal\"===d.type||\"numeric\"===d.type)&&(null!==e.NUMERIC_PRECISION&&!E.isDefaultColumnPrecision(t,d,e.NUMERIC_PRECISION)&&(d.precision=e.NUMERIC_PRECISION),null!==e.NUMERIC_SCALE&&!E.isDefaultColumnScale(t,d,e.NUMERIC_SCALE)&&(d.scale=e.NUMERIC_SCALE)),\"nvarchar\"===d.type){var m=a.filter(function(e){return\"CHECK\"===e.CONSTRAINT_TYPE});if(m.length){var y=new RegExp(\"^\\\\(\\\\[\"+d.name+\"\\\\]='[^']+'(?: OR \\\\[\"+d.name+\"\\\\]='[^']+')*\\\\)$\");try{for(var b,v=Object(r.g)(m),g=v.next();!g.done;g=v.next())if(b=g.value,y.test(b.definition)){d.type=\"simple-enum\",d.enum=[];for(var T=new RegExp(\"\\\\[\"+d.name+\"\\\\]='([^']+)'\",\"g\"),N=void 0;null!==(N=T.exec(b.definition));)d.enum.unshift(N[1]);break}}catch(e){n={error:e}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}}}return d.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?E.removeParenthesisFromDefault(e.COLUMN_DEFAULT):void 0,d.isNullable=\"YES\"===e.IS_NULLABLE,d.isPrimary=l,d.isUnique=!!o&&!c,d.isGenerated=p,p&&(d.generationStrategy=\"increment\"),\"newsequentialid()\"===d.default&&(d.isGenerated=!0,d.generationStrategy=\"uuid\",d.default=void 0),e.COLLATION_NAME&&(d.collation=e.COLLATION_NAME===u.COLLATION_NAME?void 0:e.COLLATION_NAME),(\"datetime2\"===d.type||\"time\"===d.type||\"datetimeoffset\"===d.type)&&(d.precision=E.isDefaultColumnPrecision(t,d,e.DATETIME_PRECISION)?void 0:e.DATETIME_PRECISION),d}),m=b.a.uniq(w.filter(function(e){return E.driver.buildTableName(e.TABLE_NAME,e.CONSTRAINT_SCHEMA,e.CONSTRAINT_CATALOG)===s&&\"UNIQUE\"===e.CONSTRAINT_TYPE}),function(e){return e.CONSTRAINT_NAME}),t.uniques=m.map(function(e){var t=w.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new f.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME})})}),y=b.a.uniq(w.filter(function(e){return E.driver.buildTableName(e.TABLE_NAME,e.CONSTRAINT_SCHEMA,e.CONSTRAINT_CATALOG)===s&&\"CHECK\"===e.CONSTRAINT_TYPE}),function(e){return e.CONSTRAINT_NAME}),t.checks=y.map(function(e){var t=w.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new l.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),expression:e.definition})}),v=b.a.uniq(R.filter(function(e){return E.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG)===s}),function(e){return e.FK_NAME}),t.foreignKeys=v.map(function(e){var t=R.filter(function(t){return t.FK_NAME===e.FK_NAME}),r=e.TABLE_CATALOG===i?void 0:e.TABLE_CATALOG,a=e.REF_SCHEMA===n?void 0:e.REF_SCHEMA,o=E.driver.buildTableName(e.REF_TABLE,a,r);return new p.a({name:e.FK_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:o,referencedColumnNames:t.map(function(e){return e.REF_COLUMN}),onDelete:e.ON_DELETE.replace(\"_\",\" \"),onUpdate:e.ON_UPDATE.replace(\"_\",\" \")})}),g=b.a.uniq(j.filter(function(e){return E.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG)===s}),function(e){return e.INDEX_NAME}),t.indices=g.map(function(e){var n=j.filter(function(t){return t.TABLE_CATALOG===e.TABLE_CATALOG&&t.TABLE_SCHEMA===e.TABLE_SCHEMA&&t.TABLE_NAME===e.TABLE_NAME&&t.INDEX_NAME===e.INDEX_NAME});return new d.a({table:t,name:e.INDEX_NAME,columnNames:n.map(function(e){return e.COLUMN_NAME}),isUnique:e.IS_UNIQUE,where:e.CONDITION})}),[2,t]})})}))]:[2,[]];case 4:return[2,x.sent()]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map(function(t){return n.buildCreateColumnSql(e,t,!1,!0)}).join(\", \"),i=\"CREATE TABLE \"+this.escapePath(e)+\" (\"+r;(e.columns.filter(function(e){return e.isUnique}).forEach(function(t){e.uniques.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})||e.uniques.push(new f.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))}),0<e.uniques.length)&&(i+=\", \"+e.uniques.map(function(t){return'CONSTRAINT \"'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'\" UNIQUE ('+t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \")+\")\"}).join(\", \"));0<e.checks.length&&(i+=\", \"+e.checks.map(function(t){return'CONSTRAINT \"'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'\" CHECK ('+t.expression+\")\"}).join(\", \"));0<e.foreignKeys.length&&t&&(i+=\", \"+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),a='CONSTRAINT \"'+t.name+'\" FOREIGN KEY ('+r+\") REFERENCES \"+n.escapePath(t.referencedTableName)+\" (\"+i+\")\";return t.onDelete&&(a+=\" ON DELETE \"+t.onDelete),t.onUpdate&&(a+=\" ON UPDATE \"+t.onUpdate),a}).join(\", \"));var a=e.columns.filter(function(e){return e.isPrimary});0<a.length&&(i+=', CONSTRAINT \"'+this.connection.namingStrategy.primaryKeyName(e.name,a.map(function(e){return e.name}))+'\" PRIMARY KEY ('+a.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+\")\");return i+=\")\",new v.a(i)},t.prototype.dropTableSql=function(e,t){var n=t?\"DROP TABLE IF EXISTS \"+this.escapePath(e):\"DROP TABLE \"+this.escapePath(e);return new v.a(n)},t.prototype.createViewSql=function(e){return\"string\"==typeof e.expression?new v.a(\"CREATE VIEW \"+this.escapePath(e)+\" AS \"+e.expression):new v.a(\"CREATE VIEW \"+this.escapePath(e)+\" AS \"+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s;return Object(r.d)(this,function(u){switch(u.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=u.sent(),n=this.parseTableName(e,t),i=\"string\"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),a=Object(r.e)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:\"VIEW\",database:n.database,schema:n.schema,name:n.name,value:i}).getQueryAndParameters(),2),o=a[0],s=a[1],[2,new v.a(o,s)]}})})},t.prototype.dropViewSql=function(e){return new v.a(\"DROP VIEW \"+this.escapePath(e))},t.prototype.deleteViewDefinitionSql=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s;return Object(r.d)(this,function(u){switch(u.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=u.sent(),n=this.parseTableName(e,t),i=this.connection.createQueryBuilder(),a=Object(r.e)(i.delete().from(this.getTypeormMetadataTableName()).where(i.escape(\"type\")+\" = 'VIEW'\").andWhere(i.escape(\"database\")+\" = :database\",{database:n.database}).andWhere(i.escape(\"schema\")+\" = :schema\",{schema:n.schema}).andWhere(i.escape(\"name\")+\" = :name\",{name:n.name}).getQueryAndParameters(),2),o=a[0],s=a[1],[2,new v.a(o,s)]}})})},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");return new v.a(\"CREATE \"+(t.isUnique?\"UNIQUE \":\"\")+'INDEX \"'+t.name+'\" ON '+this.escapePath(e)+\" (\"+n+\") \"+(t.where?\"WHERE \"+t.where:\"\"))},t.prototype.dropIndexSql=function(e,t){var n=t instanceof d.a?t.name:t;return new v.a('DROP INDEX \"'+n+'\" ON '+this.escapePath(e))},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map(function(e){return'\"'+e+'\"'}).join(\", \");return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+n+'\" PRIMARY KEY ('+r+\")\")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map(function(e){return e.name}),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+t.name+'\" UNIQUE ('+n+\")\")},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof f.a?t.name:t;return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.createCheckConstraintSql=function(e,t){return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+t.name+'\" CHECK ('+t.expression+\")\")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof l.a?t.name:t;return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),r=t.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\",\"),i=\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+t.name+'\" FOREIGN KEY ('+n+\") REFERENCES \"+this.escapePath(t.referencedTableName)+\"(\"+r+\")\";return t.onDelete&&(i+=\" ON DELETE \"+t.onDelete),t.onUpdate&&(i+=\" ON UPDATE \"+t.onUpdate),new v.a(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof p.a?t.name:t;return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.escapePath=function(e,t){var n=e instanceof c.a||e instanceof m.a?e.name:e;if(this.driver.options.schema)if(-1===n.indexOf(\".\"))n=this.driver.options.schema+\".\"+n;else if(3===n.split(\".\").length){var r=n.split(\".\"),i=r[0],a=r[2];n=i+\".\"+this.driver.options.schema+\".\"+a}return n.split(\".\").map(function(e){return\"\"===e?e:t?e:'\"'+e+'\"'}).join(\".\")},t.prototype.parseTableName=function(e,t){var n=e instanceof c.a||e instanceof m.a?e.name:e;return 3===n.split(\".\").length?{database:n.split(\".\")[0],schema:\"\"===n.split(\".\")[1]?t||\"SCHEMA_NAME()\":n.split(\".\")[1],name:n.split(\".\")[2]}:2===n.split(\".\").length?{database:this.driver.database,schema:n.split(\".\")[0],name:n.split(\".\")[1]}:{database:this.driver.database,schema:this.driver.options.schema?this.driver.options.schema:t||\"SCHEMA_NAME()\",name:n}},t.prototype.buildForeignKeyName=function(e,t,n){var r=e;return t&&(r=t+\".\"+r),n&&(r=n+\".\"+r),r},t.prototype.removeParenthesisFromDefault=function(e){if(\"(\"!==e.substr(0,1))return e;var t=e.substr(1,e.lastIndexOf(\")\")-1);return this.removeParenthesisFromDefault(t)},t.prototype.buildCreateColumnSql=function(e,t,n,r){var i='\"'+t.name+'\" '+this.connection.driver.createFullType(t);(t.enum&&(i+=\" CHECK( \"+t.name+\" IN (\"+t.enum.map(function(e){return\"'\"+e+\"'\"}).join(\",\")+\") )\"),t.collation&&(i+=\" COLLATE \"+t.collation),!0!==t.isNullable&&(i+=\" NOT NULL\"),!0!==t.isGenerated||\"increment\"!==t.generationStrategy||n||(i+=\" IDENTITY(1,1)\"),void 0!==t.default&&null!==t.default&&r)&&(i+=' CONSTRAINT \"'+this.connection.namingStrategy.defaultConstraintName(e.name,t.name)+'\" DEFAULT '+t.default);t.isGenerated&&\"uuid\"===t.generationStrategy&&!t.default&&(i+=' CONSTRAINT \"'+this.connection.namingStrategy.defaultConstraintName(e.name,t.name)+'\" DEFAULT NEWSEQUENTIALID()');return i},t.prototype.mssqlParameterToNativeParameter=function(e){var t,n,i,a,o,s,u,c,l,h;switch(this.driver.normalizeType({type:e.type})){case\"bit\":return this.driver.mssql.Bit;case\"bigint\":return this.driver.mssql.BigInt;case\"decimal\":return(t=this.driver.mssql).Decimal.apply(t,Object(r.f)(e.params));case\"float\":return this.driver.mssql.Float;case\"int\":return this.driver.mssql.Int;case\"money\":return this.driver.mssql.Money;case\"numeric\":return(n=this.driver.mssql).Numeric.apply(n,Object(r.f)(e.params));case\"smallint\":return this.driver.mssql.SmallInt;case\"smallmoney\":return this.driver.mssql.SmallMoney;case\"real\":return this.driver.mssql.Real;case\"tinyint\":return this.driver.mssql.TinyInt;case\"char\":return(i=this.driver.mssql).Char.apply(i,Object(r.f)(e.params));case\"nchar\":return(a=this.driver.mssql).NChar.apply(a,Object(r.f)(e.params));case\"text\":return this.driver.mssql.Text;case\"ntext\":return this.driver.mssql.Ntext;case\"varchar\":return(o=this.driver.mssql).VarChar.apply(o,Object(r.f)(e.params));case\"nvarchar\":return(s=this.driver.mssql).NVarChar.apply(s,Object(r.f)(e.params));case\"xml\":return this.driver.mssql.Xml;case\"time\":return(u=this.driver.mssql).Time.apply(u,Object(r.f)(e.params));case\"date\":return this.driver.mssql.Date;case\"datetime\":return this.driver.mssql.DateTime;case\"datetime2\":return(c=this.driver.mssql).DateTime2.apply(c,Object(r.f)(e.params));case\"datetimeoffset\":return(l=this.driver.mssql).DateTimeOffset.apply(l,Object(r.f)(e.params));case\"smalldatetime\":return this.driver.mssql.SmallDateTime;case\"uniqueidentifier\":return this.driver.mssql.UniqueIdentifier;case\"variant\":return this.driver.mssql.Variant;case\"binary\":return this.driver.mssql.Binary;case\"varbinary\":return(h=this.driver.mssql).VarBinary.apply(h,Object(r.f)(e.params));case\"image\":return this.driver.mssql.Image;case\"udt\":return this.driver.mssql.UDT;case\"rowversion\":return this.driver.mssql.RowVersion}},t.prototype.convertIsolationLevel=function(e){var t=this.driver.mssql.ISOLATION_LEVEL;switch(e){case\"READ UNCOMMITTED\":return t.READ_UNCOMMITTED;case\"REPEATABLE READ\":return t.REPEATABLE_READ;case\"SERIALIZABLE\":return t.SERIALIZABLE;case\"READ COMMITTED\":default:return t.READ_COMMITTED}},t}(u.a)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return g});var r=n(0),i=n(14),a=n(31),o=n(22),s=n(42),u=n(41),c=n(3),l=n(18),h=n(8),p=n(13),d=n(12),f=n(10),m=n(17),y=n(25),b=n(4),v=n(1),g=function(e){function t(t,n){var r=e.call(this)||this;return r.queryResponsibilityChain=[],r.driver=t,r.connection=t.connection,r.broadcaster=new y.a(r),r.mode=n,r}return Object(r.c)(t,e),t.prototype.connect=function(){return Object(r.b)(this,void 0,void 0,function(){var e;return Object(r.d)(this,function(t){switch(t.label){case 0:return this.databaseConnection?[2,this.databaseConnection]:(e=this,[4,this.driver.obtainMasterConnection()]);case 1:return e.databaseConnection=t.sent(),[2,this.databaseConnection]}})})},t.prototype.release=function(){return this.isReleased=!0,this.databaseConnection?this.driver.master.release(this.databaseConnection):Promise.resolve()},t.prototype.startTransaction=function(e){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(t){switch(t.label){case 0:if(this.isReleased)throw new i.a;if(this.isTransactionActive)throw new a.a;return this.isTransactionActive=!0,e?[4,this.query(\"SET TRANSACTION ISOLATION LEVEL \"+(e||\"\"))]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.commitTransaction=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new i.a;if(!this.isTransactionActive)throw new o.a;return[4,this.query(\"COMMIT\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.rollbackTransaction=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:if(this.isReleased)throw new i.a;if(!this.isTransactionActive)throw new o.a;return[4,this.query(\"ROLLBACK\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.query=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,a,o,u,c=this;return Object(r.d)(this,function(l){switch(l.label){case 0:if(this.isReleased)throw new i.a;return a=new Promise(function(e){return n=e}),this.queryResponsibilityChain.length?(o=Object(r.f)(this.queryResponsibilityChain),this.queryResponsibilityChain.push(a),[4,Promise.all(o)]):[3,2];case 1:l.sent(),l.label=2;case 2:return u=new Promise(function(i,o){return Object(r.b)(c,void 0,void 0,function(){var c,l,h,p,d=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.connect()];case 1:return(c=r.sent()).setAutoCommit(!this.isTransactionActive),this.driver.connection.logger.logQuery(e,t,this),l=+new Date,h=\"INSERT INTO\"===e.substr(0,11),c.prepare(e).exec(t,function(r,p){var f=d.driver.connection.options.maxQueryExecutionTime,m=+new Date-l;f&&m>f&&d.driver.connection.logger.logQuerySlow(m,e,t,d);var y=function(){-1!==b&&d.queryResponsibilityChain.splice(b,1),-1!==v&&d.queryResponsibilityChain.splice(v,1),n()},b=d.queryResponsibilityChain.indexOf(u),v=d.queryResponsibilityChain.indexOf(a);if(r)return d.driver.connection.logger.logQueryError(r,e,t,d),y(),o(new s.c(e,t,r));if(h){var g='SELECT CURRENT_IDENTITY_VALUE() FROM \"SYS\".\"DUMMY\"';d.driver.connection.logger.logQuery(g,[],d),c.exec(g,function(e,t){return e?(d.driver.connection.logger.logQueryError(e,g,[],d),y(),void o(new s.c(g,[],e))):(i(t[0][\"CURRENT_IDENTITY_VALUE()\"]),void y())})}else i(p),y()}),[3,3];case 2:return p=r.sent(),o(p),[3,3];case 3:return[2]}})})}),this.queryResponsibilityChain.push(u),[2,u]}})})},t.prototype.stream=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"Stream is not supported by SAP driver.\")})})},t.prototype.getDatabases=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:return[4,this.query('SELECT DATABASE_NAME FROM \"SYS\".\"M_DATABASES\"')];case 1:return[2,e.sent().map(function(e){return e.DATABASE_NAME})]}})})},t.prototype.getSchemas=function(e){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(n){switch(n.label){case 0:return t=e?'SELECT * FROM \"'+e+'\".\"SYS\".\"SCHEMAS\"':'SELECT * FROM \"SYS\".\"SCHEMAS\"',[4,this.query(t)];case 1:return[2,n.sent().map(function(e){return e.SCHEMA_NAME})]}})})},t.prototype.hasDatabase=function(e){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(t){switch(t.label){case 0:return[4,this.getDatabases()];case 1:return[2,-1!==t.sent().indexOf(e)]}})})},t.prototype.hasSchema=function(e){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(t){switch(t.label){case 0:return[4,this.getSchemas()];case 1:return[2,-1!==t.sent().indexOf(e)]}})})},t.prototype.hasTable=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n;return Object(r.d)(this,function(r){switch(r.label){case 0:return t=this.parseTableName(e),n='SELECT * FROM \"SYS\".\"TABLES\" WHERE \"SCHEMA_NAME\" = '+t.schema+' AND \"TABLE_NAME\" = '+t.tableName,[4,this.query(n)];case 1:return[2,!!r.sent().length]}})})},t.prototype.hasColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=this.parseTableName(e),i='SELECT * FROM \"SYS\".\"TABLE_COLUMNS\" WHERE \"SCHEMA_NAME\" = '+n.schema+' AND \"TABLE_NAME\" = '+n.tableName+' AND \"COLUMN_NAME\" = \\''+t+\"'\",[4,this.query(i)];case 1:return[2,!!r.sent().length]}})})},t.prototype.createDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve()]})})},t.prototype.dropDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve()]})})},t.prototype.createSchema=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=!1,t?[4,this.query('SELECT * FROM \"SYS\".\"SCHEMAS\" WHERE \"SCHEMA_NAME\" = \\''+e+\"'\")]:[3,2];case 1:i=r.sent(),n=!!i.length,r.label=2;case 2:return!t||t&&!n?(a='CREATE SCHEMA \"'+e+'\"',o='DROP SCHEMA \"'+e+'\" CASCADE',[4,this.executeQueries(new v.a(a),new v.a(o))]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},t.prototype.dropSchema=function(e,t,n){return Object(r.b)(this,void 0,void 0,function(){var i,a,o,s,u;return Object(r.d)(this,function(r){switch(r.label){case 0:return i=-1===e.indexOf(\".\")?e:e.split(\".\")[0],a=!1,t?[4,this.query('SELECT * FROM \"SYS\".\"SCHEMAS\" WHERE \"SCHEMA_NAME\" = \\''+i+\"'\")]:[3,2];case 1:o=r.sent(),a=!!o.length,r.label=2;case 2:return!t||t&&a?(s='DROP SCHEMA \"'+i+'\" '+(n?\"CASCADE\":\"\"),u='CREATE SCHEMA \"'+i+'\"',[4,this.executeQueries(new v.a(s),new v.a(u))]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),Object(r.b)(this,void 0,void 0,function(){var a,o,s=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return o=[],(a=[]).push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach(function(t){return o.push(s.dropForeignKeySql(e,t))}),i&&e.indices.forEach(function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(e,t))}),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),Object(r.b)(this,void 0,void 0,function(){var a,o,s,u,l,h=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof c.a?(s=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,u=[],l=[],i&&o.indices.forEach(function(e){u.push(h.dropIndexSql(o,e)),l.push(h.createIndexSql(o,e))}),n&&o.foreignKeys.forEach(function(e){return u.push(h.dropForeignKeySql(o,e))}),u.push(this.dropTableSql(o)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(u,l)];case 6:return r.sent(),[2]}})})},t.prototype.createView=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),a=(i=t).push,[4,this.insertViewDefinitionSql(e)];case 1:return a.apply(i,[r.sent()]),n.push(this.dropViewSql(e)),s=(o=n).push,[4,this.deleteViewDefinitionSql(e)];case 2:return s.apply(o,[r.sent()]),[4,this.executeQueries(t,n)];case 3:return r.sent(),[2]}})})},t.prototype.dropView=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c;return Object(r.d)(this,function(r){switch(r.label){case 0:return t=e instanceof m.a?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],s=(o=i=[]).push,[4,this.deleteViewDefinitionSql(n)];case 2:return s.apply(o,[r.sent()]),i.push(this.dropViewSql(n)),c=(u=a).push,[4,this.insertViewDefinitionSql(n)];case 3:return c.apply(u,[r.sent()]),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 4:return r.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u,l,h,d,f,m,y,b,g,E,T=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=[],i=[],e instanceof c.a?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return s=(a=o).clone(),u=-1===a.name.indexOf(\".\")?a.name:a.name.split(\".\")[1],l=-1===a.name.indexOf(\".\")?void 0:a.name.split(\".\")[0],s.name=l?l+\".\"+t:t,n.push(new v.a(\"RENAME TABLE \"+this.escapePath(a.name)+\" TO \"+this.escapePath(t))),i.push(new v.a(\"RENAME TABLE \"+this.escapePath(s.name)+\" TO \"+this.escapePath(u))),s.foreignKeys.forEach(function(e){n.push(T.dropForeignKeySql(s,e)),i.push(T.createForeignKeySql(s,e))}),h='SELECT * FROM \"SYS\".\"REFERENTIAL_CONSTRAINTS\" WHERE \"REFERENCED_SCHEMA_NAME\" = \\''+l+\"' AND \\\"REFERENCED_TABLE_NAME\\\" = '\"+u+\"'\",[4,this.query(h)];case 4:return d=r.sent(),f=[],m=[],0<d.length&&(f=d.map(function(e){var t=d.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return m.push({tableName:e.SCHEMA_NAME+\".\"+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new p.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:s.name,referencedColumnNames:t.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:\"RESTRICT\"===e.DELETE_RULE?\"NO ACTION\":e.DELETE_RULE,onUpdate:\"RESTRICT\"===e.UPDATE_RULE?\"NO ACTION\":e.UPDATE_RULE})})).forEach(function(e){var t=m.find(function(t){return t.fkName===e.name});n.push(T.dropForeignKeySql(t.tableName,e)),i.push(T.createForeignKeySql(t.tableName,e))}),0<s.primaryColumns.length&&(y=s.primaryColumns.map(function(e){return e.name}),b=y.map(function(e){return'\"'+e+'\"'}).join(\", \"),g=this.connection.namingStrategy.primaryKeyName(a,y),E=this.connection.namingStrategy.primaryKeyName(s,y),n.push(new v.a(\"ALTER TABLE \"+this.escapePath(s)+' DROP CONSTRAINT \"'+g+'\"')),i.push(new v.a(\"ALTER TABLE \"+this.escapePath(s)+' ADD CONSTRAINT \"'+g+'\" PRIMARY KEY ('+b+\")\")),n.push(new v.a(\"ALTER TABLE \"+this.escapePath(s)+' ADD CONSTRAINT \"'+E+'\" PRIMARY KEY ('+b+\")\")),i.push(new v.a(\"ALTER TABLE \"+this.escapePath(s)+' DROP CONSTRAINT \"'+E+'\"'))),s.foreignKeys.forEach(function(e){e.name=T.connection.namingStrategy.foreignKeyName(s,e.columnNames,e.referencedTableName,e.referencedColumnNames),n.push(T.createForeignKeySql(s,e)),i.push(T.dropForeignKeySql(s,e))}),f.forEach(function(e){var t=m.find(function(t){return t.fkName===e.name});n.push(T.createForeignKeySql(t.tableName,e)),i.push(T.dropForeignKeySql(t.tableName,e))}),s.indices.forEach(function(e){var t=T.connection.namingStrategy.indexName(s,e.columnNames,e.where);n.push(T.dropIndexSql(s,e)),i.push(T.createIndexSql(s,e)),e.name=t,n.push(T.createIndexSql(s,e)),i.push(T.dropIndexSql(s,e))}),[4,this.executeQueries(n,i)];case 5:return r.sent(),a.name=s.name,this.replaceCachedTable(a,s),[2]}})})},t.prototype.addColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u,l,h,m,y,b,g,E,T,N,O,A,C=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,a=this.parseTableName(n),o=n.clone(),u=[],(s=[]).push(new v.a(this.addColumnSql(n,t))),u.push(new v.a(this.dropColumnSql(n,t))),t.isPrimary?0<(l=o.primaryColumns).length?(h='SELECT * FROM \"SYS\".\"REFERENTIAL_CONSTRAINTS\" WHERE \"REFERENCED_SCHEMA_NAME\" = '+a.schema+' AND \"REFERENCED_TABLE_NAME\" = '+a.tableName,[4,this.query(h)]):[3,5]:[3,6];case 4:m=r.sent(),y=[],b=[],0<m.length&&(y=m.map(function(e){var t=m.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return b.push({tableName:e.SCHEMA_NAME+\".\"+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new p.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:n.name,referencedColumnNames:t.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:\"RESTRICT\"===e.DELETE_RULE?\"NO ACTION\":e.DELETE_RULE,onUpdate:\"RESTRICT\"===e.UPDATE_RULE?\"NO ACTION\":e.UPDATE_RULE})})).forEach(function(e){var t=b.find(function(t){return t.fkName===e.name});s.push(C.dropForeignKeySql(t.tableName,e)),u.push(C.createForeignKeySql(t.tableName,e))}),g=this.connection.namingStrategy.primaryKeyName(o.name,l.map(function(e){return e.name})),E=l.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+g+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+g+'\" PRIMARY KEY ('+E+\")\")),y.forEach(function(e){var t=b.find(function(t){return t.fkName===e.name});s.push(C.createForeignKeySql(t.tableName,e)),u.push(C.dropForeignKeySql(t.tableName,e))}),r.label=5;case 5:l.push(t),T=this.connection.namingStrategy.primaryKeyName(o.name,l.map(function(e){return e.name})),N=l.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+T+'\" PRIMARY KEY ('+N+\")\")),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+T+'\"')),r.label=6;case 6:return(O=o.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))?(s.push(this.createIndexSql(n,O)),u.push(this.dropIndexSql(n,O))):t.isUnique&&(A=new d.a({name:this.connection.namingStrategy.indexName(n.name,[t.name]),columnNames:[t.name],isUnique:!0}),o.indices.push(A),o.uniques.push(new f.a({name:A.name,columnNames:A.columnNames})),s.push(this.createIndexSql(n,A)),u.push(this.dropIndexSql(n,A))),[4,this.executeQueries(s,u)];case 7:return r.sent(),o.addColumn(t),this.replaceCachedTable(n,o),[2]}})})},t.prototype.addColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u;return Object(r.d)(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=Object(r.g)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.addColumn(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}})})},t.prototype.renameColumn=function(e,t,n){return Object(r.b)(this,void 0,void 0,function(){var i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(o=t instanceof h.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+i.name+'\" table.');return s=void 0,n instanceof h.a?s=n:(s=o.clone()).name=n,[4,this.changeColumn(i,o,s)];case 4:return r.sent(),[2]}})})},t.prototype.changeColumn=function(e,t,n){return Object(r.b)(this,void 0,void 0,function(){var i,a,o,s,u,l,p,m,y,b,g,E,T,N,O,A,C,w=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(o=(i=a).clone(),s=[],u=[],!(l=t instanceof h.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+i.name+'\" table.');return n.isGenerated!==l.isGenerated&&\"uuid\"!==n.generationStrategy||n.type!==l.type||n.length!==l.length?[4,this.dropColumn(i,l)]:[3,6];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),o=i.clone(),[3,8];case 6:return n.name!==l.name&&(s.push(new v.a(\"RENAME COLUMN \"+this.escapePath(i)+'.\"'+l.name+'\" TO \"'+n.name+'\"')),u.push(new v.a(\"RENAME COLUMN \"+this.escapePath(i)+'.\"'+n.name+'\" TO \"'+l.name+'\"')),!0===l.isPrimary&&(g=o.primaryColumns,N=g.map(function(e){return e.name}),p=this.connection.namingStrategy.primaryKeyName(o,N),N.splice(N.indexOf(l.name),1),N.push(n.name),m=N.map(function(e){return'\"'+e+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(o)+' DROP CONSTRAINT \"'+p+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(o)+' ADD CONSTRAINT \"'+p+'\" PRIMARY KEY ('+m+\")\")),y=this.connection.namingStrategy.primaryKeyName(o,N),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(o)+' ADD CONSTRAINT \"'+y+'\" PRIMARY KEY ('+m+\")\")),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(o)+' DROP CONSTRAINT \"'+y+'\"'))),o.findColumnIndices(l).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=w.connection.namingStrategy.indexName(o,e.columnNames,e.where);s.push(w.dropIndexSql(o,e)),u.push(w.createIndexSql(o,e)),e.name=t,s.push(w.createIndexSql(o,e)),u.push(w.dropIndexSql(o,e))}),o.findColumnForeignKeys(l).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=w.connection.namingStrategy.foreignKeyName(o,e.columnNames,e.referencedTableName,e.referencedColumnNames);s.push(w.dropForeignKeySql(o,e)),u.push(w.createForeignKeySql(o,e)),e.name=t,s.push(w.createForeignKeySql(o,e)),u.push(w.dropForeignKeySql(o,e))}),o.findColumnChecks(l).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=w.connection.namingStrategy.checkConstraintName(o,e.expression);s.push(w.dropCheckConstraintSql(o,e)),u.push(w.createCheckConstraintSql(o,e)),e.name=t,s.push(w.createCheckConstraintSql(o,e)),u.push(w.dropCheckConstraintSql(o,e))}),b=o.columns.find(function(e){return e.name===l.name}),o.columns[o.columns.indexOf(b)].name=n.name,l.name=n.name),this.isColumnChanged(l,n)&&(s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+\" ALTER (\"+this.buildCreateColumnSql(n)+\")\")),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+\" ALTER (\"+this.buildCreateColumnSql(l)+\")\"))),n.isPrimary!==l.isPrimary&&(0<(g=o.primaryColumns).length&&(T=this.connection.namingStrategy.primaryKeyName(o.name,g.map(function(e){return e.name})),N=g.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+T+'\"')),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+T+'\" PRIMARY KEY ('+N+\")\"))),!0===n.isPrimary?(g.push(n),o.columns.find(function(e){return e.name===n.name}).isPrimary=!0,T=this.connection.namingStrategy.primaryKeyName(o.name,g.map(function(e){return e.name})),N=g.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+T+'\" PRIMARY KEY ('+N+\")\")),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+T+'\"'))):(E=g.find(function(e){return e.name===n.name}),g.splice(g.indexOf(E),1),o.columns.find(function(e){return e.name===n.name}).isPrimary=!1,0<g.length&&(T=this.connection.namingStrategy.primaryKeyName(o.name,g.map(function(e){return e.name})),N=g.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ADD CONSTRAINT \"'+T+'\" PRIMARY KEY ('+N+\")\")),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' DROP CONSTRAINT \"'+T+'\"'))))),n.isUnique!==l.isUnique&&(!0===n.isUnique?(O=new d.a({name:this.connection.namingStrategy.indexName(i.name,[n.name]),columnNames:[n.name],isUnique:!0}),o.indices.push(O),o.uniques.push(new f.a({name:O.name,columnNames:O.columnNames})),s.push(this.createIndexSql(i,O)),u.push(this.dropIndexSql(i,O))):(A=o.indices.find(function(e){return 1===e.columnNames.length&&!0===e.isUnique&&!!e.columnNames.find(function(e){return e===n.name})}),o.indices.splice(o.indices.indexOf(A),1),C=o.uniques.find(function(e){return e.name===A.name}),o.uniques.splice(o.uniques.indexOf(C),1),s.push(this.dropIndexSql(i,A)),u.push(this.createIndexSql(i,A)))),n.default!==l.default&&(null!==n.default&&void 0!==n.default?(s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ALTER (\"'+n.name+'\" '+this.connection.driver.createFullType(n)+\" DEFAULT \"+n.default+\")\")),null!==l.default&&void 0!==l.default?u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ALTER (\"'+l.name+'\" '+this.connection.driver.createFullType(l)+\" DEFAULT \"+l.default+\")\")):u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ALTER (\"'+l.name+'\" '+this.connection.driver.createFullType(l)+\" DEFAULT NULL)\"))):null!==l.default&&void 0!==l.default&&(s.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ALTER (\"'+n.name+'\" '+this.connection.driver.createFullType(n)+\" DEFAULT NULL)\")),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(i)+' ALTER (\"'+l.name+'\" '+this.connection.driver.createFullType(l)+\" DEFAULT \"+l.default+\")\")))),[4,this.executeQueries(s,u)];case 7:r.sent(),this.replaceCachedTable(i,o),r.label=8;case 8:return[2]}})})},t.prototype.changeColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l;return Object(r.d)(this,function(h){switch(h.label){case 0:h.trys.push([0,5,6,7]),n=Object(r.g)(t),i=n.next(),h.label=1;case 1:return i.done?[3,4]:(a=i.value,o=a.oldColumn,s=a.newColumn,[4,this.changeColumn(e,o,s)]);case 2:h.sent(),h.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return u=h.sent(),c={error:u},[3,7];case 6:try{i&&!i.done&&(l=n.return)&&l.call(n)}finally{if(c)throw c.error}return[7];case 7:return[2]}})})},t.prototype.dropColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u,l,d,f,m,y,b,g,E,T,N,O,A,C,w,R,S=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,a=this.parseTableName(n),!(o=t instanceof h.a?t:n.findColumnByName(t)))throw new Error('Column \"'+t+'\" was not found in table \"'+n.name+'\"');return s=n.clone(),u=[],l=[],o.isPrimary?(d='SELECT * FROM \"SYS\".\"REFERENTIAL_CONSTRAINTS\" WHERE \"REFERENCED_SCHEMA_NAME\" = '+a.schema+' AND \"REFERENCED_TABLE_NAME\" = '+a.tableName,[4,this.query(d)]):[3,5];case 4:f=r.sent(),m=[],y=[],0<f.length&&(m=f.map(function(e){var t=f.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return y.push({tableName:e.SCHEMA_NAME+\".\"+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new p.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:n.name,referencedColumnNames:t.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:\"RESTRICT\"===e.DELETE_RULE?\"NO ACTION\":e.DELETE_RULE,onUpdate:\"RESTRICT\"===e.UPDATE_RULE?\"NO ACTION\":e.UPDATE_RULE})})).forEach(function(e){var t=y.find(function(t){return t.fkName===e.name});u.push(S.dropForeignKeySql(t.tableName,e)),l.push(S.createForeignKeySql(t.tableName,e))}),b=this.connection.namingStrategy.primaryKeyName(s.name,s.primaryColumns.map(function(e){return e.name})),g=s.primaryColumns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(s)+' DROP CONSTRAINT \"'+b+'\"')),l.push(new v.a(\"ALTER TABLE \"+this.escapePath(s)+' ADD CONSTRAINT \"'+b+'\" PRIMARY KEY ('+g+\")\")),s.findColumnByName(o.name).isPrimary=!1,0<s.primaryColumns.length&&(E=this.connection.namingStrategy.primaryKeyName(s.name,s.primaryColumns.map(function(e){return e.name})),T=s.primaryColumns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(s)+' ADD CONSTRAINT \"'+E+'\" PRIMARY KEY ('+T+\")\")),l.push(new v.a(\"ALTER TABLE \"+this.escapePath(s)+' DROP CONSTRAINT \"'+E+'\"'))),m.forEach(function(e){var t=y.find(function(t){return t.fkName===e.name});u.push(S.createForeignKeySql(t.tableName,e)),l.push(S.dropForeignKeySql(t.tableName,e))}),r.label=5;case 5:return(N=s.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===o.name}))?(s.indices.splice(s.indices.indexOf(N),1),u.push(this.dropIndexSql(n,N)),l.push(this.createIndexSql(n,N))):o.isUnique&&(O=this.connection.namingStrategy.uniqueConstraintName(n.name,[o.name]),(A=s.uniques.find(function(e){return e.name===O}))&&(s.uniques.splice(s.uniques.indexOf(A),1),u.push(this.dropIndexSql(n,O)),l.push(new v.a('CREATE UNIQUE INDEX \"'+O+'\" ON '+this.escapePath(n)+' (\"'+o.name+'\")'))),C=this.connection.namingStrategy.indexName(n.name,[o.name]),(w=s.indices.find(function(e){return e.name===C}))&&(s.indices.splice(s.indices.indexOf(w),1),u.push(this.dropIndexSql(n,C)),l.push(new v.a('CREATE UNIQUE INDEX \"'+C+'\" ON '+this.escapePath(n)+' (\"'+o.name+'\")')))),(R=s.checks.find(function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===o.name}))&&(s.checks.splice(s.checks.indexOf(R),1),u.push(this.dropCheckConstraintSql(n,R)),l.push(this.createCheckConstraintSql(n,R))),u.push(new v.a(this.dropColumnSql(n,o))),l.push(new v.a(this.addColumnSql(n,o))),[4,this.executeQueries(u,l)];case 6:return r.sent(),s.removeColumn(o),this.replaceCachedTable(n,s),[2]}})})},t.prototype.dropColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u;return Object(r.d)(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=Object(r.g)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.dropColumn(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}})})},t.prototype.createPrimaryKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),s=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,s)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}})})},t.prototype.updatePrimaryKeys=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u,l,h,d,f,m,y,b,g,E,T,N=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,a=this.parseTableName(n),o=n.clone(),s=t.map(function(e){return e.name}),u=[],l=[],h='SELECT * FROM \"SYS\".\"REFERENTIAL_CONSTRAINTS\" WHERE \"REFERENCED_SCHEMA_NAME\" = '+a.schema+' AND \"REFERENCED_TABLE_NAME\" = '+a.tableName,[4,this.query(h)];case 4:return d=r.sent(),f=[],m=[],0<d.length&&(f=d.map(function(e){var t=d.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return m.push({tableName:e.SCHEMA_NAME+\".\"+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new p.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:n.name,referencedColumnNames:t.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:\"RESTRICT\"===e.DELETE_RULE?\"NO ACTION\":e.DELETE_RULE,onUpdate:\"RESTRICT\"===e.UPDATE_RULE?\"NO ACTION\":e.UPDATE_RULE})})).forEach(function(e){var t=m.find(function(t){return t.fkName===e.name});u.push(N.dropForeignKeySql(t.tableName,e)),l.push(N.createForeignKeySql(t.tableName,e))}),0<(y=o.primaryColumns).length&&(b=this.connection.namingStrategy.primaryKeyName(o.name,y.map(function(e){return e.name})),g=y.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+b+'\"')),l.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+b+'\" PRIMARY KEY ('+g+\")\"))),o.columns.filter(function(e){return-1!==s.indexOf(e.name)}).forEach(function(e){return e.isPrimary=!0}),E=this.connection.namingStrategy.primaryKeyName(o.name,s),T=s.map(function(e){return'\"'+e+'\"'}).join(\", \"),u.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' ADD CONSTRAINT \"'+E+'\" PRIMARY KEY ('+T+\")\")),l.push(new v.a(\"ALTER TABLE \"+this.escapePath(n)+' DROP CONSTRAINT \"'+E+'\"')),f.forEach(function(e){var t=m.find(function(t){return t.fkName===e.name});u.push(N.createForeignKeySql(t.tableName,e)),l.push(N.dropForeignKeySql(t.tableName,e))}),[4,this.executeQueries(u,l)];case 5:return r.sent(),this.replaceCachedTable(n,o),[2]}})})},t.prototype.dropPrimaryKey=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,l,h,d=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.parseTableName(t),a=[],o=[],s='SELECT * FROM \"SYS\".\"REFERENTIAL_CONSTRAINTS\" WHERE \"REFERENCED_SCHEMA_NAME\" = '+i.schema+' AND \"REFERENCED_TABLE_NAME\" = '+i.tableName,[4,this.query(s)];case 4:return u=r.sent(),l=[],h=[],0<u.length&&(l=u.map(function(e){var n=u.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return h.push({tableName:e.SCHEMA_NAME+\".\"+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new p.a({name:e.CONSTRAINT_NAME,columnNames:n.map(function(e){return e.COLUMN_NAME}),referencedTableName:t.name,referencedColumnNames:n.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:\"RESTRICT\"===e.DELETE_RULE?\"NO ACTION\":e.DELETE_RULE,onUpdate:\"RESTRICT\"===e.UPDATE_RULE?\"NO ACTION\":e.UPDATE_RULE})})).forEach(function(e){var t=h.find(function(t){return t.fkName===e.name});a.push(d.dropForeignKeySql(t.tableName,e)),o.push(d.createForeignKeySql(t.tableName,e))}),a.push(this.dropPrimaryKeySql(t)),o.push(this.createPrimaryKeySql(t,t.primaryColumns.map(function(e){return e.name}))),l.forEach(function(e){var t=h.find(function(t){return t.fkName===e.name});a.push(d.createForeignKeySql(t.tableName,e)),o.push(d.dropForeignKeySql(t.tableName,e))}),[4,this.executeQueries(a,o)];case 5:return r.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SAP HANA does not support unique constraints. Use unique index instead.\")})})},t.prototype.createUniqueConstraints=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SAP HANA does not support unique constraints. Use unique index instead.\")})})},t.prototype.dropUniqueConstraint=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SAP HANA does not support unique constraints. Use unique index instead.\")})})},t.prototype.dropUniqueConstraints=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SAP HANA does not support unique constraints. Use unique index instead.\")})})},t.prototype.createCheckConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof l.a?t:n.checks.find(function(e){return e.name===t})))throw new Error(\"Supplied check constraint was not found in table \"+n.name);return o=this.dropCheckConstraintSql(n,a),s=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SAP HANA does not support exclusion constraints.\")})})},t.prototype.createExclusionConstraints=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SAP HANA does not support exclusion constraints.\")})})},t.prototype.dropExclusionConstraint=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SAP HANA does not support exclusion constraints.\")})})},t.prototype.dropExclusionConstraints=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"SAP HANA does not support exclusion constraints.\")})})},t.prototype.createForeignKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames,t.referencedTableName,t.referencedColumnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}})})},t.prototype.createForeignKeys=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof p.a?t:n.foreignKeys.find(function(e){return e.name===t})))throw new Error(\"Supplied foreign key was not found in table \"+n.name);return o=this.dropForeignKeySql(n,a),s=this.createForeignKeySql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeForeignKey(a),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createIndex=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}})})},t.prototype.createIndices=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropIndex=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof d.a?t:n.indices.find(function(e){return e.name===t})))throw new Error(\"Supplied index was not found in table \"+n.name);return o=this.dropIndexSql(n,a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}})})},t.prototype.dropIndices=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.clearTable=function(e){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(t){switch(t.label){case 0:return[4,this.query(\"TRUNCATE TABLE \"+this.escapePath(e))];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i,a,o=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return e=[],this.connection.entityMetadatas.filter(function(e){return e.schema}).forEach(function(t){!!e.find(function(e){return e===t.schema})||e.push(t.schema)}),e.push(this.driver.options.schema||\"current_schema\"),t=e.map(function(e){return\"current_schema\"===e?e:\"'\"+e+\"'\"}).join(\", \"),[4,this.startTransaction()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,6,,11]),n='SELECT \\'DROP TABLE \"\\' || schema_name || \\'\".\"\\' || table_name || \\'\" CASCADE;\\' as \"query\" FROM \"SYS\".\"TABLES\" WHERE \"SCHEMA_NAME\" IN ('+t+\") AND \\\"TABLE_NAME\\\" NOT IN ('SYS_AFL_GENERATOR_PARAMETERS') AND \\\"IS_COLUMN_TABLE\\\" = 'TRUE'\",[4,this.query(n)];case 3:return i=r.sent(),[4,Promise.all(i.map(function(e){return o.query(e.query)}))];case 4:return r.sent(),[4,this.commitTransaction()];case 5:return r.sent(),[3,11];case 6:a=r.sent(),r.label=7;case 7:return r.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:return r.sent(),[3,10];case 9:return r.sent(),[3,10];case 10:throw a;case 11:return[2]}})})},t.prototype.getCurrentDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:return[4,this.query('SELECT \"VALUE\" AS \"db_name\" FROM \"SYS\".\"M_SYSTEM_OVERVIEW\" WHERE \"SECTION\" = \\'System\\' and \"NAME\" = \\'Instance ID\\'')];case 1:return[2,e.sent()[0].db_name]}})})},t.prototype.getCurrentSchema=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:return[4,this.query('SELECT CURRENT_SCHEMA AS \"schema_name\" FROM \"SYS\".\"DUMMY\"')];case 1:return[2,e.sent()[0].schema_name]}})})},t.prototype.loadViews=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a=this;return Object(r.d)(this,function(o){switch(o.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return o.sent()?[4,this.getCurrentSchema()]:[2,Promise.resolve([])];case 2:return t=o.sent(),n=e.map(function(e){var n=Object(r.e)(e.split(\".\"),2),i=n[0],o=n[1];return o||(o=i,i=a.driver.options.schema||t),'(\"t\".\"schema\" = \\''+i+'\\' AND \"t\".\"name\" = \\''+o+\"')\"}).join(\" OR \"),i='SELECT \"t\".* FROM '+this.escapePath(this.getTypeormMetadataTableName())+' \"t\" WHERE \"t\".\"type\" = \\'VIEW\\' '+(n?\"AND (\"+n+\")\":\"\"),[4,this.query(i)];case 3:return[2,o.sent().map(function(e){var n=new m.a,r=e.schema!==t||a.driver.options.schema?e.schema:void 0;return n.name=a.driver.buildTableName(e.name,r),n.expression=e.value,n})]}})})},t.prototype.loadTables=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,f,m,y,v,g,E,T,N,O,A=this;return Object(r.d)(this,function(C){switch(C.label){case 0:return e&&e.length?[4,this.getCurrentSchema()]:[2,[]];case 1:return t=C.sent(),n=e.map(function(e){var n=Object(r.e)(e.split(\".\"),2),i=n[0],a=n[1];return a||(a=i,i=A.driver.options.schema||t),'(\"SCHEMA_NAME\" = \\''+i+\"' AND \\\"TABLE_NAME\\\" = '\"+a+\"')\"}).join(\" OR \"),i='SELECT * FROM \"SYS\".\"TABLES\" WHERE '+n,a='SELECT * FROM \"SYS\".\"TABLE_COLUMNS\" WHERE '+n+' ORDER BY \"POSITION\"',o=e.map(function(e){var n=Object(r.e)(e.split(\".\"),2),i=n[0],a=n[1];return a||(a=i,i=A.driver.options.schema||t),'(\"SCHEMA_NAME\" = \\''+i+\"' AND \\\"TABLE_NAME\\\" = '\"+a+\"')\"}).join(\" OR \"),s='SELECT * FROM \"SYS\".\"CONSTRAINTS\" WHERE ('+o+') ORDER BY \"POSITION\"',u=e.map(function(e){var n=Object(r.e)(e.split(\".\"),2),i=n[0],a=n[1];return a||(a=i,i=A.driver.options.schema||t),'(\"I\".\"SCHEMA_NAME\" = \\''+i+'\\' AND \"I\".\"TABLE_NAME\" = \\''+a+\"')\"}).join(\" OR \"),f='SELECT \"I\".\"INDEX_TYPE\", \"I\".\"SCHEMA_NAME\", \"I\".\"TABLE_NAME\", \"I\".\"INDEX_NAME\", \"IC\".\"COLUMN_NAME\", \"I\".\"CONSTRAINT\" FROM \"SYS\".\"INDEXES\" \"I\" INNER JOIN \"SYS\".\"INDEX_COLUMNS\" \"IC\" ON \"IC\".\"INDEX_OID\" = \"I\".\"INDEX_OID\" WHERE ('+u+') AND (\"I\".\"CONSTRAINT\" IS NULL OR \"I\".\"CONSTRAINT\" != \\'PRIMARY KEY\\') AND \"I\".\"INDEX_NAME\" NOT LIKE \\'%_SYS_FULLTEXT_%\\' ORDER BY \"IC\".\"POSITION\"',m=e.map(function(e){var n=Object(r.e)(e.split(\".\"),2),i=n[0],a=n[1];return a||(a=i,i=A.driver.options.schema||t),'(\"SCHEMA_NAME\" = \\''+i+\"' AND \\\"TABLE_NAME\\\" = '\"+a+\"')\"}).join(\" OR \"),y='SELECT * FROM \"SYS\".\"REFERENTIAL_CONSTRAINTS\" WHERE ('+m+') ORDER BY \"POSITION\"',[4,Promise.all([this.query(i),this.query(a),this.query(s),this.query(f),this.query(y)])];case 2:return v=r.e.apply(void 0,[C.sent(),5]),g=v[0],E=v[1],T=v[2],N=v[3],O=v[4],g.length?[2,Promise.all(g.map(function(e){return Object(r.b)(A,void 0,void 0,function(){var n,i,a,o,s,u,f,m=this;return Object(r.d)(this,function(y){switch(y.label){case 0:return n=new c.a,i=e.SCHEMA_NAME!==t||this.driver.options.schema?e.SCHEMA_NAME:void 0,n.name=this.driver.buildTableName(e.TABLE_NAME,i),a=this.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME),o=n,[4,Promise.all(E.filter(function(e){return m.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a}).map(function(e){return Object(r.b)(m,void 0,void 0,function(){var t,i,o,s,u,c,l,p=this;return Object(r.d)(this,function(){return t=T.filter(function(t){return p.driver.buildTableName(t.TABLE_NAME,t.SCHEMA_NAME)===a&&t.COLUMN_NAME===e.COLUMN_NAME}),i=N.find(function(t){return p.driver.buildTableName(t.TABLE_NAME,t.SCHEMA_NAME)===a&&t.COLUMN_NAME===e.COLUMN_NAME&&t.CONSTRAINT&&-1!==t.CONSTRAINT.indexOf(\"UNIQUE\")}),o=this.connection.entityMetadatas.find(function(e){return e.tablePath===n.name}),s=i&&o&&o.indices.some(function(e){return e.name===i.INDEX_NAME&&!1===e.synchronize}),u=!!i&&!!N.find(function(t){return t.INDEX_NAME===i.INDEX_NAME&&t.COLUMN_NAME!==e.COLUMN_NAME}),(c=new h.a).name=e.COLUMN_NAME,c.type=e.DATA_TYPE_NAME.toLowerCase(),(\"dec\"===c.type||\"decimal\"===c.type)&&(null===e.LENGTH||this.isDefaultColumnPrecision(n,c,e.LENGTH)?null!==e.SCALE&&!this.isDefaultColumnScale(n,c,e.SCALE)&&(c.precision=void 0):c.precision=e.LENGTH,null===e.SCALE||this.isDefaultColumnScale(n,c,e.SCALE)?null!==e.LENGTH&&!this.isDefaultColumnPrecision(n,c,e.LENGTH)&&(c.scale=void 0):c.scale=e.SCALE),\"array\"===e.DATA_TYPE_NAME.toLowerCase()&&(c.isArray=!0,c.type=e.CS_DATA_TYPE_NAME.toLowerCase()),-1!==this.driver.withLengthColumnTypes.indexOf(c.type)&&e.LENGTH&&(l=e.LENGTH.toString(),c.length=this.isDefaultColumnLength(n,c,l)?\"\":l),c.isUnique=!!i&&!s&&!u,c.isNullable=\"TRUE\"===e.IS_NULLABLE,c.isPrimary=!!t.find(function(e){return\"TRUE\"===e.IS_PRIMARY_KEY}),c.isGenerated=\"ALWAYS AS IDENTITY\"===e.GENERATION_TYPE,c.isGenerated&&(c.generationStrategy=\"increment\"),c.default=null===e.DEFAULT_VALUE||void 0===e.DEFAULT_VALUE?void 0:\"char\"===c.type||\"nchar\"===c.type||\"varchar\"===c.type||\"nvarchar\"===c.type||\"alphanum\"===c.type||\"shorttext\"===c.type?\"'\"+e.DEFAULT_VALUE+\"'\":\"boolean\"===c.type?\"1\"===e.DEFAULT_VALUE?\"true\":\"false\":e.DEFAULT_VALUE,c.comment=\"\",e.character_set_name&&(c.charset=e.character_set_name),e.collation_name&&(c.collation=e.collation_name),[2,c]})})}))];case 1:return o.columns=y.sent(),s=b.a.uniq(T.filter(function(e){return m.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a&&null!==e.CHECK_CONDITION&&void 0!==e.CHECK_CONDITION}),function(e){return e.CONSTRAINT_NAME}),n.checks=s.map(function(e){var t=T.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new l.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),expression:e.CHECK_CONDITION})}),u=b.a.uniq(O.filter(function(e){return m.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a}),function(e){return e.CONSTRAINT_NAME}),n.foreignKeys=u.map(function(e){var n=O.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}),r=e.REFERENCED_SCHEMA_NAME===t?void 0:e.REFERENCED_SCHEMA_NAME,i=m.driver.buildTableName(e.REFERENCED_TABLE_NAME,r);return new p.a({name:e.CONSTRAINT_NAME,columnNames:n.map(function(e){return e.COLUMN_NAME}),referencedTableName:i,referencedColumnNames:n.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:\"RESTRICT\"===e.DELETE_RULE?\"NO ACTION\":e.DELETE_RULE,onUpdate:\"RESTRICT\"===e.UPDATE_RULE?\"NO ACTION\":e.UPDATE_RULE})}),f=b.a.uniq(N.filter(function(e){return m.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a}),function(e){return e.INDEX_NAME}),n.indices=f.map(function(e){var t=N.filter(function(t){return t.SCHEMA_NAME===e.SCHEMA_NAME&&t.TABLE_NAME===e.TABLE_NAME&&t.INDEX_NAME===e.INDEX_NAME});return new d.a({table:n,name:e.INDEX_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),isUnique:e.CONSTRAINT&&-1!==e.CONSTRAINT.indexOf(\"UNIQUE\"),isFulltext:\"FULLTEXT\"===e.INDEX_TYPE})}),[2,n]}})})}))]:[2,[]]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map(function(e){return n.buildCreateColumnSql(e)}).join(\", \"),i=\"CREATE TABLE \"+this.escapePath(e)+\" (\"+r;(e.columns.filter(function(e){return e.isUnique}).forEach(function(t){var r=e.indices.some(function(e){return 1===e.columnNames.length&&!!e.isUnique&&-1!==e.columnNames.indexOf(t.name)}),i=e.uniques.some(function(e){return 1===e.columnNames.length&&-1!==e.columnNames.indexOf(t.name)});r||i||e.indices.push(new d.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name],isUnique:!0}))}),0<e.uniques.length&&e.uniques.forEach(function(t){e.indices.some(function(e){return e.name===t.name})||e.indices.push(new d.a({name:t.name,columnNames:t.columnNames,isUnique:!0}))}),0<e.checks.length)&&(i+=\", \"+e.checks.map(function(t){return'CONSTRAINT \"'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'\" CHECK ('+t.expression+\")\"}).join(\", \"));0<e.foreignKeys.length&&t&&(i+=\", \"+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),a='CONSTRAINT \"'+t.name+'\" FOREIGN KEY ('+r+\") REFERENCES \"+n.escapePath(t.referencedTableName)+\" (\"+i+\")\";t.onDelete&&(a+=\" ON DELETE \"+(\"NO ACTION\"===t.onDelete?\"RESTRICT\":t.onDelete));t.onUpdate&&(a+=\" ON UPDATE \"+(\"NO ACTION\"===t.onUpdate?\"RESTRICT\":t.onUpdate));return a}).join(\", \"));var a=e.columns.filter(function(e){return e.isPrimary});0<a.length&&(i+=', CONSTRAINT \"'+this.connection.namingStrategy.primaryKeyName(e.name,a.map(function(e){return e.name}))+'\" PRIMARY KEY ('+a.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+\")\");return i+=\")\",new v.a(i)},t.prototype.dropTableSql=function(e,t){var n=t?\"DROP TABLE IF EXISTS \"+this.escapePath(e):\"DROP TABLE \"+this.escapePath(e);return new v.a(n)},t.prototype.createViewSql=function(e){return\"string\"==typeof e.expression?new v.a(\"CREATE VIEW \"+this.escapePath(e)+\" AS \"+e.expression):new v.a(\"CREATE VIEW \"+this.escapePath(e)+\" AS \"+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c;return Object(r.d)(this,function(l){switch(l.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=l.sent(),n=e.name.split(\".\"),i=this.driver.options.schema||t,a=e.name,2===n.length&&(i=n[0],a=n[1]),o=\"string\"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),s=Object(r.e)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:\"VIEW\",schema:i,name:a,value:o}).getQueryAndParameters(),2),u=s[0],c=s[1],[2,new v.a(u,c)]}})})},t.prototype.dropViewSql=function(e){return new v.a(\"DROP VIEW \"+this.escapePath(e))},t.prototype.deleteViewDefinitionSql=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,o,s,u,c,l;return Object(r.d)(this,function(h){switch(h.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=h.sent(),n=e instanceof m.a?e.name:e,i=n.split(\".\"),a=this.driver.options.schema||t,o=n,2===i.length&&(a=i[0],o=i[1]),s=this.connection.createQueryBuilder(),u=Object(r.e)(s.delete().from(this.getTypeormMetadataTableName()).where(s.escape(\"type\")+\" = 'VIEW'\").andWhere(s.escape(\"schema\")+\" = :schema\",{schema:a}).andWhere(s.escape(\"name\")+\" = :name\",{name:o}).getQueryAndParameters(),2),c=u[0],l=u[1],[2,new v.a(c,l)]}})})},t.prototype.addColumnSql=function(e,t){return\"ALTER TABLE \"+this.escapePath(e)+\" ADD (\"+this.buildCreateColumnSql(t)+\")\"},t.prototype.dropColumnSql=function(e,t){return\"ALTER TABLE \"+this.escapePath(e)+' DROP (\"'+t.name+'\")'},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),r=\"\";return t.isUnique&&(r+=\"UNIQUE \"),t.isFulltext&&(r+=\"FULLTEXT \"),new v.a(\"CREATE \"+r+'INDEX \"'+t.name+'\" ON '+this.escapePath(e)+\" (\"+n+\") \"+(t.where?\"WHERE \"+t.where:\"\"))},t.prototype.dropIndexSql=function(e,t){var n=t instanceof d.a?t.name:t,r=this.parseTableName(e);return\"current_schema\"===r.schema?new v.a('DROP INDEX \"'+n+'\"'):new v.a('DROP INDEX \"'+r.schema.replace(/'/g,\"\")+'\".\"'+n+'\"')},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map(function(e){return'\"'+e+'\"'}).join(\", \");return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+n+'\" PRIMARY KEY ('+r+\")\")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map(function(e){return e.name}),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.createCheckConstraintSql=function(e,t){return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+t.name+'\" CHECK ('+t.expression+\")\")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof l.a?t.name:t;return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),r=t.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\",\"),i=\"ALTER TABLE \"+this.escapePath(e)+' ADD CONSTRAINT \"'+t.name+'\" FOREIGN KEY ('+n+\") REFERENCES \"+this.escapePath(t.referencedTableName)+\"(\"+r+\")\";t.onDelete&&(i+=\" ON DELETE \"+(\"NO ACTION\"===t.onDelete?\"RESTRICT\":t.onDelete));t.onUpdate&&(i+=\" ON UPDATE \"+(\"NO ACTION\"===t.onUpdate?\"RESTRICT\":t.onUpdate));return new v.a(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof p.a?t.name:t;return new v.a(\"ALTER TABLE \"+this.escapePath(e)+' DROP CONSTRAINT \"'+n+'\"')},t.prototype.escapePath=function(e,t){var n=e instanceof c.a||e instanceof m.a?e.name:e;return(n=-1===n.indexOf(\".\")&&this.driver.options.schema?this.driver.options.schema+\".\"+n:n).split(\".\").map(function(e){return t?e:'\"'+e+'\"'}).join(\".\")},t.prototype.parseTableName=function(e){var t=e instanceof c.a?e.name:e;return-1===t.indexOf(\".\")?{schema:this.driver.options.schema?\"'\"+this.driver.options.schema+\"'\":\"current_schema\",tableName:\"'\"+t+\"'\"}:{schema:\"'\"+t.split(\".\")[0]+\"'\",tableName:\"'\"+t.split(\".\")[1]+\"'\"}},t.prototype.buildForeignKeyName=function(e,t,n){var r=e;return t&&(r=t+\".\"+r),n&&(r=n+\".\"+r),r},t.prototype.removeParenthesisFromDefault=function(e){if(\"(\"!==e.substr(0,1))return e;var t=e.substr(1,e.lastIndexOf(\")\")-1);return this.removeParenthesisFromDefault(t)},t.prototype.buildCreateColumnSql=function(e){var t='\"'+e.name+'\" '+this.connection.driver.createFullType(e);return e.charset&&(t+=\" CHARACTER SET \"+e.charset),e.collation&&(t+=\" COLLATE \"+e.collation),void 0!==e.default&&null!==e.default&&(t+=\" DEFAULT \"+e.default),!0===e.isNullable||e.isGenerated||(t+=\" NOT NULL\"),!0===e.isGenerated&&\"increment\"===e.generationStrategy&&(t+=\" GENERATED ALWAYS AS IDENTITY\"),t},t}(u.a)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return g});var r=n(0),i=n(31),a=n(22),o=n(8),s=n(3),u=n(13),c=n(12),l=n(14),h=n(17),p=n(1),d=n(24),f=n(10),m=n(25),y=n(41),b=n(4),v=n(18),g=function(e){function t(t,n){var r=e.call(this)||this;return r.driver=t,r.connection=t.connection,r.broadcaster=new m.a(r),r.mode=n,r}return Object(r.c)(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):this.databaseConnectionPromise?this.databaseConnectionPromise:(this.databaseConnectionPromise=\"slave\"===this.mode&&this.driver.isReplicated?this.driver.obtainSlaveConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}):this.driver.obtainMasterConnection().then(function(t){return e.databaseConnection=t,e.databaseConnection}),this.databaseConnectionPromise)},t.prototype.release=function(){var e=this;return new Promise(function(t,n){e.isReleased=!0,e.databaseConnection?e.databaseConnection.close(function(e){return e?n(e):void t()}):t()})},t.prototype.startTransaction=function(e){return void 0===e&&(e=\"READ COMMITTED\"),Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(t){switch(t.label){case 0:if(this.isReleased)throw new l.a;if(this.isTransactionActive)throw new i.a;if(\"SERIALIZABLE\"!==e&&\"READ COMMITTED\"!==e)throw new Error(\"Oracle only supports SERIALIZABLE and READ COMMITTED isolation\");return[4,this.query(\"SET TRANSACTION ISOLATION LEVEL \"+e)];case 1:return t.sent(),this.isTransactionActive=!0,[2]}})})},t.prototype.commitTransaction=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query(\"COMMIT\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.rollbackTransaction=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query(\"ROLLBACK\")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}})})},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.a;return new Promise(function(i,a){return Object(r.b)(n,void 0,void 0,function(){var n,o,s,u,c=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(e,t,this),n=+new Date,o=function(r,o){var s=c.driver.connection.options.maxQueryExecutionTime,u=+new Date-n;return s&&u>s&&c.driver.connection.logger.logQuerySlow(u,e,t,c),r?(c.driver.connection.logger.logQueryError(r,e,t,c),a(new d.a(e,t,r))):void i(o.rows||o.outBinds||o.rowsAffected)},s={autoCommit:!this.isTransactionActive},[4,this.connect()];case 1:return r.sent().execute(e,t||{},s,o),[3,3];case 2:return u=r.sent(),a(u),[3,3];case 3:return[2]}})})})},t.prototype.stream=function(){throw new Error(\"Stream is not supported by Oracle driver.\")},t.prototype.getDatabases=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve([])]})})},t.prototype.getSchemas=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve([])]})})},t.prototype.hasDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve(!1)]})})},t.prototype.hasSchema=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve(!1)]})})},t.prototype.hasTable=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n;return Object(r.d)(this,function(r){switch(r.label){case 0:return t=e instanceof s.a?e.name:e,n='SELECT \"TABLE_NAME\" FROM \"USER_TABLES\" WHERE \"TABLE_NAME\" = \\''+t+\"'\",[4,this.query(n)];case 1:return[2,!!r.sent().length]}})})},t.prototype.hasColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=e instanceof s.a?e.name:e,i='SELECT \"COLUMN_NAME\" FROM \"USER_TAB_COLS\" WHERE \"TABLE_NAME\" = \\''+n+\"' AND \\\"COLUMN_NAME\\\" = '\"+t+\"'\",[4,this.query(i)];case 1:return[2,!!r.sent().length]}})})},t.prototype.createDatabase=function(e){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(t){switch(t.label){case 0:return[4,this.query('CREATE DATABASE IF NOT EXISTS \"'+e+'\"')];case 1:return t.sent(),[2]}})})},t.prototype.dropDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){return[2,Promise.resolve()]})})},t.prototype.createSchema=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"Schema create queries are not supported by Oracle driver.\")})})},t.prototype.dropSchema=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"Schema drop queries are not supported by Oracle driver.\")})})},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),Object(r.b)(this,void 0,void 0,function(){var a,o,s=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return o=[],(a=[]).push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach(function(t){return o.push(s.dropForeignKeySql(e,t))}),i&&e.indices.forEach(function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(t))}),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}})})},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),Object(r.b)(this,void 0,void 0,function(){var a,o,u,c,l,h=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof s.a?(u=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:u=r.sent(),r.label=5;case 5:return o=u,c=[],l=[],i&&o.indices.forEach(function(e){c.push(h.dropIndexSql(e)),l.push(h.createIndexSql(o,e))}),n&&o.foreignKeys.forEach(function(e){return c.push(h.dropForeignKeySql(o,e))}),c.push(this.dropTableSql(o)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(c,l)];case 6:return r.sent(),[2]}})})},t.prototype.createView=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),t.push(this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(this.deleteViewDefinitionSql(e)),[4,this.executeQueries(t,n)];case 1:return r.sent(),[2]}})})},t.prototype.dropView=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return t=e instanceof h.a?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],(i=[]).push(this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),a.push(this.insertViewDefinitionSql(n)),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 2:return r.sent(),[2]}})})},t.prototype.renameTable=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,u,c,l,h,d=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=[],i=[],e instanceof s.a?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return u=(a=o).clone(),t instanceof s.a?u=t:u.name=t,n.push(new p.a('ALTER TABLE \"'+a.name+'\" RENAME TO \"'+u.name+'\"')),i.push(new p.a('ALTER TABLE \"'+u.name+'\" RENAME TO \"'+a.name+'\"')),0<u.primaryColumns.length&&(c=u.primaryColumns.map(function(e){return e.name}),l=this.connection.namingStrategy.primaryKeyName(a,c),h=this.connection.namingStrategy.primaryKeyName(u,c),n.push(new p.a('ALTER TABLE \"'+u.name+'\" RENAME CONSTRAINT \"'+l+'\" TO \"'+h+'\"')),i.push(new p.a('ALTER TABLE \"'+u.name+'\" RENAME CONSTRAINT \"'+h+'\" TO \"'+l+'\"'))),u.uniques.forEach(function(e){var t=d.connection.namingStrategy.uniqueConstraintName(u,e.columnNames);n.push(new p.a('ALTER TABLE \"'+u.name+'\" RENAME CONSTRAINT \"'+e.name+'\" TO \"'+t+'\"')),i.push(new p.a('ALTER TABLE \"'+u.name+'\" RENAME CONSTRAINT \"'+t+'\" TO \"'+e.name+'\"')),e.name=t}),u.indices.forEach(function(e){var t=d.connection.namingStrategy.indexName(u,e.columnNames,e.where);n.push(new p.a('ALTER INDEX \"'+e.name+'\" RENAME TO \"'+t+'\"')),i.push(new p.a('ALTER INDEX \"'+t+'\" RENAME TO \"'+e.name+'\"')),e.name=t}),u.foreignKeys.forEach(function(e){var t=d.connection.namingStrategy.foreignKeyName(u,e.columnNames,e.referencedTableName,e.referencedColumnNames);n.push(new p.a('ALTER TABLE \"'+u.name+'\" RENAME CONSTRAINT \"'+e.name+'\" TO \"'+t+'\"')),i.push(new p.a('ALTER TABLE \"'+u.name+'\" RENAME CONSTRAINT \"'+t+'\" TO \"'+e.name+'\"')),e.name=t}),[4,this.executeQueries(n,i)];case 4:return r.sent(),a.name=u.name,this.replaceCachedTable(a,u),[2]}})})},t.prototype.addColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,u,c,l,h,d,m,y,b;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),u=[],(o=[]).push(new p.a('ALTER TABLE \"'+n.name+'\" ADD '+this.buildCreateColumnSql(t))),u.push(new p.a('ALTER TABLE \"'+n.name+'\" DROP COLUMN \"'+t.name+'\"')),t.isPrimary&&(0<(c=a.primaryColumns).length&&(l=this.connection.namingStrategy.primaryKeyName(a.name,c.map(function(e){return e.name})),h=c.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),o.push(new p.a('ALTER TABLE \"'+n.name+'\" DROP CONSTRAINT \"'+l+'\"')),u.push(new p.a('ALTER TABLE \"'+n.name+'\" ADD CONSTRAINT \"'+l+'\" PRIMARY KEY ('+h+\")\"))),c.push(t),d=this.connection.namingStrategy.primaryKeyName(a.name,c.map(function(e){return e.name})),m=c.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),o.push(new p.a('ALTER TABLE \"'+n.name+'\" ADD CONSTRAINT \"'+d+'\" PRIMARY KEY ('+m+\")\")),u.push(new p.a('ALTER TABLE \"'+n.name+'\" DROP CONSTRAINT \"'+d+'\"'))),(y=a.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))&&(a.indices.splice(a.indices.indexOf(y),1),o.push(this.createIndexSql(n,y)),u.push(this.dropIndexSql(y))),t.isUnique&&(b=new f.a({name:this.connection.namingStrategy.uniqueConstraintName(n.name,[t.name]),columnNames:[t.name]}),a.uniques.push(b),o.push(new p.a('ALTER TABLE \"'+n.name+'\" ADD CONSTRAINT \"'+b.name+'\" UNIQUE (\"'+t.name+'\")')),u.push(new p.a('ALTER TABLE \"'+n.name+'\" DROP CONSTRAINT \"'+b.name+'\"'))),[4,this.executeQueries(o,u)];case 4:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}})})},t.prototype.addColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u;return Object(r.d)(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=Object(r.g)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.addColumn(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}})})},t.prototype.renameColumn=function(e,t,n){return Object(r.b)(this,void 0,void 0,function(){var i,a,u,c;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(u=t instanceof o.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+i.name+'\" table.');return c=void 0,n instanceof o.a?c=n:(c=u.clone()).name=n,[4,this.changeColumn(i,u,c)];case 4:return r.sent(),[2]}})})},t.prototype.changeColumn=function(e,t,n){return Object(r.b)(this,void 0,void 0,function(){var i,a,u,c,l,h,d,m,y,b,v,g,E,T,N,O,A,C,w=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(u=(i=a).clone(),c=[],l=[],!(h=t instanceof o.a?t:i.columns.find(function(e){return e.name===t})))throw new Error('Column \"'+t+'\" was not found in the \"'+i.name+'\" table.');return n.isGenerated!==h.isGenerated&&\"uuid\"!==n.generationStrategy||h.type!==n.type||h.length!==n.length?[4,this.dropColumn(i,h)]:[3,6];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),u=i.clone(),[3,8];case 6:return n.name!==h.name&&(c.push(new p.a('ALTER TABLE \"'+i.name+'\" RENAME COLUMN \"'+h.name+'\" TO \"'+n.name+'\"')),l.push(new p.a('ALTER TABLE \"'+i.name+'\" RENAME COLUMN \"'+n.name+'\" TO \"'+h.name+'\"')),!0===h.isPrimary&&(T=u.primaryColumns,A=T.map(function(e){return e.name}),d=this.connection.namingStrategy.primaryKeyName(u,A),A.splice(A.indexOf(h.name),1),A.push(n.name),m=this.connection.namingStrategy.primaryKeyName(u,A),c.push(new p.a('ALTER TABLE \"'+i.name+'\" RENAME CONSTRAINT \"'+d+'\" TO \"'+m+'\"')),l.push(new p.a('ALTER TABLE \"'+i.name+'\" RENAME CONSTRAINT \"'+m+'\" TO \"'+d+'\"'))),u.findColumnUniques(h).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=w.connection.namingStrategy.uniqueConstraintName(u,e.columnNames);c.push(new p.a('ALTER TABLE \"'+i.name+'\" RENAME CONSTRAINT \"'+e.name+'\" TO \"'+t+'\"')),l.push(new p.a('ALTER TABLE \"'+i.name+'\" RENAME CONSTRAINT \"'+t+'\" TO \"'+e.name+'\"')),e.name=t}),u.findColumnIndices(h).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=w.connection.namingStrategy.indexName(u,e.columnNames,e.where);c.push(new p.a('ALTER INDEX \"'+e.name+'\" RENAME TO \"'+t+'\"')),l.push(new p.a('ALTER INDEX \"'+t+'\" RENAME TO \"'+e.name+'\"')),e.name=t}),u.findColumnForeignKeys(h).forEach(function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=w.connection.namingStrategy.foreignKeyName(u,e.columnNames,e.referencedTableName,e.referencedColumnNames);c.push(new p.a('ALTER TABLE \"'+i.name+'\" RENAME CONSTRAINT \"'+e.name+'\" TO \"'+t+'\"')),l.push(new p.a('ALTER TABLE \"'+i.name+'\" RENAME CONSTRAINT \"'+t+'\" TO \"'+e.name+'\"')),e.name=t}),y=u.columns.find(function(e){return e.name===h.name}),u.columns[u.columns.indexOf(y)].name=n.name,h.name=n.name),this.isColumnChanged(h,n,!0)&&(b=\"\",v=\"\",g=\"\",E=\"\",null!==n.default&&void 0!==n.default?(b=\"DEFAULT \"+n.default,v=null!==h.default&&void 0!==h.default?\"DEFAULT \"+h.default:\"DEFAULT NULL\"):null!==h.default&&void 0!==h.default&&(b=\"DEFAULT NULL\",v=\"DEFAULT \"+h.default),n.isNullable!==h.isNullable&&(!0===n.isNullable?(g=\"NULL\",E=\"NOT NULL\"):(g=\"NOT NULL\",E=\"NULL\")),c.push(new p.a('ALTER TABLE \"'+i.name+'\" MODIFY \"'+h.name+'\" '+this.connection.driver.createFullType(n)+\" \"+b+\" \"+g)),l.push(new p.a('ALTER TABLE \"'+i.name+'\" MODIFY \"'+h.name+'\" '+this.connection.driver.createFullType(h)+\" \"+v+\" \"+E))),n.isPrimary!==h.isPrimary&&(0<(T=u.primaryColumns).length&&(O=this.connection.namingStrategy.primaryKeyName(u.name,T.map(function(e){return e.name})),A=T.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),c.push(new p.a('ALTER TABLE \"'+i.name+'\" DROP CONSTRAINT \"'+O+'\"')),l.push(new p.a('ALTER TABLE \"'+i.name+'\" ADD CONSTRAINT \"'+O+'\" PRIMARY KEY ('+A+\")\"))),!0===n.isPrimary?(T.push(n),u.columns.find(function(e){return e.name===n.name}).isPrimary=!0,O=this.connection.namingStrategy.primaryKeyName(u.name,T.map(function(e){return e.name})),A=T.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),c.push(new p.a('ALTER TABLE \"'+i.name+'\" ADD CONSTRAINT \"'+O+'\" PRIMARY KEY ('+A+\")\")),l.push(new p.a('ALTER TABLE \"'+i.name+'\" DROP CONSTRAINT \"'+O+'\"'))):(N=T.find(function(e){return e.name===n.name}),T.splice(T.indexOf(N),1),u.columns.find(function(e){return e.name===n.name}).isPrimary=!1,0<T.length&&(O=this.connection.namingStrategy.primaryKeyName(u.name,T.map(function(e){return e.name})),A=T.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),c.push(new p.a('ALTER TABLE \"'+i.name+'\" ADD CONSTRAINT \"'+O+'\" PRIMARY KEY ('+A+\")\")),l.push(new p.a('ALTER TABLE \"'+i.name+'\" DROP CONSTRAINT \"'+O+'\"'))))),n.isUnique!==h.isUnique&&(!0===n.isUnique?(C=new f.a({name:this.connection.namingStrategy.uniqueConstraintName(i.name,[n.name]),columnNames:[n.name]}),u.uniques.push(C),c.push(new p.a('ALTER TABLE \"'+i.name+'\" ADD CONSTRAINT \"'+C.name+'\" UNIQUE (\"'+n.name+'\")')),l.push(new p.a('ALTER TABLE \"'+i.name+'\" DROP CONSTRAINT \"'+C.name+'\"'))):(C=u.uniques.find(function(e){return 1===e.columnNames.length&&!!e.columnNames.find(function(e){return e===n.name})}),u.uniques.splice(u.uniques.indexOf(C),1),c.push(new p.a('ALTER TABLE \"'+i.name+'\" DROP CONSTRAINT \"'+C.name+'\"')),l.push(new p.a('ALTER TABLE \"'+i.name+'\" ADD CONSTRAINT \"'+C.name+'\" UNIQUE (\"'+n.name+'\")')))),[4,this.executeQueries(c,l)];case 7:r.sent(),this.replaceCachedTable(i,u),r.label=8;case 8:return[2]}})})},t.prototype.changeColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u,c,l;return Object(r.d)(this,function(h){switch(h.label){case 0:h.trys.push([0,5,6,7]),n=Object(r.g)(t),i=n.next(),h.label=1;case 1:return i.done?[3,4]:(a=i.value,o=a.oldColumn,s=a.newColumn,[4,this.changeColumn(e,o,s)]);case 2:h.sent(),h.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return u=h.sent(),c={error:u},[3,7];case 6:try{i&&!i.done&&(l=n.return)&&l.call(n)}finally{if(c)throw c.error}return[7];case 7:return[2]}})})},t.prototype.dropColumn=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,u,c,l,h,d,f,m,y,b,v;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof o.a?t:n.findColumnByName(t)))throw new Error('Column \"'+t+'\" was not found in table \"'+n.name+'\"');return u=n.clone(),c=[],l=[],a.isPrimary&&(h=this.connection.namingStrategy.primaryKeyName(u.name,u.primaryColumns.map(function(e){return e.name})),d=u.primaryColumns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),c.push(new p.a('ALTER TABLE \"'+u.name+'\" DROP CONSTRAINT \"'+h+'\"')),l.push(new p.a('ALTER TABLE \"'+u.name+'\" ADD CONSTRAINT \"'+h+'\" PRIMARY KEY ('+d+\")\")),u.findColumnByName(a.name).isPrimary=!1,0<u.primaryColumns.length&&(f=this.connection.namingStrategy.primaryKeyName(u.name,u.primaryColumns.map(function(e){return e.name})),m=u.primaryColumns.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),c.push(new p.a('ALTER TABLE \"'+u.name+'\" ADD CONSTRAINT \"'+f+'\" PRIMARY KEY ('+m+\")\")),l.push(new p.a('ALTER TABLE \"'+u.name+'\" DROP CONSTRAINT \"'+f+'\"')))),(y=u.indices.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(c.push(this.dropIndexSql(y)),l.push(this.createIndexSql(n,y))),(b=u.checks.find(function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(u.checks.splice(u.checks.indexOf(b),1),c.push(this.dropCheckConstraintSql(n,b)),l.push(this.createCheckConstraintSql(n,b))),(v=u.uniques.find(function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name}))&&(u.uniques.splice(u.uniques.indexOf(v),1),c.push(this.dropUniqueConstraintSql(n,v)),l.push(this.createUniqueConstraintSql(n,v))),c.push(new p.a('ALTER TABLE \"'+n.name+'\" DROP COLUMN \"'+a.name+'\"')),l.push(new p.a('ALTER TABLE \"'+n.name+'\" ADD '+this.buildCreateColumnSql(a))),[4,this.executeQueries(c,l)];case 4:return r.sent(),u.removeColumn(a),this.replaceCachedTable(n,u),[2]}})})},t.prototype.dropColumns=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,s,u;return Object(r.d)(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),n=Object(r.g)(t),i=n.next(),c.label=1;case 1:return i.done?[3,4]:(a=i.value,[4,this.dropColumn(e,a)]);case 2:c.sent(),c.label=3;case 3:return i=n.next(),[3,1];case 4:return[3,7];case 5:return o=c.sent(),s={error:o},[3,7];case 6:try{i&&!i.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 7:return[2]}})})},t.prototype.createPrimaryKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,u;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach(function(e){t.find(function(t){return t===e.name})&&(e.isPrimary=!0)}),u=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,u)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}})})},t.prototype.updatePrimaryKeys=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,u,c,l,h,d,f,m;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,a=t.map(function(e){return e.name}),o=n.clone(),u=[],c=[],0<(l=o.primaryColumns).length&&(h=this.connection.namingStrategy.primaryKeyName(o.name,l.map(function(e){return e.name})),d=l.map(function(e){return'\"'+e.name+'\"'}).join(\", \"),u.push(new p.a('ALTER TABLE \"'+n.name+'\" DROP CONSTRAINT \"'+h+'\"')),c.push(new p.a('ALTER TABLE \"'+n.name+'\" ADD CONSTRAINT \"'+h+'\" PRIMARY KEY ('+d+\")\"))),o.columns.filter(function(e){return-1!==a.indexOf(e.name)}).forEach(function(e){return e.isPrimary=!0}),f=this.connection.namingStrategy.primaryKeyName(o.name,a),m=a.map(function(e){return'\"'+e+'\"'}).join(\", \"),u.push(new p.a('ALTER TABLE \"'+n.name+'\" ADD CONSTRAINT \"'+f+'\" PRIMARY KEY ('+m+\")\")),c.push(new p.a('ALTER TABLE \"'+n.name+'\" DROP CONSTRAINT \"'+f+'\"')),[4,this.executeQueries(u,c)];case 4:return r.sent(),this.replaceCachedTable(n,o),[2]}})})},t.prototype.dropPrimaryKey=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map(function(e){return e.name})),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach(function(e){e.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n.name,t.columnNames)),a=this.createUniqueConstraintSql(n,t),o=this.dropUniqueConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addUniqueConstraint(t),[2]}})})},t.prototype.createUniqueConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createUniqueConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropUniqueConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,u;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof f.a?t:n.uniques.find(function(e){return e.name===t})))throw new Error(\"Supplied unique constraint was not found in table \"+n.name);return o=this.dropUniqueConstraintSql(n,a),u=this.createUniqueConstraintSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeUniqueConstraint(a),[2]}})})},t.prototype.dropUniqueConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropUniqueConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createCheckConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}})})},t.prototype.createCheckConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,u;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof v.a?t:n.checks.find(function(e){return e.name===t})))throw new Error(\"Supplied check constraint was not found in table \"+n.name);return o=this.dropCheckConstraintSql(n,a),u=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}})})},t.prototype.dropCheckConstraints=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropCheckConstraint(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"Oracle does not support exclusion constraints.\")})})},t.prototype.createExclusionConstraints=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"Oracle does not support exclusion constraints.\")})})},t.prototype.dropExclusionConstraint=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"Oracle does not support exclusion constraints.\")})})},t.prototype.dropExclusionConstraints=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(){throw new Error(\"Oracle does not support exclusion constraints.\")})})},t.prototype.createForeignKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames,t.referencedTableName,t.referencedColumnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}})})},t.prototype.createForeignKeys=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createForeignKey(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,c;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof u.a?t:n.foreignKeys.find(function(e){return e.name===t})))throw new Error(\"Supplied foreign key was not found in table \"+n.name);return o=this.dropForeignKeySql(n,a),c=this.createForeignKeySql(n,a),[4,this.executeQueries(o,c)];case 4:return r.sent(),n.removeForeignKey(a),[2]}})})},t.prototype.dropForeignKeys=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropForeignKey(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.createIndex=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}})})},t.prototype.createIndices=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.createIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.dropIndex=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i,a,o,u;return Object(r.d)(this,function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof c.a?t:n.indices.find(function(e){return e.name===t})))throw new Error(\"Supplied index was not found in table \"+n.name);return o=this.dropIndexSql(a),u=this.createIndexSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeIndex(a),[2]}})})},t.prototype.dropIndices=function(e,t){return Object(r.b)(this,void 0,void 0,function(){var n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return n=t.map(function(t){return i.dropIndex(e,t)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype.clearTable=function(e){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(t){switch(t.label){case 0:return[4,this.query('TRUNCATE TABLE \"'+e+'\"')];case 1:return t.sent(),[2]}})})},t.prototype.clearDatabase=function(){return Object(r.b)(this,void 0,void 0,function(){var e,t,n,i=this;return Object(r.d)(this,function(r){switch(r.label){case 0:return[4,this.startTransaction()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,8,,13]),'SELECT \\'DROP VIEW \"\\' || VIEW_NAME || \\'\"\\' AS \"query\" FROM \"USER_VIEWS\"',[4,this.query('SELECT \\'DROP VIEW \"\\' || VIEW_NAME || \\'\"\\' AS \"query\" FROM \"USER_VIEWS\"')];case 3:return e=r.sent(),[4,Promise.all(e.map(function(e){return i.query(e.query)}))];case 4:return r.sent(),'SELECT \\'DROP TABLE \"\\' || TABLE_NAME || \\'\" CASCADE CONSTRAINTS\\' AS \"query\" FROM \"USER_TABLES\"',[4,this.query('SELECT \\'DROP TABLE \"\\' || TABLE_NAME || \\'\" CASCADE CONSTRAINTS\\' AS \"query\" FROM \"USER_TABLES\"')];case 5:return t=r.sent(),[4,Promise.all(t.map(function(e){return i.query(e.query)}))];case 6:return r.sent(),[4,this.commitTransaction()];case 7:return r.sent(),[3,13];case 8:n=r.sent(),r.label=9;case 9:return r.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return r.sent(),[3,12];case 11:return r.sent(),[3,12];case 12:throw n;case 13:return[2]}})})},t.prototype.loadViews=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n;return Object(r.d)(this,function(r){switch(r.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return r.sent()?(t=e.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),n='SELECT \"T\".* FROM \"'+this.getTypeormMetadataTableName()+'\" \"T\" INNER JOIN \"USER_VIEWS\" \"V\" ON \"V\".\"VIEW_NAME\" = \"T\".\"name\" WHERE \"T\".\"type\" = \\'VIEW\\'',0<t.length&&(n+=' AND \"T\".\"name\" IN ('+t+\")\"),[4,this.query(n)]):[2,Promise.resolve([])];case 2:return[2,r.sent().map(function(e){var t=new h.a;return t.name=e.name,t.expression=e.value,t})]}})})},t.prototype.loadTables=function(e){return Object(r.b)(this,void 0,void 0,function(){var t,n,i,a,l,h,p,d,m,y,g,E,T=this;return Object(r.d)(this,function(N){switch(N.label){case 0:return e&&e.length?(t=e.map(function(e){return\"'\"+e+\"'\"}).join(\", \"),n='SELECT * FROM \"USER_TABLES\" WHERE \"TABLE_NAME\" IN ('+t+\")\",i='SELECT * FROM \"USER_TAB_COLS\" WHERE \"TABLE_NAME\" IN ('+t+\")\",a='SELECT \"IND\".\"INDEX_NAME\", \"IND\".\"TABLE_NAME\", \"IND\".\"UNIQUENESS\", LISTAGG (\"COL\".\"COLUMN_NAME\", \\',\\') WITHIN GROUP (ORDER BY \"COL\".\"COLUMN_NAME\") AS \"COLUMN_NAMES\" FROM \"USER_INDEXES\" \"IND\" INNER JOIN \"USER_IND_COLUMNS\" \"COL\" ON \"COL\".\"INDEX_NAME\" = \"IND\".\"INDEX_NAME\" LEFT JOIN \"USER_CONSTRAINTS\" \"CON\" ON \"CON\".\"CONSTRAINT_NAME\" = \"IND\".\"INDEX_NAME\" WHERE \"IND\".\"TABLE_NAME\" IN ('+t+') AND \"CON\".\"CONSTRAINT_NAME\" IS NULL GROUP BY \"IND\".\"INDEX_NAME\", \"IND\".\"TABLE_NAME\", \"IND\".\"UNIQUENESS\"',l='SELECT \"C\".\"CONSTRAINT_NAME\", \"C\".\"TABLE_NAME\", \"COL\".\"COLUMN_NAME\", \"REF_COL\".\"TABLE_NAME\" AS \"REFERENCED_TABLE_NAME\", \"REF_COL\".\"COLUMN_NAME\" AS \"REFERENCED_COLUMN_NAME\", \"C\".\"DELETE_RULE\" AS \"ON_DELETE\" FROM \"USER_CONSTRAINTS\" \"C\" INNER JOIN \"USER_CONS_COLUMNS\" \"COL\" ON \"COL\".\"OWNER\" = \"C\".\"OWNER\" AND \"COL\".\"CONSTRAINT_NAME\" = \"C\".\"CONSTRAINT_NAME\" INNER JOIN \"USER_CONS_COLUMNS\" \"REF_COL\" ON \"REF_COL\".\"OWNER\" = \"C\".\"R_OWNER\" AND \"REF_COL\".\"CONSTRAINT_NAME\" = \"C\".\"R_CONSTRAINT_NAME\" AND \"REF_COL\".\"POSITION\" = \"COL\".\"POSITION\" WHERE \"C\".\"TABLE_NAME\" IN ('+t+') AND \"C\".\"CONSTRAINT_TYPE\" = \\'R\\'',h='SELECT \"C\".\"CONSTRAINT_NAME\", \"C\".\"CONSTRAINT_TYPE\", \"C\".\"TABLE_NAME\", \"COL\".\"COLUMN_NAME\", \"C\".\"SEARCH_CONDITION\" FROM \"USER_CONSTRAINTS\" \"C\" INNER JOIN \"USER_CONS_COLUMNS\" \"COL\" ON \"COL\".\"OWNER\" = \"C\".\"OWNER\" AND \"COL\".\"CONSTRAINT_NAME\" = \"C\".\"CONSTRAINT_NAME\" WHERE \"C\".\"TABLE_NAME\" IN ('+t+\") AND \\\"C\\\".\\\"CONSTRAINT_TYPE\\\" IN ('C', 'U', 'P') AND \\\"C\\\".\\\"GENERATED\\\" = 'USER NAME'\",[4,Promise.all([this.query(n),this.query(i),this.query(a),this.query(l),this.query(h)])]):[2,[]];case 1:return p=r.e.apply(void 0,[N.sent(),5]),d=p[0],m=p[1],y=p[2],g=p[3],E=p[4],d.length?[2,d.map(function(e){var t=new s.a;t.name=e.TABLE_NAME,t.columns=m.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){var n=E.filter(function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME}),r=n.find(function(e){return\"U\"===e.CONSTRAINT_TYPE}),i=!!r&&!!E.find(function(t){return\"U\"===t.CONSTRAINT_TYPE&&t.CONSTRAINT_NAME===r.CONSTRAINT_NAME&&t.COLUMN_NAME!==e.COLUMN_NAME}),a=!!n.find(function(e){return\"P\"===e.CONSTRAINT_TYPE}),s=new o.a;if(s.name=e.COLUMN_NAME,s.type=e.DATA_TYPE.toLowerCase(),-1!==s.type.indexOf(\"(\")&&(s.type=s.type.replace(/\\([0-9]*\\)/,\"\")),-1!==T.driver.withLengthColumnTypes.indexOf(s.type)){var u=\"raw\"===s.type?e.DATA_LENGTH:e.CHAR_COL_DECL_LENGTH;s.length=u&&!T.isDefaultColumnLength(t,s,u)?u.toString():\"\"}return\"number\"===s.type||\"float\"===s.type?(null!==e.DATA_PRECISION&&!T.isDefaultColumnPrecision(t,s,e.DATA_PRECISION)&&(s.precision=e.DATA_PRECISION),null!==e.DATA_SCALE&&!T.isDefaultColumnScale(t,s,e.DATA_SCALE)&&(s.scale=e.DATA_SCALE)):(\"timestamp\"===s.type||\"timestamp with time zone\"===s.type||\"timestamp with local time zone\"===s.type)&&null!==e.DATA_SCALE&&(s.precision=T.isDefaultColumnPrecision(t,s,e.DATA_SCALE)?void 0:e.DATA_SCALE),s.default=null!==e.DATA_DEFAULT&&void 0!==e.DATA_DEFAULT&&\"NULL\"!==e.DATA_DEFAULT.trim()?s.default=e.DATA_DEFAULT.trim():void 0,s.isNullable=\"Y\"===e.NULLABLE,s.isUnique=!!r&&!i,s.isPrimary=a,s.isGenerated=\"YES\"===e.IDENTITY_COLUMN,s.isGenerated&&(s.generationStrategy=\"increment\",s.default=void 0),s.comment=\"\",s});var n=b.a.uniq(E.filter(function(e){return e.TABLE_NAME===t.name&&\"U\"===e.CONSTRAINT_TYPE}),function(e){return e.CONSTRAINT_NAME});t.uniques=n.map(function(e){var t=E.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new f.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME})})});var r=b.a.uniq(E.filter(function(e){return e.TABLE_NAME===t.name&&\"C\"===e.CONSTRAINT_TYPE}),function(e){return e.CONSTRAINT_NAME});t.checks=r.map(function(e){var t=E.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new v.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),expression:e.SEARCH_CONDITION})});var i=b.a.uniq(g.filter(function(e){return e.TABLE_NAME===t.name}),function(e){return e.CONSTRAINT_NAME});return t.foreignKeys=i.map(function(e){var t=g.filter(function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME});return new u.a({name:e.CONSTRAINT_NAME,columnNames:t.map(function(e){return e.COLUMN_NAME}),referencedTableName:e.REFERENCED_TABLE_NAME,referencedColumnNames:t.map(function(e){return e.REFERENCED_COLUMN_NAME}),onDelete:e.ON_DELETE,onUpdate:\"NO ACTION\"})}),t.indices=y.filter(function(e){return e.TABLE_NAME===t.name}).map(function(e){return new c.a({name:e.INDEX_NAME,columnNames:e.COLUMN_NAMES.split(\",\"),isUnique:\"UNIQUE\"===e.UNIQUENESS})}),t})]:[2,[]]}})})},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map(function(e){return n.buildCreateColumnSql(e)}).join(\", \"),i='CREATE TABLE \"'+e.name+'\" ('+r;(e.columns.filter(function(e){return e.isUnique}).forEach(function(t){e.uniques.some(function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})||e.uniques.push(new f.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))}),0<e.uniques.length)&&(i+=\", \"+e.uniques.map(function(t){return'CONSTRAINT \"'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'\" UNIQUE ('+t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \")+\")\"}).join(\", \"));0<e.checks.length&&(i+=\", \"+e.checks.map(function(t){return'CONSTRAINT \"'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'\" CHECK ('+t.expression+\")\"}).join(\", \"));0<e.foreignKeys.length&&t&&(i+=\", \"+e.foreignKeys.map(function(t){var r=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),a='CONSTRAINT \"'+t.name+'\" FOREIGN KEY ('+r+') REFERENCES \"'+t.referencedTableName+'\" ('+i+\")\";return t.onDelete&&\"NO ACTION\"!==t.onDelete&&(a+=\" ON DELETE \"+t.onDelete),a}).join(\", \"));var a=e.columns.filter(function(e){return e.isPrimary});0<a.length&&(i+=', CONSTRAINT \"'+this.connection.namingStrategy.primaryKeyName(e.name,a.map(function(e){return e.name}))+'\" PRIMARY KEY ('+a.map(function(e){return'\"'+e.name+'\"'}).join(\", \")+\")\");return i+=\")\",new p.a(i)},t.prototype.dropTableSql=function(e,t){var n=e instanceof s.a?e.name:e,r=t?'DROP TABLE IF EXISTS \"'+n+'\"':'DROP TABLE \"'+n+'\"';return new p.a(r)},t.prototype.createViewSql=function(e){var t=e.materialized?\"MATERIALIZED \":\"\";return\"string\"==typeof e.expression?new p.a(\"CREATE \"+t+'VIEW \"'+e.name+'\" AS '+e.expression):new p.a(\"CREATE \"+t+'VIEW \"'+e.name+'\" AS '+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){var t=\"string\"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),n=Object(r.e)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:\"VIEW\",name:e.name,value:t}).getQueryAndParameters(),2),i=n[0],a=n[1];return new p.a(i,a)},t.prototype.dropViewSql=function(e){var t=e instanceof h.a?e.name:e;return new p.a('DROP VIEW \"'+t+'\"')},t.prototype.deleteViewDefinitionSql=function(e){var t=e instanceof h.a?e.name:e,n=this.connection.createQueryBuilder(),i=Object(r.e)(n.delete().from(this.getTypeormMetadataTableName()).where(n.escape(\"type\")+\" = 'VIEW'\").andWhere(n.escape(\"name\")+\" = :name\",{name:t}).getQueryAndParameters(),2),a=i[0],o=i[1];return new p.a(a,o)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");return new p.a(\"CREATE \"+(t.isUnique?\"UNIQUE \":\"\")+'INDEX \"'+t.name+'\" ON \"'+e.name+'\" ('+n+\")\")},t.prototype.dropIndexSql=function(e){var t=e instanceof c.a?e.name:e;return new p.a('DROP INDEX \"'+t+'\"')},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map(function(e){return'\"'+e+'\"'}).join(\", \");return new p.a('ALTER TABLE \"'+e.name+'\" ADD CONSTRAINT \"'+n+'\" PRIMARY KEY ('+r+\")\")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map(function(e){return e.name}),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return new p.a('ALTER TABLE \"'+e.name+'\" DROP CONSTRAINT \"'+n+'\"')},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \");return new p.a('ALTER TABLE \"'+e.name+'\" ADD CONSTRAINT \"'+t.name+'\" UNIQUE ('+n+\")\")},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof f.a?t.name:t;return new p.a('ALTER TABLE \"'+e.name+'\" DROP CONSTRAINT \"'+n+'\"')},t.prototype.createCheckConstraintSql=function(e,t){return new p.a('ALTER TABLE \"'+e.name+'\" ADD CONSTRAINT \"'+t.name+'\" CHECK ('+t.expression+\")\")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof v.a?t.name:t;return new p.a('ALTER TABLE \"'+e.name+'\" DROP CONSTRAINT \"'+n+'\"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map(function(e){return'\"'+e+'\"'}).join(\", \"),r=t.referencedColumnNames.map(function(e){return'\"'+e+'\"'}).join(\",\"),i='ALTER TABLE \"'+e.name+'\" ADD CONSTRAINT \"'+t.name+'\" FOREIGN KEY ('+n+') REFERENCES \"'+t.referencedTableName+'\" ('+r+\")\";return t.onDelete&&\"NO ACTION\"!==t.onDelete&&(i+=\" ON DELETE \"+t.onDelete),new p.a(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof u.a?t.name:t;return new p.a('ALTER TABLE \"'+e.name+'\" DROP CONSTRAINT \"'+n+'\"')},t.prototype.buildCreateColumnSql=function(e){var t='\"'+e.name+'\" '+this.connection.driver.createFullType(e);return e.charset&&(t+=\" CHARACTER SET \"+e.charset),e.collation&&(t+=\" COLLATE \"+e.collation),void 0!==e.default&&null!==e.default&&(t+=\" DEFAULT \"+e.default),!0===e.isNullable||e.isGenerated||(t+=\" NOT NULL\"),!0===e.isGenerated&&\"increment\"===e.generationStrategy&&(t+=\" GENERATED BY DEFAULT AS IDENTITY\"),t},t}(y.a)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return u});var r=n(0),i=n(14),a=n(39),o=n(25),s=n(24),u=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new o.a(n),n}return Object(r.c)(t,e),t.prototype.commitTransaction=function(){return Object(r.b)(this,void 0,void 0,function(){return Object(r.d)(this,function(t){switch(t.label){case 0:return[4,e.prototype.commitTransaction.call(this)];case 1:return t.sent(),[4,this.driver.autoSave()];case 2:return t.sent(),[2]}})})},t.prototype.query=function(e,t){var n=this;if(void 0===t&&(t=[]),this.isReleased)throw new i.a;return new Promise(function(i,a){return Object(r.b)(n,void 0,void 0,function(){var n,o,u,c,l,h,p;return Object(r.d)(this,function(){n=this.driver.databaseConnection,this.driver.connection.logger.logQuery(e,t,this),o=+new Date;try{for(u=n.prepare(e),t&&(t=t.map(function(e){return void 0===e?null:e}),u.bind(t)),c=this.driver.connection.options.maxQueryExecutionTime,l=+new Date,h=l-o,c&&h>c&&this.driver.connection.logger.logQuerySlow(h,e,t,this),p=[];u.step();)p.push(u.getAsObject());u.free(),i(p)}catch(n){u&&u.free(),this.driver.connection.logger.logQueryError(n,e,t,this),a(new s.a(e,t,n))}return[2]})})})},t}(a.a)},function(e,t,n){\"use strict\";(function(e){n.d(t,\"a\",function(){return u});var r=n(0),i=n(15),a=n(79),o=n(33),s=n(29),u=function(t){function n(e){var n=t.call(this,e)||this;if(n.connection=e,n.options=e.options,n.database=n.options.database,n.driver=n.options.driver,!n.options.database)throw new o.a(\"database\");return n.loadDependencies(),n}return Object(r.c)(n,t),n.prototype.disconnect=function(){return Object(r.b)(this,void 0,void 0,function(){var e=this;return Object(r.d)(this,function(){return[2,new Promise(function(t,n){e.queryRunner=void 0,e.databaseConnection.close().then(t).catch(n)})]})})},n.prototype.createQueryRunner=function(){return this.queryRunner||(this.queryRunner=new a.a(this)),this.queryRunner},n.prototype.normalizeType=function(n){return n.type===e?\"blob\":t.prototype.normalizeType.call(this,n)},n.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(t,n){var r=Object.assign({},{readOnly:e.options.readOnly,key:e.options.key,multithreading:e.options.multithreading,migrate:e.options.migrate,iosFlags:e.options.iosFlags,androidFlags:e.options.androidFlags},e.options.extra||{});new e.sqlite(e.options.database,r,function(r,i){return r?n(r):(i.resultType(e.sqlite.RESULTSASOBJECT),void i.execSQL(\"PRAGMA foreign_keys = ON;\",[],function(e){return e?n(e):void t(i)}))})})},n.prototype.loadDependencies=function(){if(this.sqlite=this.driver,!this.driver)throw new s.a(\"Nativescript\",\"nativescript-sqlite\")},n}(i.a)}).call(this,n(38).Buffer)},function(e,t,n){\"use strict\";n.d(t,\"a\",function(){return u});var r=n(0),i=n(14),a=n(24),o=n(39),s=n(25),u=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new s.a(n),n}return Object(r.c)(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new i.a;var r=this.driver.connection;return new Promise(function(i,o){var s=\"INSERT INTO\"===e.substr(0,11),u=function(n,s){var u=r.options.maxQueryExecutionTime,l=+new Date-c;u&&l>u&&r.logger.logQuerySlow(l,e,t,this),n?(r.logger.logQueryError(n,e,t,this),o(new a.a(e,t,n))):i(s)};n.driver.connection.logger.logQuery(e,t,n);var c=+new Date;n.connect().then(function(n){s?n.execSQL(e,t,u):n.all(e,t,u)})})},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map(function(e){return'\"'+e+'\"=?'})},t}(o.a)},function(e,t,n){\"use strict\";(function(e){n.d(t,\"a\",function(){return o});var r=n(0),i=n(4),a=n(16),o=function(){function t(e,t,n,r,i){this.expressionMap=e,this.driver=t,this.rawRelationIdResults=n,this.rawRelationCountResults=r,this.queryRunner=i}return t.prototype.transform=function(e,t){var n=this,r=this.group(e,t),i=[];return r.forEach(function(e){var r=n.transformRawResultsGroup(e,t);void 0!==r&&i.push(r)}),i},t.prototype.group=function(t,n){var i=this,o=new Map,s=[];return\"view\"===n.metadata.tableType?s.push.apply(s,Object(r.f)(n.metadata.columns.map(function(e){return a.a.buildColumnAlias(i.driver,n.name,e.databaseName)}))):s.push.apply(s,Object(r.f)(n.metadata.primaryColumns.map(function(e){return a.a.buildColumnAlias(i.driver,n.name,e.databaseName)}))),t.forEach(function(t){var n=s.map(function(n){var r=t[n];return e.isBuffer(r)?r.toString(\"hex\"):r}).join(\"_\"),r=o.get(n);r?r.push(t):o.set(n,[t])}),o},t.prototype.transformRawResultsGroup=function(e,t){var n=this,r=t.metadata;if(r.discriminatorColumn){var i=e.map(function(e){return e[a.a.buildColumnAlias(n.driver,t.name,t.metadata.discriminatorColumn.databaseName)]}),o=r.childEntityMetadatas.find(function(e){return!!i.find(function(t){return t===e.discriminatorValue})});o&&(r=o)}var s=-1===this.expressionMap.options.indexOf(\"create-pojo\")?r.create(this.queryRunner):{},u=this.transformColumns(e,t,s,r),c=this.transformJoins(e,s,t,r),l=this.transformRelationIds(e,t,s,r),h=this.transformRelationCounts(e,t,s);return u?s:0===r.primaryColumns.filter(function(e){return!1===e.isVirtual}).length&&(c||l||h)?s:void 0},t.prototype.transformColumns=function(e,t,n,r){var i=this,o=!1;return r.columns.forEach(function(s){if(!(0<r.childEntityMetadatas.length&&-1!==r.childEntityMetadatas.map(function(e){return e.target}).indexOf(s.target))){var u=e[0][a.a.buildColumnAlias(i.driver,t.name,s.databaseName)];void 0===u||s.isVirtual||!i.expressionMap.selects.find(function(e){return e.selection===t.name||e.selection===t.name+\".\"+s.propertyPath})||(s.setEntityValue(n,i.driver.prepareHydratedValue(u,s)),null!==u&&(o=!0))}}),o},t.prototype.transformJoins=function(e,t,n,r){var i=this,a=!1;return this.expressionMap.joinAttributes.forEach(function(o){if(o.metadata&&o.isSelected&&(!o.relation||r.relations.find(function(e){return e===o.relation}))){if(o.mapToProperty){if(o.mapToPropertyParentAlias!==n.name)return}else if(!o.relation||o.parentAlias!==n.name||o.relationPropertyPath!==o.relation.propertyPath)return;var s=i.transform(e,o.alias);s=o.isMany?s:s[0],void 0===(s=o.isMany||void 0!==s?s:null)||(o.mapToPropertyPropertyName?t[o.mapToPropertyPropertyName]=s:o.relation.setEntityValue(t,s),a=!0)}}),a},t.prototype.transformRelationIds=function(e,t,n){var r=this,a=!1;return this.rawRelationIdResults.forEach(function(o){if(o.relationIdAttribute.parentAlias===t.name){var s=o.relationIdAttribute.relation,u=r.createValueMapFromJoinColumns(s,o.relationIdAttribute.parentAlias,e);if(null!=u){var c=o.results.map(function(e){var t=r.extractEntityPrimaryIds(s,e);if(!1!==i.a.compareIds(t,u)){var n=s.isManyToOne||s.isOneToOneOwner?s.joinColumns.map(function(e){return e}):s.isOneToMany||s.isOneToOneNotOwner?s.inverseEntityMetadata.primaryColumns.map(function(e){return e}):s.isOwning?s.inverseJoinColumns.map(function(e){return e}):s.inverseRelation.joinColumns.map(function(e){return e}),a=n.reduce(function(t,n){var r=e[n.databaseName];return s.isOneToMany||s.isOneToOneNotOwner?(n.referencedColumn&&(r=n.referencedColumn.createValueMap(r)),i.a.mergeDeep(t,n.createValueMap(r))):(n.referencedColumn.referencedColumn&&(r=n.referencedColumn.referencedColumn.createValueMap(r)),i.a.mergeDeep(t,n.referencedColumn.createValueMap(r)))},{});return 1===n.length&&!1===o.relationIdAttribute.disableMixedMap?s.isOneToMany||s.isOneToOneNotOwner?n[0].getEntityValue(a):n[0].referencedColumn.getEntityValue(a):a}}).filter(function(e){return e}),l=o.relationIdAttribute.mapToPropertyPropertyPath.split(\".\"),h=function(e,t,n){var r=e.shift();return r&&0===e.length?(t[r]=n,t):r&&0<e.length?void h(e,t[r],n):t};s.isOneToOne||s.isManyToOne?void 0!==c[0]&&(h(l,n,c[0]),a=!0):(h(l,n,c),0<c.length&&(a=!0))}}}),a},t.prototype.transformRelationCounts=function(e,t,n){var r=this,i=!1;return this.rawRelationCountResults.filter(function(e){return e.relationCountAttribute.parentAlias===t.name}).forEach(function(o){var s,u=o.relationCountAttribute.relation;s=u.isOneToMany?u.inverseRelation.joinColumns[0].referencedColumn.databaseName:u.isOwning?u.joinColumns[0].referencedColumn.databaseName:u.inverseRelation.joinColumns[0].referencedColumn.databaseName;var c=e[0][a.a.buildColumnAlias(r.driver,t.name,s)];null!=c&&(n[o.relationCountAttribute.mapToPropertyPropertyName]=0,o.results.filter(function(e){return e.parentId===c}).forEach(function(e){n[o.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),i=!0}))}),i},t.prototype.createValueMapFromJoinColumns=function(e,t,n){var r=this;return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(i,o){return n.forEach(function(n){i[o.databaseName]=e.isManyToOne||e.isOneToOneOwner?r.driver.prepareHydratedValue(n[a.a.buildColumnAlias(r.driver,t,o.databaseName)],o):r.driver.prepareHydratedValue(n[a.a.buildColumnAlias(r.driver,t,o.referencedColumn.databaseName)],o)}),i},{})},t.prototype.extractEntityPrimaryIds=function(e,t){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map(function(e){return e}):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map(function(e){return e}):e.isOwning?e.joinColumns.map(function(e){return e}):e.inverseRelation.inverseJoinColumns.map(function(e){return e})).reduce(function(e,n){return e[n.databaseName]=t[n.databaseName],e},{})},t}()}).call(this,n(38).Buffer)},function(e,t,n){\"use strict\";n.r(t);var r=n(42);console.log({getRepository:r.h})},function(e,t,n){(function(e,t){var n;!function(n){!function(e){function r(e,t){return function(n,r){\"function\"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}var i=\"object\"==typeof t?t:\"object\"==typeof self?self:\"object\"==typeof this?this:Function(\"return this;\")(),a=r(n);void 0===i.Reflect?i.Reflect=n:a=r(i.Reflect,a),e(a)}(function(t){function n(e,t,n){var r=_.get(e);if(u(r)){if(!n)return;r=new x,_.set(e,r)}var i=r.get(t);if(u(i)){if(!n)return;i=new x,r.set(t,i)}return i}function r(e,t,r){var i=n(t,r,!1);return!u(i)&&function(e){return!!e}(i.has(e))}function i(e,t,r){var i=n(t,r,!1);return u(i)?void 0:i.get(e)}function a(e,t,r,i){n(r,i,!0).set(e,t)}function o(e,t){var r=[],i=n(e,t,!1);if(u(i))return r;for(var a=function(e){var t=y(e,C);if(!f(t))throw new TypeError;var n=t.call(e);if(!l(n))throw new TypeError;return n}(i.keys()),o=0;;){var s=v(a);if(!s)return r.length=o,r;var c=b(s);try{r[o]=c}catch(t){try{g(a)}finally{throw t}}o++}}function s(e){if(null===e)return 1;switch(typeof e){case\"undefined\":return 0;case\"boolean\":return 2;case\"string\":return 3;case\"symbol\":return 4;case\"number\":return 5;case\"object\":return null===e?1:6;default:return 6}}function u(e){return void 0===e}function c(e){return null===e}function l(e){return\"object\"==typeof e?null!==e:\"function\"==typeof e}function h(e,t){switch(s(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?\"string\":5===t?\"number\":\"default\",r=y(e,A);if(void 0!==r){var i=r.call(e,n);if(l(i))throw new TypeError;return i}return function(e,t){if(\"string\"===t){var n=e.toString;if(f(n)){var r=n.call(e);if(!l(r))return r}var i=e.valueOf;if(f(i)){var r=i.call(e);if(!l(r))return r}}else{var i=e.valueOf;if(f(i)){var r=i.call(e);if(!l(r))return r}var a=e.toString;if(f(a)){var r=a.call(e);if(!l(r))return r}}throw new TypeError}(e,\"default\"==n?\"number\":n)}function p(e){var t=h(e,3);return function(e){return\"symbol\"==typeof e}(t)?t:function(e){return\"\"+e}(t)}function d(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:\"[object Array]\"===Object.prototype.toString.call(e)}function f(e){return\"function\"==typeof e}function m(e){return\"function\"==typeof e}function y(e,t){var n=e[t];if(null!=n){if(!f(n))throw new TypeError;return n}}function b(e){return e.value}function v(e){var t=e.next();return!t.done&&t}function g(e){var t=e.return;t&&t.call(e)}function E(e){var t=Object.getPrototypeOf(e);if(\"function\"!=typeof e||e===j)return t;if(t!==j)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return\"function\"==typeof i?i===e?t:i:t}function T(e){return e.__=void 0,delete e.__,e}var N=Object.prototype.hasOwnProperty,O=\"function\"==typeof Symbol,A=O&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:\"@@toPrimitive\",C=O&&void 0!==Symbol.iterator?Symbol.iterator:\"@@iterator\",w=\"function\"==typeof Object.create,R={__proto__:[]}instanceof Array,S=!w&&!R,M={create:w?function(){return T(Object.create(null))}:R?function(){return T({__proto__:null})}:function(){return T({})},has:S?function(e,t){return N.call(e,t)}:function(e,t){return t in e},get:S?function(e,t){return N.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},j=Object.getPrototypeOf(Function),P=\"object\"==typeof e&&e.env&&\"true\"===e.env.REFLECT_METADATA_USE_MAP_POLYFILL,x=P||\"function\"!=typeof Map||\"function\"!=typeof Map.prototype.entries?function(){function e(e){return e}function t(e,t){return t}function n(e,t){return[e,t]}var r={},i=[],a=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype[\"@@iterator\"]=function(){return this},e.prototype[C]=function(){return this},e.prototype.next=function(){var e=this._index;if(0<=e&&e<this._keys.length){var t=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=i,this._values=i):this._index++,{value:t,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw 0<=this._index&&(this._index=-1,this._keys=i,this._values=i),e},e.prototype.return=function(e){return 0<=this._index&&(this._index=-1,this._keys=i,this._values=i),{value:e,done:!0}},e}();return function(){function i(){this._keys=[],this._values=[],this._cacheKey=r,this._cacheIndex=-2}return Object.defineProperty(i.prototype,\"size\",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),i.prototype.has=function(e){return 0<=this._find(e,!1)},i.prototype.get=function(e){var t=this._find(e,!1);return 0<=t?this._values[t]:void 0},i.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},i.prototype.delete=function(e){var t=this._find(e,!1);if(0<=t){for(var n=this._keys.length,i=t+1;i<n;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=r,this._cacheIndex=-2),!0}return!1},i.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=r,this._cacheIndex=-2},i.prototype.keys=function(){return new a(this._keys,this._values,e)},i.prototype.values=function(){return new a(this._keys,this._values,t)},i.prototype.entries=function(){return new a(this._keys,this._values,n)},i.prototype[\"@@iterator\"]=function(){return this.entries()},i.prototype[C]=function(){return this.entries()},i.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),0>this._cacheIndex&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},i}()}():Map,I=P||\"function\"!=typeof Set||\"function\"!=typeof Set.prototype.entries?function(){function e(){this._map=new x}return Object.defineProperty(e.prototype,\"size\",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype[\"@@iterator\"]=function(){return this.keys()},e.prototype[C]=function(){return this.keys()},e}():Set,_=new(P||\"function\"!=typeof WeakMap?function(){function e(){var e;do{e=\"@@WeakMap@@\"+i()}while(M.has(o,e));return o[e]=!0,e}function t(e,t){if(!N.call(e,s)){if(!t)return;Object.defineProperty(e,s,{value:M.create()})}return e[s]}function n(e,t){for(var n=0;n<t;++n)e[n]=0|255*Math.random();return e}function r(e){return\"function\"==typeof Uint8Array?\"undefined\"==typeof crypto?\"undefined\"==typeof msCrypto?n(new Uint8Array(e),e):msCrypto.getRandomValues(new Uint8Array(e)):crypto.getRandomValues(new Uint8Array(e)):n(Array(e),e)}function i(){var e=r(a);e[6]=64|79&e[6],e[8]=128|191&e[8];for(var t,n=\"\",i=0;i<a;++i)(4===i||6===i||8===i)&&(n+=\"-\"),16>(t=e[i])&&(n+=\"0\"),n+=t.toString(16).toLowerCase();return n}var a=16,o=M.create(),s=e();return function(){function n(){this._key=e()}return n.prototype.has=function(e){var n=t(e,!1);return void 0!==n&&M.has(n,this._key)},n.prototype.get=function(e){var n=t(e,!1);return void 0===n?void 0:M.get(n,this._key)},n.prototype.set=function(e,n){return t(e,!0)[this._key]=n,this},n.prototype.delete=function(e){var n=t(e,!1);return void 0!==n&&delete n[this._key]},n.prototype.clear=function(){this._key=e()},n}()}():WeakMap);t(\"decorate\",function(e,t,n,r){if(!u(n)){if(!d(e))throw new TypeError;if(!l(t))throw new TypeError;if(!l(r)&&!u(r)&&!c(r))throw new TypeError;return c(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;0<=i;--i){var a=(0,e[i])(t,n,r);if(!u(a)&&!c(a)){if(!l(a))throw new TypeError;r=a}}return r}(e,t,n=p(n),r)}if(!d(e))throw new TypeError;if(!m(t))throw new TypeError;return function(e,t){for(var n=e.length-1;0<=n;--n){var r=(0,e[n])(t);if(!u(r)&&!c(r)){if(!m(r))throw new TypeError;t=r}}return t}(e,t)}),t(\"metadata\",function(e,t){return function(n,r){if(!l(n))throw new TypeError;if(!u(r)&&!function(e){switch(s(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;a(e,t,n,r)}}),t(\"defineMetadata\",function(e,t,n,r){if(!l(n))throw new TypeError;return u(r)||(r=p(r)),a(e,t,n,r)}),t(\"hasMetadata\",function(e,t,n){if(!l(t))throw new TypeError;return u(n)||(n=p(n)),function e(t,n,i){if(r(t,n,i))return!0;var a=E(n);return!c(a)&&e(t,a,i)}(e,t,n)}),t(\"hasOwnMetadata\",function(e,t,n){if(!l(t))throw new TypeError;return u(n)||(n=p(n)),r(e,t,n)}),t(\"getMetadata\",function(e,t,n){if(!l(t))throw new TypeError;return u(n)||(n=p(n)),function e(t,n,a){if(r(t,n,a))return i(t,n,a);var o=E(n);return c(o)?void 0:e(t,o,a)}(e,t,n)}),t(\"getOwnMetadata\",function(e,t,n){if(!l(t))throw new TypeError;return u(n)||(n=p(n)),i(e,t,n)}),t(\"getMetadataKeys\",function(e,t){if(!l(e))throw new TypeError;return u(t)||(t=p(t)),function e(t,n){var r=o(t,n),i=E(t);if(null===i)return r;var a=e(i,n);if(0>=a.length)return r;if(0>=r.length)return a;for(var s=new I,u=[],c=0,l=r;c<l.length;c++){var h=l[c];s.has(h)||(s.add(h),u.push(h))}for(var p=0,d=a;p<d.length;p++)h=d[p],s.has(h)||(s.add(h),u.push(h));return u}(e,t)}),t(\"getOwnMetadataKeys\",function(e,t){if(!l(e))throw new TypeError;return u(t)||(t=p(t)),o(e,t)}),t(\"deleteMetadata\",function(e,t,r){if(!l(t))throw new TypeError;u(r)||(r=p(r));var i=n(t,r,!1);if(u(i))return!1;if(!i.delete(e))return!1;if(0<i.size)return!0;var a=_.get(t);return a.delete(r),!!(0<a.size)||(_.delete(t),!0)})})}(n||(n={}))}).call(this,n(69),n(64))},function(e,t,n){function r(){this.init(),this._w=h,u.call(this,64,56)}function i(e){return e<<5|e>>>27}function a(e){return e<<30|e>>>2}function o(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}var s=n(47),u=n(48),c=n(46).Buffer,l=[1518500249,1859775393,-1894007588,-899497514],h=Array(80);s(r,u),r.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},r.prototype._update=function(e){for(var t=this._w,n=0|this._a,r=0|this._b,s=0|this._c,u=0|this._d,c=0|this._e,h=0;16>h;++h)t[h]=e.readInt32BE(4*h);for(;80>h;++h)t[h]=t[h-3]^t[h-8]^t[h-14]^t[h-16];for(var p=0;80>p;++p){var d=~~(p/20),f=0|i(n)+o(d,r,s,u)+c+t[p]+l[d];c=u,u=s,s=a(r),r=n,n=f}this._a=0|n+this._a,this._b=0|r+this._b,this._c=0|s+this._c,this._d=0|u+this._d,this._e=0|c+this._e},r.prototype._hash=function(){var e=c.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=r},function(e,t){\"use strict\";function n(e){var t=e.length;if(0<t%4)throw new Error(\"Invalid string. Length must be a multiple of 4\");var n=e.indexOf(\"=\");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function r(e){return a[63&e>>18]+a[63&e>>12]+a[63&e>>6]+a[63&e]}function i(e,t,n){for(var i,a=[],o=t;o<n;o+=3)i=(16711680&e[o]<<16)+(65280&e[o+1]<<8)+(255&e[o+2]),a.push(r(i));return a.join(\"\")}t.byteLength=function(e){var t=n(e),r=t[0],i=t[1];return 3*(r+i)/4-i},t.toByteArray=function(e){var t,r,i=n(e),a=i[0],u=i[1],c=new s(function(e,t,n){return 3*(t+n)/4-n}(0,a,u)),l=0,h=0<u?a-4:a;for(r=0;r<h;r+=4)t=o[e.charCodeAt(r)]<<18|o[e.charCodeAt(r+1)]<<12|o[e.charCodeAt(r+2)]<<6|o[e.charCodeAt(r+3)],c[l++]=255&t>>16,c[l++]=255&t>>8,c[l++]=255&t;return 2===u&&(t=o[e.charCodeAt(r)]<<2|o[e.charCodeAt(r+1)]>>4,c[l++]=255&t),1===u&&(t=o[e.charCodeAt(r)]<<10|o[e.charCodeAt(r+1)]<<4|o[e.charCodeAt(r+2)]>>2,c[l++]=255&t>>8,c[l++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,o=[],s=16383,u=0,c=n-r;u<c;u+=s)o.push(i(e,u,u+s>c?c:u+s));return 1==r?(t=e[n-1],o.push(a[t>>2]+a[63&t<<4]+\"==\")):2==r&&(t=(e[n-2]<<8)+e[n-1],o.push(a[t>>10]+a[63&t>>4]+a[63&t<<2]+\"=\")),o.join(\"\")};for(var a=[],o=[],s=\"undefined\"==typeof Uint8Array?Array:Uint8Array,u=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",c=0,l=u.length;c<l;++c)a[c]=u[c],o[u.charCodeAt(c)]=c;o[45]=62,o[95]=63},function(e,t){var n=Math.pow;t.read=function(e,t,r,i,a){var o,s,u=8*a-i-1,c=(1<<u)-1,l=c>>1,h=-7,p=r?a-1:0,d=r?-1:1,f=e[t+p];for(p+=d,o=f&(1<<-h)-1,f>>=-h,h+=u;0<h;o=256*o+e[t+p],p+=d,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=i;0<h;s=256*s+e[t+p],p+=d,h-=8);if(0===o)o=1-l;else{if(o===c)return s?NaN:1/0*(f?-1:1);s+=n(2,i),o-=l}return(f?-1:1)*s*n(2,o-i)},t.write=function(e,t,r,i,a,o){var s,u,c,l=8*o-a-1,h=(1<<l)-1,p=h>>1,d=23===a?5.960464477539062e-8:0,f=i?0:o-1,m=i?1:-1,y=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(u=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),1>t*(c=n(2,-s))&&(s--,c*=2),2<=(t+=1<=s+p?d/c:d*n(2,1-p))*c&&(s++,c/=2),s+p>=h?(u=0,s=h):1<=s+p?(u=(t*c-1)*n(2,a),s+=p):(u=t*n(2,p-1)*n(2,a),s=0));8<=a;e[r+f]=255&u,f+=m,u/=256,a-=8);for(s=s<<a|u,l+=a;0<l;e[r+f]=255&s,f+=m,s/=256,l-=8);e[r+f-m]|=128*y}},function(e){e.exports=Array.isArray||function(e){return\"[object Array]\"==Object.prototype.toString.call(e)}},function(e,t,n){function r(){this.init(),this._w=p,c.call(this,64,56)}function i(e){return e<<1|e>>>31}function a(e){return e<<5|e>>>27}function o(e){return e<<30|e>>>2}function s(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}var u=n(47),c=n(48),l=n(46).Buffer,h=[1518500249,1859775393,-1894007588,-899497514],p=Array(80);u(r,c),r.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},r.prototype._update=function(e){for(var t=this._w,n=0|this._a,r=0|this._b,u=0|this._c,c=0|this._d,l=0|this._e,p=0;16>p;++p)t[p]=e.readInt32BE(4*p);for(;80>p;++p)t[p]=i(t[p-3]^t[p-8]^t[p-14]^t[p-16]);for(var d=0;80>d;++d){var f=~~(d/20),m=0|a(n)+s(f,r,u,c)+l+t[d]+h[f];l=c,c=u,u=o(r),r=n,n=m}this._a=0|n+this._a,this._b=0|r+this._b,this._c=0|u+this._c,this._d=0|c+this._d,this._e=0|l+this._e},r.prototype._hash=function(){var e=l.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=r},function(e,t,n){function r(){this.init(),this._w=u,o.call(this,64,56)}var i=n(47),a=n(70),o=n(48),s=n(46).Buffer,u=Array(64);i(r,a),r.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},r.prototype._hash=function(){var e=s.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=r},function(e,t,n){function r(){this.init(),this._w=u,o.call(this,128,112)}var i=n(47),a=n(71),o=n(48),s=n(46).Buffer,u=Array(160);i(r,a),r.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},r.prototype._hash=function(){function e(e,n,r){t.writeInt32BE(e,r),t.writeInt32BE(n,r+4)}var t=s.allocUnsafe(48);return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),t},e.exports=r},function(e,t,n){function r(e){function n(){if(n.enabled){var e=n,r=+new Date,a=r-(i||r);e.diff=a,e.prev=i,e.curr=r,i=r;for(var o=Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=t.coerce(o[0]),\"string\"!=typeof o[0]&&o.unshift(\"%O\");var u=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(n,r){if(\"%%\"===n)return n;u++;var i=t.formatters[r];if(\"function\"==typeof i){var a=o[u];n=i.call(e,a),o.splice(u,1),u--}return n}),t.formatArgs.call(e,o),(n.log||t.log||console.log.bind(console)).apply(e,o)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),\"function\"==typeof t.init&&t.init(n),n}var i;(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable(\"\")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=(\"string\"==typeof e?e:\"\").split(/[\\s,]+/),r=n.length,i=0;i<r;i++)n[i]&&(\"-\"===(e=n[i].replace(/\\*/g,\".*?\"))[0]?t.skips.push(new RegExp(\"^\"+e.substr(1)+\"$\")):t.names.push(new RegExp(\"^\"+e+\"$\")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(91),t.names=[],t.skips=[],t.formatters={}},function(e){function t(e){var t=a(e);return t>=c?i(e/c)+\"d\":t>=u?i(e/u)+\"h\":t>=s?i(e/s)+\"m\":t>=o?i(e/o)+\"s\":e+\"ms\"}function n(e){var t=a(e);return t>=c?r(e,t,c,\"day\"):t>=u?r(e,t,u,\"hour\"):t>=s?r(e,t,s,\"minute\"):t>=o?r(e,t,o,\"second\"):e+\" ms\"}function r(e,t,n,r){return i(e/n)+\" \"+r+(t>=1.5*n?\"s\":\"\")}var i=Math.round,a=Math.abs,o=1e3,s=60*o,u=60*s,c=24*u,l=7*c,h=365.25*c;e.exports=function(e,r){r=r||{};var i=typeof e;if(\"string\"==i&&0<e.length)return function(e){if(!(100<(e+=\"\").length)){var t=/^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),r=(t[2]||\"ms\").toLowerCase();return\"years\"===r||\"year\"===r||\"yrs\"===r||\"yr\"===r||\"y\"===r?n*h:\"weeks\"===r||\"week\"===r||\"w\"===r?n*l:\"days\"===r||\"day\"===r||\"d\"===r?n*c:\"hours\"===r||\"hour\"===r||\"hrs\"===r||\"hr\"===r||\"h\"===r?n*u:\"minutes\"===r||\"minute\"===r||\"mins\"===r||\"min\"===r||\"m\"===r?n*s:\"seconds\"===r||\"second\"===r||\"secs\"===r||\"sec\"===r||\"s\"===r?n*o:\"milliseconds\"===r||\"millisecond\"===r||\"msecs\"===r||\"msec\"===r||\"ms\"===r?n:void 0}}}(e);if(\"number\"==i&&isFinite(e))return r.long?n(e):t(e);throw new Error(\"val is not a non-empty string or a valid number. val=\"+JSON.stringify(e))}}]);","extractedComments":[]}